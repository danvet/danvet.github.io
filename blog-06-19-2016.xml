<?xml version='1.0' encoding='UTF-8'?><?xml-stylesheet href="https://www.blogger.com/styles/atom.css" type="text/css"?><feed xmlns='http://www.w3.org/2005/Atom' xmlns:openSearch='http://a9.com/-/spec/opensearchrss/1.0/' xmlns:gd='http://schemas.google.com/g/2005' xmlns:thr='http://purl.org/syndication/thread/1.0' xmlns:georss='http://www.georss.org/georss'><id>tag:blogger.com,1999:blog-8047628228132312466.archive</id><updated>2016-06-19T06:04:16.842-07:00</updated><title type='text'>stuff by danvet</title><link rel='http://schemas.google.com/g/2005#feed' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/archive'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/archive'/><link rel='http://schemas.google.com/g/2005#post' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/archive'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><generator version='7.00' uri='https://www.blogger.com'>Blogger</generator><entry><id>tag:blogger.com,1999:blog-8047628228132312466.layout</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#template'/><title type='text'>Template: stuff by danvet</title><content type='text'>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE html&gt;
&lt;html b:version='2' class='v2' expr:dir='data:blog.languageDirection' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'&gt;
  &lt;head&gt;
    &lt;meta expr:content='data:blog.isMobile         ? &amp;quot;width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0&amp;quot;         : &amp;quot;width=1100&amp;quot;' name='viewport'/&gt;
    &lt;b:include data='blog' name='all-head-content'/&gt;
    &lt;title&gt;&lt;data:blog.pageTitle/&gt;&lt;/title&gt;

    &lt;b:skin&gt;&lt;![CDATA[/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Josh Peterson
URL:      www.noaesthetic.com
----------------------------------------------- */

/* Variable definitions
   ====================
   &lt;Variable name="keycolor" description="Main Color" type="color" default="#66bbdd" value="#ffffff"/&gt;

   &lt;Group description="Page Text" selector="body"&gt;
     &lt;Variable name="body.font" description="Font" type="font"
         default="normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif"/&gt;
     &lt;Variable name="body.text.color" description="Text Color" type="color" default="#222222" value="#666666"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Backgrounds" selector=".body-fauxcolumns-outer"&gt;
     &lt;Variable name="body.background.color" description="Outer Background" type="color" default="#66bbdd" value="#ffffff"/&gt;
     &lt;Variable name="content.background.color" description="Main Background" type="color" default="#ffffff" value="#ffffff"/&gt;
     &lt;Variable name="header.background.color" description="Header Background" type="color" default="transparent" value="transparent"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Links" selector=".main-outer"&gt;
     &lt;Variable name="link.color" description="Link Color" type="color" default="#2288bb" value="#2288bb"/&gt;
     &lt;Variable name="link.visited.color" description="Visited Color" type="color" default="#888888" value="#888888"/&gt;
     &lt;Variable name="link.hover.color" description="Hover Color" type="color" default="#33aaff" value="#33aaff"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Blog Title" selector=".header h1"&gt;
     &lt;Variable name="header.font" description="Font" type="font"
         default="normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 40px 'Trebuchet MS',Trebuchet,Verdana,sans-serif"/&gt;
     &lt;Variable name="header.text.color" description="Title Color" type="color" default="#3399bb"  value="#000000"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Blog Description" selector=".header .description"&gt;
     &lt;Variable name="description.text.color" description="Description Color" type="color"
         default="#777777"  value="#000000"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Tabs Text" selector=".tabs-inner .widget li a"&gt;
     &lt;Variable name="tabs.font" description="Font" type="font"
         default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 12px 'Trebuchet MS', Trebuchet, Verdana, sans-serif"/&gt;
     &lt;Variable name="tabs.text.color" description="Text Color" type="color" default="#999999" value="#000000"/&gt;
     &lt;Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#000000" value="#000000"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Tabs Background" selector=".tabs-outer .PageList"&gt;
     &lt;Variable name="tabs.background.color" description="Background Color" type="color" default="#f5f5f5" value="transparent"/&gt;
     &lt;Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#eeeeee" value="#eeeeee"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Post Title" selector="h3.post-title, .comments h4"&gt;
     &lt;Variable name="post.title.font" description="Font" type="font"
         default="normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal normal 22px 'Trebuchet MS',Trebuchet,Verdana,sans-serif"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Date Header" selector=".date-header"&gt;
     &lt;Variable name="date.header.color" description="Text Color" type="color"
         default="$(body.text.color)" value="#ffffff"/&gt;
     &lt;Variable name="date.header.background.color" description="Background Color" type="color"
         default="transparent" value="#bbbbbb"/&gt;
     &lt;Variable name="date.header.font" description="Text Font" type="font"
         default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/&gt;
     &lt;Variable name="date.header.padding" description="Date Header Padding" type="string" default="inherit" value="0.4em"/&gt;
     &lt;Variable name="date.header.letterspacing" description="Date Header Letter Spacing" type="string" default="inherit" value="3px"/&gt;
     &lt;Variable name="date.header.margin" description="Date Header Margin" type="string" default="inherit" value="inherit"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Post Footer" selector=".post-footer"&gt;
     &lt;Variable name="post.footer.text.color" description="Text Color" type="color" default="#666666" value="#666666"/&gt;
     &lt;Variable name="post.footer.background.color" description="Background Color" type="color"
         default="#f9f9f9" value="#eeeeee"/&gt;
     &lt;Variable name="post.footer.border.color" description="Shadow Color" type="color" default="#eeeeee" value="#eeeeee"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Gadgets" selector="h2"&gt;
     &lt;Variable name="widget.title.font" description="Title Font" type="font"
         default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif" value="normal bold 11px 'Trebuchet MS',Trebuchet,Verdana,sans-serif"/&gt;
     &lt;Variable name="widget.title.text.color" description="Title Color" type="color" default="#000000" value="#000000"/&gt;
     &lt;Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#999999" value="#999999"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Images" selector=".main-inner"&gt;
     &lt;Variable name="image.background.color" description="Background Color" type="color" default="#ffffff" value="#ffffff"/&gt;
     &lt;Variable name="image.border.color" description="Border Color" type="color" default="#eeeeee" value="#eeeeee"/&gt;
     &lt;Variable name="image.text.color" description="Caption Text Color" type="color" default="$(body.text.color)" value="#666666"/&gt;
   &lt;/Group&gt;

   &lt;Group description="Accents" selector=".content-inner"&gt;
     &lt;Variable name="body.rule.color" description="Separator Line Color" type="color" default="#eeeeee" value="transparent"/&gt;
     &lt;Variable name="tabs.border.color" description="Tabs Border Color" type="color" default="$(body.rule.color)" value="#dddddd"/&gt;
   &lt;/Group&gt;

   &lt;Variable name="body.background" description="Body Background" type="background"
       color="$(body.background.color)" default="$(color) none repeat scroll top left" value="$(color) none repeat scroll top left"/&gt;
   &lt;Variable name="body.background.override" description="Body Background Override" type="string" default="" value=""/&gt;

   &lt;Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
       default="url(https://www.blogblog.com/1kt/simple/gradients_light.png)" value="none"/&gt;
   &lt;Variable name="body.background.gradient.tile" description="Body Gradient Tile" type="url"
       default="url(https://www.blogblog.com/1kt/simple/body_gradient_tile_light.png)" value="none"/&gt;

   &lt;Variable name="content.background.color.selector" description="Content Background Color Selector" type="string" default=".content-inner" value=".content-inner"/&gt;
   &lt;Variable name="content.padding" description="Content Padding" type="length" default="10px" min="0" max="100px" value="10px"/&gt;
   &lt;Variable name="content.padding.horizontal" description="Content Horizontal Padding" type="length" default="$(content.padding)" min="0" max="100px" value="40px"/&gt;
   &lt;Variable name="content.shadow.spread" description="Content Shadow Spread" type="length" default="40px" min="0" max="100px" value="0"/&gt;
   &lt;Variable name="content.shadow.spread.webkit" description="Content Shadow Spread (WebKit)" type="length" default="5px" min="0" max="100px" value="0"/&gt;
   &lt;Variable name="content.shadow.spread.ie" description="Content Shadow Spread (IE)" type="length" default="10px" min="0" max="100px" value="0"/&gt;

   &lt;Variable name="main.border.width" description="Main Border Width" type="length" default="0" min="0" max="10px" value="0"/&gt;

   &lt;Variable name="header.background.gradient" description="Header Gradient" type="url" default="none" value="none"/&gt;
   &lt;Variable name="header.shadow.offset.left" description="Header Shadow Offset Left" type="length" default="-1px" min="-50px" max="50px" value="0"/&gt;
   &lt;Variable name="header.shadow.offset.top" description="Header Shadow Offset Top" type="length" default="-1px" min="-50px" max="50px" value="0"/&gt;
   &lt;Variable name="header.shadow.spread" description="Header Shadow Spread" type="length" default="1px" min="0" max="100px" value="0"/&gt;
   &lt;Variable name="header.padding" description="Header Padding" type="length" default="30px" min="0" max="100px" value="0"/&gt;

   &lt;Variable name="header.border.size" description="Header Border Size" type="length" default="1px" min="0" max="10px" value="1px"/&gt;
   &lt;Variable name="header.bottom.border.size" description="Header Bottom Border Size" type="length" default="$(header.border.size)" min="0" max="10px" value="0"/&gt;
   &lt;Variable name="header.border.horizontalsize" description="Header Horizontal Border Size" type="length" default="0" min="0" max="10px" value="1px"/&gt;

   &lt;Variable name="description.text.size" description="Description Text Size" type="string" default="140%" value="18px"/&gt;

   &lt;Variable name="tabs.margin.top" description="Tabs Margin Top" type="length" default="0" min="0" max="100px" value="0"/&gt;
   &lt;Variable name="tabs.margin.side" description="Tabs Side Margin" type="length" default="30px" min="0" max="100px" value="30px"/&gt;
   &lt;Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
       default="url(https://www.blogblog.com/1kt/simple/gradients_light.png)" value="none"/&gt;
   &lt;Variable name="tabs.border.width" description="Tabs Border Width" type="length" default="1px" min="0" max="10px" value="1px"/&gt;
   &lt;Variable name="tabs.bevel.border.width" description="Tabs Bevel Border Width" type="length" default="1px" min="0" max="10px" value="1px"/&gt;

   &lt;Variable name="post.margin.bottom" description="Post Bottom Margin" type="length" default="25px" min="0" max="100px" value="45px"/&gt;

   &lt;Variable name="image.border.small.size" description="Image Border Small Size" type="length" default="2px" min="0" max="10px" value="2px"/&gt;
   &lt;Variable name="image.border.large.size" description="Image Border Large Size" type="length" default="5px" min="0" max="10px" value="5px"/&gt;

   &lt;Variable name="page.width.selector" description="Page Width Selector" type="string" default=".region-inner" value=".region-inner"/&gt;
   &lt;Variable name="page.width" description="Page Width" type="string" default="auto" value="auto"/&gt;

   &lt;Variable name="main.section.margin" description="Main Section Margin" type="length" default="15px" min="0" max="100px" value="1em"/&gt;
   &lt;Variable name="main.padding" description="Main Padding" type="length" default="15px" min="0" max="100px" value="0"/&gt;
   &lt;Variable name="main.padding.top" description="Main Padding Top" type="length" default="30px" min="0" max="100px" value="35px"/&gt;
   &lt;Variable name="main.padding.bottom" description="Main Padding Bottom" type="length" default="30px" min="0" max="100px" value="65px"/&gt;

   &lt;Variable name="paging.background"
       color="$(content.background.color)"
       description="Background of blog paging area" type="background"
       default="transparent none no-repeat scroll top center" value="transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center"/&gt;

   &lt;Variable name="footer.bevel" description="Bevel border length of footer" type="length" default="0" min="0" max="10px" value="1px"/&gt;

   &lt;Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
       default="transparent none repeat scroll top left" value="transparent none repeat scroll top left"/&gt;
   &lt;Variable name="mobile.background.size" description="Mobile Background Size" type="string" default="auto" value="auto"/&gt;
   &lt;Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff"  value="#ffffff"/&gt;

   &lt;Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left" value="left"/&gt;
   &lt;Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right" value="right"/&gt;
*/

/* Content
----------------------------------------------- */
body {
  font: $(body.font);
  color: $(body.text.color);
  background: $(body.background);
  padding: 0 $(content.shadow.spread) $(content.shadow.spread) $(content.shadow.spread);
  $(body.background.override)
}

html body $(page.width.selector) {
  min-width: 0;
  max-width: 100%;
  width: $(page.width);
}

h2 {
  font-size: 22px;
}

a:link {
  text-decoration:none;
  color: $(link.color);
}

a:visited {
  text-decoration:none;
  color: $(link.visited.color);
}

a:hover {
  text-decoration:underline;
  color: $(link.hover.color);
}

.body-fauxcolumn-outer .fauxcolumn-inner {
  background: transparent $(body.background.gradient.tile) repeat scroll top left;
  _background-image: none;
}

.body-fauxcolumn-outer .cap-top {
  position: absolute;
  z-index: 1;
  height: 400px;
  width: 100%;
}

.body-fauxcolumn-outer .cap-top .cap-left {
  width: 100%;
  background: transparent $(body.background.gradient.cap) repeat-x scroll top left;
  _background-image: none;
}

.content-outer {
  -moz-box-shadow: 0 0 $(content.shadow.spread) rgba(0, 0, 0, .15);
  -webkit-box-shadow: 0 0 $(content.shadow.spread.webkit) rgba(0, 0, 0, .15);
  -goog-ms-box-shadow: 0 0 $(content.shadow.spread.ie) #333333;
  box-shadow: 0 0 $(content.shadow.spread) rgba(0, 0, 0, .15);

  margin-bottom: 1px;
}

.content-inner {
  padding: $(content.padding) $(content.padding.horizontal);
}

$(content.background.color.selector) {
  background-color: $(content.background.color);
}

/* Header
----------------------------------------------- */
.header-outer {
  background: $(header.background.color) $(header.background.gradient) repeat-x scroll 0 -400px;
  _background-image: none;
}

.Header h1 {
  font: $(header.font);
  color: $(header.text.color);
  text-shadow: $(header.shadow.offset.left) $(header.shadow.offset.top) $(header.shadow.spread) rgba(0, 0, 0, .2);
}

.Header h1 a {
  color: $(header.text.color);
}

.Header .description {
  font-size: $(description.text.size);
  color: $(description.text.color);
}

.header-inner .Header .titlewrapper {
  padding: 22px $(header.padding);
}

.header-inner .Header .descriptionwrapper {
  padding: 0 $(header.padding);
}

/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
  border-top: $(header.bottom.border.size) solid $(tabs.border.color);
}

.tabs-inner .section:first-child ul {
  margin-top: -$(header.border.size);
  border-top: $(header.border.size) solid $(tabs.border.color);
  border-left: $(header.border.horizontalsize) solid $(tabs.border.color);
  border-right: $(header.border.horizontalsize) solid $(tabs.border.color);
}

.tabs-inner .widget ul {
  background: $(tabs.background.color) $(tabs.background.gradient) repeat-x scroll 0 -800px;
  _background-image: none;
  border-bottom: $(tabs.border.width) solid $(tabs.border.color);

  margin-top: $(tabs.margin.top);
  margin-left: -$(tabs.margin.side);
  margin-right: -$(tabs.margin.side);
}

.tabs-inner .widget li a {
  display: inline-block;

  padding: .6em 1em;

  font: $(tabs.font);
  color: $(tabs.text.color);

  border-$startSide: $(tabs.border.width) solid $(content.background.color);
  border-$endSide: $(tabs.bevel.border.width) solid $(tabs.border.color);
}

.tabs-inner .widget li:first-child a {
  border-$startSide: none;
}

.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
  color: $(tabs.selected.text.color);
  background-color: $(tabs.selected.background.color);
  text-decoration: none;
}

/* Columns
----------------------------------------------- */
.main-outer {
  border-top: $(main.border.width) solid $(body.rule.color);
}

.fauxcolumn-left-outer .fauxcolumn-inner {
  border-right: 1px solid $(body.rule.color);
}

.fauxcolumn-right-outer .fauxcolumn-inner {
  border-left: 1px solid $(body.rule.color);
}

/* Headings
----------------------------------------------- */
div.widget &gt; h2,
div.widget h2.title {
  margin: 0 0 1em 0;

  font: $(widget.title.font);
  color: $(widget.title.text.color);
}

/* Widgets
----------------------------------------------- */
.widget .zippy {
  color: $(widget.alternate.text.color);
  text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}

.widget .popular-posts ul {
  list-style: none;
}

/* Posts
----------------------------------------------- */
h2.date-header {
  font: $(date.header.font);
}

.date-header span {
  background-color: $(date.header.background.color);
  color: $(date.header.color);
  padding: $(date.header.padding);
  letter-spacing: $(date.header.letterspacing);
  margin: $(date.header.margin);
}

.main-inner {
  padding-top: $(main.padding.top);
  padding-bottom: $(main.padding.bottom);
}

.main-inner .column-center-inner {
  padding: 0 $(main.padding);
}

.main-inner .column-center-inner .section {
  margin: 0 $(main.section.margin);
}

.post {
  margin: 0 0 $(post.margin.bottom) 0;
}

h3.post-title, .comments h4 {
  font: $(post.title.font);
  margin: .75em 0 0;
}

.post-body {
  font-size: 110%;
  line-height: 1.4;
  position: relative;
}

.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
  padding: $(image.border.small.size);

  background: $(image.background.color);
  border: 1px solid $(image.border.color);

  -moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
  -webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
  box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}

.post-body img, .post-body .tr-caption-container {
  padding: $(image.border.large.size);
}

.post-body .tr-caption-container {
  color: $(image.text.color);
}

.post-body .tr-caption-container img {
  padding: 0;

  background: transparent;
  border: none;

  -moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
  -webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
  box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}

.post-header {
  margin: 0 0 1.5em;

  line-height: 1.6;
  font-size: 90%;
}

.post-footer {
  margin: 20px -2px 0;
  padding: 5px 10px;

  color: $(post.footer.text.color);
  background-color: $(post.footer.background.color);
  border-bottom: 1px solid $(post.footer.border.color);

  line-height: 1.6;
  font-size: 90%;
}

#comments .comment-author {
  padding-top: 1.5em;

  border-top: 1px solid $(body.rule.color);
  background-position: 0 1.5em;
}

#comments .comment-author:first-child {
  padding-top: 0;
  border-top: none;
}

.avatar-image-container {
  margin: .2em 0 0;
}

#comments .avatar-image-container img {
  border: 1px solid $(image.border.color);
}

/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
  background-repeat: no-repeat;
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}

.comments .comments-content .loadmore a {
  border-top: 1px solid $(widget.alternate.text.color);
  border-bottom: 1px solid $(widget.alternate.text.color);
}

.comments .comment-thread.inline-thread {
  background-color: $(post.footer.background.color);
}

.comments .continue {
  border-top: 2px solid $(widget.alternate.text.color);
}

/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
  border-$startSide: 1px solid $(body.rule.color);
}

.blog-pager {
  background: $(paging.background);
}

.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
  background-color: $(content.background.color);
  padding: 5px;
}

.footer-outer {
  border-top: $(footer.bevel) dashed #bbbbbb;
}

/* Mobile
----------------------------------------------- */
body.mobile  {
  background-size: $(mobile.background.size);
}

.mobile .body-fauxcolumn-outer {
  background: $(mobile.background.overlay);
}

.mobile .body-fauxcolumn-outer .cap-top {
  background-size: 100% auto;
}

.mobile .content-outer {
  -webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
  box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}

.mobile .tabs-inner .widget ul {
  margin-left: 0;
  margin-right: 0;
}

.mobile .post {
  margin: 0;
}

.mobile .main-inner .column-center-inner .section {
  margin: 0;
}

.mobile .date-header span {
  padding: 0.1em 10px;
  margin: 0 -10px;
}

.mobile h3.post-title {
  margin: 0;
}

.mobile .blog-pager {
  background: transparent none no-repeat scroll top center;
}

.mobile .footer-outer {
  border-top: none;
}

.mobile .main-inner, .mobile .footer-inner {
  background-color: $(content.background.color);
}

.mobile-index-contents {
  color: $(body.text.color);
}

.mobile-link-button {
  background-color: $(link.color);
}

.mobile-link-button a:link, .mobile-link-button a:visited {
  color: $(mobile.button.color);
}

.mobile .tabs-inner .section:first-child {
  border-top: none;
}

.mobile .tabs-inner .PageList .widget-content {
  background-color: $(tabs.selected.background.color);
  color: $(tabs.selected.text.color);
  border-top: $(tabs.border.width) solid $(tabs.border.color);
  border-bottom: $(tabs.border.width) solid $(tabs.border.color);
}

.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
  border-$startSide: 1px solid $(tabs.border.color);
}
]]&gt;&lt;/b:skin&gt;

    &lt;b:template-skin&gt;
      &lt;b:variable default='960px' name='content.width' type='length'/&gt;
      &lt;b:variable default='0' name='main.column.left.width' type='length'/&gt;
      &lt;b:variable default='310px' name='main.column.right.width' type='length'/&gt;

      &lt;![CDATA[
      body {
        min-width: $(content.width);
      }

      .content-outer, .content-fauxcolumn-outer, .region-inner {
        min-width: $(content.width);
        max-width: $(content.width);
        _width: $(content.width);
      }

      .main-inner .columns {
        padding-left: $(main.column.left.width);
        padding-right: $(main.column.right.width);
      }

      .main-inner .fauxcolumn-center-outer {
        left: $(main.column.left.width);
        right: $(main.column.right.width);
        /* IE6 does not respect left and right together */
        _width: expression(this.parentNode.offsetWidth -
            parseInt("$(main.column.left.width)") -
            parseInt("$(main.column.right.width)") + 'px');
      }

      .main-inner .fauxcolumn-left-outer {
        width: $(main.column.left.width);
      }

      .main-inner .fauxcolumn-right-outer {
        width: $(main.column.right.width);
      }

      .main-inner .column-left-outer {
        width: $(main.column.left.width);
        right: 100%;
        margin-left: -$(main.column.left.width);
      }

      .main-inner .column-right-outer {
        width: $(main.column.right.width);
        margin-right: -$(main.column.right.width);
      }

      #layout {
        min-width: 0;
      }

      #layout .content-outer {
        min-width: 0;
        width: 800px;
      }

      #layout .region-inner {
        min-width: 0;
        width: auto;
      }

      body#layout div.add_widget {
        padding: 8px;
      }

      body#layout div.add_widget a {
        margin-left: 32px;
      }
      ]]&gt;
    &lt;/b:template-skin&gt;

    &lt;b:if cond='data:skin.vars.body_background.image and data:features.responsiveBackgrounds'&gt;
      &lt;b:with value='&amp;quot;body&amp;quot;' var='selector'&gt;
        &lt;b:include cond='not data:view.isPreview' data='skin.vars.body_background.image' name='responsiveImageStyle'/&gt;
      &lt;/b:with&gt;
    &lt;/b:if&gt;

    &lt;b:include data='blog' name='google-analytics'/&gt;
  &lt;/head&gt;

  &lt;body expr:class='&amp;quot;loading&amp;quot; + data:blog.mobileClass'&gt;
  &lt;b:section class='navbar' id='navbar' maxwidgets='1' name='Navbar' showaddelement='no'&gt;
    &lt;b:widget id='Navbar1' locked='true' title='Navbar' type='Navbar' visible='true'&gt;
      &lt;b:includable id='main'&gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener(&amp;#39;load&amp;#39;,
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent(&amp;#39;onload&amp;#39;, function(){ object[attribute] = val; });
      }
    }
  &amp;lt;/script&amp;gt;
&amp;lt;div id=&amp;quot;navbar-iframe-container&amp;quot;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;https://apis.google.com/js/plusone.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
      gapi.load(&amp;quot;gapi.iframes:gapi.iframes.style.bubble&amp;quot;, function() {
        if (gapi.iframes &amp;amp;&amp;amp; gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: &amp;#39;https://www.blogger.com/navbar.g?targetBlogID\x3d8047628228132312466\x26blogName\x3dstuff+by+danvet\x26publishMode\x3dPUBLISH_MODE_HOSTED\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttp://blog.ffwll.ch/search\x26blogLocale\x3den\x26v\x3d2\x26homepageUrl\x3dhttp://blog.ffwll.ch/\x26vt\x3d9041764273983924058&amp;#39;,
              where: document.getElementById(&amp;quot;navbar-iframe-container&amp;quot;),
              id: &amp;quot;navbar-iframe&amp;quot;
          });
        }
      });
    &amp;lt;/script&amp;gt;&amp;lt;script type=&amp;quot;text/javascript&amp;quot;&amp;gt;
(function() {
var script = document.createElement(&amp;#39;script&amp;#39;);
script.type = &amp;#39;text/javascript&amp;#39;;
script.src = &amp;#39;//pagead2.googlesyndication.com/pagead/js/google_top_exp.js&amp;#39;;
var head = document.getElementsByTagName(&amp;#39;head&amp;#39;)[0];
if (head) {
head.appendChild(script);
}})();
&amp;lt;/script&amp;gt;
&lt;/b:includable&gt;
    &lt;/b:widget&gt;
  &lt;/b:section&gt;

  &lt;b:if cond='data:blog.pageType == &amp;quot;index&amp;quot;'&gt;
    &lt;div itemscope='itemscope' itemtype='http://schema.org/Blog' style='display: none;'&gt;
      &lt;meta expr:content='data:blog.title' itemprop='name'/&gt;
      &lt;b:if cond='data:blog.metaDescription'&gt;
        &lt;meta expr:content='data:blog.metaDescription' itemprop='description'/&gt;
      &lt;/b:if&gt;
    &lt;/div&gt;
  &lt;/b:if&gt;

  &lt;div class='body-fauxcolumns'&gt;
    &lt;div class='fauxcolumn-outer body-fauxcolumn-outer'&gt;
    &lt;div class='cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;div class='fauxborder-left'&gt;
    &lt;div class='fauxborder-right'/&gt;
    &lt;div class='fauxcolumn-inner'&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class='content'&gt;
  &lt;div class='content-fauxcolumns'&gt;
    &lt;div class='fauxcolumn-outer content-fauxcolumn-outer'&gt;
    &lt;div class='cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;div class='fauxborder-left'&gt;
    &lt;div class='fauxborder-right'/&gt;
    &lt;div class='fauxcolumn-inner'&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class='content-outer'&gt;
  &lt;div class='content-cap-top cap-top'&gt;
    &lt;div class='cap-left'/&gt;
    &lt;div class='cap-right'/&gt;
  &lt;/div&gt;
  &lt;div class='fauxborder-left content-fauxborder-left'&gt;
  &lt;div class='fauxborder-right content-fauxborder-right'/&gt;
  &lt;div class='content-inner'&gt;

    &lt;header&gt;
    &lt;div class='header-outer'&gt;
    &lt;div class='header-cap-top cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;div class='fauxborder-left header-fauxborder-left'&gt;
    &lt;div class='fauxborder-right header-fauxborder-right'/&gt;
    &lt;div class='region-inner header-inner'&gt;
      &lt;b:section class='header' id='header' maxwidgets='1' name='Header' showaddelement='no'&gt;
        &lt;b:widget id='Header1' locked='true' title='stuff by danvet (Header)' type='Header' visible='true'&gt;
          &lt;b:includable id='main'&gt;

  &lt;b:if cond='data:useImage'&gt;
    &lt;b:if cond='data:imagePlacement == &amp;quot;BEHIND&amp;quot;'&gt;
      &lt;!--
      Show image as background to text. You can't really calculate the width
      reliably in JS because margins are not taken into account by any of
      clientWidth, offsetWidth or scrollWidth, so we don't force a minimum
      width if the user is using shrink to fit.
      This results in a margin-width's worth of pixels being cropped. If the
      user is not using shrink to fit then we expand the header.
      --&gt;
      &lt;b:if cond='data:mobile'&gt;
        &lt;div id='header-inner'&gt;
          &lt;div class='titlewrapper' style='background: transparent'&gt;
            &lt;h1 class='title' style='background: transparent; border-width: 0px'&gt;
              &lt;b:include name='title'/&gt;
            &lt;/h1&gt;
          &lt;/div&gt;
          &lt;b:include name='description'/&gt;
        &lt;/div&gt;
      &lt;b:else/&gt;
        &lt;div expr:style='&amp;quot;background-image: url(\&amp;quot;&amp;quot; + data:sourceUrl + &amp;quot;\&amp;quot;); &amp;quot;                      + &amp;quot;background-position: &amp;quot;                      + data:backgroundPositionStyleStr + &amp;quot;; &amp;quot;                      + data:widthStyleStr                      + &amp;quot;min-height: &amp;quot; + data:height                      + &amp;quot;_height: &amp;quot; + data:height                      + &amp;quot;background-repeat: no-repeat; &amp;quot;' id='header-inner'&gt;
          &lt;div class='titlewrapper' style='background: transparent'&gt;
            &lt;h1 class='title' style='background: transparent; border-width: 0px'&gt;
              &lt;b:include name='title'/&gt;
            &lt;/h1&gt;
          &lt;/div&gt;
          &lt;b:include name='description'/&gt;
        &lt;/div&gt;
      &lt;/b:if&gt;
    &lt;b:else/&gt;
      &lt;!--Show the image only--&gt;
      &lt;div id='header-inner'&gt;
        &lt;a expr:href='data:blog.homepageUrl' style='display: block'&gt;
          &lt;img expr:alt='data:title' expr:height='data:height' expr:id='data:widget.instanceId + &amp;quot;_headerimg&amp;quot;' expr:src='data:sourceUrl' expr:width='data:width' style='display: block'/&gt;
        &lt;/a&gt;
        &lt;!--Show the description--&gt;
        &lt;b:if cond='data:imagePlacement == &amp;quot;BEFORE_DESCRIPTION&amp;quot;'&gt;
          &lt;b:include name='description'/&gt;
        &lt;/b:if&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;
  &lt;b:else/&gt;
    &lt;!--No header image --&gt;
    &lt;div id='header-inner'&gt;
      &lt;div class='titlewrapper'&gt;
        &lt;h1 class='title'&gt;
          &lt;b:include name='title'/&gt;
        &lt;/h1&gt;
      &lt;/div&gt;
      &lt;b:include name='description'/&gt;
    &lt;/div&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
          &lt;b:includable id='description'&gt;
  &lt;div class='descriptionwrapper'&gt;
    &lt;p class='description'&gt;&lt;span&gt;&lt;data:description/&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
          &lt;b:includable id='title'&gt;
  &lt;b:if cond='data:blog.url == data:blog.homepageUrl'&gt;
    &lt;data:title/&gt;
  &lt;b:else/&gt;
    &lt;a expr:href='data:blog.homepageUrl'&gt;&lt;data:title/&gt;&lt;/a&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
        &lt;/b:widget&gt;
      &lt;/b:section&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='header-cap-bottom cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;/header&gt;

    &lt;div class='tabs-outer'&gt;
    &lt;div class='tabs-cap-top cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;div class='fauxborder-left tabs-fauxborder-left'&gt;
    &lt;div class='fauxborder-right tabs-fauxborder-right'/&gt;
    &lt;div class='region-inner tabs-inner'&gt;
      &lt;b:section class='tabs' id='crosscol' maxwidgets='1' name='Cross-Column' showaddelement='yes'/&gt;
      &lt;b:section class='tabs' id='crosscol-overflow' name='Cross-Column 2' showaddelement='no'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='tabs-cap-bottom cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class='main-outer'&gt;
    &lt;div class='main-cap-top cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;

    &lt;div class='fauxborder-left main-fauxborder-left'&gt;
    &lt;div class='fauxborder-right main-fauxborder-right'/&gt;
    &lt;div class='region-inner main-inner'&gt;

      &lt;div class='columns fauxcolumns'&gt;

        &lt;div class='fauxcolumn-outer fauxcolumn-center-outer'&gt;
        &lt;div class='cap-top'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;div class='fauxborder-left'&gt;
        &lt;div class='fauxborder-right'/&gt;
        &lt;div class='fauxcolumn-inner'&gt;
        &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class='cap-bottom'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='fauxcolumn-outer fauxcolumn-left-outer'&gt;
        &lt;div class='cap-top'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;div class='fauxborder-left'&gt;
        &lt;div class='fauxborder-right'/&gt;
        &lt;div class='fauxcolumn-inner'&gt;
        &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class='cap-bottom'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='fauxcolumn-outer fauxcolumn-right-outer'&gt;
        &lt;div class='cap-top'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;div class='fauxborder-left'&gt;
        &lt;div class='fauxborder-right'/&gt;
        &lt;div class='fauxcolumn-inner'&gt;
        &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class='cap-bottom'&gt;
          &lt;div class='cap-left'/&gt;
          &lt;div class='cap-right'/&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;!-- corrects IE6 width calculation --&gt;
        &lt;div class='columns-inner'&gt;

        &lt;div class='column-center-outer'&gt;
        &lt;div class='column-center-inner'&gt;
          &lt;b:section class='main' id='main' name='Main' showaddelement='no'&gt;
            &lt;b:widget id='Blog1' locked='true' title='Blog Posts' type='Blog' visible='true'&gt;
              &lt;b:includable id='main' var='top'&gt;
  &lt;b:if cond='!data:mobile'&gt;
    &lt;!-- posts --&gt;
    &lt;div class='blog-posts hfeed'&gt;

      &lt;b:include data='top' name='status-message'/&gt;

      &lt;b:loop values='data:posts' var='post'&gt;
        &lt;b:if cond='data:post.isDateStart and not data:post.isFirstPost'&gt;
          &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;
        &lt;/b:if&gt;
        &lt;b:if cond='data:post.isDateStart'&gt;
          &amp;lt;div class=&amp;quot;date-outer&amp;quot;&amp;gt;
        &lt;/b:if&gt;
        &lt;b:if cond='data:post.dateHeader'&gt;
          &lt;h2 class='date-header'&gt;&lt;span&gt;&lt;data:post.dateHeader/&gt;&lt;/span&gt;&lt;/h2&gt;
        &lt;/b:if&gt;
        &lt;b:if cond='data:post.isDateStart'&gt;
          &amp;lt;div class=&amp;quot;date-posts&amp;quot;&amp;gt;
        &lt;/b:if&gt;
        &lt;div class='post-outer'&gt;
          &lt;b:include data='post' name='post'/&gt;
          &lt;b:include cond='data:blog.pageType in {&amp;quot;static_page&amp;quot;,&amp;quot;item&amp;quot;}' data='post' name='comment_picker'/&gt;
        &lt;/div&gt;

        &lt;!-- Ad --&gt;
        &lt;b:if cond='data:post.includeAd'&gt;
          &lt;div class='inline-ad'&gt;
            &lt;data:adCode/&gt;
          &lt;/div&gt;
        &lt;/b:if&gt;
      &lt;/b:loop&gt;
      &lt;b:if cond='data:numPosts != 0'&gt;
        &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;
      &lt;/b:if&gt;
    &lt;/div&gt;

    &lt;!-- navigation --&gt;
    &lt;b:include name='nextprev'/&gt;

    &lt;!-- feed links --&gt;
    &lt;b:include name='feedLinks'/&gt;

  &lt;b:else/&gt;
    &lt;b:include name='mobile-main'/&gt;
  &lt;/b:if&gt;

  &lt;b:if cond='data:top.showPlusOne'&gt;
    &lt;data:top.googlePlusBootstrap/&gt;
  &lt;/b:if&gt;

&lt;/b:includable&gt;
              &lt;b:includable id='backlinkDeleteIcon' var='backlink'&gt;
  &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:backlink.adminClass'&gt;
    &lt;a expr:href='data:backlink.deleteUrl' expr:title='data:top.deleteBacklinkMsg'&gt;
      &lt;img src='https://resources.blogblog.com/img/icon_delete13.gif'/&gt;
    &lt;/a&gt;
  &lt;/span&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='backlinks' var='post'&gt;
  &lt;a name='links'/&gt;&lt;h4&gt;&lt;data:post.backlinksLabel/&gt;&lt;/h4&gt;
  &lt;b:if cond='data:post.numBacklinks != 0'&gt;
    &lt;dl class='comments-block' id='comments-block'&gt;
      &lt;b:loop values='data:post.backlinks' var='backlink'&gt;
        &lt;div class='collapsed-backlink backlink-control'&gt;
          &lt;dt class='comment-title'&gt;
            &lt;span class='backlink-toggle-zippy'&gt;&amp;#160;&lt;/span&gt;
            &lt;a expr:href='data:backlink.url' rel='nofollow'&gt;&lt;data:backlink.title/&gt;&lt;/a&gt;
            &lt;b:include data='backlink' name='backlinkDeleteIcon'/&gt;
          &lt;/dt&gt;
          &lt;dd class='comment-body collapseable'&gt;
            &lt;data:backlink.snippet/&gt;
          &lt;/dd&gt;
          &lt;dd class='comment-footer collapseable'&gt;
            &lt;span class='comment-author'&gt;&lt;data:post.authorLabel/&gt; &lt;data:backlink.author/&gt;&lt;/span&gt;
            &lt;span class='comment-timestamp'&gt;&lt;data:post.timestampLabel/&gt; &lt;data:backlink.timestamp/&gt;&lt;/span&gt;
          &lt;/dd&gt;
        &lt;/div&gt;
      &lt;/b:loop&gt;
    &lt;/dl&gt;
  &lt;/b:if&gt;
  &lt;p class='comment-footer'&gt;
    &lt;a class='comment-link' expr:href='data:post.createLinkUrl' expr:id='data:widget.instanceId + &amp;quot;_backlinks-create-link&amp;quot;' target='_blank'&gt;&lt;data:post.createLinkLabel/&gt;&lt;/a&gt;
  &lt;/p&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='comment-form' var='post'&gt;
  &lt;div class='comment-form'&gt;
    &lt;a name='comment-form'/&gt;
    &lt;b:if cond='data:mobile'&gt;
      &lt;h4 id='comment-post-message'&gt;
        &lt;a expr:id='data:widget.instanceId + &amp;quot;_comment-editor-toggle-link&amp;quot;' href='javascript:void(0)'&gt;&lt;data:postCommentMsg/&gt;&lt;/a&gt;&lt;/h4&gt;
      &lt;p&gt;&lt;data:blogCommentMessage/&gt;&lt;/p&gt;
      &lt;data:blogTeamBlogMessage/&gt;
      &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
      &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/&gt;
    &lt;b:else/&gt;
      &lt;h4 id='comment-post-message'&gt;&lt;data:postCommentMsg/&gt;&lt;/h4&gt;
      &lt;p&gt;&lt;data:blogCommentMessage/&gt;&lt;/p&gt;
      &lt;data:blogTeamBlogMessage/&gt;
      &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
      &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' width='100%'/&gt;
    &lt;/b:if&gt;
    &lt;data:post.friendConnectJs/&gt;
    &lt;data:post.cmtfpIframe/&gt;
    &lt;script type='text/javascript'&gt;
      BLOG_CMT_createIframe(&amp;#39;&lt;data:post.appRpcRelayPath/&gt;&amp;#39;);
    &lt;/script&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='commentDeleteIcon' var='comment'&gt;
  &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:comment.adminClass'&gt;
    &lt;b:if cond='data:showCmtPopup'&gt;
      &lt;div class='goog-toggle-button'&gt;
        &lt;div class='goog-inline-block comment-action-icon'/&gt;
      &lt;/div&gt;
    &lt;b:else/&gt;
      &lt;a class='comment-delete' expr:href='data:comment.deleteUrl' expr:title='data:top.deleteCommentMsg'&gt;
        &lt;img src='https://resources.blogblog.com/img/icon_delete13.gif'/&gt;
      &lt;/a&gt;
    &lt;/b:if&gt;
  &lt;/span&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='comment_count_picker' var='post'&gt;
  &lt;b:if cond='data:post.commentSource == 1'&gt;
    &lt;span class='cmt_count_iframe_holder' expr:data-count='data:post.numComments' expr:data-onclick='data:post.addCommentOnclick' expr:data-post-url='data:post.url' expr:data-url='data:post.url.canonical.http'&gt;
    &lt;/span&gt;
  &lt;b:else/&gt;
    &lt;a class='comment-link' expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;
      &lt;data:post.commentLabelFull/&gt;:
    &lt;/a&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='comment_picker' var='post'&gt;
  &lt;b:if cond='data:post.commentSource == 1'&gt;
    &lt;b:include data='post' name='iframe_comments'/&gt;
  &lt;b:elseif cond='data:post.showThreadedComments'/&gt;
    &lt;b:include data='post' name='threaded_comments'/&gt;
  &lt;b:else/&gt;
    &lt;b:include data='post' name='comments'/&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='comments' var='post'&gt;
  &lt;div class='comments' id='comments'&gt;
    &lt;a name='comments'/&gt;
    &lt;b:if cond='data:post.allowComments'&gt;
      &lt;h4&gt;&lt;data:post.commentLabelFull/&gt;:&lt;/h4&gt;

      &lt;b:if cond='data:post.commentPagingRequired'&gt;
        &lt;span class='paging-control-container'&gt;
          &lt;b:if cond='data:post.hasOlderLinks'&gt;
            &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'&gt;&lt;data:post.oldestLinkText/&gt;&lt;/a&gt;
              &amp;#160;
            &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'&gt;&lt;data:post.olderLinkText/&gt;&lt;/a&gt;
              &amp;#160;
          &lt;/b:if&gt;

          &lt;data:post.commentRangeText/&gt;

          &lt;b:if cond='data:post.hasNewerLinks'&gt;
            &amp;#160;
            &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'&gt;&lt;data:post.newerLinkText/&gt;&lt;/a&gt;
            &amp;#160;
            &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'&gt;&lt;data:post.newestLinkText/&gt;&lt;/a&gt;
          &lt;/b:if&gt;
        &lt;/span&gt;
      &lt;/b:if&gt;

      &lt;div expr:id='data:widget.instanceId + &amp;quot;_comments-block-wrapper&amp;quot;'&gt;
        &lt;dl expr:class='data:post.avatarIndentClass' id='comments-block'&gt;
          &lt;b:loop values='data:post.comments' var='comment'&gt;
            &lt;dt expr:class='&amp;quot;comment-author &amp;quot; + data:comment.authorClass' expr:id='data:comment.anchorName'&gt;
              &lt;b:if cond='data:comment.favicon'&gt;
                &lt;img expr:src='data:comment.favicon' height='16px' style='margin-bottom:-2px;' width='16px'/&gt;
              &lt;/b:if&gt;
              &lt;a expr:name='data:comment.anchorName'/&gt;
              &lt;b:if cond='data:blog.enabledCommentProfileImages'&gt;
                &lt;data:comment.authorAvatarImage/&gt;
              &lt;/b:if&gt;
              &lt;b:if cond='data:comment.authorUrl'&gt;
                &lt;a expr:href='data:comment.authorUrl' rel='nofollow'&gt;&lt;data:comment.author/&gt;&lt;/a&gt;
              &lt;b:else/&gt;
                &lt;data:comment.author/&gt;
              &lt;/b:if&gt;
              &lt;data:commentPostedByMsg/&gt;
            &lt;/dt&gt;
            &lt;dd class='comment-body' expr:id='data:widget.instanceId + data:comment.cmtBodyIdPostfix'&gt;
              &lt;b:if cond='data:comment.isDeleted'&gt;
                &lt;span class='deleted-comment'&gt;&lt;data:comment.body/&gt;&lt;/span&gt;
              &lt;b:else/&gt;
                &lt;p&gt;
                  &lt;data:comment.body/&gt;
                &lt;/p&gt;
              &lt;/b:if&gt;
            &lt;/dd&gt;
            &lt;dd class='comment-footer'&gt;
              &lt;span class='comment-timestamp'&gt;
                &lt;a expr:href='data:comment.url' title='comment permalink'&gt;
                  &lt;data:comment.timestamp/&gt;
                &lt;/a&gt;
                &lt;b:include data='comment' name='commentDeleteIcon'/&gt;
              &lt;/span&gt;
            &lt;/dd&gt;
          &lt;/b:loop&gt;
        &lt;/dl&gt;
      &lt;/div&gt;

      &lt;b:if cond='data:post.commentPagingRequired'&gt;
        &lt;span class='paging-control-container'&gt;
          &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'&gt;
            &lt;data:post.oldestLinkText/&gt;
          &lt;/a&gt;
          &lt;a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'&gt;
            &lt;data:post.olderLinkText/&gt;
          &lt;/a&gt;
          &amp;#160;
          &lt;data:post.commentRangeText/&gt;
          &amp;#160;
          &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'&gt;
            &lt;data:post.newerLinkText/&gt;
          &lt;/a&gt;
          &lt;a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'&gt;
            &lt;data:post.newestLinkText/&gt;
          &lt;/a&gt;
        &lt;/span&gt;
      &lt;/b:if&gt;

      &lt;p class='comment-footer'&gt;
        &lt;b:if cond='data:post.embedCommentForm'&gt;
          &lt;b:if cond='data:post.allowNewComments'&gt;
            &lt;b:include data='post' name='comment-form'/&gt;
          &lt;b:else/&gt;
            &lt;data:post.noNewCommentsText/&gt;
          &lt;/b:if&gt;
        &lt;b:elseif cond='data:post.allowComments'/&gt;
          &lt;a expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;&lt;data:postCommentMsg/&gt;&lt;/a&gt;
        &lt;/b:if&gt;
      &lt;/p&gt;
    &lt;/b:if&gt;
    &lt;b:if cond='data:showCmtPopup'&gt;
      &lt;div id='comment-popup'&gt;
        &lt;iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'&gt;
        &lt;/iframe&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div id='backlinks-container'&gt;
    &lt;div expr:id='data:widget.instanceId + &amp;quot;_backlinks-container&amp;quot;'&gt;
       &lt;b:include cond='data:post.showBacklinks' data='post' name='backlinks'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='feedLinks'&gt;
  &lt;b:if cond='data:blog.pageType != &amp;quot;item&amp;quot;'&gt; &lt;!-- Blog feed links --&gt;
    &lt;b:if cond='data:feedLinks'&gt;
      &lt;div class='blog-feeds'&gt;
        &lt;b:include data='feedLinks' name='feedLinksBody'/&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

  &lt;b:else/&gt; &lt;!--Post feed links --&gt;
    &lt;div class='post-feeds'&gt;
      &lt;b:loop values='data:posts' var='post'&gt;
        &lt;b:include cond='data:post.allowComments and data:post.feedLinks' data='post.feedLinks' name='feedLinksBody'/&gt;
      &lt;/b:loop&gt;
    &lt;/div&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='feedLinksBody' var='links'&gt;
  &lt;div class='feed-links'&gt;
  &lt;data:feedLinksMsg/&gt;
  &lt;b:loop values='data:links' var='f'&gt;
     &lt;a class='feed-link' expr:href='data:f.url' expr:type='data:f.mimeType' target='_blank'&gt;&lt;data:f.name/&gt; (&lt;data:f.feedType/&gt;)&lt;/a&gt;
  &lt;/b:loop&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='iframe_comments' var='post'&gt;

  &lt;b:if cond='data:post.allowIframeComments'&gt;
    &lt;script expr:src='data:post.iframeCommentSrc' type='text/javascript'/&gt;
    &lt;div class='cmt_iframe_holder' expr:data-href='data:post.url.canonical' expr:data-viewtype='data:post.viewType'/&gt;

    &lt;b:if cond='data:post.embedCommentForm == &amp;quot;false&amp;quot;'&gt;
      &lt;a expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'&gt;&lt;data:postCommentMsg/&gt;&lt;/a&gt;
    &lt;/b:if&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='mobile-index-post' var='post'&gt;
  &lt;div class='mobile-date-outer date-outer'&gt;
    &lt;b:if cond='data:post.dateHeader'&gt;
      &lt;div class='date-header'&gt;
        &lt;span&gt;&lt;data:post.dateHeader/&gt;&lt;/span&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div class='mobile-post-outer'&gt;
      &lt;a expr:href='data:post.url'&gt;
        &lt;h3 class='mobile-index-title entry-title' itemprop='name'&gt;
          &lt;data:post.title/&gt;
        &lt;/h3&gt;

        &lt;div class='mobile-index-arrow'&gt;&amp;amp;rsaquo;&lt;/div&gt;

        &lt;div class='mobile-index-contents'&gt;
          &lt;b:if cond='data:post.thumbnailUrl'&gt;
            &lt;div class='mobile-index-thumbnail'&gt;
              &lt;div class='Image'&gt;
                &lt;img expr:src='data:post.thumbnailUrl'/&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/b:if&gt;

          &lt;div class='post-body'&gt;
            &lt;b:if cond='data:post.snippet'&gt;&lt;data:post.snippet/&gt;&lt;/b:if&gt;
          &lt;/div&gt;
        &lt;/div&gt;

        &lt;div style='clear: both;'/&gt;
      &lt;/a&gt;

      &lt;div class='mobile-index-comment'&gt;
        &lt;b:include cond='data:blog.pageType != &amp;quot;static_page&amp;quot;                          and data:post.allowComments                          and data:post.numComments != 0' data='post' name='comment_count_picker'/&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='mobile-main' var='top'&gt;
    &lt;!-- posts --&gt;
    &lt;div class='blog-posts hfeed'&gt;

      &lt;b:include data='top' name='status-message'/&gt;

      &lt;b:if cond='data:blog.pageType == &amp;quot;index&amp;quot;'&gt;
        &lt;b:loop values='data:posts' var='post'&gt;
          &lt;b:include data='post' name='mobile-index-post'/&gt;
        &lt;/b:loop&gt;
      &lt;b:else/&gt;
        &lt;b:loop values='data:posts' var='post'&gt;
          &lt;b:include data='post' name='mobile-post'/&gt;
        &lt;/b:loop&gt;
      &lt;/b:if&gt;
    &lt;/div&gt;

   &lt;b:include name='mobile-nextprev'/&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='mobile-nextprev'&gt;
  &lt;div class='blog-pager' id='blog-pager'&gt;
    &lt;b:if cond='data:newerPageUrl'&gt;
      &lt;div class='mobile-link-button' id='blog-pager-newer-link'&gt;
      &lt;a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-newer-link&amp;quot;' expr:title='data:newerPageTitle'&gt;&amp;amp;lsaquo;&lt;/a&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;b:if cond='data:olderPageUrl'&gt;
      &lt;div class='mobile-link-button' id='blog-pager-older-link'&gt;
      &lt;a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-older-link&amp;quot;' expr:title='data:olderPageTitle'&gt;&amp;amp;rsaquo;&lt;/a&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div class='mobile-link-button' id='blog-pager-home-link'&gt;
    &lt;a class='home-link' expr:href='data:blog.homepageUrl'&gt;&lt;data:homeMsg/&gt;&lt;/a&gt;
    &lt;/div&gt;

    &lt;div class='mobile-desktop-link'&gt;
      &lt;a class='home-link' expr:href='data:desktopLinkUrl'&gt;&lt;data:desktopLinkMsg/&gt;&lt;/a&gt;
    &lt;/div&gt;

  &lt;/div&gt;
  &lt;div class='clear'/&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='mobile-post' var='post'&gt;
  &lt;div class='date-outer'&gt;
    &lt;b:if cond='data:post.dateHeader'&gt;
      &lt;h2 class='date-header'&gt;&lt;span&gt;&lt;data:post.dateHeader/&gt;&lt;/span&gt;&lt;/h2&gt;
    &lt;/b:if&gt;
    &lt;div class='date-posts'&gt;
      &lt;div class='post-outer'&gt;

        &lt;div class='post hentry uncustomized-post-template' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'&gt;
          &lt;b:if cond='data:post.thumbnailUrl'&gt;
            &lt;meta expr:content='data:post.thumbnailUrl' itemprop='image_url'/&gt;
          &lt;/b:if&gt;
          &lt;meta expr:content='data:blog.blogId' itemprop='blogId'/&gt;
          &lt;meta expr:content='data:post.id' itemprop='postId'/&gt;

          &lt;a expr:name='data:post.id'/&gt;
          &lt;b:if cond='data:post.title'&gt;
            &lt;h3 class='post-title entry-title' itemprop='name'&gt;
              &lt;b:if cond='data:post.link'&gt;
                &lt;a expr:href='data:post.link'&gt;&lt;data:post.title/&gt;&lt;/a&gt;
              &lt;b:elseif cond='data:post.url and data:blog.url != data:post.url'/&gt;
                &lt;a expr:href='data:post.url'&gt;&lt;data:post.title/&gt;&lt;/a&gt;
              &lt;b:else/&gt;
                &lt;data:post.title/&gt;
              &lt;/b:if&gt;
            &lt;/h3&gt;
          &lt;/b:if&gt;

          &lt;div class='post-header'&gt;
            &lt;div class='post-header-line-1'/&gt;
          &lt;/div&gt;

          &lt;div class='post-body entry-content' expr:id='&amp;quot;post-body-&amp;quot; + data:post.id' itemprop='articleBody'&gt;
            &lt;data:post.body/&gt;
            &lt;div style='clear: both;'/&gt; &lt;!-- clear for photos floats --&gt;
          &lt;/div&gt;

          &lt;div class='post-footer'&gt;
            &lt;div class='post-footer-line post-footer-line-1'&gt;
              &lt;span class='post-author vcard'&gt;
                &lt;b:if cond='data:top.showAuthor'&gt;
                  &lt;b:if cond='data:post.authorProfileUrl'&gt;
                    &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                      &lt;meta expr:content='data:post.authorProfileUrl' itemprop='url'/&gt;
                      &lt;a expr:href='data:post.authorProfileUrl' rel='author' title='author profile'&gt;
                        &lt;span itemprop='name'&gt;&lt;data:post.author/&gt;&lt;/span&gt;
                      &lt;/a&gt;
                    &lt;/span&gt;
                  &lt;b:else/&gt;
                    &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                      &lt;span itemprop='name'&gt;&lt;data:post.author/&gt;&lt;/span&gt;
                    &lt;/span&gt;
                  &lt;/b:if&gt;
                &lt;/b:if&gt;
              &lt;/span&gt;

              &lt;span class='post-timestamp'&gt;
                &lt;b:if cond='data:top.showTimestamp'&gt;
                  &lt;data:top.timestampLabel/&gt;
                  &lt;b:if cond='data:post.url'&gt;
                    &lt;meta expr:content='data:post.url.canonical' itemprop='url'/&gt;
                    &lt;a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'&gt;&lt;abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'&gt;&lt;data:post.timestamp/&gt;&lt;/abbr&gt;&lt;/a&gt;
                  &lt;/b:if&gt;
                &lt;/b:if&gt;
              &lt;/span&gt;

              &lt;span class='post-comment-link'&gt;
                &lt;b:include cond='data:blog.pageType not in {&amp;quot;item&amp;quot;,&amp;quot;static_page&amp;quot;}                                  and data:post.allowComments' data='post' name='comment_count_picker'/&gt;
              &lt;/span&gt;
            &lt;/div&gt;

            &lt;div class='post-footer-line post-footer-line-2'&gt;
              &lt;b:if cond='data:top.showMobileShare'&gt;
                &lt;div class='mobile-link-button goog-inline-block' id='mobile-share-button'&gt;
                  &lt;a href='javascript:void(0);'&gt;&lt;data:shareMsg/&gt;&lt;/a&gt;
                &lt;/div&gt;
              &lt;/b:if&gt;
              &lt;b:if cond='data:top.showDummy'&gt;
                &lt;div class='goog-inline-block dummy-container'&gt;&lt;data:post.dummyTag/&gt;&lt;/div&gt;
              &lt;/b:if&gt;
            &lt;/div&gt;

          &lt;/div&gt;
        &lt;/div&gt;

        &lt;b:include cond='data:blog.pageType in {&amp;quot;static_page&amp;quot;,&amp;quot;item&amp;quot;}' data='post' name='comment_picker'/&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='nextprev'&gt;
  &lt;div class='blog-pager' id='blog-pager'&gt;
    &lt;b:if cond='data:newerPageUrl'&gt;
      &lt;span id='blog-pager-newer-link'&gt;
      &lt;a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-newer-link&amp;quot;' expr:title='data:newerPageTitle'&gt;&lt;data:newerPageTitle/&gt;&lt;/a&gt;
      &lt;/span&gt;
    &lt;/b:if&gt;

    &lt;b:if cond='data:olderPageUrl'&gt;
      &lt;span id='blog-pager-older-link'&gt;
      &lt;a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &amp;quot;_blog-pager-older-link&amp;quot;' expr:title='data:olderPageTitle'&gt;&lt;data:olderPageTitle/&gt;&lt;/a&gt;
      &lt;/span&gt;
    &lt;/b:if&gt;

    &lt;a class='home-link' expr:href='data:blog.homepageUrl'&gt;&lt;data:homeMsg/&gt;&lt;/a&gt;

    &lt;b:if cond='data:mobileLinkUrl'&gt;
      &lt;div class='blog-mobile-link'&gt;
        &lt;a expr:href='data:mobileLinkUrl'&gt;&lt;data:mobileLinkMsg/&gt;&lt;/a&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

  &lt;/div&gt;
  &lt;div class='clear'/&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='post' var='post'&gt;
  &lt;div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'&gt;
    &lt;b:if cond='data:post.firstImageUrl'&gt;
      &lt;meta expr:content='data:post.firstImageUrl' itemprop='image_url'/&gt;
    &lt;/b:if&gt;
    &lt;meta expr:content='data:blog.blogId' itemprop='blogId'/&gt;
    &lt;meta expr:content='data:post.id' itemprop='postId'/&gt;

    &lt;a expr:name='data:post.id'/&gt;
    &lt;b:if cond='data:post.title'&gt;
      &lt;h3 class='post-title entry-title' itemprop='name'&gt;
      &lt;b:if cond='data:post.link or (data:post.url and data:blog.url != data:post.url)'&gt;
        &lt;a expr:href='data:post.link ? data:post.link : data:post.url'&gt;&lt;data:post.title/&gt;&lt;/a&gt;
      &lt;b:else/&gt;
        &lt;data:post.title/&gt;
      &lt;/b:if&gt;
      &lt;/h3&gt;
    &lt;/b:if&gt;

    &lt;div class='post-header'&gt;
    &lt;div class='post-header-line-1'/&gt;
    &lt;/div&gt;

    &lt;!-- Then use the post body as the schema.org description, for good G+/FB snippeting. --&gt;
    &lt;div class='post-body entry-content' expr:id='&amp;quot;post-body-&amp;quot; + data:post.id' expr:itemprop='(data:blog.metaDescription ? &amp;quot;&amp;quot; : &amp;quot;description &amp;quot;) + &amp;quot;articleBody&amp;quot;'&gt;
      &lt;data:post.body/&gt;
      &lt;div style='clear: both;'/&gt; &lt;!-- clear for photos floats --&gt;
    &lt;/div&gt;

    &lt;b:if cond='data:post.hasJumpLink'&gt;
      &lt;div class='jump-link'&gt;
        &lt;a expr:href='data:post.url + &amp;quot;#more&amp;quot;' expr:title='data:post.title'&gt;&lt;data:post.jumpText/&gt;&lt;/a&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div class='post-footer'&gt;
    &lt;div class='post-footer-line post-footer-line-1'&gt;
      &lt;span class='post-author vcard'&gt;
        &lt;b:if cond='data:top.showAuthor'&gt;
          &lt;data:top.authorLabel/&gt;
            &lt;b:if cond='data:post.authorProfileUrl'&gt;
              &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                &lt;meta expr:content='data:post.authorProfileUrl' itemprop='url'/&gt;
                &lt;a class='g-profile' expr:href='data:post.authorProfileUrl' rel='author' title='author profile'&gt;
                  &lt;span itemprop='name'&gt;&lt;data:post.author/&gt;&lt;/span&gt;
                &lt;/a&gt;
              &lt;/span&gt;
            &lt;b:else/&gt;
              &lt;span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
                &lt;span itemprop='name'&gt;&lt;data:post.author/&gt;&lt;/span&gt;
              &lt;/span&gt;
            &lt;/b:if&gt;
        &lt;/b:if&gt;
      &lt;/span&gt;

      &lt;span class='post-timestamp'&gt;
        &lt;b:if cond='data:top.showTimestamp'&gt;
          &lt;data:top.timestampLabel/&gt;
          &lt;b:if cond='data:post.url'&gt;
            &lt;meta expr:content='data:post.url.canonical' itemprop='url'/&gt;
            &lt;a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'&gt;&lt;abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'&gt;&lt;data:post.timestamp/&gt;&lt;/abbr&gt;&lt;/a&gt;
          &lt;/b:if&gt;
        &lt;/b:if&gt;
      &lt;/span&gt;

      &lt;span class='reaction-buttons'&gt;
        &lt;b:if cond='data:top.showReactions'&gt;
          &lt;table border='0' cellpadding='0' cellspacing='0' width='100%'&gt;&lt;tr&gt;
            &lt;td class='reactions-label-cell' nowrap='nowrap' valign='top' width='1%'&gt;
              &lt;span class='reactions-label'&gt;
              &lt;data:top.reactionsLabel/&gt;&lt;/span&gt;&amp;#160;&lt;/td&gt;
            &lt;td&gt;&lt;iframe allowtransparency='true' class='reactions-iframe' expr:src='data:post.reactionsUrl' frameborder='0' name='reactions' scrolling='no'/&gt;&lt;/td&gt;
           &lt;/tr&gt;&lt;/table&gt;
        &lt;/b:if&gt;
      &lt;/span&gt;

      &lt;span class='post-comment-link'&gt;
        &lt;b:include cond='data:blog.pageType not in {&amp;quot;item&amp;quot;,&amp;quot;static_page&amp;quot;}                          and data:post.allowComments' data='post' name='comment_count_picker'/&gt;
      &lt;/span&gt;

       &lt;!-- backlinks --&gt;
       &lt;span class='post-backlinks post-comment-link'&gt;
         &lt;b:if cond='data:blog.pageType not in {&amp;quot;item&amp;quot;,&amp;quot;static_page&amp;quot;}                      and data:post.showBacklinks'&gt;
           &lt;a class='comment-link' expr:href='data:post.url + &amp;quot;#links&amp;quot;'&gt;&lt;data:top.backlinkLabel/&gt;&lt;/a&gt;
         &lt;/b:if&gt;
       &lt;/span&gt;

      &lt;span class='post-icons'&gt;
        &lt;!-- email post links --&gt;
        &lt;b:if cond='data:post.emailPostUrl'&gt;
          &lt;span class='item-action'&gt;
          &lt;a expr:href='data:post.emailPostUrl' expr:title='data:top.emailPostMsg'&gt;
            &lt;img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/&gt;
          &lt;/a&gt;
          &lt;/span&gt;
        &lt;/b:if&gt;

        &lt;!-- quickedit pencil --&gt;
        &lt;b:include data='post' name='postQuickEdit'/&gt;
      &lt;/span&gt;

      &lt;!-- share buttons --&gt;
      &lt;div class='post-share-buttons goog-inline-block'&gt;
        &lt;b:include cond='data:post.sharePostUrl' data='post' name='shareButtons'/&gt;
      &lt;/div&gt;

      &lt;/div&gt;

      &lt;div class='post-footer-line post-footer-line-2'&gt;
      &lt;span class='post-labels'&gt;
        &lt;b:if cond='data:top.showPostLabels and data:post.labels'&gt;
          &lt;data:postLabelsLabel/&gt;
          &lt;b:loop values='data:post.labels' var='label'&gt;
            &lt;a expr:href='data:label.url' rel='tag'&gt;&lt;data:label.name/&gt;&lt;/a&gt;&lt;b:if cond='not data:label.isLast'&gt;,&lt;/b:if&gt;
          &lt;/b:loop&gt;
        &lt;/b:if&gt;
      &lt;/span&gt;
      &lt;/div&gt;

      &lt;div class='post-footer-line post-footer-line-3'&gt;
      &lt;span class='post-location'&gt;
        &lt;b:if cond='data:top.showLocation and data:post.location'&gt;
          &lt;data:postLocationLabel/&gt;
          &lt;a expr:href='data:post.location.mapsUrl' target='_blank'&gt;&lt;data:post.location.name/&gt;&lt;/a&gt;
        &lt;/b:if&gt;
      &lt;/span&gt;
      &lt;/div&gt;
      &lt;b:if cond='data:post.authorAboutMe'&gt;
        &lt;div class='author-profile' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'&gt;
          &lt;b:if cond='data:post.authorPhoto.url'&gt;
            &lt;img expr:src='data:post.authorPhoto.url' itemprop='image' width='50px'/&gt;
          &lt;/b:if&gt;
          &lt;div&gt;
            &lt;a class='g-profile' expr:href='data:post.authorProfileUrl' itemprop='url' rel='author' title='author profile'&gt;
              &lt;span itemprop='name'&gt;&lt;data:post.author/&gt;&lt;/span&gt;
            &lt;/a&gt;
          &lt;/div&gt;
          &lt;span itemprop='description'&gt;&lt;data:post.authorAboutMe/&gt;&lt;/span&gt;
        &lt;/div&gt;
      &lt;/b:if&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='postQuickEdit' var='post'&gt;
  &lt;b:if cond='data:post.editUrl'&gt;
    &lt;span expr:class='&amp;quot;item-control &amp;quot; + data:post.adminClass'&gt;
      &lt;a expr:href='data:post.editUrl' expr:title='data:top.editPostMsg'&gt;
        &lt;img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/&gt;
      &lt;/a&gt;
    &lt;/span&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='shareButtons' var='post'&gt;
  &lt;b:if cond='data:top.showEmailButton'&gt;&lt;a class='goog-inline-block share-button sb-email' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=email&amp;quot;' expr:title='data:top.emailThisMsg' target='_blank'&gt;&lt;span class='share-button-link-text'&gt;&lt;data:top.emailThisMsg/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b:if&gt;&lt;b:if cond='data:top.showBlogThisButton'&gt;&lt;a class='goog-inline-block share-button sb-blog' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=blog&amp;quot;' expr:onclick='&amp;quot;window.open(this.href, \&amp;quot;_blank\&amp;quot;, \&amp;quot;height=270,width=475\&amp;quot;); return false;&amp;quot;' expr:title='data:top.blogThisMsg' target='_blank'&gt;&lt;span class='share-button-link-text'&gt;&lt;data:top.blogThisMsg/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b:if&gt;&lt;b:if cond='data:top.showTwitterButton'&gt;&lt;a class='goog-inline-block share-button sb-twitter' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=twitter&amp;quot;' expr:title='data:top.shareToTwitterMsg' target='_blank'&gt;&lt;span class='share-button-link-text'&gt;&lt;data:top.shareToTwitterMsg/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b:if&gt;&lt;b:if cond='data:top.showFacebookButton'&gt;&lt;a class='goog-inline-block share-button sb-facebook' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=facebook&amp;quot;' expr:onclick='&amp;quot;window.open(this.href, \&amp;quot;_blank\&amp;quot;, \&amp;quot;height=430,width=640\&amp;quot;); return false;&amp;quot;' expr:title='data:top.shareToFacebookMsg' target='_blank'&gt;&lt;span class='share-button-link-text'&gt;&lt;data:top.shareToFacebookMsg/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b:if&gt;&lt;b:if cond='data:top.showPinterestButton'&gt;&lt;a class='goog-inline-block share-button sb-pinterest' expr:href='data:post.sharePostUrl + &amp;quot;&amp;amp;target=pinterest&amp;quot;' expr:title='data:top.shareToPinterestMsg' target='_blank'&gt;&lt;span class='share-button-link-text'&gt;&lt;data:top.shareToPinterestMsg/&gt;&lt;/span&gt;&lt;/a&gt;&lt;/b:if&gt;&lt;b:if cond='data:top.showPlusOne'&gt;&lt;div class='goog-inline-block google-plus-share-container'&gt;&lt;data:post.googlePlusShareTag/&gt;&lt;/div&gt;&lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='status-message'&gt;
  &lt;b:if cond='data:navMessage'&gt;
  &lt;div class='status-msg-wrap'&gt;
    &lt;div class='status-msg-body'&gt;
      &lt;data:navMessage/&gt;
    &lt;/div&gt;
    &lt;div class='status-msg-border'&gt;
      &lt;div class='status-msg-bg'&gt;
        &lt;div class='status-msg-hidden'&gt;&lt;data:navMessage/&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  &lt;div style='clear: both;'/&gt;
  &lt;/b:if&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='threaded-comment-form' var='post'&gt;
  &lt;div class='comment-form'&gt;
    &lt;a name='comment-form'/&gt;
    &lt;b:if cond='data:mobile'&gt;
      &lt;p&gt;&lt;data:blogCommentMessage/&gt;&lt;/p&gt;
      &lt;data:blogTeamBlogMessage/&gt;
      &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
      &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/&gt;
    &lt;b:else/&gt;
      &lt;p&gt;&lt;data:blogCommentMessage/&gt;&lt;/p&gt;
      &lt;data:blogTeamBlogMessage/&gt;
      &lt;a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/&gt;
      &lt;iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' width='100%'/&gt;
    &lt;/b:if&gt;
    &lt;data:post.friendConnectJs/&gt;
    &lt;data:post.cmtfpIframe/&gt;
    &lt;script type='text/javascript'&gt;
      BLOG_CMT_createIframe(&amp;#39;&lt;data:post.appRpcRelayPath/&gt;&amp;#39;);
    &lt;/script&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='threaded_comment_js' var='post'&gt;
  &lt;script async='async' expr:src='data:post.commentSrc' type='text/javascript'/&gt;

  &lt;script type='text/javascript'&gt;
    (function() {
      var items = &lt;data:post.commentJso/&gt;;
      var msgs = &lt;data:post.commentMsgs/&gt;;
      var config = &lt;data:post.commentConfig/&gt;;

// &lt;![CDATA[
      var cursor = null;
      if (items &amp;&amp; items.length &gt; 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        if (entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '&lt;span class="deleted-comment"&gt;' + entry.content.$t + '&lt;/span&gt;';
            }
          }
        }
        return entry.content.$t;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data &amp;&amp; data.feed &amp;&amp; data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author &amp;&amp; entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid &amp;&amp; pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&amp;v=2&amp;orderby=published&amp;reverse=false&amp;max-results=50';
          if (cursor) {
            url += '&amp;published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length &lt; 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&amp;callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              &amp;&amp; comment.author.name == config.authorName
              &amp;&amp; comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&amp;postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox &amp;&amp; (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&amp;parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog &amp;&amp; window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog &amp;&amp; window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]&gt;
  &lt;/script&gt;
&lt;/b:includable&gt;
              &lt;b:includable id='threaded_comments' var='post'&gt;
  &lt;div class='comments' id='comments'&gt;
    &lt;a name='comments'/&gt;
    &lt;h4&gt;&lt;data:post.commentLabelFull/&gt;:&lt;/h4&gt;

    &lt;div class='comments-content'&gt;
      &lt;b:include cond='data:post.embedCommentForm' data='post' name='threaded_comment_js'/&gt;
      &lt;div id='comment-holder'&gt;
         &lt;data:post.commentHtml/&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;p class='comment-footer'&gt;
      &lt;b:if cond='data:post.allowNewComments'&gt;
        &lt;b:include data='post' name='threaded-comment-form'/&gt;
      &lt;b:else/&gt;
        &lt;data:post.noNewCommentsText/&gt;
      &lt;/b:if&gt;
    &lt;/p&gt;

    &lt;b:if cond='data:showCmtPopup'&gt;
      &lt;div id='comment-popup'&gt;
        &lt;iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'&gt;
        &lt;/iframe&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div id='backlinks-container'&gt;
    &lt;div expr:id='data:widget.instanceId + &amp;quot;_backlinks-container&amp;quot;'&gt;
      &lt;b:include cond='data:post.showBacklinks' data='post' name='backlinks'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
            &lt;/b:widget&gt;
          &lt;/b:section&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='column-left-outer'&gt;
        &lt;div class='column-left-inner'&gt;
          &lt;aside&gt;
          &lt;macro:include id='main-column-left-sections' name='sections'&gt;
            &lt;macro:param default='0' name='num'/&gt;
            &lt;macro:param default='sidebar-left' name='idPrefix'/&gt;
            &lt;macro:param default='sidebar' name='class'/&gt;
            &lt;macro:param default='true' name='includeBottom'/&gt;
          &lt;/macro:include&gt;
          &lt;/aside&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='column-right-outer'&gt;
        &lt;div class='column-right-inner'&gt;
          &lt;aside&gt;
          &lt;macro:include id='main-column-right-sections' name='sections'&gt;
            &lt;macro:param default='2' name='num'/&gt;
            &lt;macro:param default='sidebar-right' name='idPrefix'/&gt;
            &lt;macro:param default='sidebar' name='class'/&gt;
            &lt;macro:param default='true' name='includeBottom'/&gt;
          &lt;/macro:include&gt;
          &lt;/aside&gt;
        &lt;/div&gt;
        &lt;/div&gt;

        &lt;/div&gt;

        &lt;div style='clear: both'/&gt;
      &lt;!-- columns --&gt;
      &lt;/div&gt;

    &lt;!-- main --&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='main-cap-bottom cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;

    &lt;footer&gt;
    &lt;div class='footer-outer'&gt;
    &lt;div class='footer-cap-top cap-top'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;div class='fauxborder-left footer-fauxborder-left'&gt;
    &lt;div class='fauxborder-right footer-fauxborder-right'/&gt;
    &lt;div class='region-inner footer-inner'&gt;
      &lt;macro:include id='footer-sections' name='sections'&gt;
        &lt;macro:param default='2' name='num'/&gt;
        &lt;macro:param default='footer' name='idPrefix'/&gt;
        &lt;macro:param default='foot' name='class'/&gt;
        &lt;macro:param default='false' name='includeBottom'/&gt;
      &lt;/macro:include&gt;
      &lt;!-- outside of the include in order to lock Attribution widget --&gt;
      &lt;b:section class='foot' id='footer-3' name='Footer' showaddelement='no'&gt;
        &lt;b:widget id='Attribution1' locked='true' title='' type='Attribution' visible='true'&gt;
          &lt;b:includable id='main'&gt;
    &lt;b:if cond='data:feedbackSurveyLink'&gt;
      &lt;div class='mobile-survey-link' style='text-align: center;'&gt;
        &lt;data:feedbackSurveyLink/&gt;
      &lt;/div&gt;
    &lt;/b:if&gt;

    &lt;div class='widget-content' style='text-align: center;'&gt;
      &lt;b:if cond='data:attribution != &amp;quot;&amp;quot;'&gt;
       &lt;data:attribution/&gt;
      &lt;/b:if&gt;
    &lt;/div&gt;

    &lt;b:include name='quickedit'/&gt;
  &lt;/b:includable&gt;
        &lt;/b:widget&gt;
      &lt;/b:section&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class='footer-cap-bottom cap-bottom'&gt;
      &lt;div class='cap-left'/&gt;
      &lt;div class='cap-right'/&gt;
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;/footer&gt;

  &lt;!-- content --&gt;
  &lt;/div&gt;
  &lt;/div&gt;
  &lt;div class='content-cap-bottom cap-bottom'&gt;
    &lt;div class='cap-left'/&gt;
    &lt;div class='cap-right'/&gt;
  &lt;/div&gt;
  &lt;/div&gt;
  &lt;/div&gt;

  &lt;script type='text/javascript'&gt;
    window.setTimeout(function() {
        document.body.className = document.body.className.replace(&amp;#39;loading&amp;#39;, &amp;#39;&amp;#39;);
      }, 10);
  &lt;/script&gt;
&lt;/body&gt;

&lt;macro:includable id='sections' var='col'&gt;
  &lt;macro:if cond='data:col.num == 0'&gt;
  &lt;macro:else/&gt;
    &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-1&amp;quot;' preferred='yes' showaddelement='yes'/&gt;

    &lt;macro:if cond='data:col.num &amp;gt;= 2'&gt;
      &lt;table border='0' cellpadding='0' cellspacing='0' mexpr:class='&amp;quot;section-columns columns-&amp;quot; + data:col.num'&gt;
      &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td class='first columns-cell'&gt;
          &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-1&amp;quot;'/&gt;
        &lt;/td&gt;

        &lt;td class='columns-cell'&gt;
          &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-2&amp;quot;'/&gt;
        &lt;/td&gt;

        &lt;macro:if cond='data:col.num &amp;gt;= 3'&gt;
          &lt;td class='columns-cell'&gt;
            &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-3&amp;quot;'/&gt;
          &lt;/td&gt;
        &lt;/macro:if&gt;

        &lt;macro:if cond='data:col.num &amp;gt;= 4'&gt;
          &lt;td class='columns-cell'&gt;
            &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-2-4&amp;quot;'/&gt;
          &lt;/td&gt;
        &lt;/macro:if&gt;
      &lt;/tr&gt;
      &lt;/tbody&gt;
      &lt;/table&gt;

      &lt;macro:if cond='data:col.includeBottom'&gt;
        &lt;b:section mexpr:class='data:col.class' mexpr:id='data:col.idPrefix + &amp;quot;-3&amp;quot;' showaddelement='no'/&gt;
      &lt;/macro:if&gt;
    &lt;/macro:if&gt;
  &lt;/macro:if&gt;
&lt;/macro:includable&gt;

&lt;b:section-contents id='sidebar-right-1'&gt;
  &lt;b:widget id='PageList1' locked='false' title='' type='PageList' visible='true'&gt;
    &lt;b:includable id='main'&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;&lt;h2&gt;&lt;data:title/&gt;&lt;/h2&gt;&lt;/b:if&gt;
  &lt;div class='widget-content'&gt;
    &lt;b:if cond='data:mobile'&gt;
      &lt;select expr:id='data:widget.instanceId + &amp;quot;_select&amp;quot;'&gt;
        &lt;b:loop values='data:links' var='link'&gt;
          &lt;b:if cond='data:link.isCurrentPage'&gt;
            &lt;option expr:value='data:link.href' selected='selected'&gt;&lt;data:link.title/&gt;&lt;/option&gt;
          &lt;b:else/&gt;
            &lt;option expr:value='data:link.href'&gt;&lt;data:link.title/&gt;&lt;/option&gt;
          &lt;/b:if&gt;
        &lt;/b:loop&gt;
      &lt;/select&gt;
      &lt;span class='pagelist-arrow'&gt;&amp;amp;#9660;&lt;/span&gt;

    &lt;b:else/&gt;
      &lt;ul&gt;
        &lt;b:loop values='data:links' var='link'&gt;
          &lt;b:if cond='data:link.isCurrentPage'&gt;
            &lt;li class='selected'&gt;&lt;a expr:href='data:link.href'&gt;&lt;data:link.title/&gt;&lt;/a&gt;&lt;/li&gt;
          &lt;b:else/&gt;
            &lt;li&gt;&lt;a expr:href='data:link.href'&gt;&lt;data:link.title/&gt;&lt;/a&gt;&lt;/li&gt;
          &lt;/b:if&gt;
        &lt;/b:loop&gt;
      &lt;/ul&gt;
    &lt;/b:if&gt;
    &lt;b:include name='quickedit'/&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='Label1' locked='false' title='Labels' type='Label' visible='true'&gt;
    &lt;b:includable id='main'&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;
    &lt;h2&gt;&lt;data:title/&gt;&lt;/h2&gt;
  &lt;/b:if&gt;
  &lt;div expr:class='&amp;quot;widget-content &amp;quot; + data:display + &amp;quot;-label-widget-content&amp;quot;'&gt;
    &lt;b:if cond='data:display == &amp;quot;list&amp;quot;'&gt;
      &lt;ul&gt;
        &lt;b:loop values='data:labels' var='label'&gt;
          &lt;li&gt;
            &lt;b:if cond='data:blog.url == data:label.url'&gt;
              &lt;span expr:dir='data:blog.languageDirection'&gt;&lt;data:label.name/&gt;&lt;/span&gt;
            &lt;b:else/&gt;
              &lt;a expr:dir='data:blog.languageDirection' expr:href='data:label.url'&gt;&lt;data:label.name/&gt;&lt;/a&gt;
            &lt;/b:if&gt;
            &lt;b:if cond='data:showFreqNumbers'&gt;
              &lt;span dir='ltr'&gt;(&lt;data:label.count/&gt;)&lt;/span&gt;
            &lt;/b:if&gt;
          &lt;/li&gt;
        &lt;/b:loop&gt;
      &lt;/ul&gt;
    &lt;b:else/&gt;
      &lt;b:loop values='data:labels' var='label'&gt;
        &lt;span expr:class='&amp;quot;label-size label-size-&amp;quot; + data:label.cssSize'&gt;
          &lt;b:if cond='data:blog.url == data:label.url'&gt;
            &lt;span expr:dir='data:blog.languageDirection'&gt;&lt;data:label.name/&gt;&lt;/span&gt;
          &lt;b:else/&gt;
            &lt;a expr:dir='data:blog.languageDirection' expr:href='data:label.url'&gt;&lt;data:label.name/&gt;&lt;/a&gt;
          &lt;/b:if&gt;
          &lt;b:if cond='data:showFreqNumbers'&gt;
            &lt;span class='label-count' dir='ltr'&gt;(&lt;data:label.count/&gt;)&lt;/span&gt;
          &lt;/b:if&gt;
        &lt;/span&gt;
      &lt;/b:loop&gt;
    &lt;/b:if&gt;
    &lt;b:include name='quickedit'/&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='PopularPosts1' locked='false' title='Popular' type='PopularPosts' visible='true'&gt;
    &lt;b:includable id='main'&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;&lt;h2&gt;&lt;data:title/&gt;&lt;/h2&gt;&lt;/b:if&gt;
  &lt;div class='widget-content popular-posts'&gt;
    &lt;ul&gt;
      &lt;b:loop values='data:posts' var='post'&gt;
      &lt;li&gt;
        &lt;b:if cond='!data:showThumbnails'&gt;
          &lt;b:if cond='!data:showSnippets'&gt;
            &lt;!-- (1) No snippet/thumbnail --&gt;
            &lt;a expr:href='data:post.href'&gt;&lt;data:post.title/&gt;&lt;/a&gt;
          &lt;b:else/&gt;
            &lt;!-- (2) Show only snippets --&gt;
            &lt;div class='item-title'&gt;&lt;a expr:href='data:post.href'&gt;&lt;data:post.title/&gt;&lt;/a&gt;&lt;/div&gt;
            &lt;div class='item-snippet'&gt;&lt;data:post.snippet/&gt;&lt;/div&gt;
          &lt;/b:if&gt;
        &lt;b:else/&gt;
          &lt;!-- (3) Show only thumbnails or (4) Snippets and thumbnails. --&gt;
          &lt;div expr:class='data:showSnippets ? &amp;quot;item-content&amp;quot; : &amp;quot;item-thumbnail-only&amp;quot;'&gt;
            &lt;b:if cond='data:post.featuredImage.isResizable or data:post.thumbnail'&gt;
              &lt;div class='item-thumbnail'&gt;
                &lt;a expr:href='data:post.href' target='_blank'&gt;
                  &lt;b:with value='data:post.featuredImage.isResizable                                  ? resizeImage(data:post.featuredImage, 72, &amp;quot;1:1&amp;quot;)                                  : data:post.thumbnail' var='image'&gt;
                    &lt;img alt='' border='0' expr:src='data:image'/&gt;
                  &lt;/b:with&gt;
                &lt;/a&gt;
              &lt;/div&gt;
            &lt;/b:if&gt;
            &lt;div class='item-title'&gt;&lt;a expr:href='data:post.href'&gt;&lt;data:post.title/&gt;&lt;/a&gt;&lt;/div&gt;
            &lt;b:if cond='data:showSnippets'&gt;
              &lt;div class='item-snippet'&gt;&lt;data:post.snippet/&gt;&lt;/div&gt;
            &lt;/b:if&gt;
          &lt;/div&gt;
          &lt;div style='clear: both;'/&gt;
        &lt;/b:if&gt;
      &lt;/li&gt;
      &lt;/b:loop&gt;
    &lt;/ul&gt;
    &lt;b:include name='quickedit'/&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
  &lt;b:widget id='BlogArchive1' locked='false' title='Blog Archive' type='BlogArchive' visible='true'&gt;
    &lt;b:includable id='main'&gt;
  &lt;b:if cond='data:title != &amp;quot;&amp;quot;'&gt;
    &lt;h2&gt;&lt;data:title/&gt;&lt;/h2&gt;
  &lt;/b:if&gt;
  &lt;div class='widget-content'&gt;
  &lt;div id='ArchiveList'&gt;
  &lt;div expr:id='data:widget.instanceId + &amp;quot;_ArchiveList&amp;quot;'&gt;
    &lt;b:include cond='data:style == &amp;quot;HIERARCHY&amp;quot;' data='data' name='interval'/&gt;
    &lt;b:include cond='data:style == &amp;quot;FLAT&amp;quot;' data='data' name='flat'/&gt;
    &lt;b:include cond='data:style == &amp;quot;MENU&amp;quot;' data='data' name='menu'/&gt;
  &lt;/div&gt;
  &lt;/div&gt;
  &lt;b:include name='quickedit'/&gt;
  &lt;/div&gt;
&lt;/b:includable&gt;
    &lt;b:includable id='flat' var='data'&gt;
  &lt;ul class='flat'&gt;
    &lt;b:loop values='data:data' var='i'&gt;
      &lt;li class='archivedate'&gt;
        &lt;a expr:href='data:i.url'&gt;&lt;data:i.name/&gt;&lt;/a&gt; (&lt;data:i.post-count/&gt;)
      &lt;/li&gt;
    &lt;/b:loop&gt;
  &lt;/ul&gt;
&lt;/b:includable&gt;
    &lt;b:includable id='interval' var='intervalData'&gt;
  &lt;b:loop values='data:intervalData' var='interval'&gt;
    &lt;ul class='hierarchy'&gt;
      &lt;li expr:class='&amp;quot;archivedate &amp;quot; + data:interval.expclass'&gt;
        &lt;b:include cond='data:interval.toggleId' data='interval' name='toggle'/&gt;
        &lt;a class='post-count-link' expr:href='data:interval.url'&gt;
          &lt;data:interval.name/&gt;
        &lt;/a&gt;
        &lt;span class='post-count' dir='ltr'&gt;(&lt;data:interval.post-count/&gt;)&lt;/span&gt;
        &lt;b:include cond='data:interval.data' data='interval.data' name='interval'/&gt;
        &lt;b:include cond='data:interval.posts' data='interval.posts' name='posts'/&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/b:loop&gt;
&lt;/b:includable&gt;
    &lt;b:includable id='menu' var='data'&gt;
  &lt;select expr:id='data:widget.instanceId + &amp;quot;_ArchiveMenu&amp;quot;'&gt;
    &lt;option value=''&gt;&lt;data:title/&gt;&lt;/option&gt;
    &lt;b:loop values='data:data' var='i'&gt;
      &lt;option expr:value='data:i.url'&gt;&lt;data:i.name/&gt; (&lt;data:i.post-count/&gt;)&lt;/option&gt;
    &lt;/b:loop&gt;
  &lt;/select&gt;
&lt;/b:includable&gt;
    &lt;b:includable id='posts' var='posts'&gt;
  &lt;ul class='posts'&gt;
    &lt;b:loop values='data:posts' var='post'&gt;
      &lt;li&gt;&lt;a expr:href='data:post.url'&gt;&lt;data:post.title/&gt;&lt;/a&gt;&lt;/li&gt;
    &lt;/b:loop&gt;
  &lt;/ul&gt;
&lt;/b:includable&gt;
    &lt;b:includable id='toggle' var='interval'&gt;
  &lt;a class='toggle' href='javascript:void(0)'&gt;
    &lt;span expr:class='&amp;quot;zippy&amp;quot; + (data:interval.expclass == &amp;quot;expanded&amp;quot; ? &amp;quot; toggle-open&amp;quot; : &amp;quot;&amp;quot;)'&gt;
      &lt;b:if cond='data:interval.expclass == &amp;quot;expanded&amp;quot;'&gt;
        &amp;#9660;&amp;#160;
      &lt;b:elseif cond='data:blog.languageDirection == &amp;quot;rtl&amp;quot;'/&gt;
        &amp;#9668;&amp;#160;
      &lt;b:else/&gt;
        &amp;#9658;&amp;#160;
      &lt;/b:if&gt;
    &lt;/span&gt;
  &lt;/a&gt;
&lt;/b:includable&gt;
  &lt;/b:widget&gt;
&lt;/b:section-contents&gt;&lt;b:section-contents id='sidebar-right-2-1'/&gt;&lt;b:section-contents id='sidebar-right-2-2'/&gt;&lt;b:section-contents id='sidebar-right-3'/&gt;&lt;b:section-contents id='footer-1'/&gt;&lt;b:section-contents id='footer-2-1'/&gt;&lt;b:section-contents id='footer-2-2'/&gt;&lt;/html&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/template/default'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/template/default'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_PUBLISHING_MODE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of publishing done for this blog.</title><content type='text'>PUBLISH_MODE_HOSTED</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PUBLISHING_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PUBLISHING_MODE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ADMIN_PERMISSION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of administrators' emails for the blog.</title><content type='text'>daniel.vetter@ffwll.ch</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ADMIN_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ADMIN_PERMISSION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ADULT_CONTENT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog contains adult content</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ADULT_CONTENT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ADULT_CONTENT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ALTERNATE_JSRENDER_ALLOWED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether alternate JS renderings are allowed</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ALTERNATE_JSRENDER_ALLOWED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ALTERNATE_JSRENDER_ALLOWED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ANALYTICS_ACCOUNT_NUMBER</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog's Google Analytics account number</title><content type='text'>UA-36557550-1</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ANALYTICS_ACCOUNT_NUMBER'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ANALYTICS_ACCOUNT_NUMBER'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ARCHIVE_DATE_FORMAT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the archive index date format</title><content type='text'>9</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ARCHIVE_DATE_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ARCHIVE_DATE_FORMAT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_ARCHIVE_FREQUENCY</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>How frequently this blog should be archived</title><content type='text'>MONTHLY</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ARCHIVE_FREQUENCY'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_ARCHIVE_FREQUENCY'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_AUTHOR_PERMISSION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of authors' emails who have permission to publish.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_AUTHOR_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_AUTHOR_PERMISSION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_BACKLINKS_ALLOWED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show comment backlinks on the blog</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_BACKLINKS_ALLOWED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_BACKLINKS_ALLOWED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_BY_POST_ARCHIVING</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to provide an archive page for each post</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_BY_POST_ARCHIVING'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_BY_POST_ARCHIVING'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_ACCESS</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Who can comment</title><content type='text'>REGISTERED</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_ACCESS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_ACCESS'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_CAPTCHA</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to require commenters to complete a Captcha</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_CAPTCHA'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_CAPTCHA'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_EMAIL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>List of e-mail addresses to send notifications of new comments to</title><content type='text'>daniel@ffwll.ch</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_EMAIL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_FEED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for blog comments</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_FEED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_FORM_LOCATION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog comment form location</title><content type='text'>EMBEDDED_IFRAME</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_FORM_LOCATION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_FORM_LOCATION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_MESSAGE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Blog comment message</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MESSAGE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MESSAGE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_MODERATION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to enable comment moderation</title><content type='text'>DISABLED</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_MODERATION_DELAY</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Number of days after which new comments are subject to moderation</title><content type='text'>14</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION_DELAY'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION_DELAY'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_MODERATION_EMAIL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Email address to send notifications of new comments needing moderation to</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_MODERATION_EMAIL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENT_PROFILE_IMAGES</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show profile images in comments</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_PROFILE_IMAGES'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENT_PROFILE_IMAGES'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENTS_ALLOWED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show comments</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENTS_ALLOWED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENTS_ALLOWED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_COMMENTS_TIME_STAMP_FORMAT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Comment time stamp format number</title><content type='text'>29</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENTS_TIME_STAMP_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_COMMENTS_TIME_STAMP_FORMAT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_CONVERT_LINE_BREAKS</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to convert line breaks into &lt;br /&gt; tags in post editor</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CONVERT_LINE_BREAKS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CONVERT_LINE_BREAKS'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_CUSTOM_PAGE_NOT_FOUND</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The content served when the requested post or page is not found.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_PAGE_NOT_FOUND'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_PAGE_NOT_FOUND'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_CUSTOM_ROBOTS_TXT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The custom robots.txt content of the blog served to search engines.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_ROBOTS_TXT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_ROBOTS_TXT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_CUSTOM_ROBOTS_TXT_ENABLED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog serves custom robots.txt content to search engines.</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_ROBOTS_TXT_ENABLED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_CUSTOM_ROBOTS_TXT_ENABLED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_DATE_FORMAT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the date header format</title><content type='text'>26</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DATE_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DATE_FORMAT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_DEFAULT_BACKLINKS_MODE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Default backlinks mode for posts</title><content type='text'>DEFAULT_HAVE_BACKLINKS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DEFAULT_BACKLINKS_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DEFAULT_BACKLINKS_MODE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_DEFAULT_COMMENTS_MODE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Default comment mode for posts</title><content type='text'>DEFAULT_HAVE_COMMENTS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DEFAULT_COMMENTS_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DEFAULT_COMMENTS_MODE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_DESCRIPTION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>A description of the blog</title><content type='text'>Daniel Vetter's ramblings on code, bugs, graphics, hw and the utter lack of sanity in all this.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DESCRIPTION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_DESCRIPTION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_EMAIL_POST_LINKS</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show a link for users to e-mail posts</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_EMAIL_POST_LINKS'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_EMAIL_POST_LINKS'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_FEED_REDIRECT_URL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>URL to redirect post feed requests to</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_FEED_REDIRECT_URL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_FEED_REDIRECT_URL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_FLOAT_ALIGNMENT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether float alignment is enabled for the blog</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_FLOAT_ALIGNMENT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_FLOAT_ALIGNMENT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_LOCALE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Language for this blog</title><content type='text'>en</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_LOCALE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_LOCALE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_M2B_WHITELIST_EMAIL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>List of email addresses that can post to the blog via email.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_M2B_WHITELIST_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_M2B_WHITELIST_EMAIL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_MAX_NUM</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Maximum number of things to show on the main page"</title><content type='text'>10</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_MAX_NUM'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_MAX_NUM'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_MAX_UNIT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Unit of things to show on the main page</title><content type='text'>POSTS</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_MAX_UNIT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_MAX_UNIT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_META_DESCRIPTION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The meta description of the blog served to search engines.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_META_DESCRIPTION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_META_DESCRIPTION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_META_DESCRIPTION_ENABLED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog is served with meta descriptions.</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_META_DESCRIPTION_ENABLED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_META_DESCRIPTION_ENABLED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_NAME</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The name of the blog</title><content type='text'>stuff by danvet</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_NAME'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_NAME'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_PER_POST_FEED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for per-post comments</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PER_POST_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PER_POST_FEED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_POST_FEED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The type of feed to provide for blog posts</title><content type='text'>FULL</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_FEED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_FEED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_POST_FEED_FOOTER</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Footer to append to the end of each entry in the post feed</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_FEED_FOOTER'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_FEED_FOOTER'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_POST_TEMPLATE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The template for blog posts</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_TEMPLATE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_POST_TEMPLATE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_PROMOTED</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog can be promoted on Blogger</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PROMOTED'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_PROMOTED'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_QUICK_EDITING</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether Quick Editing is enabled</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_QUICK_EDITING'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_QUICK_EDITING'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_READ_ACCESS_MODE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The access type for the readers of the blog.</title><content type='text'>PUBLIC</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_READ_ACCESS_MODE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_READ_ACCESS_MODE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_READER_PERMISSION</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The list of emails for users who have permission to read the blog.</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_READER_PERMISSION'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_READER_PERMISSION'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_SEARCHABLE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether this blog should be indexed by search engines</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SEARCHABLE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SEARCHABLE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_SEND_EMAIL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Comma separated list of emails to send new blog posts to</title><content type='text'></content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SEND_EMAIL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SEND_EMAIL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_SHOW_TITLE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show the title field</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SHOW_TITLE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SHOW_TITLE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_SHOW_URL</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show a related link box in the post composer</title><content type='text'>false</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SHOW_URL'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_SHOW_URL'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_TIME_STAMP_FORMAT</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The number of the time stamp format</title><content type='text'>15</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_TIME_STAMP_FORMAT'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_TIME_STAMP_FORMAT'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_TIME_ZONE</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>The time zone for this blog</title><content type='text'>America/Los_Angeles</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_TIME_ZONE'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_TIME_ZONE'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.settings.BLOG_USE_LIGHTBOX</id><published>2011-01-06T05:23:29.019-08:00</published><updated>2016-06-19T06:04:16.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#settings'/><title type='text'>Whether to show images in the Lightbox when clicked</title><content type='text'>true</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_USE_LIGHTBOX'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/settings/BLOG_USE_LIGHTBOX'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6308458049828256007</id><published>2016-06-06T02:41:00.002-07:00</published><updated>2016-06-06T12:06:56.307-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Awesome Atomic Advances</title><content type='html'>Also, silly titles. Atomic has taken of for real, right now there's 17 drivers supporting &lt;a href="http://blog.ffwll.ch/2015/08/atomic-modesetting-design-overview.html"&gt;atomic modesetting&lt;/a&gt; merged into the DRM subsystem. And still a pile of them each release pending for review&amp;amp;merging. But it's not just new drivers, there's also been a steady stream of small improvements over the past year, I think it's time for an update.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;It seems small, but a big improvement made over the past few months is that &lt;b&gt;most driver callbacks used by the helper libraries are now optional&lt;/b&gt;. Which means tons and tons of dummy functions and boilerplate code can be removed from drivers, leading to less clutter and easier to understand driver code. Aside: Not all drivers have been decluttered, doing that is great starter project for contributing a first few patches to the DRM subsystem. Many thanks to Boris Brezillion, Noralf Trønnes and many others for making this happen.&lt;br /&gt;&lt;br /&gt;A long standing complaint about the DRM kernel mode setting is that it's too complicated, especially compared to fbdev when all you have is one dumb framebuffer and nothing else. And yes, in that case there's really no point in having distinct CRTC, plane and encoder objects, and now finally Noralf Trønnes has volunteered to write a &lt;a href="https://lists.freedesktop.org/archives/dri-devel/2016-May/107452.html"&gt;&lt;b&gt;helper library for simple display pipelines&lt;/b&gt;&lt;/a&gt; to hide all that complexity from drivers. It's not yet merged but I'm postive it'll land in 4.8. And it will help to make writing DRM drivers for simple hardware easy and the driver code clutter-free.&lt;br /&gt;&lt;br /&gt;Another piece many dumb framebuffer drivers need is support for manually uploading new contents to the screen. Often on this simple panels there's no point in doing page-flipping of entire buffers since a real render engine is nowhere to be seen. And the panels are often behind a really slow bus, making full screen uploads to expensive. Instead it's all done by directly drawing into the frontbuffer, and then telling the driver what changed so that it can shovel the new bits over the bus to the panel. DRM has full support for this through a dirty interface and IOCTL, and legacy fbdev also has some support for this. But the fbdev emulation helpers in DRM never wired these two bits together, forcing drivers to all type their own boilerplate. Noralf has fixed this by implementing &lt;a href="https://cgit.freedesktop.org/drm-intel/commit/?id=eaa434defaca1781fb2932c685289b610aeb8b4b"&gt;&lt;b&gt;fbdev deferred I/O support for the DRM fbdev helpers&lt;/b&gt;&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;A related improvement is &lt;a href="https://cgit.freedesktop.org/drm-intel/commit/?id=a03fdcb1863297481a4b817c2a759cafcbdfa0ae"&gt;&lt;b&gt;generic support to disable the fbdev emulation&lt;/b&gt;&lt;/a&gt; from Archit Tajena, both through a Kconfig option and a module option. Most distributions still expect fbdev to work for the boot splash, recovery console and emergency logging. But some, like ChromeOS, are entirely legacy-free and don't need any of this. Thus far every DRM driver had to add implement support for fbdev emulation and disabling it optionally itself. Now that's all done in the library using dummy stub functions in the disabled case, again simplifying driver code.&lt;br /&gt;&lt;br /&gt;Somehow most ARM-SoC display drivers start out their system suspend/resume support with a dumb register save/restore. I guess because with simple hardware that works, and regmap provides it almost for free. And then everyone learns the lessons why the atomic modeset helpers have a very strict state transition model the hard way: Display hardware gets upset extremely easily when things are done in the wrong order, or without the required delays, obeying the depencies between components and much more. Dumb register restoring does none of that. To fix this Thierry Redding implemented &lt;a href="https://cgit.freedesktop.org/drm-intel/commit/?id=1494276000db789c6d2acd85747be4707051c801"&gt;&lt;b&gt;suspend/resume helpers for atomic drivers&lt;/b&gt;&lt;/a&gt;. Unfortunately not many drivers use this support yet, which is again a nice opportunity to get a kernel patch merged if you have the hardware for such a driver.&lt;br /&gt;&lt;br /&gt;Another big gap in the original atomic infrastructure that's finally getting close is &lt;a href="http://thread.gmane.org/gmane.comp.freedesktop.xorg.drivers.intel/91023"&gt;&lt;b&gt;generic support for nonblocking commits&lt;/b&gt;&lt;/a&gt;. The tricky part there is getting the depency tracking between commits on different display parts right, and I secretly hoped that with a few examples it would be easier to implement something that's useful for most drivers. With 17 examples I've finally run out of excuse to postpone this, after more than 1 year.&lt;br /&gt;&lt;br /&gt;But even more important than making the code prettier for atomic drivers and removing boilerplate with better helpers and libraries is in my opinion explaing it all, and making sure all drivers work the same. Over the past few months there's been massive &lt;a href="https://01.org/linuxgraphics/gfx-docs/drm/"&gt;&lt;b&gt;improvements to the driver interface documentation&lt;/b&gt;&lt;/a&gt;. One of the big items there is certainly &lt;a href="https://01.org/linuxgraphics/gfx-docs/drm/gpu.html#modeset-helper-reference-for-common-vtables"&gt;documenting the expected behaviour, return codes and special cases of every driver callback&lt;/a&gt;. But there is lots more improved than just this example, so go and read them! And of course, when you spot an inconsistency or typo, just send in a patch to fix it. And it's not just contents, but also presentation: Hopefully in 4.8 Jani Nikula's &lt;a href="https://www.mail-archive.com/linux-kernel@vger.kernel.org/msg1158589.html"&gt;sphinx-based documentation toolchain&lt;/a&gt; - the above links are already generated using that for a peek at all the new pretty.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;The flip side is testing, and on that front Collabora's effort to&amp;nbsp; convert all the kernel mode-setting tests in &lt;a href="https://cgit.freedesktop.org/xorg/app/intel-gpu-tools/"&gt;intel-gpu-tools&lt;/a&gt; to be generic and useful on any DRM is progressing nicely. For a bit more details read up on &lt;a href="http://blog.tomeuvizoso.net/2016/04/validating-changes-to-kms-drivers-with.html"&gt;Tomeu Vizoso's blog on validating changes to KMS drivers&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;Finally it's not all improvements to make it easier to write great drivers, there's also some new feature work. Lionel Landwerlin added new atomic properties to &lt;a href="https://cgit.freedesktop.org/drm-intel/commit/?id=5488dc16fde74595a40c5d20ae52d978313f0b4e"&gt;&lt;b&gt;implement color management support&lt;/b&gt;&lt;/a&gt;. And there's work on-going to implement Z-order and blending properties, and lots more, but that's not yet ready for merging.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6308458049828256007/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/06/awesome-atomic-advances.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6308458049828256007'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6308458049828256007'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/06/awesome-atomic-advances.html' title='Awesome Atomic Advances'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-9134466153059324092</id><published>2016-06-04T07:32:00.001-07:00</published><updated>2016-06-04T07:32:24.500-07:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LCA Community Topics Reading List</title><content type='html'>https://lwn.net/Articles/675657/&lt;br /&gt;&lt;br /&gt;Jono Bacon keynote + scarf compared to maslov's hierarchy&lt;br /&gt;&lt;br /&gt;non-violent communication?&lt;br /&gt;&lt;br /&gt;&amp;nbsp;https://www.youtube.com/watch?v=EqcuzSwySR4&lt;br /&gt;&lt;br /&gt;ruby community hacking ed dunham?&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&lt;span class="comment"&gt;&lt;span class="c00"&gt;Drive: The surprising truth about what motivates us&lt;/span&gt;&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;&amp;nbsp;https://www.youtube.com/watch?v=u6XAPnuFjJc&amp;amp;feature=youtu.be</content><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/06/lca-community-topics-reading-list.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9134466153059324092'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9134466153059324092'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-9200098891319736997</id><published>2016-06-04T07:32:00.000-07:00</published><updated>2016-06-04T07:32:05.055-07:00</updated><app:control xmlns:app='http://purl.org/atom/app#'><app:draft>yes</app:draft></app:control><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>open org</title><content type='html'>https://opensource.com/open-organization/16/6/introducing-open-decision-framework?sc_cid=701600000011jJkAAI&lt;br /&gt;&lt;br /&gt;https://github.com/opensourceway/open-decision-framework/blob/master/Open_Decision_Framework-community.pdf&lt;br /&gt;&lt;br /&gt;http://danieltenner.com/2014/11/06/the-advice-process-definition-and-usage-tips/&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;the open organization book</content><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/06/open-org.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9200098891319736997'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9200098891319736997'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4783717525266737585</id><published>2016-06-04T04:11:00.000-07:00</published><updated>2016-06-12T13:45:05.243-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>On Getting Patches Merged</title><content type='html'>In some project there's an awesome process to handle newcomer's contributions - autobuilder picks up your pull and runs full CI on it, coding style checkers automatically do basic review, and the functional review load is also at least all assigned with tooling too.&lt;br /&gt;&lt;br /&gt;Then there's projects where utter chaos and ad-hoc process reign, like the Linux kernel or the X.org community, and it's much harder for new folks to get their foot into the door. Of course there's documentation trying to bridge that gap, tools like get_maintainers.pl to figure out whom to ping, but that's kinda the details. In the end you need someone from the inside to care about what you're doing and guide you through the maze the first few times.&lt;br /&gt;&lt;br /&gt;I've been pinged about this a few times recently on IRC, so I figured I'll type up my recommended best practices.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;The crucial bit is that such unstructured developer communities run entirely on mutual trust, and patches get reviewed through a market of favours as in "I review yours and you review my patches". As a newcomer you have neither. The goal is to build up enough trust and review favours owed to you to get your patches in.&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Write a few small, simple patches in related areas. When developing your patches you probably had to read some code, documentation, look at testcases, and very likely you spotted a small thing or two that could be improved. Create a patch for each of those and submit them - it's a great way to test-drive the process and make first contact. Some projects even have tools to hunt for trivial things, e.g. Linux' checkpatch.pl. And as a maintainer I try hard to give everyone a chance to land their first few simple patches fast and try to review&amp;amp;merge them within days.&lt;/li&gt;&lt;li&gt;Talk about what you're doing on IRC or whatever your project uses for fast&amp;amp;informal communication. Interactive communication is much faster at clearing up initial misunderstandings compared to mailing lists and similar things like pull request discussions. It's also more scary, but let's be honest: If the community you want to contribute too isn't open&amp;amp;friendly, you probably don't want to stick around anyway. In short, it's a good community test too.&lt;/li&gt;&lt;li&gt;Go the extra mile: If you create a new interface, helper function or whatever try to roll it out everywhere. Even in code you can't run yourself (like drivers for other hardware or similar things), or when you're unsure about how to convert a given piece of code to the new way of doing things. If you have no idea what other piece could benefit from your work, ask around - that's why you started out with talking on IRC after all. The benefit is that by touching lots of other codes you automatically also gain lots more reviewers who might be interesting in your work and help push it forward.&lt;/li&gt;&lt;li&gt;When submitting your work, or resubmitting revised versions, make sure that everyone who showed interest or might be interested stays informed. There's various support in tooling for this, but with git and mailing-list patch submissions I just add everyone who ever commented on a patch, or who's reviewer or maintainer for an area with a Cc: entry to the patch itself. That way I never forget to add them when resubmitting.&lt;/li&gt;&lt;li&gt;Doing all this you will have learned a lot - apply that knowledge by reviewing patches from people who commented on your work in related areas. That will also fill your review favours kitty and help get your patches landed.&lt;/li&gt;&lt;li&gt;If the project uses the maintainer model for committing with no  commit rights for regular contributors, don't ask the maintainer for  review, they're generally overloaded. Instead fan out and try to find  the subject expert, like you would do in a project where all regular  contributors have commit rights.&lt;/li&gt;&lt;li&gt;Most important of all: Don't just sit&amp;amp;wait around scared and hope your patches will magically land. They won't, not because they're bad but simply because people are busy, and your patches are forever lost in the chaos after just a week or two. Hence ping after a few days about the status, but don't ask when the patches will land, but instead what you can do to move them forward. It's a cheap trick, but it helps to elicit useful responses, at least in my experience.&lt;/li&gt;&lt;li&gt;And equally important: Don't fall into the imposter syndrome gap or end up blaming yourself when things are a bit bumpy at first - it's just plain hard to figure out undocumented rules of projects who run on chaos and personal relationships. But do try to improve the documentation once you've managed all the pitfalls, to make it easier for the next new person. After all, as the most recent new contributor, you're now the residential expert on this topic!&lt;/li&gt;&lt;/ul&gt;And finally your patches have landed, and in the process you've learned to know a few interesting people. And getting to know new folks is in my opinion really what open source and community is all about. Congrats, and all the best for the next step in your journey!&lt;br /&gt;&lt;br /&gt;And finally for the flip side, there's a great write up from &lt;a href="http://sarah.thesharps.us/2014/09/01/the-gentle-art-of-patch-review/"&gt;Sarah Sharp about doing review&lt;/a&gt;, which applies especially to reviewing newcomer's patches.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4783717525266737585/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/06/on-getting-patches-merged.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4783717525266737585'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4783717525266737585'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/06/on-getting-patches-merged.html' title='On Getting Patches Merged'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3142001204592303032</id><published>2016-05-10T14:52:00.001-07:00</published><updated>2016-05-11T08:02:31.939-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Neat drm/i915 Stuff for 4.7</title><content type='html'>The &lt;a href="http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html"&gt;4.6 release&lt;/a&gt; is almost out of the door, it's time to look at what's in store for 4.7.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;Let's first look at the epic saga called atomic support. In 4.7 the &lt;b&gt;atomic watermark update support for Ironlake through Broadwell&lt;/b&gt; from Matt Roper, Ville Syrjälä and others finally landed. This took about 3 attempts to get merged because there's lots of small little corner cases that caused regressions each time around, but it's finally done. And it's an absolutely key piece for atomic support, since Intel hardware does not support atomic updates of the watermark settings for the display fetch fifos. And if those values are wrong tearings and other ugly things will result. We still need corresponding support for other platforms, but this is a really big step. But that's not the only atomic work: Maarten Lankhorst made the &lt;b&gt;hardware state checker atomic&lt;/b&gt;, and there's been tons of smaller things all over to move the driver towards the shiny new.&lt;br /&gt;&lt;br /&gt;Another big feature on the display side is &lt;b&gt;color management&lt;/b&gt;, implemented by Lionel Landwerlin, and then fixes to make it fully &lt;b&gt;atomic&lt;/b&gt; from Maarten. Color management aims for more accurate reproduction of a well definied color space on panels, using a de-gamma table, then a color matrix, and finally a gamma table.&lt;br /&gt;&lt;br /&gt;For platform enabling the big thing is support for &lt;b&gt;DSI panels on Broxton&lt;/b&gt; from Jani Nikula and Ramalingam C. One fallout from this effort is the &lt;b&gt;cleaned up VBT parsing &lt;/b&gt;code, done by Jani. There's now a clean split between parsing the different VBT versions on all the various platforms, now neatly consolidated, and using that information in different places within the driver. Ville also hooked up &lt;b&gt;upscaling/panel fitting for DSI panels&lt;/b&gt; on all platforms.&lt;br /&gt;&lt;br /&gt;Looking more at driver internals Ander Conselvan de Oliviera&lt;b&gt; &lt;/b&gt;and Ville &lt;b&gt;refactored the entire display PLL &lt;/b&gt;code on all platforms, with the goal to reuse it in the DP detection code for upfront link training. This is needed to detect the link configuration in certain situations like USB type C connectors. Shubhangi Shrivastava &lt;b&gt;reworked the DP detection&lt;/b&gt; code itself, again to prep for these features. Still on pure display topics Ville &lt;b&gt;fixed lots of underrun issues&lt;/b&gt; to appease our CI on lots of platforms. Together with the atomic watermark updates this should shut up one of the largest sources of noise in our test results.&lt;br /&gt;&lt;br /&gt;Moving on to power management work the big thing is &lt;b&gt;lots of small fixes for the runtime PM support&lt;/b&gt; all over the place from Imre Deak and Ville, with a big focus on the Broxton platform. And while we talk features affecting the entire driver: Imre&lt;b&gt; added fault injection to the driver load paths&lt;/b&gt; so that we can start to exercise all that code in an automated way.&lt;br /&gt;&lt;br /&gt;Finally looking at the render/GEM side of the driver the short summary is that Tvrtko Ursulin and Chris Wilson worked the code all over the place: A cleanup up and &lt;b&gt;tuned forcewake handling &lt;/b&gt;code from Tvrtko, f&lt;b&gt;ixes for more userptr corner cases &lt;/b&gt;from Chris, a new &lt;b&gt;notifier to handle vmap exhaustion&lt;/b&gt; and assorted polish in the related shrinker code, &lt;b&gt;cleaned up and fixed handling of gpu reset corner cases&lt;/b&gt;, &lt;b&gt;fixes for context related hard hangs&lt;/b&gt; on Sandybridge and Ironlake, large-scale renaming of parameters and structures to realign old code with the newish execlist hardware mode, the list goes on. And finally a rather big piece, and one which causes some trouble, is all the work to &lt;b&gt;speed up the execlist code&lt;/b&gt;, with a big focusing on &lt;b&gt;reducing interrupt handling overhead&lt;/b&gt;. This was done by moving the expensive parts of execlist interrupt handling into a tasklet. Unfortunately that uncovered some bugs in our interrupt handling on Braswell, so Ville jumped in and fixed it all up, plus of course removed some cruft and applied some nice polish.&lt;br /&gt;&lt;br /&gt;Other work in the GT are are &lt;b&gt;gpu hang fixes for Skylake GT3 and GT4&lt;/b&gt; configurations from Mika Kuoppala. Mika also provided patches to i&lt;b&gt;mprove the edram handling&lt;/b&gt; on those same chips. Alex Dai and Dave Gordon kept working on making GuC ready for prime time, but not yet there. And Peter Antoine improved the MOCS support to work on all engines.&lt;br /&gt;&lt;br /&gt;And of course there's been tons of smaller improvements, bugfixes, cleanups and refactorings all over the place, as usual.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3142001204592303032/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3142001204592303032'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3142001204592303032'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html' title='Neat drm/i915 Stuff for 4.7'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5946104774138124042</id><published>2016-04-27T23:37:00.002-07:00</published><updated>2016-04-27T23:37:44.312-07:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='X.org'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>X.Org Foundation Election Results</title><content type='html'>Two questions were up for voting, 4 seats on the Board of Directors and approval of the amended By-Laws to join SPI.&lt;br /&gt;&lt;br /&gt;Congratulations to our reelected and new board members Egbert Eich, Alex Deucher, Keith Packard and Bryce Harrington. Thanks a lot to Lucas Stach for running. And also big thanks to our outgoing board member Matt Dew, who stepped down for personal reasons.&lt;br /&gt;&lt;br /&gt;On the bylaw changes and merging with SPI, 61 out of 65 active members voted, with 54 voting yes, 4 no and 3 abstained. Which means we're well past the 2/3rd quorum for bylaw changes, and everything's green now to proceed with the plan to join SPI!</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5946104774138124042/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-results.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5946104774138124042'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5946104774138124042'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-results.html' title='X.Org Foundation Election Results'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3068400291878314076</id><published>2016-04-24T02:14:00.001-07:00</published><updated>2016-04-24T02:14:48.547-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Should the X.org Foundation join SPI? Vote Now!</title><content type='html'>&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://2.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAY0/szB2xu42-qwWGLZpwIitJYZkDKiNrgBsQCKgB/s1600/vote_now.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" height="320" src="https://2.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAY0/szB2xu42-qwWGLZpwIitJYZkDKiNrgBsQCKgB/s320/vote_now.jpg" width="320" /&gt;&lt;/a&gt;&lt;/div&gt;&lt;br /&gt;&lt;br /&gt;&lt;a href="http://keithp.com/blogs/x.org-election/"&gt;In&lt;/a&gt; &lt;a href="https://phoronix.com/scan.php?page=news_item&amp;amp;px=Xorg-2016-Elections-Start"&gt;case&lt;/a&gt; you &lt;a href="http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html?showComment=1461317453899#c781631829836255757"&gt;missed&lt;/a&gt; &lt;a href="http://www.xorg-foundation.org/wiki/BoardOfDirectors/Elections/2016/"&gt;it&lt;/a&gt;: Please vote now on &lt;a href="https://members.x.org/login.php"&gt;https://members.x.org/login.php&lt;/a&gt;!</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3068400291878314076/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/04/should-xorg-foundation-join-spi-vote-now.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3068400291878314076'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3068400291878314076'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/04/should-xorg-foundation-join-spi-vote-now.html' title='Should the X.org Foundation join SPI? Vote Now!'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://2.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAY0/szB2xu42-qwWGLZpwIitJYZkDKiNrgBsQCKgB/s72-c/vote_now.jpg' height='72' width='72'/><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-9047795241514036687</id><published>2016-04-20T00:24:00.002-07:00</published><updated>2016-04-20T00:24:39.792-07:00</updated><category scheme='http://www.blogger.com/atom/ns#' term='X.org'/><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>X.org Foundation Election - Vote Now!</title><content type='html'>&lt;div class="separator" style="clear: both; text-align: center;"&gt;&lt;a href="https://1.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAYw/qho0p0LtZH0jfQGQ5L01ZoedVmL9fKaFQCLcB/s1600/vote_now.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"&gt;&lt;img border="0" height="320" src="https://1.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAYw/qho0p0LtZH0jfQGQ5L01ZoedVmL9fKaFQCLcB/s320/vote_now.jpg" width="320" /&gt;&lt;/a&gt;&lt;/div&gt;It's election season in X.org land, and it matters: Besides new board seats we're also voting on bylaw changes and whether to join SPI or not.&lt;br /&gt;&lt;br /&gt;Personally, and as the secretary of the board I'm very much in favour of joining SPI. It will allow us to offload all the boring bits of running a foundation, and those are also all the bits we tend to struggle with. And that would give the board more time to do things that actually matter and help the community. And all that for a really reasonable price - running our own legal entity isn't free, and not really worth it for our small budget mostly consisting of travel sponsoring and the occasional internship.&lt;br /&gt;&lt;br /&gt;And bylaw changes need a qualified supermajority of all members, every vote counts and not voting essentially means voting no. Hence please vote, and please vote even when you don't want to join - this is our second attempt and I'd really like to see a clear verdict from our members, one way or the other.&lt;br /&gt;&lt;br /&gt;Thanks.&lt;br /&gt;&lt;br /&gt;Voting closes by&amp;nbsp; &lt;strong&gt;             Apr 26  23:59 UTC&lt;/strong&gt;, but please don't cut it short, it's a computer that decides when it's over ...&lt;br /&gt;&lt;br /&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/9047795241514036687/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9047795241514036687'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9047795241514036687'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html' title='X.org Foundation Election - Vote Now!'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='https://1.bp.blogspot.com/-0xdeyuFfML0/VxcuHa6le1I/AAAAAAAAAYw/qho0p0LtZH0jfQGQ5L01ZoedVmL9fKaFQCLcB/s72-c/vote_now.jpg' height='72' width='72'/><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6153199226047072843</id><published>2016-03-10T01:51:00.000-08:00</published><updated>2016-03-10T02:27:44.724-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 4.6</title><content type='html'>The &lt;a href="http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html"&gt;4.5 release &lt;/a&gt;is close, it's time to look at what's in store for the next kernel's merge window in the Intel graphics driver.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;Headline features for sure are that &lt;b&gt;FBC and PSR are enabled by default&lt;/b&gt;. And this time around I'm really hopeful that it will stick, since Paulo&amp;amp;Rodrigo have done a stellar job hunting down all the corner cases, writing testcases for them all and in general making sure we have a really solid foundation for display power saving features. There's still some oddball cornercases, which means it's not yet enabled everywhere and on all platforms, but like I said: Looking really good, and the culmination of over 1 year of effort to get the code infrastructure fixed up and solid.&lt;br /&gt;&lt;br /&gt;Another project &lt;b&gt;ongoing is atomic display support&lt;/b&gt;, with again lots of work from Maarten and Matt and others to move things forward. Specifically Maarten adapted the load detect logic to atomic and removed a pile of legacy structures no longer needed in preparation of next steps. Matt continued to work on atomic display fifo watermark updates. Another area that has seen a &lt;b&gt;lot of work in the background is runtime PM&lt;/b&gt;. Mika, Imre and Ville have massively improved the debugging infrastructure we have to track down rare bugs in our power status tracking code. They also merged lots of fixes in this area. Unfortunately we're not yet at a point where we can enable overall runtime PM for the device by default.&lt;br /&gt;&lt;br /&gt;More on the feature side is &lt;b&gt;pixel clock limit checks &lt;/b&gt;for all outputs and platforms from Mika Kahola. This is related to the work to also enable dynamic display clock scaling on Gen9, but that part is still being worked on. Ville worked a lot on how &lt;b&gt;offsets and alignment are handled for display planes&lt;/b&gt;, all in preparation to support rotated multi-planar formats like NV12. Again a feature where a lot of hard work is required to make the final patch to enable it all look really simple.&lt;br /&gt;&lt;br /&gt;On the plain hardware and platform enabling side Jani implemented support for version 3 of the &lt;b&gt;VBT DSI descriptions&lt;/b&gt;, which should extend DSI panel support to all current hardware. Which includes the Surface 3.&lt;br /&gt;&lt;br /&gt;Finally on the &lt;b&gt;GEM side there have been mostly small fixes&lt;/b&gt; and imrpovements under the hood. Tvrtko decoupled the internal engine representation from the userspace ABI defines. He also restructed the CS irq handler code, and started to fix up some locking issues in execlist. Chris tracked down some coherency issues in the execlist interrupt handler. Dave Gordon finally started to somewhat untangle the execlist initialization logic and some of the confusion in how all the different software structures connect.&lt;br /&gt;&lt;br /&gt;One real feature work by Alex Dai though was enabled &lt;b&gt;ADS for GuC&lt;/b&gt;, which is some means to hand additional metadata to the GuC firmware scheduler. But since GuC based command submission isn't enabled yet, this doesn't have a direct impact.&lt;br /&gt;&lt;br /&gt;And of course there have been bugfixes all over the place, as usual.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6153199226047072843/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6153199226047072843'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6153199226047072843'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html' title='Neat drm/i915 stuff for 4.6'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1109414631376380336</id><published>2016-02-10T08:01:00.000-08:00</published><updated>2016-02-10T08:01:34.700-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>ARM kernel cross compiling</title><content type='html'>I do a lot of cross driver subsytem refactorings, and DRM has lots of drivers that only run on ARM. Which means I routinely break a leg or arm since at least in the past cross-compiling was somehow always super painful. But I've just learned (thanks to Daniel Stone) that cross-compiling this stuff has become real easy, so here's my handy script for this. This assumes Debian, but the difference is just in installing a different cross-compiler toolchain.&lt;br /&gt;&lt;br /&gt;First get the tooling:&lt;br /&gt;&lt;br /&gt;&lt;code&gt;$ sudo apt-get install gcc-arm-linux-gnueabihf&lt;/code&gt;&lt;br /&gt;&lt;code&gt;&amp;nbsp;&lt;/code&gt;&lt;br /&gt;Then create another git checkout. I prefer the recently merged worktree support, since with that all your branches and remotes transparently work in the new checkout, too.&lt;br /&gt;&lt;br /&gt;&lt;code&gt;~/kernel/src/ $ git worktree add ../armhf HEAD&lt;/code&gt;&lt;br /&gt;&lt;code&gt;&amp;nbsp;&lt;/code&gt;&lt;br /&gt;With that we're all set up. For building any &lt;code&gt;$branch&lt;/code&gt; wrap the following lines into a scrip:&lt;br /&gt;&lt;br /&gt;&lt;code&gt;$ cd ~/kernel/armhf&lt;br /&gt;$ git checkout --detach $branch&lt;br /&gt;$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- multi_v7_defconfig zImage modules&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;I'm using --detach to avoid complaints from the git worktree code that I've checked out a branch already in the main repo. Note: Never accidentally run plain make in the ARM build directory - mixing up architectures seriously confuses the kernel build system.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1109414631376380336/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/02/arm-kernel-cross-compiling.html#comment-form' title='1 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1109414631376380336'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1109414631376380336'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/02/arm-kernel-cross-compiling.html' title='ARM kernel cross compiling'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>1</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-183319580757219114</id><published>2016-02-08T01:32:00.001-08:00</published><updated>2016-02-08T01:32:06.305-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LCA Geelong: Embrace the Atomic Display Age</title><content type='html'>Back from another awesome linux.conf.au, still the best general Linux conference even the second time around. I've also done a talk about all the &lt;a href="https://linux.conf.au/schedule/30132/view_talk?day=wednesday"&gt;shiny new atomic display support&lt;/a&gt; in the kernel, and the great LCA AV team has &lt;a href="https://www.youtube.com/watch?v=LjiB_JeDn2M&amp;amp;feature=youtu.be"&gt;uploaded the video&lt;/a&gt; already, and &lt;a href="https://people.freedesktop.org/~danvet/presentations/lca-2016.pdf"&gt;the slides are here&lt;/a&gt;.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/183319580757219114/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/02/lca-geelong-embrace-atomic-display-age.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/183319580757219114'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/183319580757219114'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/02/lca-geelong-embrace-atomic-display-age.html' title='LCA Geelong: Embrace the Atomic Display Age'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8106885102788327740</id><published>2016-01-14T05:55:00.000-08:00</published><updated>2016-01-14T05:55:36.328-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>VT Switching with Atomic Modeset</title><content type='html'>First the title is a slight lie, this really is about compositor switching and not necessarily about using Linux VTs for that. But I hope that the title draws in the right folks and tempts them to read this. Since with atomic there's a bit a problem if you want to switch between different compositors - maybe you have X running and hack on wayland-mutter, or kwin and mutter or just a DE and a login manager&amp;nbsp; - and expect it to not end up in a modern arts project like &lt;a href="https://twitter.com/__damien__/status/676741658940186625"&gt;this&lt;/a&gt;.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;Now the trouble with atomic modesetting and switching between different compositors is that atomic display updates are incremental for two reasons:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;First we need to be able to support the legacy KMS interface for existing userspace, and that inteface was only updating parts of the overall display state.&lt;/li&gt;&lt;li&gt;Second we want atomic to be extensible. Which means compositors must be able to only update the properties they understand and leave everything else at a presumably reasonable default values.&lt;/li&gt;&lt;/ul&gt;But if you mix this with a bunch of different compositors which all understand different subsets of all the atomic extensions a driver supports, suddenly the assumption that unhandled values have reasonable settings becomes invalid, and partial updates become a problem. Recently there's been a discussions on mailing lists and IRC about how to solve this, which ultimately ended in the conclusion that us kernel folks don't really know what would work best for distros, desktop environments and their compositors. Just going ahead with some new kernel ABI could easily result in a mistake that we have to support for the next 10 years. Therefore this blog post here covers the ideas with come up with to tackle this, just to make it clear that kernel folks are aware of this gap. As soon as userspace people with real clue about this topic run into problems they're more than welcome on dri-devel@lists.freedesktop.org and then we can figure out what to implement.&lt;br /&gt;&lt;br /&gt;With that out of the way, let's look at possible solutions.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;FBDEV resets to defaults&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;This is the cheap cop-out that is essentially implemented right now - when switching to a kernel console running on top of the FBDEV emulation KMS drivers can provide, the driver resets atomic properties of new extensions (like rotation, color management, Z-position/alpha/blending, whatever) to hopefully sane defaults. That's good enough for developers hacking around on different compositors, as long as you remember to VT-switch to a kernel console after things went south.&lt;br /&gt;&lt;br /&gt;But FBDEV is seriously uncool, and a lot of people are working towards removing the kernel's VT subsytem from modern distros, too. This doesn't really work everywhere, but it's kinda the minimal and what we'll definitely implement. This has also the downside that maybe you only want to restore some properties, while keeping others (since they might be crucial to your setup, for example rotating the screen).&lt;br /&gt;&lt;br /&gt;&lt;b&gt;System compositor restores boot-up state&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;If doing something in the kernel isn't flexible enough then the usual approach is to do it in userspace. Most systems have some kind of master compositor that's run in-between user sessions, like a login manager. That system compositor could restore modeset state to something sensible every time it runs again, and user session compositors could then take over that sensible setup as their starting point.&lt;br /&gt;&lt;br /&gt;This has the benefit that more clever and specific stuff like only restoring some properties is easy to implement. This shouldn't need a hole lot of code since a compositor needs to be able to restore it's state anyway to allow switching between them.&lt;br /&gt;&lt;br /&gt;But, you're saying, how can a system compositor know about all the possible and future atomic KMS extensions? Won't this scheme break the much heralded extensibility? Well the neat trick is that userspace doesn't need to be able to understand properties to save and restore them - the actual property value transport between kernel and userspace is fully generic. There are a few special cases, like the need to disable outputs that have been unplugged meanwhile, and also some properties with special meaning, like framebuffers. But generic userspace can read out all the metadata, and even if future property types extend e.g. the value range that should still work.&lt;br /&gt;&lt;br /&gt;The downsides of this approach is that it depends upon the global system compositor to do this right, so if that crashes and leaves your display setup in shambles you can't easily recover any more. This also requires that everyone who cares about switching between different compositors to have such a system compositors.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Interlude: Only launching compositors matters&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;The above observation that atomic clients can always faithfully restore a state (even if they don't understand the semantics of all properties) means that switching compositors itself will always work. The real trouble is making sure that a compositor can start up with a sane enough configuration to be able to successfully get pixels onto the screen. &lt;br /&gt;&lt;br /&gt;&lt;b&gt;New atomic IOCTL kernel flag&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;What might be needed is a way to make this safe state persistent in the kernel. The next option tries that, by adding a new flag to the atomic IOCTL which asks the kernel to start out with an atomic KMS state reset to some default value.&lt;br /&gt;&lt;br /&gt;But again the trouble here is, like with the FBDEV approach, that it's monolithic, and doesn't easily allow userspace to control what's being restored. And again the question is, should things get restored to the boot-up state (and which boot-up state - something equivalent to what FBDEV emulation would pick, what the firmware would have picked or a mix), or maybe reset values (set everything to unrotated) is better?&lt;br /&gt;&lt;br /&gt;On top of that most often compositors don't want to reset state at all, to be able to smoothly take over the display configuration from the preceeding KMS client. Users have lost pretty much all appreciation of unsightly flickering that commonly happened in the pre-KMS world when switching compositors.&lt;br /&gt;&lt;br /&gt;Another problem with keeping the boot-up state around is that the kernel then needs to keep a copy of all such state (and some objects like gamma tables are sizeable) around. Just in case there's userspace around to ask for it.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Use SysRq to reset atomic state&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;A problem with adding a flag to the atomic IOCTL to reset state is that all compositors need to implement support for it, and somehow make a decision for when to employ it. But on most systems compositors shouldn't completely mess up the atomic state. Most likely that's after a crash, and then there's no userspace around anyway to fix things up. Now generally this is, or well should, only be a problem for developers, and a possible solution might be to wire up a SysRq hotkey where the kernel force-resets atomic state to defaults. This would be similar to the FBDEV based solution, except without FBDEV and not tied to VT switching.&lt;br /&gt;&lt;br /&gt;An alternative would be to implement this in the boot-splash service, by sampling boot-up state and providing some command to force-reset to that. But that's pretty much the system compositor approach, but using the boot splash, and a tool to restore its state from a stored location, as the system compositor.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Expose reset or boot-up state&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;An easy fix to give control back to userspace over what will get restored is to instead expose the boot-up values or the reset values to userspace, through an extension to the GET_PROPERTY IOCTL. But again storing boot-up state in the kernel would be wasteful on systems that will never need it (like Android or CrOS), and exposing reset values somewhat pointless if e.g. you really want your screen rotated, always.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Per-compositor atomic state&lt;/b&gt;&lt;br /&gt;&lt;br /&gt;A slight spiel on all this is to make atomic state per-compositor in the kernel. This sounds a bit like it might help, but on the other hand implementing full state restore isn't more effort when compositors need to restore their state after a VT switch anyway. This leaves the tricky question of what the inherited state should be when a new compositor starts up: Normally you want the current state, so that the compositor can take over smoothly. Except when that's a really bad idea because the current state is badly mangled from a different compositor that just crashed.&lt;br /&gt;&lt;br /&gt;Overall lots of different approaches and ideas, but no clear winner. That's why kernel folks need distro, compositor and desktop people to run into this issue first, to make sure the solution that lands actually solves the right problem. And in a way that suits userspace.&lt;br /&gt;&lt;br /&gt;Thanks to Daniel Stone, Pekka Paalanen and Ville&lt;span style="font-weight: normal;"&gt;&lt;span class="gD" name="Ville Syrjälä"&gt; Syrjälä for input on this.&lt;/span&gt;&lt;/span&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/8106885102788327740/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/01/vt-switching-with-atomic-modeset.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8106885102788327740'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8106885102788327740'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/01/vt-switching-with-atomic-modeset.html' title='VT Switching with Atomic Modeset'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1984383501718899742</id><published>2016-01-11T08:12:00.000-08:00</published><updated>2016-01-11T08:12:27.039-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 4.5</title><content type='html'>&lt;a href="http://blog.ffwll.ch/2015/12/neat-drmi915-stuff-for-44.html"&gt;Kernel version 4.4&lt;/a&gt; is released, it's time for our regular look at what's in store for the Intel graphics driver in the next release.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;Overall this cycle has seen lots and lots of bugfixes, and the reason for that is that we're rebuilding our CI infrastructure after it went up in a poof of smoke last summer. Really big thanks to the entire team for the effort invested! And that's why this overview is a bit different and we'll start with bugfix efforts before delving into the few feature additions:&lt;br /&gt;&lt;br /&gt;Ville &lt;b&gt;fixed up display fifo underruns&lt;/b&gt; all over the place: FDI modeset fixes for Haswell/Broadwell, correctly detecting fused-of VGA on the same,&amp;nbsp; and disabling fifo underrun reporting in some places where we've learned that underruns just happen - mostly around starting up the display pipeline.&lt;br /&gt;&lt;br /&gt;Next up is &lt;b&gt;improved runtime PM wakelock debugging&lt;/b&gt; from Imre Deak, with efforts from other folks trying to fix up various issues. Unfortunately this turned up so many little buglets that we had to disable the reporting again, at least for now. But at least we'll now have a very clear list of things to address, and a reliable way to audit any failures, to finally be able to enable runtime PM by default hopefully soon.&lt;br /&gt;&lt;br /&gt;There's also been lots of &lt;b&gt;fixes for PSR and FBC&lt;/b&gt; from Rodrigo and Paulo respectively. PSR enabled by default missed the 4.5 merge window by just a hair - it's already enabled for 4.6. FBC is also pretty close, the last bit Paulo is working is untangling the locking issues. FBC is sitting between GEM and KMS and FBC code gets called by both subsystems. And that's an easy recipe for deadlocks, which Paulo is now working to resolve.&lt;br /&gt;&lt;br /&gt;There's also fixes included from Tvrtko Ursulin, Lukas Wunner and Chris Wilson to remedy some long-standing regressions in the &lt;b&gt;fbdev framebuffer setup code&lt;/b&gt;. In GEM finally Dave Gordon &lt;b&gt;fixed issues with the page dirty&lt;/b&gt; tracking. And Chris Wilson &lt;b&gt;fine-tuned the request polling logic&lt;/b&gt; to avoid needlessly wasting CPU cycles.&lt;br /&gt;&lt;br /&gt;Imre, Patrik and others have done a lot of work to &lt;b&gt;fix up various issues in the DMC&lt;/b&gt; firmware loader for Skylake and the DC5/6 support. It works well now on that platform, and could reenable the overall display power well support again on Skylake. But there's still plenty of issues on Broxton unfortunately.&lt;br /&gt;&lt;br /&gt;Since bugfixes have been highly prioritized over feature work this time around there's only very little progress on atomic modesettting and specifically atomic watermark updates. But 4.5 includes a few more prep patches from Maarten Lankhorst and Matt Roper.&lt;br /&gt;&lt;br /&gt;There have been some real features though still: Alex Goins from nvidia implementd proper &lt;b&gt;sync for page-flipping dma-buf&lt;/b&gt; backed framebuffers, benefitting setups where nVidia renders buffers that the Intel driver displays.&lt;br /&gt;&lt;br /&gt;Finally there's also been the usual amount of internal refactoring to prepare the code for the future and keep it maintainable. Jani Nikula &lt;b&gt;rewrote the VBT parsing&lt;/b&gt; code.&amp;nbsp; And Ander started to &lt;b&gt;rework the DP detection&lt;/b&gt; code as the first step of a large DP support revamp. And finally ther's been a bit of &lt;b&gt;enabling for Kabylake&lt;/b&gt; too, but it's not yet complete.&lt;br /&gt;&lt;br /&gt;And of courese there's been a lot more smaller things, again mostly bugfixes.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1984383501718899742/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1984383501718899742'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1984383501718899742'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html' title='Neat drm/i915 stuff for 4.5'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5274572225825971862</id><published>2016-01-10T15:00:00.000-08:00</published><updated>2016-01-10T15:00:00.050-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>Better Markup for the Kernel GPU DocBook</title><content type='html'>This summer Intel sponsored some work to improve the kerneldoc toolchain, with the aim to use all that to extend the DRM and i915 driver documentation we have. Most of it landed, but the last bit to integrate some type&amp;nbsp; of text markup processing was stalled until it could be discussed at the kernel summit, see the  &lt;a href="https://lwn.net/Articles/662930/" rel="nofollow"&gt;LWN summary&lt;/a&gt;. Unfortunately it died in a bikeshed fest due to an alliance of people who think docs are useless and you should just read the code, and others who didn't even know how to convert the kerneldoc into something pretty.&lt;br /&gt;&lt;br /&gt;But we still need this, since without lists, highlighting, basic tables and inserting code snippets it's really hard to write decent documentation. Luckily Dave Airlie is ok with using it for DRM kerneldoc as long as Intel maintains the support. It's purely opt-in and the only downside of not using &lt;code&gt;asciidoc&lt;/code&gt; is that the resulting docs won't be as pretty. All the changes to the text itself to use this markup are going into upstream as normal. The only bit that's not in upstream is the tooling, which is available in a topic branch at&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;        git://anongit.freedesktop.org/drm-intel topic/kerneldoc&lt;/pre&gt;&lt;br /&gt;&lt;br /&gt;If you want to build pretty docs just install &lt;code&gt;asciidoc&lt;/code&gt; and base your drm documentation patches on top of drm-intel-nightly from the same repository - that tree also includes all of Dave's tree. Alternatively pull in the above topic branch into your own personal tree.  Note that &lt;code&gt;asciidoc&lt;/code&gt; is detected automatically, so you really only need it and the tooling branch to check the rendering of your changes.&lt;br /&gt;&lt;br /&gt;For added convenience Intel also maintains an autobuilder that pushes latest drm-intel-nightly DRM documentation builds to      &lt;a href="http://dri.freedesktop.org/docs/drm/" rel="nofollow"&gt;http://dri.freedesktop.org/docs/drm/&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;Aside: If all you want to build is just the GPU DocBook instead of all of them, you can do that with&lt;br /&gt;&lt;br /&gt;&lt;pre&gt;        $ make DOCBOOKS="gpu.xml" htmldocs&lt;/pre&gt;&lt;br /&gt;With that have fun reading the new&amp;amp;improved documentation, and if you spot anything please submit a patch to dri-devel@lists.freedesktop.org. </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5274572225825971862/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2016/01/better-markup-for-kernel-gpu-docbook.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5274572225825971862'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5274572225825971862'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/01/better-markup-for-kernel-gpu-docbook.html' title='Better Markup for the Kernel GPU DocBook'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-64982716988550007</id><published>2015-12-09T00:55:00.003-08:00</published><updated>2015-12-09T02:52:48.769-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Neat drm/i915 stuff for 4.4</title><content type='html'>Due to vacations, conferences and other things I'm way later than usual and &lt;a href="http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html"&gt;4.3 has been released&lt;/a&gt; a while ago. More than overdue to take a look at what's in store in the next kernel release.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;First looking at overall infrastructure work on the display side there's a lot of &lt;b&gt;atomic conversion&lt;/b&gt; progress again. One feature that's now on solid fundations is &lt;b&gt;fastboot, built on top of atomic infrastructure&lt;/b&gt; with patches from Maarten. Unfortunately we had to disable it again due to some backligh issues early in 4.4-rc. The other big piece is reworking the watermark update code (Ville&amp;amp;Matt), which unfortunately ran into regression roadblocks already in the development cycle and had to be reverted partially. Another piece of infrastructure building on top of atomic is &lt;b&gt;validation&amp;amp;adjusting the display clock&lt;/b&gt; - some ULT chips can't drive all DP screens and the driver now detects that, and it should also downclock when less bandwidth is needed. This was implemented by Mika Kahola and Ville.&lt;br /&gt;&lt;br /&gt;Again this round has seen a lot of improvements and &lt;b&gt;bug fixes to PSR code&lt;/b&gt; (from Rodrigo) and for &lt;b&gt;FBC&lt;/b&gt; (from Paulo). Unfortunately we're not yet done with those, but it looks really good that at least PSR can finally be enabled for 4.5. Still on the display side of the driver there was a pile of smaller improvements all over: Prep work for Broxton DSI support (Shashank Sharma). HDMI detection finally checks the hotplug sense, after some workaround from Sonika. And tons of cleanups all over. Fixing up DMC support (for new low-power display states) was also a topic, but we've only managed to fix it up for real in 4.5.&lt;br /&gt;&lt;br /&gt;On the GEM side the big thing for sure is support for the extended &lt;b&gt;48-bit GPU address space&lt;/b&gt; on Broadwell and later chips, from Michel Thierry. And then there's the code for &lt;b&gt;GuC-based command submission&lt;/b&gt; (Alex Dai and Dave Gordon), which is merged but not yet enabled by default. The idea behind that is to feed all command submission through an on-chip microcontroller, which can then react much faster to changing workloads and tune power states accordingly. It should also help long-term with better scheduling by supporting preemption. But none of that is implemented yet, so this is just fundations.&lt;br /&gt;&lt;br /&gt;For existing features there are &lt;b&gt;bugfixes for userptr and shrinker improvements&lt;/b&gt; from Chris Wilson. And Tvrtko has extended the vma view code in prepartion of rotation support for NV12.&lt;br /&gt;&lt;br /&gt;Of course there's also been the usual enabling work for new platforms, this time around mostly consisting of workaround patches for Skylake and Broxton. But Zhiyuan Lv submitted support for the &lt;b&gt;virtualized XenGT gpu support on Broadwell&lt;/b&gt;.&lt;br /&gt;&lt;br /&gt;Finally for driver internals there's the massive work from Ville to &lt;b&gt;make the register access functions type safe&lt;/b&gt;. This is escpecially a problem for writing registers, where both the register and the value that needs to be written are of type &lt;code&gt;uin32_t&lt;/code&gt;. That resulted in subtile bugs fairly often. Ville encapsulated the register offset into a struct and converted all the thousands of register #defines and users over to that, and now compilation will fail if we ever get this wrong again.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/64982716988550007/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/12/neat-drmi915-stuff-for-44.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/64982716988550007'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/64982716988550007'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/12/neat-drmi915-stuff-for-44.html' title='Neat drm/i915 stuff for 4.4'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5289130486490976068</id><published>2015-09-18T08:27:00.000-07:00</published><updated>2015-09-18T08:27:19.744-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>XDC 2015: Atomic Modesetting for Drivers</title><content type='html'>I've done a talk at &lt;a href="http://www.x.org/wiki/Events/XDC2015/"&gt;XDC 2015&lt;/a&gt; about atomic modesetting with a focus for driver writers. Most of the talk is an overview of how an atomic modeset looks and how to implement the different parts in a driver backend. Anyway, for all those who missed it, there's a &lt;a href="https://www.youtube.com/watch?v=kl9suFgbTc8"&gt;video&lt;/a&gt; and &lt;a href="http://people.freedesktop.org/~danvet/presentations/xdc-2015.pdf"&gt;slides&lt;/a&gt;.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5289130486490976068/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/09/xdc-2015-atomic-modesetting-for-drivers.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5289130486490976068'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5289130486490976068'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/09/xdc-2015-atomic-modesetting-for-drivers.html' title='XDC 2015: Atomic Modesetting for Drivers'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5631845111107853206</id><published>2015-09-07T02:40:00.000-07:00</published><updated>2015-09-07T02:40:13.541-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 4.3</title><content type='html'>&lt;a href="http://blog.ffwll.ch/2015/06/neat-drmi915-stuff-for-42.html"&gt;Kernel 4.2&lt;/a&gt; is released already and the 4.3 merge window in full swing, time to look at what's in it for the intel graphics driver.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Biggest thing for sure is that &lt;b&gt;Skylake is finally out of preliminary support&lt;/b&gt; and enabled by default. The reason for the long hold-up was some ABI fumble - the hardware exposes the topmost plane both through the new universal plane registers and the legacy cursor registers and because we simply carried the legacy plane code around in the driver we ended up exposing both. This wasn't something big to take care of but somehow was dragged on forever.&lt;br /&gt;&lt;br /&gt;The other big thing is that now &lt;b&gt;legacy modesets are done with the new atomic modesetting code &lt;/b&gt;driver-internally. Atomic support in i915.ko isn't ready for prime-time yet fully, but this is definitely a big step forward. Besides atomic there's also other cross-platform improvements in the modeset code: Ville fixed up the &lt;b&gt;12bpc support for HDMI&lt;/b&gt;, which is now used by default if the screen supports it. Mika Kahola and Ville also implemented dynamic adjustment of the cdclk, which is the main clock source for display engines on intel graphics. And there's a big difference in the clock speeds needed between e.g. a 4k screen and a 720p TV.&lt;br /&gt;&lt;br /&gt;Continuing with power saving features Rodrigo again spent a lot of time &lt;b&gt;fixing up PSR&lt;/b&gt; (panel self refresh). And Paulo did the same by writing patches to &lt;b&gt;improve FBC &lt;/b&gt;(framebuffer compression). We have some really solid testcases by now, unfortunately neither feature is ready for enabling by default yet. Especially PSR is still plagued by screen freezes on some random systems. Also there's been &lt;b&gt;some fixes to DRRS&lt;/b&gt; (dynamic refresh rate switching) from Ramalingam. DRRS is enabled by default already, where supported. And finally some improvements to make the frontbuffer rendering tracking more accurate, which is used by all three of these display power saving features.&lt;br /&gt;&lt;br /&gt;And of course there's also tons of improvements to platform code. &lt;b&gt;Display PLL code for Sklylake and Valleyview&amp;amp;Cherryview was tuned&lt;/b&gt; by Damien and Ville respectively. There's been &lt;b&gt;tons of work on Broxton and DSI support&lt;/b&gt; by Imre, Gaurav and others.&lt;br /&gt;&lt;br /&gt;Moving on to the rendering side the big change is how tracking of rendering tasks is handled. In the past the driver just used raw sequence numbers emitted by the hardware, but for cross-driver synchronization and reordering tasks with an eventual gpu scheduler more abstraction is needed. A big step is &lt;b&gt;converting over to the i915 request structure&lt;/b&gt; completely, done by John Harrison. The next step will be to switch the internal implementation for i915 requests to the cross-driver fences, but that's for future kernels. As a follow-up cleanup John also &lt;b&gt;removed the OLR&lt;/b&gt;, which stands for outstanding lazy request. It was a neat little trick implemented years ago to simplify handling error recovery, but which causes tons of pain with subtle bugs. Making requests more explicit in the driver allowed us to finally remove this trick since.&lt;br /&gt;&lt;br /&gt;There's also been a pile of platform related features: &lt;b&gt;MOCS programming for Skylake/Broxton&lt;/b&gt; (which is used for caching control). &lt;b&gt;Resource streamer support&lt;/b&gt; from Abdiel, which is used to offload some of the buffer object tracking for shaders from the cpu to the gpu. And the command parser on Haswell was extended to &lt;b&gt;support atomic instructions&lt;/b&gt; in shaders. And finally for Skylake Mika Kuoppala added code to avoid resetting the gpu - in certain cases the hardware would hard-hang the entire system trying to execute the reset. And a dead gpu is still better than a dead system.&lt;br /&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5631845111107853206/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html#comment-form' title='3 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5631845111107853206'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5631845111107853206'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html' title='Neat drm/i915 stuff for 4.3'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>3</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2572132837736503140</id><published>2015-08-16T06:52:00.003-07:00</published><updated>2015-08-16T06:52:37.045-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Atomic Modesetting Design Overview</title><content type='html'>After a few years of development the atomic display update IOCTL for drm drivers is finally ready for prime time with the &lt;a href="http://mid.mail-archive.com/alpine.DEB.2.00.1506260158440.13786@skynet.skynet.ie"&gt;4.2 pull request from Dave Airlie&lt;/a&gt;. It's been a long road, with a lot of drivers &lt;a href="http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html"&gt;already converted over to atomic&lt;/a&gt; and even more in progress, the &lt;a href="http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html"&gt;atomic helper libraries and support code in the drm subsystem&lt;/a&gt; sufficiently polished. But what's really missing is a design overview of what the overall atomic infrastructure looks like and why some decisions and details are implemented like they are.&lt;br /&gt;&lt;br /&gt;That's now done and published on LWN: &lt;a href="https://lwn.net/Articles/653071/"&gt;Part 1 talks about the problem space, issues with the Android atomic display framework and the basic atomic IOCTL interface.&lt;/a&gt; &lt;a href="https://lwn.net/Articles/653466/"&gt;Part 2 goes into more detail about a few specific things like locking, helper library design and the exact semantics of atomic modessetting updates.&lt;/a&gt; Happy Reading! </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2572132837736503140/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/08/atomic-modesetting-design-overview.html#comment-form' title='1 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2572132837736503140'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2572132837736503140'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/08/atomic-modesetting-design-overview.html' title='Atomic Modesetting Design Overview'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>1</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6166429885530302954</id><published>2015-06-01T02:14:00.000-07:00</published><updated>2015-06-26T01:58:24.199-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 4.2</title><content type='html'>The &lt;a href="http://blog.ffwll.ch/2015/04/neat-drmi915-stuff-for-41.html"&gt;4.1 kernel release&lt;/a&gt; is still a few weeks off and hence a bit early to talk about 4.2. But the drm subsystem feature cut-off already passed and I'm going on vacation for 2 weeks, so here we go.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;First things first: No, i915 does not yet support atomic modesets. But a lot of progress has been made again towards enabling it. As I explained last time around the trouble is that the intel driver has grown its own almost-atomic modeset infrastructure over the past few years. And now we need to convert that to the slightly different proper atomic support infrastructure merged into the drm core, which means lots and lots of small changes all over the driver. A big part merged in this release is the &lt;b&gt;removal of the -&amp;gt;new_config&lt;/b&gt; pointer by Ander, Matt &amp;amp; Maarten. This was the old i915-specific pointer to the staged new configuration. Removing it required switching all the CRTC code over to handling the staged configuration stored in the struct drm_atomic_state to be compatible with the atomic core. Unfortunately we still need to do the same for encoder/connector states and for plane states, so there's still lots of shuffling pending for 4.2.&lt;br /&gt;&lt;br /&gt;There has also been other feature work going on on the modeset side: Ville &lt;b&gt;cleaned&amp;amp;fixed up the CDCLK support&lt;/b&gt; in anticipation of implementing dynamic display clock frequency scaling. Unfortunately that part of his patches hasn't landed yet. Ville has also merged patches to &lt;b&gt;fix up some details in the CPT modeset sequence&lt;/b&gt;, maybe this will finally fix the remaining "DP port stuck" issues we still seem to have.&lt;br /&gt;&lt;br /&gt;Looking at newer platforms the interesting bit is &lt;b&gt;rotation support for SKL&lt;/b&gt; from Sonika and Tvrtko. Compared to older platforms skl now also supports 90° and 270° rotation in the scanout engines, but only when the framebuffer uses a special tiling layout (which have been enabled in 4.0). A related feature is &lt;b&gt;support for plane/CRTC scalers on SKL&lt;/b&gt;, provided by Chandra. Skylake has also gained support for the new &lt;b&gt;low-power display states DC5/6&lt;/b&gt;. For &lt;b&gt;Broxton basic enabling has landed&lt;/b&gt;, but there's nothing too interesting yet besides piles of small adjustments all over. This is because Broxton and Skylake have a common display block (similar to how the render block for atom chips was already shared since Baytrail) and hence share a lot of the infrastructure code. Unfortunately neither of these platforms has yet left the preliminary hardware support label for the i915 driver.&lt;br /&gt;&lt;br /&gt;There's also a few minor features in the display code worth mentioning: &lt;b&gt;DP compliance testing infrastructure&lt;/b&gt; from Todd Previte - DP compliance test devices have a special DP AUX sidechannel protocol for requesting certain test procedures and hence need a bit of driver support. Most of this will be in userspace though, with the kernel just forward requests and handing back results. Mika Kahola has &lt;b&gt;optimized the DP link training&lt;/b&gt;, the kernel will now first try to use the current values (either from a previous modeset or set up by the firmware). &lt;b&gt;PSR has also seen some more work&lt;/b&gt;, unfortunately it's still not yet enabled by default. And finally there's been lots of cleanups and improvements under the hood all over, as usual.&lt;br /&gt;&lt;br /&gt;A big feature is the &lt;b&gt;dynamic pagetable allocation for gen8+&lt;/b&gt; from Michel Thierry and Ben Widawsky. This will greatly reduce the overhead of PPGTT and is a requirement for 48bit address space support - with that big a VM preallocating all the pagetables is just not possible any more. The &lt;b&gt;gen7 cmd parser&lt;/b&gt; is now finally fixed up and enabled by default (thanks to Rebecca Palmer for one crucial fix), which means finally some newer GL extensions can be used without adding kernel hacks. And Chris Wilson has fine-tuned the cmd parser with a big pile of patches to reduce the overhead. And Chris has &lt;b&gt;tuned the RPS boost&lt;/b&gt; code more, it should now no longer erratically boost the GPU's clock when it's inappropriate. He has also written a lot of patches to &lt;b&gt;reduce the overhead of execlist&lt;/b&gt; command submission, and some of those patches have been merged into this release.&lt;br /&gt;&lt;br /&gt;Finally two pieces of prep work: A few patches from John Harrison to &lt;b&gt;prepare for removing the outstanding lazy request&lt;/b&gt;. We've added this years ago as a cheap way out of a memory and ringbuffer space preallocation issue and ever since then paid the price for this with added complexity leaking all over the GEM code. Unfortunately the actual removal is still pending. And then Joonas Lahtinen has implemented &lt;b&gt;partial GTT mmap&lt;/b&gt; support. This is needed for virtual enviroments like XenGT where the GTT is cut up between the different guests and hence badly fragmented. The merged code only supports linear views and still needs support for fenced buffer objects to be actually useful.&lt;br /&gt;&lt;br /&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6166429885530302954/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/06/neat-drmi915-stuff-for-42.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6166429885530302954'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6166429885530302954'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/06/neat-drmi915-stuff-for-42.html' title='Neat drm/i915 stuff for 4.2'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2077528684329538002</id><published>2015-05-08T06:21:00.001-07:00</published><updated>2015-05-08T06:21:08.637-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>GFX Kernel Upstreaming Requirements</title><content type='html'>Upstreaming requirements for the DRM subsystem are a bit special since Dave Airlie requires a full-blown open-source implementation as a demonstration vehicle for any new interfaces added. I've figured it's better to clear this up once instead of dealing with the fallout from surprises and made a few slides for a training session. Dave reviewed and acked them, hence this should be the up-to-date rules - the old mails and &lt;a href="https://airlied.livejournal.com/73337.html"&gt;blogs&lt;/a&gt; &lt;a href="https://airlied.livejournal.com/73337.html"&gt;back&lt;/a&gt; &lt;a href="https://airlied.livejournal.com/76383.html"&gt;from&lt;/a&gt; when some ARM SoC vendors tried to push drm drivers for blob userspace to upstream are a bit outdated.&lt;br /&gt;&lt;br /&gt;Any here's the &lt;a href="https://secure.freedesktop.org/~danvet/presentations/gfx_kmd_upstream_abi_requirements.pdf"&gt;slides for my gfx kernel upstreaming requirements training&lt;/a&gt;.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2077528684329538002/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/05/gfx-kernel-upstreaming-requirements.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2077528684329538002'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2077528684329538002'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/05/gfx-kernel-upstreaming-requirements.html' title='GFX Kernel Upstreaming Requirements'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1727790391245288063</id><published>2015-04-19T20:57:00.001-07:00</published><updated>2015-04-19T20:57:44.735-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 4.1</title><content type='html'>With &lt;a href="http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html"&gt;Linux kernel v3.20^W v4.0&lt;/a&gt; already out there door my overview of what's in 4.1 for drm/i915 is way overdue.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;First looking at the modeset side of the driver the big overall thing is all the work to convert i915 to atomic. In this release there's code from Ander Conselvan de Oliveira to have a&lt;b&gt; struct drm_atomic_state allocated for all the legacy modeset code paths&lt;/b&gt; in the driver. With that we can switch the internals to start using atomic state objects and gradually convert over everything to atomic on the modeset side. Matt Roper on the other hand was busy to prepare the plane code to land the atomic watermark update code. Damien has &lt;b&gt;reworked the initial plane configuration code&lt;/b&gt; used for fastboot, which also needs to be adapted to the atomic world.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;For more specific feature work there's the &lt;b&gt;DRRS&lt;/b&gt; (dynamic refresh rate switching) from Sonika, Vandana and more people, which is now enabled where supported. The idea is to reduce the refresh rate of the panel to save power when nothing changes on the screen. And Paulo Zanoni has provided patches to &lt;b&gt;improve the FBC code&lt;/b&gt;, hopefully we can enable that by default soon too. Under the hood Ville has &lt;b&gt;refactored the DP link rate computation and the sprite color key handling&lt;/b&gt;, both to prepare for future work and platform enabling. &lt;b&gt;Intermediate link rate support for eDP&lt;/b&gt; 1.4 from Sonika built on top of this. Imre Deak has also reworked the Baytrail/Braswell &lt;b&gt;DPLL code to prepare for Broxton&lt;/b&gt;.&lt;br /&gt;&lt;br /&gt;Speaking of platforms, Skyleigh has gained&lt;b&gt; runtime PM&lt;/b&gt; support from Damien, and &lt;b&gt;RPS&lt;/b&gt; (render turbo and sleep states) from Akash. Another SKL exclusive is support for &lt;b&gt;scanout of Y-tiled buffers&lt;/b&gt; and scanning out buffers rotated by 90°/270° (instead of just normal and rotated by 180°) from Tvrtko and Damien. Well the rotation support didn't quite land yet, but Tvrtko's support for the special pagetable binding needed for that feature in the form of &lt;b&gt;rotated GGTT views&lt;/b&gt;. Finally Nick Hoath and Damien also submitted a lot of workaround patches for SKL.&lt;br /&gt;&lt;br /&gt;Moving on to &lt;b&gt;Braswell/Cherryview &lt;/b&gt;there have been tons of fixes to the DPLL and watermark code from Vijay and Ville, and &lt;b&gt;BSW left the preliminary hw support&lt;/b&gt;. And also for the SoC platforms Chris Wilson has supplied a pile of patches to &lt;b&gt;tune the rps code&lt;/b&gt; and bring it more in-line with the big core platforms.&lt;br /&gt;&lt;br /&gt;On the GT side the big ongoing work is &lt;b&gt;dyanmic pagetable allocations&lt;/b&gt; Michel Thierry based upon patches from Ben Widawsky. With per-process address spaces and even more so with the big address spaces gen8+ supports it would be wasteful if not impossible to allocate pagetables for the entire address space upfront. But changing the code to handle another possible memory allocation failure point needed a lot of work. Most of that has landed now, but the benefits of enabling bigger address spaces haven't made it into 4.1.&lt;br /&gt;&lt;br /&gt;Another big work is &lt;b&gt;XenGT client-side support&lt;/b&gt; fromYu Zhang and team. This is paravirtualization to allow virtual machines to tap into the render engines without requiring exclusive access, but also with a lot less overhead than full virtual hardware like vmware or virgil would provide. The host-side code is also submitted already, but needs a bit more work still to integrate cleanly into the driver.&lt;br /&gt;&lt;br /&gt;And of course there's been lots of other smaller work all over, as usual. Internal documentation for the shrinker, more dead UMS code removed, the vblank interrupt code cleaned up and more.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1727790391245288063/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/04/neat-drmi915-stuff-for-41.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1727790391245288063'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1727790391245288063'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/04/neat-drmi915-stuff-for-41.html' title='Neat drm/i915 stuff for 4.1'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2307160452468978284</id><published>2015-04-02T00:53:00.001-07:00</published><updated>2015-04-02T00:53:32.319-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>Community Code of Conduct for intel-gfx</title><content type='html'>[This is a cross-post from the &lt;a href="http://lists.freedesktop.org/archives/intel-gfx/2015-April/063766.html"&gt;mail I just sent out to intel-gfx&lt;/a&gt;.] &lt;br /&gt;&lt;br /&gt;Code of conducts seem to be in the news a bit recently, and I realized that I've never really documented how we run things. It's different from the kernel's overall &lt;a href="https://www.kernel.org/doc/Documentation/CodeOfConflict"&gt;CodeOfConflict&lt;/a&gt; and also differs from the official &lt;a href="https://01.org/linuxgraphics/community"&gt;Intel/OTC one&lt;/a&gt; in small details about handling issues. And for completeness there's also the &lt;a href="http://www.x.org/wiki/XorgFoundation/Policies/Harassment/"&gt;Xorg Foundation event policy&lt;/a&gt;. Anyway, I think this is worth clarifying and here it goes.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;It's simple: Be respectful, open and excellent to each another.&lt;br /&gt;&lt;br /&gt;Which doesn't mean we want to sacrifice quality to be nice. Striving for technical excellence very much doesn't exclude being excellent to someone else, and in our experience it tends to go hand in hand.&lt;br /&gt;&lt;br /&gt;Unfortunately things go south occasionally. So if you feel threatened, personally abused or otherwise uncomfortable, even and especially when you didn't participate in a discussion yourself, then please raise this in private with the drm/i915 maintainers (currently Daniel Vetter and Jani Nikula, see &lt;a href="https://www.kernel.org/doc/linux/MAINTAINERS"&gt;MAINTAINERS&lt;/a&gt; for contact information). And the "in private" part is important: Humans screw up, disciplining minor fumbles by tarnishing someones google-able track record forever is out of proportion.&lt;br /&gt;&lt;br /&gt;Still there are some teeth to this code of conduct:&lt;br /&gt;&lt;br /&gt;1. First time around minor issues will be raised in private.&lt;br /&gt;&lt;br /&gt;2. On repeat cases a public reply in the discussion will enforce that respectful behavior is expected.&lt;br /&gt;&lt;br /&gt;3. We'll ban people who don't get it.&lt;br /&gt;&lt;br /&gt;And severe cases will be escalated much quicker.&lt;br /&gt;&lt;br /&gt;This applies to all community communication channels (irc, mailing list and bugzilla). And as mentioned this really just is a public clarification of the rules already in place - you can't see that though since we never had to go further than step 1.&lt;br /&gt;&lt;br /&gt;Let's keep it at that.&lt;br /&gt;&lt;br /&gt;And in case you have a problem with an individual drm/i915 maintainer and don't want to raise it with the other one there's the &lt;a href="http://www.x.org/wiki/BoardOfDirectors/"&gt;Xorg BoD&lt;/a&gt;, &lt;a href="http://www.linuxfoundation.org/programs/advisory-councils/tab"&gt;linux foundation TAB&lt;/a&gt; and the drm upstream maintainer Dave Airlie.&lt;br /&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2307160452468978284/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/04/community-code-of-conduct-for-intel-gfx.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2307160452468978284'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2307160452468978284'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/04/community-code-of-conduct-for-intel-gfx.html' title='Community Code of Conduct for intel-gfx'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-746164648252083417</id><published>2015-02-11T15:20:00.000-08:00</published><updated>2015-02-11T15:20:25.645-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 Stuff for 3.20</title><content type='html'>&lt;a href="http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html"&gt;Linux 3.19&lt;/a&gt; was just released and my usual overview of what the next merge window will bring is more than overdue. The big thing overall is certainly all the work around &lt;a href="http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html"&gt;atomic display updates&lt;/a&gt;, but read on for what else all has been done.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;Let's first start with all the driver internal rework to support atomic. The big thing with atomic is that it requires a clean split between code that checks display updates and the code that commits a new display state to the hardware. The corallary from that is that any derived state that's computed in the validation code and needed int the commit code must be stored somewhere in the state object. Gustavo Padovan and Matt Roper have done all that work to &lt;b&gt;support atomic plane updates&lt;/b&gt;. This is the code that's now in 3.20 as a tech preview. The big things missing for proper atomic plane updates is async commit support (which has already landed for 3.21) and support to adjust watermark settings on the fly. Patches for from Ville have been around for a long time, but need to be rebased, reviewed and extended for recently added platforms.&lt;br /&gt;&lt;br /&gt;On the modeset side Ander Conselvan de Oliveira has done a lot of the necessary work already. Unfortunately converting the modeset code is much more involved for mainly two reaons: First there's a lot more derived state that needs to be handled, and the existing code already has structures and code for this. Conceptually the code has been prepared for an atomic world since the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;big display rewrite&lt;/a&gt; and the introduction of &lt;a href="http://blog.ffwll.ch/2013/07/precomputing-crtc-configuration-in.html"&gt;CRTC configuration structures&lt;/a&gt;. But &lt;b&gt;converting the i915 modeset code to the new DRM atomic structures and interface&lt;/b&gt; is still a lot of work. Most of these refactorings have landed in 3.20. The other hold-up is shared resources and the software state to handle that. This is mostly for handling display PLLs, but also other shared resources like the display FIFO buffers. Patches to handle this are still in-flight.&lt;br /&gt;&lt;br /&gt;Continuing with modeset work Jani Nikula has reworked the &lt;b&gt;DSI support to use the shared DSI helpers&lt;/b&gt; from the DRM core. Jani also reworked the DSI to in preparation for &lt;b&gt;dual-link DSI support&lt;/b&gt;, which Gaurav Singh implemented. Rodrigo Vivi and others provided a lot of patches to &lt;b&gt;improve PSR support&lt;/b&gt; and enable it for Baytrail/Braswell. Unfortunately there's still issues with the automated testcase and so PSR unfortunately stays disabled by default for now. Rodrigo also wrote some nice DocBook &lt;b&gt;documentation for fbc&lt;/b&gt;, another step towards fully documenting i915 driver internals.&lt;br /&gt;&lt;br /&gt;Moving on to platform enabling there has been a lot of work from Ville on &lt;b&gt;Cherryview&lt;/b&gt;: RPS/gpu turbo and pipe CRC support (used for automated display testing) are both improved. On &lt;b&gt;Skylake&lt;/b&gt; almost all the basic enabling is merged now: PM patches, enabling mmio pageflips and fastboot support from Damien have landed. Tvrtko Ursulin also create the infrastructure for &lt;b&gt;global GTT views&lt;/b&gt;. This will be used for some upcoming features on Skylake. And to simplify enabling future platforms Chris Wilson and Mika Kuoppala have completely &lt;b&gt;rewritten the forcewake domains handling&lt;/b&gt; code.&lt;br /&gt;&lt;br /&gt;Also really important for Skylake is that the &lt;b&gt;execlist support&lt;/b&gt; for gen8+ command submission is finally in a good enough to be used by default - on Skylake that's the only support path, legacy ring submission has been deprecated. Around that feature and a few other closely related ones a lot of code was refactoring: John Harrison implemented the &lt;b&gt;conversion from raw sequence numbers to request objects&lt;/b&gt; for gpu progress tracking. This as is also prep work for landing a gpu scheduler. Nick Hoath removed the special execlist request tracking structures, simplifying the code. The &lt;b&gt;engine initialization code was also refactored&lt;/b&gt; for a cleaner split between software and hardware initialization, leading to robuster code for driver load and system resume. Dave Gordon has also reworked the code tracking and computing the ring free space. On top of that we've also &lt;b&gt;enabled full ppgtt&lt;/b&gt; again, but for now only where execlists are available since there are still issues with the legacy ring-based pagetable loading.&lt;br /&gt;&lt;br /&gt;For generic GEM work there's the really nice support for &lt;b&gt;write-combine cpu memory mappings&lt;/b&gt; from Akash Goel and Chris Wilson. On Atom SoC platforms lacking the giant LLC bigger chips have this gives a really fast way to upload textures. And even with LLC it's useful for uploading to scanout targets since those are always uncached. But like the special-purpose uploads paths for LLC platforms the cpu mmap views do not detile textures, hence special-purpose fastpaths need to be written in mesa and other userspace to fully exploit this. In other GEM features the shadow batch copying code for the command parser has now also landed.&lt;br /&gt;&lt;br /&gt;Finally there's the redesign from Imre Deak to &lt;b&gt;use the component framework for the snd-hda/i915 interactions&lt;/b&gt;. Modern platforms need a lot of coordination between the graphics and sound driver side for audio over hdmi, and thus far this was done with some ad-hoc dynamic symbol lookups. Which results in a lot of headaches to get the ordering correctly for driver load or system suspend and resume. With the component framework this depency is now explicit, which means we will be able to get rid of a few hacks. It's also much easier to extend for the future - new platforms tend to integrate different components even more.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/746164648252083417/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/746164648252083417'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/746164648252083417'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html' title='Neat drm/i915 Stuff for 3.20'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-9029048282758780689</id><published>2015-01-28T09:18:00.000-08:00</published><updated>2015-01-28T09:18:55.513-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Update for Atomic Display Updates</title><content type='html'>Another kernel release is imminent and a lot of things happened since my last big blog post about &lt;a href="http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html"&gt;atomic modeset&lt;/a&gt;. Read on for what new shiny things 3.20 will bring this area.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;&lt;h3&gt;Atomic IOCTL and Properties&lt;/h3&gt;&lt;br /&gt;The big thing for sure is that the actual atomic IOCTL from Ville has finally landed for 3.20. That together with all the work from Rob Clark to add all the new atomic properties to make it functional (there's no IOCTL structs for any standard values, everything is a property now) means userspace can finally start using atomic. Well, it's still hidden behind the experimental module option &lt;code&gt;drm.atomic=1&lt;/code&gt; but otherwise it's all there. There's a few big differences compared to earlier iterations:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Core properties are now fully handled by the core, drivers can only decode their own properties. This should mean that the handling of standardized properties should be more uniform and also makes it easier to extend (e.g. with the standardized rotation property we already have) beyond the paramaters the legacy interfaces provided.&lt;/li&gt;&lt;li&gt;Atomic props&amp;amp;ioctl are opt-in per file_priv, userspace needs to explicitly ask for it. This is the same idea as with universal plane support and will make sure that old userspace doesn't get confused and fall over when it would see all the new atomic properties. In the same spirit some of the legacy-only properties (like DPMS) will be rejected in the atomic IOCTL paths.&lt;/li&gt;&lt;li&gt;Atomic modesets are currently not possible since the exact ABI for how to handle the mode property is still under discussion. The big missing thing is handling blob properties, which will also be needed to upload gamma table updates through the atomic interface.&lt;/li&gt;&lt;/ul&gt;Another missing piece that's now resolved is the DPMS support. On a high level this greatly reduces the complexity of the legacy DPMS settings into a&amp;nbsp; simple per-CRTC boolean. Contemporary userspace really wants nothing more and anything but a simple on/off is the only thing that current hardware can support. Furthermore all the bookkeeping is done in the helpers, which call down into drivers to enable or disable entire display pipelines as needed. Which means that drivers can rip out tons of code for the legacy DPMS support by just wiring up &lt;code&gt;drm_atomic_helper_connector_dpms&lt;/code&gt;.&lt;br /&gt;&lt;br /&gt;&lt;h3&gt;New Driver Conversions and Backend Hooks&lt;/h3&gt;&lt;br /&gt;Another big thing for 3.20 is that driver support has moved forward greatly: Tegra has now most of the basic bits ready, MSM is already converted. Both still lack conversion and testing for DPMS since that landed very late though. There's a lot of prep work for exynos, but unfortunately nothing yet towards atomic support. And i915 is in the process of being converted to the new structures and will have very preliminary atomic plane updates support in 3.20, hidden behind a module option for now.&lt;br /&gt;&lt;br /&gt;And all that work resulted in piles of little fixes. Like making sure that the legacy cursor IOCTLs don't suddenly stall a lot more, breaking old userspace. But we also added a bunch more hooks for driver backends to simplifiy driver code:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;For drivers there's often a very big difference between a plane update, and disabling a plane. And with atomic state objects it's a bit more work to figure out when exactly you're doing a on to off transition. Thierry Redding added a new optional &lt;code&gt;-&amp;gt;atomic_plane_disable()&lt;/code&gt; hook for drivers which will take care of all those disdinctions.&lt;/li&gt;&lt;li&gt;Mostly for hysterical raisins going back to the original Xrandr implementations for userspace mode setting the callbacks to enable and disable encoders and CRTCs used by the various helper libraries have really confusing names. And with the legacy helpers all kinds of strange semantics. Since the atomic helpers massively simplify things in this area it made a lot of sense to add a new set of &lt;code&gt;-&amp;gt;enable()&lt;/code&gt; and &lt;code&gt;-&amp;gt;disable()&lt;/code&gt; hooks, which are preferred if they're set. All the other hooks (namely &lt;code&gt;-&amp;gt;prepare()&lt;/code&gt;, &lt;code&gt;-&amp;gt;commit()&lt;/code&gt; and &lt;code&gt;-&amp;gt;dpms()&lt;/code&gt;) will eventually be deprecated for atomic drivers. Note that &lt;code&gt;-&amp;gt;mode_set&lt;/code&gt; is already superseeded by &lt;code&gt;-&amp;gt;mode_set_nofb&lt;/code&gt; due to the explicit primary plane handling with atomic updates.&lt;/li&gt;&lt;/ul&gt;Finally driver conversions showed that vblank handling requirements imposed by the atomic helpers are a lot stricter than what userspace tends to cope with. i915 has recently reworked all its vblank handling and improved the core helpers with the addition of &lt;code&gt;drm_crtc_vblank_off()&lt;/code&gt; and &lt;code&gt;drm_crtc_vblank_on()&lt;/code&gt;. If these are used in the CRTC disable and enable hooks the vblank code will automatically reject vblank waits when the pipe is off. Which is the behaviour both the atomic helpers and the transitional helpers expect.&lt;br /&gt;&lt;br/&gt;One complication is that on load the driver must ensure manually that the vblank state matches up with the hardware and atomic software state with a manual call to these functions. In the simple case where drivers reset everything to off (which is what the reset implementations provided by the atomic helpers presume) this just means calling &lt;code&gt;drm_crtc_vblank_off()&lt;/code&gt; somewhen in the driver load code. For drivers that read out the actual hardware state they need to call either &lt;code&gt;_off()&lt;/code&gt; or &lt;code&gt;_on()&lt;/code&gt; matching on the actual display pipe status.&lt;br /&gt;&lt;br /&gt;&lt;h3&gt;Future Work&lt;/h3&gt;&lt;br /&gt;Of course there's still a few things left to do before atomic display updates can be rolled out to the masses. And a few things that would be rather nice to have, too:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Support for blob properties so that modesets and a bunch of other neat things can finally be done.&lt;/li&gt;&lt;li&gt;Testing, and lots of it, before we enable atomic by default.&lt;/li&gt;&lt;li&gt;Thanks to DP MST connectors can be hotplugged, and there are still a lot of lifetime issues surrounding connector handling all over the drm subsystem. Atomic display code is unfortunately no exception.&lt;/li&gt;&lt;li&gt;And finally try to make the vblank code a bit more generally useful and then implement generic async atomic commit on top of that.&lt;/li&gt;&lt;/ul&gt;It's promising to keep interesting!</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/9029048282758780689/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9029048282758780689'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/9029048282758780689'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html' title='Update for Atomic Display Updates'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6543470772358829887</id><published>2015-01-18T21:55:00.003-08:00</published><updated>2015-01-18T21:55:25.511-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LCA 2015: Botching Up IOCTLs</title><content type='html'>So I'm stuck somewhere on an airport and jetlagged on my return trip from my very first LCA in Auckland - awesome conference, except for being on the wrong side of the globe: Very broad range of speakers, awesome people all around, great organization and since it's still a community conference none of the marketing nonsense and sales-pitch keynotes.&lt;br /&gt;&lt;br /&gt;Also done a presentation about &lt;a href="http://blog.ffwll.ch/2013/11/botching-up-ioctls.html"&gt;botching up ioctls&lt;/a&gt;. Compared to my blog post a bunch more details on technical issues and some overall comments on what's really important to avoid a v2 ioctl because v1 ended up being unsalvageable. &lt;a href="http://people.freedesktop.org/~danvet/presentations/lca-2015.pdf"&gt;Slides&lt;/a&gt; and &lt;a href="https://www.youtube.com/watch?v=WnqXHs_tGR4"&gt;video&lt;/a&gt; (curtesy the LCA video team).</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6543470772358829887/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2015/01/lca-2015-botching-up-ioctls.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6543470772358829887'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6543470772358829887'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/01/lca-2015-botching-up-ioctls.html' title='LCA 2015: Botching Up IOCTLs'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149</id><published>2014-12-16T13:03:00.000-08:00</published><updated>2014-12-16T13:03:06.285-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.19</title><content type='html'>So &lt;a href="http://blog.ffwll.ch/2014/10/neat-drmi915-stuff-for-318.html"&gt;kernel version 3.18&lt;/a&gt; is out the door and it's time for our regular look at what's in the next merge window.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;First looking at new hardware the big item is &lt;b&gt;basic Skylake support&lt;/b&gt;. There are still a few smalls things missing, but mostly it's there now. This has been contributed by Damien, Satheeshakrishna and a lot of other folks. Looking at other platforms there has also been a lot of &lt;b&gt;changes for vlv/chv&lt;/b&gt;: &lt;b&gt;Improved&lt;/b&gt; &lt;b&gt;backlight code&lt;/b&gt;, completely &lt;b&gt;refactored interrupt handling&lt;/b&gt; to bring it in line with other platforms, &lt;b&gt;rewritten panel power sequencing&lt;/b&gt; code, all from Ville. Rodrigo contributed &lt;b&gt;PSR support&lt;/b&gt; for vlv/chv together with a lot of other fixes for PSR. Unfortunately it's not yet again enabled by default.&lt;br /&gt;&lt;br /&gt;Moving on to Broadwell and the render side of things, Mika and Arun provided patches to &lt;b&gt;improve the render workaround code&lt;/b&gt; and bring the set of workarounds up to date. &lt;b&gt;execlist&lt;/b&gt; (the new command submission support on Gen8+) is also being polished with the addition of &lt;b&gt;on-demand pinning&lt;/b&gt; of context objects with patches from Thomas Daniel and Oscar Mateo. Finally the RPS/render-turbo code has seen a lot of polish from Imre with a few fixes from Tom O'Rourke.&lt;br /&gt;&lt;br /&gt;Otherwise not a lot of really big things happened on the GEM side: Just a few  patches to fix issues in ppgtt (unfortunately still not enabled by  default anywhere due to fun with context switches). And there's a bit of  prep work and reorg all over for new stuff landing hopefully soon.&lt;br /&gt;&lt;br /&gt;Looking at overall infrastructure changes the big thing certainly is the &lt;b&gt;preparations for atomic display updates&lt;/b&gt;. The drm core/driver interface for atomic and all the helper library code to convert drivers has landed in 3.19, and already some conversions. On the Intel side it's been just prep work under the hood thus far with patches from Ander to &lt;b&gt;precompute display PLL state&lt;/b&gt;. The new code to &lt;b&gt;use vblank evades for pagelips&lt;/b&gt; has also landed, which is needed for atomic plane updates. And prep patches from Gustavo Padovan started to &lt;b&gt;split the low-level plane update functions into check and commit&lt;/b&gt; steps. Lots more patches from different people are in flight and some have been merged for 3.20 already.&lt;br /&gt;&lt;br /&gt;Besides these driver internal changes for atomic there has been other work to improve the codebase: Imre &lt;b&gt;reorganized our handlers for suspend, resume &lt;/b&gt;and thawing and freezing. Jani &lt;b&gt;reworked the audio and eld code&lt;/b&gt; which is the gfx side of the puzzle needed to make audio over HDMI or DP work. Jesse provided patches to &lt;b&gt;track infoframes&lt;/b&gt; more accurately, which is needed to correctly fastboot (i.e. without modesets if possible) on external screens.&lt;br /&gt;&lt;br /&gt;For older machines Ville has spent a few spare cycles to make them more useful: GPU &lt;b&gt;reset support for gen3/4&lt;/b&gt; should mitigate some of the recent chromium crashes on mesa, and the &lt;b&gt;modeset code on i830M might work correctly&lt;/b&gt; for the first time, ever.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;And of course the usual pile of smaller fixes and improvements all over.&lt;br /&gt;&lt;br /&gt;Not directly related to code or features is the start of &lt;b&gt;documenting i915 driver internals&lt;/b&gt;: With this release we now have some of the interrupt handling, fifo underrun reporting, frontbuffer tracking and runtime pm support newly document. And there's lots more in-flight, so hopefully soonish this will be fairly useful.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6057911954792525149/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html#comment-form' title='5 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' title='Neat drm/i915 stuff for 3.19'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>5</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8822981517130755067</id><published>2014-11-02T10:49:00.002-08:00</published><updated>2014-11-03T14:23:30.264-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Atomic Modeset Support for KMS Drivers</title><content type='html'>&lt;p&gt;So I've just reposted my &lt;a href="http://article.gmane.org/gmane.comp.video.dri.devel/117376"&gt;atomic modeset helper series&lt;/a&gt;, and since the main goal of all that work was to ensure a smooth and simple transition for existing drivers to the promised atomic land it's time to elaborate a bit. The big problem is that the existing helper libraries and callbacks to driver backends don't really fit the new semantics, so some shuffling was required to avoid long-term pain. So if you are a driver writer and just interested in the details then read for what needs to be done to support atomic modeset updates using these new helper libraries.&lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h3&gt;Phase 1: Reworking the Driver Backend Functions for Planes&lt;/h3&gt;&lt;p&gt;The first phase is reworking the driver backend callbacks to fit the new world. There are two big mismatches between the new atomic semantics and legacy ioctl interfaces:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The primary plane is no longer tied to the CRTC. Instead it is possible to enable the CRTC without any planes (resulting in a black screen) or only overlay planes. And the primary plane can be enabled/disabled and moved without changing the mode (of course only if the hardware actually supports it). But the existing CRTC helper library used to implement modesets only provides the single &lt;code&gt;crtc-&amp;gt;mode_set&lt;/code&gt; driver callback which always implicitly enables the primary plane, too.&lt;/li&gt;&lt;li&gt;Atomic updates of multiple planes isn't supported at all. And worse the code to check whether a plane update will work out is smashed into the same callback that does the actual plane update, defeating the check/commit distinction used in atomic interfaces.&lt;/li&gt;&lt;/ul&gt;Both issues are addressed by adding new driver backend callbacks. Furthermore a few transitional helper functions are provided to implement the legacy entry points in terms of these new callbacks. That way the driver backend can be reworked without the additional hassle of needing to deal with all the atomic state object handling and check/commit semantics.&lt;br /&gt;&lt;br /&gt;The first step is to rework the &lt;code&gt;-&amp;gt;disable/update_plane&lt;/code&gt; hooks using the transitional helper implementations &lt;code&gt;drm_plane_helper_update/disable&lt;/code&gt;. These need the following new driver callbacks:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;-&amp;gt;atomic_check&lt;/code&gt; for both CRTCs and planes. This isn't strictly required, but any state checks implemented in the current &lt;code&gt;-&amp;gt;update_plane&lt;/code&gt; hook must be moved into the plane's -&amp;gt;atomic_check callback. The CRTC's callback will likely be empty for now.&lt;/li&gt;&lt;li&gt;&lt;code&gt;-&amp;gt;atomic_begin&lt;/code&gt; and &lt;code&gt;-&amp;gt;atomic_flush&lt;/code&gt; CRTC callbacks. These wrap the actual plane update and should do per-CRTC work like preparing to send out the flip completion event. Or ensure that the plane updates are actually done atomically by e.g. setting/clearing GO bits or latching the update through some other means. Or if the hardware does not provide any support for synchronized updates, use vblank evasion to ensure all updates happen on the same frame.&lt;/li&gt;&lt;li&gt;&lt;code&gt;-&amp;gt;prepare_fb&lt;/code&gt; and &lt;code&gt;-&amp;gt;cleanup_fb&lt;/code&gt; hooks are also optional. These are used to setup the framebuffers, e.g. pin their backing storage into memory and set up any needed hardware resources. The important part is that besides the &lt;code&gt;-&amp;gt;atomic_check&lt;/code&gt; callbacks &lt;code&gt;-&amp;gt;prepare_fb&lt;/code&gt; is the only new callback which is allowed to fail. This is important to make asynchronous commits of atomic state updates work. The helper library guarantees that for any successful call of &lt;code&gt;-&gt;prepare_fb&lt;/code&gt; it will call &lt;code&gt;-&gt;cleanup_fb&lt;/code&gt; - even when something else fails in the atomic update.&lt;/li&gt;&lt;li&gt;Finally there's &lt;code&gt;-&amp;gt;atomic_update&lt;/code&gt;. That's the function which does all the per-plane update, like setting up the new viewport or the new base address of the framebuffer for each plane.&lt;/li&gt;&lt;/ul&gt;With this it's also easy to implement universal plane support directly, instead of with the default implementation which doesn't allow the primary plane to be disabled.  Universal planes are a requirement for atomic and need to be implemented in phase 1, but testing the primary plane support is also a good preparation for the next step: &lt;p&gt;The new &lt;code&gt;crtc-&amp;gt;mode_set_nofb&lt;/code&gt; callback must be implement, which just updates the CRTC timings and data in the hardware without touching the primary plane state at all. The provided helpers functions &lt;code&gt;drm_helper_crtc_mode_set&lt;/code&gt; and &lt;code&gt;drm_helper_crtc_mode_set_base&lt;/code&gt; then implement the callbacks required by the CRTC helpers in terms of the new &lt;code&gt;-&amp;gt;mode_set_nofb&lt;/code&gt; callback and the above newly implemented plane helper callbacks.&lt;/p&gt;&lt;h3&gt;Phase 2: Wire up the Atomic State Object Scaffolding &lt;/h3&gt;&lt;p&gt;With the completion of phase 1 all the driver backend functions have been adapted to the new requirements of the atomic helper library. The goal of phase 2 is to get all the state object handling needed for atomic updates into place. There are three steps to that:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The first is fairly simply and consists in just wiring up all the state reset, duplicate and destroy functions for planes, CRTCs and connectors. Except for really crazy cases the default implementations from the atomic helper library should be good enough, at least to get started. With this there will always be an atomic state object stored in each object's &lt;code&gt;-&amp;gt;state&lt;/code&gt; pointer.&lt;/li&gt;&lt;li&gt;The second step is patching up the state objects in legacy code paths to make sure that we can partially transition to atomic updates. If your driver doesn't have any transition checks for plane updates (i.e. doesn't ever look at the old state to figure out whether an change is possible) then all you need to do is keep the framebuffer pointers and reference counts in balance with &lt;code&gt;drm_atomic_set_fb_for_plane&lt;/code&gt;. The transitional helpers from phase 1 already do this, so usually the only place this is needs to be manually added is in the &lt;code&gt;-&amp;gt;page_flip&lt;/code&gt; callback.&lt;/li&gt;&lt;li&gt;Finally all &lt;code&gt;-&amp;gt;mode_fixup&lt;/code&gt; callbacks need to be audited to not depend upon any state which is only set in the various CRTC helper callbacks and not tracked by the atomic state objects. This isn't required for implementing the legacy interfaces using atomic updates, but this is important to correctly implement the check/commit semantics. Especially when the commit is done asynchronously. This really is a corner-case though, but any such code must be moved into &lt;code&gt;-&amp;gt;atomic_check&lt;/code&gt; hooks and rewritten in terms of the atomic state objects.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Phase 3: Rolling out Atomic Support&lt;/h3&gt;&lt;p&gt;With the driver backend changes from phase 1 and the state handling changes from phase 2 everything is ready for the step-by-step rollout of atomic support. Presuming nothing was missed this just consists of wiring up the -&amp;gt;atomic_check and -&amp;gt;atomic_commit implementations from the atomic helper library. And then replacing all the legacy entry pointers with the corresponding functions from the atomic helper library to implement them in terms of atomic.&lt;/p&gt;The recommended order is to start with planes first, then test the -&amp;gt;set_config functionality. Page flips and properties are best done later since they likely need some additional work:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;The atomic helper library doesn't provide any default asynchronous commit support, since driver and hardware requirements seem to be too diverse. At least until we have a few proper implementations and can use them to extract a good set of helper functions. Hence drivers must implement basic async commit support using the building blocks provided (and other drm and kernel infrastructre like flip queues, fence callbacks and work items - hopefully soonish also vblank callbacks).&lt;/li&gt;&lt;li&gt;Property values need to be moved into the relevant state object first before the corresponding implementations can be wired up. As long as the driver doesn't yet support the full atomic ioctl this can be done at leisure, but must be completed before the ioctl can be enabled. To do so drivers need to subclass the relevant state structure and reimplement all the state handling functions rolled out in phase 2.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Besides these two complications (which might require a bit of work depending upon the driver) this is all that's needed for full atomic modeset and pageflip support.&lt;/p&gt;&lt;h3&gt;Follow-up Driver Cleanups&lt;/h3&gt;&lt;p&gt;But there's of course quite a bit of cleanup work possible afterards!&lt;/p&gt;The are some big differences between the old CRTC helper modeset logic and the new one (using the same callbacks, but completely rewritten otherwise) in the atomic helper library:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;The encoder/bridge/CRTC enabling/disabling sequence for a given modeset configuration is now always the same. Which means unused CRTC won't be disabled any more only after everything else is set up, but together with all the other blocks before enabling anything from the new configuration. Also, when an output pipeline changes the helper library will always force a full modeset of the entire pipeline.&lt;br /&gt;This reduces combinatorial complexity a lot and should especially help with shared resources (like PLLs) - no longer can a modeset spuriously fail just because the old CRTC hasn't released its PLL before the new one was enabled.&lt;/li&gt;&lt;li&gt;Thanks to the atomic state tracking the helper code won't lose track of the software state of each object any more. Which means disabled functions won't be disabled more than once. So all code in the driver-backend which checks the current state and acts accordingly can be flattened and replaced by WARNings.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;These are all lessons learned from the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;i915 modeset rewrite&lt;/a&gt;. The only thing missing in the atomic helpers compared to i915 is the &lt;a href="http://blog.ffwll.ch/2013/07/precomputing-crtc-configuration-in.html"&gt;state readout and cross-checking support&lt;/a&gt; - everything else is there. But even that can be easily implemented by adding hardware state readout callbacks and using them in the various state reset functions (to reconstruct matching software state) and also to cross-check state.&lt;br /&gt;&lt;br /&gt;The other big cleanup task is to stop using all the legacy state variables and switch all the driver backend code to only look at the state object structures. The two big examples here are &lt;code&gt;crtc-&amp;gt;mode&lt;/code&gt; and the &lt;code&gt;plane-&amp;gt;fb&lt;/code&gt; pointer.&lt;/p&gt;&lt;h3&gt;So What Now?&lt;/h3&gt;&lt;p&gt;With all that converting drivers should be simple and can be done with a series of not-too-invasive refactorings. But my patch series doesn't yet contain the actual atomic modeset ioctl. So what's left to be done in the drm core?&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Per-plane locking is still missing - currently all plane-related changes just lock all CRTCs. Which is a bit too much, and in cases like the cursor plane or for page flips actually a regression compared to the legacy code paths.&lt;/li&gt;&lt;li&gt;The atomic ioctl uses properties for everything, even for the standard properties inherited from the legacy ioctls. All the code for parsing properties exists already in Rob Clark's patch series, but needs to be rebased and adpated to the slightly different interfaces this latest iteration of the internal atomic interface has.&lt;/li&gt;&lt;li&gt;The fbdev emulation needs to grow proper atomic check/commit support. This is both a good kernel-internal validation of the atomic interface and would finally allow us to get multi-pipe configuration for fbcon to work correctly. But before we can do this we need a driver with multiple CRTCs, shared resource constraints and proper atomic support to be able to even test this.&lt;/li&gt;&lt;li&gt;There's still some room for more helpers, for example pretty much all drivers have some sort of vblank driver callback and work item infrastructure. That's better done as a helper in the core vblank handling code.&lt;/li&gt;&lt;li&gt;And finally we need the actual ioctl code.&lt;/li&gt;&lt;/ul&gt;So still a few things to do, besides adding atomic support to all drivers. &lt;br /&gt;&lt;br /&gt;&lt;b&gt;Update:&lt;/b&gt; The explanation for how to implement state readout and cross checking was a bit confused, so I reworded that.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/8822981517130755067/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html#comment-form' title='1 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8822981517130755067'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8822981517130755067'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html' title='Atomic Modeset Support for KMS Drivers'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>1</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4075400659743837174</id><published>2014-10-03T08:47:00.000-07:00</published><updated>2014-11-02T06:31:49.294-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.18</title><content type='html'>Since Dave Airlie moved the feature cut-off of the drm-next tree roughly one month ahead it is already time for our regular look at what's ahead. Even though &lt;a href="http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html"&gt;the 3.17 features&lt;/a&gt; aren't even released yet.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;On the modeset side of things we now have the final pieces for &lt;b&gt;plane rotation support&lt;/b&gt; from Sonika Jindal and Ville. The DisplayPort code has also seen lots of improvements, with updated training values in preparation of the latest eDP standard (Sonika Jindal) and support for &lt;b&gt;DP training&lt;/b&gt; pattern 3 (Ville). DSI panels now support burst mode (Shobhit) and hdmi conformance has been improved with some fixes from Clint Taylor.&lt;br /&gt;&lt;br /&gt;For eDP panels we also have &lt;b&gt;improved panel power sequencing code&lt;/b&gt;, mostly to fix issues on Cherryview, from Ville. Ville has also contributed fixes to the VDD handling code, which is used to temporarily enable panel power. And the backlight code learned to handle the bl_power setting so that the backlight can be turned off completely without upsetting the panel's power sequencing, contributed by Jani.&lt;br /&gt;&lt;br /&gt;Chris Wilson has also been fairly busy on the modeset code: 3.18 includes his patches to &lt;b&gt;cache EDIDs&lt;/b&gt; for a single probe call - unfortunately the full caching solution to keep the EDID around between multiple probe calls isn't merged yet. And &lt;b&gt;pageflips have now improved error detection and recovery &lt;/b&gt;logic: In case something goes wrong we shouldn't end up stuck any longer waiting for a pageflip to complete that has been lost by either the hardware or the driver.&lt;br /&gt;&lt;br /&gt;Moving on to platform specific work there's been lots of &lt;b&gt;preparations for Skylake&lt;/b&gt;, most of it from Damien and Sonika. The actual intial platform enabling is delayed for 3.19 though. On the other end of the timeline Ville &lt;b&gt;fixed up i830M modeset support&lt;/b&gt; on a rainy w/e in his vacation, and 3.18 now has all that code. And there has been a lot of &lt;b&gt;Cherryview fixes&lt;/b&gt; all over.&lt;br /&gt;&lt;br /&gt;Cherryview also gained support for power wells and hence runtime pm (Ville). And for platform agnostic feature a lot of the &lt;b&gt;preparation for DRRS &lt;/b&gt;(dynamic refresh rate switching) is merged, hopefully the actual feature patches from Vandana Kannan will land in 3.19.&lt;br /&gt;&lt;br /&gt;Moving on the render side of the driver there's been a lot of patches to beat the &lt;b&gt;full ppgtt support into shape&lt;/b&gt;. The context code has been cleaned up, lifetime handling for ppgtt address spaces is fixed and bad interactions with secure batches are now also rectified. Enabling full ppgtt missed the feature cutoff by a hair though, but it's already enabling for the following release.&lt;br /&gt;&lt;br /&gt;Basic support for &lt;b&gt;execlists command submission&lt;/b&gt; from Ben Widawsky, Oscar Mateo and Thomas Daniel was also merged. This is the fancy new way to submit commands available on Gen8 and subsequent platforms. It's not yet enabled by default, but since it's a requirement for a lot of cool new features keep an eye on what's going on here. There is also a lot of work going on underneath to enable all this new code in GEM, like preparing to switch away from sequence numbers to tracking gpu progress more abstractly using the driver's request structures.&lt;br /&gt;&lt;br /&gt;And this time around there is also some cool stuff going on in the drm core worth of a shout-out: The &lt;b&gt;vblank handling code is massively revamped&lt;/b&gt;, hopefully plugging all the small races, inconsistencies and inefficiencies in that code. And thanks to David Herrmann it is finally possible to write a&lt;b&gt; drm driver without the drm midlayer&lt;/b&gt; getting completely in the way of a proper driver load and unload sequence! Unfortunately i915 can't be converted right away since the legacy usermodesetting code crucial relies on this midlayer functionality. But that's now well deprecated and hopefully can be removed in one of the next releases.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4075400659743837174/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/10/neat-drmi915-stuff-for-318.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4075400659743837174'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4075400659743837174'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/10/neat-drmi915-stuff-for-318.html' title='Neat drm/i915 stuff for 3.18'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5773001722969153808</id><published>2014-08-29T09:14:00.000-07:00</published><updated>2014-08-29T09:14:46.642-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Review Training Slides</title><content type='html'>We currently have a large influx of new people contributing to i915 - for the curious just check the git logs. As part of ramping them up I've done a few trainings about upstream review, and a bunch of people I've talked with at KS in Chicago were interested in that, too. So I've cleaned up the slides a bit and dropped the very few references to Intel internal resources. No speaker notes or video recording, but I think this is useful all in itself. And of course if you have comments or see big gaps - feedback is very much welcome:&lt;br /&gt;&lt;br /&gt;&lt;a href="http://people.freedesktop.org/~danvet/presentations/review-training-public.pdf"&gt;Upstream Review Training Slides&lt;/a&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5773001722969153808/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/08/review-training-slides.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5773001722969153808'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5773001722969153808'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/08/review-training-slides.html' title='Review Training Slides'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3223799358281583581</id><published>2014-08-07T07:29:00.000-07:00</published><updated>2014-08-07T08:36:55.470-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat stuff for 3.17</title><content type='html'>So with the &lt;a href="http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html"&gt;3.16 kernel&lt;/a&gt; out of the door it's time to look at what's queued up for the Intel graphics driver in 3.17.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;This release features the &lt;b&gt;universal plane&lt;/b&gt; support from Matt Roper, all enabled already by default. This is prep work for atomic modesetting and pageflipping support: Since a while we support additional (overlay) planes in the DRM core and the i915 driver, but there have always been two implicit planes directly attached to the CRTC: The primary plane used by the SetCrtc and PageFlip functions, and the optional cursor support. But with the atomic ioctl these implicit planes it's easier to handle everything as an explicit plane, so Matt's patches split them away into separate real plane objects. This is a nice cleanup of the kms api in general since a lot of SoC hardware has unified plane hardware, where cursor, primary plane and any overlays are fully interchangeable. So we already expose this to userspace, if it sets the corresponding feature flag.&lt;br /&gt;&lt;br /&gt;Another big feature on the display side is the &lt;b&gt;improved PSR&lt;/b&gt; support, which is now enabled by default on Haswell and Broadwell. The tricky bit with PSR (and also with FBC) and the reason we didn't yet enable this by default is correctly support legacy frontbuffer rendering (for example for X). The hardware provides a bit of support to do that, but it doesn't catch all possible frontbuffer rendering and has a lot of other limitations. To finally fix this for real we've added &lt;b&gt;accurate frontbuffer tracking&lt;/b&gt; in software. This should finally allow us to enable a lot of display power saving features by default like PSR on Baytrail, FBC (on all platforms) and DRRS (dynamic refresh rate switching).&lt;br /&gt;&lt;br /&gt;On actual platform display enabling we have lots of improvements all over: Baytrail MIPI &lt;b&gt;DSI support&lt;/b&gt; has greatly stabilized, &lt;b&gt;backlight and power sequencer&lt;/b&gt; fixes, &lt;b&gt;mmio based flips&lt;/b&gt; to work around issues with stalls and hangs for blitter ring based flips and plenty of other work. The core drm pieces for &lt;b&gt;plane rotation support&lt;/b&gt; have also landed, unfortunately the i915 parts didn't make the cut for 3.17.&lt;br /&gt;&lt;br /&gt;Another big area, as usual, has been general power management improvements. We now support &lt;b&gt;runtime PM for DPMS Off&lt;/b&gt; and not just when the output is completely disabled. This was fairly invasive work since our current modesetting code assumed that a DPMS Off/On cycle will not destroy register state, but that's exactly what runtime PM can do. On the plus side this reorganization greatly cleaned up the code base and prepared the driver for atomic modesetting, which requires a similar separation between state computation and actual hw state updating like this feature.&lt;br /&gt;&lt;br /&gt;Jesse Barnes implemented &lt;b&gt;S0ix support&lt;/b&gt; for system suspend/resume. Marketing has some crazy descriptions for this, but essentially this means that we use the same power saving knobs for system suspend as for runtime PM - the entire machine is still running, just at a very low power state. Long-term this should simplify our system suspend code a bit since we can just reuse all the code used to implement runtime PM.&lt;br /&gt;&lt;br /&gt;Moving on to the render side of the gpu there have been again improvements to the rps code. Chris Wilson further &lt;b&gt;tuned the rps boost&lt;/b&gt; logic, and Ville and Deepak implemented &lt;b&gt;rps support for Cherrytrail&lt;/b&gt;.&lt;br /&gt;Jesse contributed &lt;b&gt;ppgtt support for Baytrail&lt;/b&gt; which will be a lot more interesting once we enable full ppgtt again (hopefully in 3.18).&lt;br /&gt;&lt;br /&gt;For &lt;b&gt;Broadwell semaphores&lt;/b&gt; support from Ben and Rodrigo was merged, but it looks like we need to disable that again due to stability issues. Oscar Mateo also implemented a large pile of &lt;b&gt;interrupt handling improvements &lt;/b&gt;which hopefully address the small races and bugs we've had in the past on some platforms. There's also a lot of refactoring patches to &lt;b&gt;prepare for execlist&lt;/b&gt; support from Oscar. Excelists are the new way of submitting work to the gpu, first supported on Broadwell (but not yet mandatory). The key feature compared to legacy ringbuffer submission is that we'll finally be able to preempt gpu tasks.&lt;br /&gt;&lt;br /&gt;And as usual there have been tons of bugsfixes and improvements all over. Oh and: User mode setting has moved one step further on the path to deprecation and is now fully disabled. If no one complains about this we can finally rip out all that code in one of the next kernel releases.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3223799358281583581/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3223799358281583581'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3223799358281583581'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html' title='Neat stuff for 3.17'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6079091040906080615</id><published>2014-06-11T11:51:00.001-07:00</published><updated>2014-06-11T11:51:32.241-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Documentation for drm/i915</title><content type='html'>So over the past few years the drm subsystem gained some very nice documentation. And recently we've started to follow suite with the Intel graphics driver. All the kernel documenation is integrated into one big DocBook and I regularly upload latest HTML builds of the &lt;a href="http://people.freedesktop.org/~danvet/drm/"&gt;Linux DRM Developer's Guide&lt;/a&gt;. This is built from drm-intel-nightly so has slightly freshed documentation (hopefully) than the usual DocBook builds from Linus' main branch which can be found all over the place. If you want to build these yourself simply run&lt;br /&gt;&lt;br /&gt;&lt;code&gt;$ make htmldocs&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;For testing we now also have neat &lt;a href="http://people.freedesktop.org/~danvet/igt/"&gt;documentation for the infrastructure and helper libraries found in intel-gpu-tools&lt;/a&gt;. The README in the i-g-t repository has detailed build instructions - gtkdoc is a bit more of a fuzz to integrate.&lt;br /&gt;&lt;br /&gt;Below the break some more details about documentation requirements relevant for developers.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;So from now on I expect reasonable documentation for new, big kernel features and for new additions to the i-g-t library.&lt;br /&gt;&lt;br /&gt;For i-g-t the process is simple: Add the gtk-doc comment blocks to all newly added functions, install and build with gtk-doc enabled. Done. If the new library is tricky (for example the pipe CRC support code) a short overview section that references some functions to get people started is useful, but not really required. And with the exception of the still in-flux kernel modesetting helper library i-g-t is fully documented, so there's lots of examples to copy from.&lt;br /&gt;&lt;br /&gt;For the kernel this is a bit more involved, mostly since kerneldoc sucks more. But we also only just started with documenting the drm/i915 driver itself.&lt;br /&gt;&lt;ol&gt;&lt;li&gt;First extract all the code for your new feature into a new file. There's unfortunately no other way to sensibly split up and group the reference documentation with kerneldoc. But at least that will also be a good excuse to review the related interfaces before extracting them.&lt;/li&gt;&lt;li&gt;Create reference kerneldoc comments for the functions used as interfaces to the rest of the driver. It's always a bit a judgement call what to document and what not, since compared to the DRM core where functions must be explicitly exported to drivers there's no clean separate between the core parts and subsystems and more mundane platform enabling code. For big and complicated features it's also good practice to have an overview &lt;code&gt;DOC:&lt;/code&gt; section somewhere at the beginning of the file.&lt;/li&gt;&lt;li&gt;Note that kerneldoc doesn't have support for markdown syntax (or anything else like that) and doesn't do automatic cross-referencing like gtk-doc. So if you documentation absolutely needs a table or a list you have to do it twice unfortunately: Once as a plain code comment and once as a DocBook marked-up table or list. Long-term we want to improve the kerneldoc markup support, but for now we have to deal with what we have.&lt;/li&gt;&lt;li&gt;As with all documentation don't document the details of the implementation - otherwise it will get stale fast because comments are often overlooked when updating code.&lt;/li&gt;&lt;li&gt;Integrate the new kerneldoc section into the overall DRM DocBook template. Note that you can't go deeper than a &lt;code&gt;section2&lt;/code&gt; nesting for otherwise the reference documentation won't be lists, and due to the lack of any autogenerated cross-links inaccessible and useless. Build the html docs to check that your overview summary and reference sections have all been pulled in and that the kerneldoc parser is happy with your comments.&lt;/li&gt;&lt;/ol&gt;A really nice example for how to do this all is the documentation for the gen7 cmd parser in &lt;code&gt;i915_cmd_parser.c&lt;/code&gt;. </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6079091040906080615/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/06/documentation-for-drmi915.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6079091040906080615'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6079091040906080615'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/06/documentation-for-drmi915.html' title='Documentation for drm/i915'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1326050572154159414</id><published>2014-06-10T02:16:00.000-07:00</published><updated>2014-06-10T02:30:51.439-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.16</title><content type='html'>Linus decided to have a bit fun with the 3.16 merge window and the &lt;a href="http://blog.ffwll.ch/2014/04/neat-drmi915-stuff-for-315.html"&gt;3.15 release&lt;/a&gt;, so I'm a bit late with our regular look at the new stuff for the Intel graphics driver.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;First things first, Baytrail/Valleyview has finally gained support for &lt;b&gt;MIPI DSI panels&lt;/b&gt;! Which means no more ugly hacks to get machines like the ASUS T100 going for users and no more promises we can't keep from developers - it landed for real this time around. Baytrail has also seen a lot of polish work in e.g. the infoframe handling, power domain reset, ...&lt;br /&gt;&lt;br /&gt;Continuing on the new hardware platform this release features the first version of our &lt;b&gt;prelimary support for Cherryview&lt;/b&gt;. At a very high level this combines a Gen8 render unit derived from Broadwell with a beefed-up Valleyview display block. So a lot of the enabling work boiled down to wiring up existing code, but of course there's also tons of new code to get all the details rights. Most of the work has been done by Ville and Chon Ming Lee with lots of help from other people.&lt;br /&gt;&lt;br /&gt;Our modeset code has also seen lots of improvements. The user-visible feature is surely &lt;b&gt;support for large cursors&lt;/b&gt;. On high-dpi panels 64x64 simply doesn't cut it and the kernel (and latest SNA DDX) now support up to the hardware limit of 256x256. But there's also been a lot of improvements under the hood: More of Ville's &lt;b&gt;infrastructure for atomic pageflips&lt;/b&gt; has been merged - slowly all the required pieces like unified plane updates for modeset, two stage watermark updates or atomic sprite updates are falling into place. Still a lot of work left to do though. And the modesetting infrasfrastucture has also seen a bit of work by the almost complete &lt;b&gt;removal of the &lt;code&gt;-&amp;gt;mode_set&lt;/code&gt; hooks&lt;/b&gt;. We need that for both atomic modeset updates and for proper runtime PM support.&lt;br /&gt;&lt;br /&gt;On that topic: &lt;b&gt;Runtime power management&lt;/b&gt; is now enabled for a bunch of our recent platforms - all the prep work from Paulo Zanoni and Imre Deak in the past few releases has finally paid off. There's still leftovers to be picked up over the coming releases like proper runtime PM support for DPMS on all platforms, addressing a bunch of crazy corner cases, rolling it out on the newer platforms like Cherryview or Broadwell and cleaning the code up a bit. But overall we're now ready for what the marketing people call "connected standy", which means that power consumption with all devices turned off through runtime pm should be as low as when doing a full system suspend. It crucially relies upon userspace not sucking and waking the cpu and devices up all the time, so personally I'm not sure how well this will work out really.&lt;br /&gt;&lt;br /&gt;Another piece for proper atomic pageflip support is the &lt;b&gt;universal primary plane&lt;/b&gt; support from Matt Roper. Based upon his DRM core work in 3.15 he now enabled the universal primary plane support in i915 properly. Unfortunately the corresponding patches for cursor support missed 3.16. The universal plane support is hence still disabled by default. For other atomic modeset work a shout-out goes to Rob Clark who's locking conversion to &lt;b&gt;wait/wound mutexes&lt;/b&gt; for modeset objects has been merged.&lt;br /&gt;&lt;br /&gt;On the GEM side Chris Wilson massively &lt;b&gt;improved our OOM handling&lt;/b&gt;. We are now much better at surviving a crash against the memory brickwall. And if we don't and indeed run out of memory we have much better data to diagnose the reason for the OOM. The &lt;b&gt;top-down PDE allocator&lt;/b&gt; from Ben Widawsky better segregates our usage of the GTT and is one of the pieces required before we can enable full ppgtt for production use. And the &lt;b&gt;command parser&lt;/b&gt; from Brad Volkin is required for some OpenGL and OpenCL features on Haswell. The parser itself is fully merged and ready, but the actual batch buffer copying to a secure location missed the merge window and hence it's not yet enabled in permission granting mode.&lt;br /&gt;&lt;br /&gt;The big feature to pop the champagne though is the &lt;b&gt;userptr&lt;/b&gt; support from Chris - after years I've finally run out of things to complain about and merged it. This allows userspace to wrap up any memory allocations obtained by &lt;code&gt;malloc()&lt;/code&gt; (or anything else backed by normal pages) into a GEM buffer object. Useful for faster uploads and downloads in lots of situation and currently used by the DDX to wrap X shmem segments. But OpenCL also wants to use this.&lt;br /&gt;&lt;br /&gt;We've also enabled a few &lt;b&gt;Broadwell features&lt;/b&gt; this time around: &lt;b&gt;eDRAM&lt;/b&gt; support from Ben, &lt;b&gt;VEBOX2&lt;/b&gt; support from Zhao Yakui and &lt;b&gt;gpu turbo&lt;/b&gt; support from Ben and Deepak S.&lt;br /&gt;&lt;br /&gt;And finally there's the usual set of improvements and polish all over the place: &lt;b&gt;GPU reset improvements&lt;/b&gt; on gen4 from Ville, &lt;b&gt;prep work for DRRS&lt;/b&gt; (dynamic refresh rate switching) from Vandana, tons of &lt;b&gt;interrupt and especially vblank handling rework&lt;/b&gt; (from Paulo and Ville) and lots of other things.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1326050572154159414/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html#comment-form' title='3 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1326050572154159414'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1326050572154159414'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html' title='Neat drm/i915 stuff for 3.16'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>3</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-202618990586317078</id><published>2014-05-07T14:45:00.003-07:00</published><updated>2014-05-07T14:45:57.649-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>LinuxTag 2014</title><content type='html'>Tomorrow I'll be travelling to LinuxTag in Berlin for the first time. Should be pretty cool, and to top it off I'll give a presentation about the &lt;a href="http://www.linuxtag.org/2014/de/programm/vortragsdetails/?eventid=2332"&gt;state of the intel kernel graphics driver&lt;/a&gt;. For those that can't attend I've uploaded the &lt;a href="http://people.freedesktop.org/~danvet/presentations/linuxtag-2014.odp"&gt;slides&lt;/a&gt; already, and if there's a video cut I'll link to that as soon as it's available.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/202618990586317078/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/05/linuxtag-2014.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/202618990586317078'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/202618990586317078'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/05/linuxtag-2014.html' title='LinuxTag 2014'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5069398136577877315</id><published>2014-04-01T04:03:00.000-07:00</published><updated>2014-04-01T04:03:13.886-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.15</title><content type='html'>So the release of the &lt;a href="https://www.blogger.com/%3Cdegasus%3E%20but%20when%20implementing%20running%20based%20on%20walking%20needs%20some%20major%20api%20changes%20:/"&gt;3.14 linux kernel&lt;/a&gt; already happended and I'm a bit late for our regular look at what cool stuff will land in the 3.15 merge window for the Intel graphics driver.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;The first big thing is Ben Widawsky's support for &lt;b&gt;per-process address spaces&lt;/b&gt;. Since a long time we've already supported the per-process gtt page tables the hardware provides, but only with one address space. With Ben's work we can now manage multiple address spaces and switch between them, at least on Ivybridge and Haswell. Support for Baytrail and Broadwell for this feature is still in progress. This finally allows multiple different users to use the gpu concurrently without accidentally leaking information between applications. Unfortunately there have been a few issues with the code still so we had to disable this for 3.15 by default.&lt;br /&gt;&lt;br /&gt;Another really big feature was the much more &lt;b&gt;fine-grained display power domain&lt;/b&gt; handling and a lot of &lt;b&gt;runtime power management infrastructure&lt;/b&gt; work from Imre and Paulo. Intel gfx hardware always had lots of automatic clock and power gating, but recent hardware started to have some explicit power domains which need to be managed by the driver. To do that we need to keep track of the power state of each domain, and if we need to switch something on we also need to restore the hardware state. On top of that every platform has it's own special set of power domains and how the logical pieces are split up between them also changes. To make this all manageable we now have an extensive set of display power domains and functions to handle them as abstraction between the core driver code and the platform specific power management backend. Also a lot of work has happened to allow us to reuse parts of our driver resume/suspend code for runtime power management. Unfortunately the patches merged into 3.15 are all just groundwork, new platforms and features will only be enabled in 3.16.&lt;br /&gt;&lt;br /&gt;Another long-standing nuisance with our driver was the take-over from the firmware configuration. With the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;reworked modesetting infrastructure&lt;/a&gt; we could take over the output routing, and with the experimental i915.fastboot=1 option we could eschew the initial modeset. This release Jesse provided another piece of the puzzle by allowing the driver to &lt;b&gt;inherit the firmware framebuffer&lt;/b&gt;. There's still more work to do to make fastboot solid and enable it by default, but we now have all the pieces in place for a smooth and fast boot-up.&lt;br /&gt;&lt;br /&gt;There&amp;nbsp; have been &lt;b&gt;tons of patches for Broadwell&lt;/b&gt; all over the place. And we still have some features which aren't yet fully enabled, so there will be lots more to come. Other smaller features in 3.15 are &lt;b&gt;improved support for framebuffer compression&lt;/b&gt; from Ville, again more work still left. &lt;b&gt;5.4GHz DisplayPort&lt;/b&gt; support, which is a required to get 4k working. Unfortunately most 4k DP monitors seem to expose two separate screens and so need a adriver with working MST (multi-stream support) which we don't yet support. On that topic: The i915 driver now uses the &lt;b&gt;generic DP aux helpers&lt;/b&gt; from Thierry Redding. Having shared code to handle all the communication with DP sinks should help a lot in getting MST off the ground. And finally I'd like to highlight the &lt;b&gt;large cursor support&lt;/b&gt;, which should be especially useful for high-dpi screens.&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;And of course there's been fixes and small improvements all over the place, as usual.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5069398136577877315/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/04/neat-drmi915-stuff-for-315.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5069398136577877315'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5069398136577877315'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/04/neat-drmi915-stuff-for-315.html' title='Neat drm/i915 stuff for 3.15'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8956176966686217947</id><published>2014-02-04T15:02:00.000-08:00</published><updated>2014-02-04T15:02:24.507-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>New drm/i915 Git Repository</title><content type='html'>So earlier this year I've signed up &lt;a href="http://comments.gmane.org/gmane.comp.freedesktop.xorg.drivers.intel/31780"&gt;Jani Nikula officially as co-maintainer&lt;/a&gt;. Now we've also gotten around to move the drm/i915 git repository to a &lt;a href="http://cgit.freedesktop.org/drm-intel"&gt;common location&lt;/a&gt; so that there's no longer a need to move it around when I'm on vacation. So everone please update any git references and remotes:&lt;br /&gt;&lt;pre&gt;&lt;br /&gt;&lt;a href="git://anongit.freedesktop.org/drm-intel"&gt;git://anongit.freedesktop.org/drm-intel&lt;/a&gt;&lt;br /&gt;&lt;a href="ssh://git.freedesktop.org/git/drm-intel"&gt;ssh://git.freedesktop.org/git/drm-intel&lt;/a&gt;&lt;br /&gt;&lt;/pre&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/8956176966686217947/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/02/new-drmi915-git-repository.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8956176966686217947'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8956176966686217947'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/02/new-drmi915-git-repository.html' title='New drm/i915 Git Repository'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5608395435030887397</id><published>2014-02-04T01:42:00.000-08:00</published><updated>2014-02-13T15:32:35.886-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>FOSDEM: Testing Kernel GPU Drivers</title><content type='html'>So as usual FOSDEM was a blast and as usual the hallway track was great too. The beer certainly helped with that ... Big props to the entire conference crew for organizing a stellar event and specifically to Luc and the other graphics devroom people.&lt;br /&gt;&lt;br /&gt;I've also uploaded the slides for my &lt;a href="http://people.freedesktop.org/~danvet/presentations/fosdem-2014.odp"&gt;Kernel GPU Driver Testing&lt;/a&gt; talk. My OCD made me remove that additional dot and resurrect the missing 'e' in one of the slides even. FOSDEM also had live-streaming and rendering videos should eventually show up, I'll add the link as soon as it's there.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Update:&lt;/b&gt; FOSDEM staff published the &lt;a href="http://video.fosdem.org/2014/H1301_Cornil/Sunday/Testing_Kernel_GFX_Drivers.webm"&gt;video of the talk&lt;/a&gt;! </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5608395435030887397/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5608395435030887397'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5608395435030887397'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html' title='FOSDEM: Testing Kernel GPU Drivers'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559</id><published>2014-01-15T09:29:00.001-08:00</published><updated>2014-01-15T09:29:24.124-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.14</title><content type='html'>&lt;a href="http://blog.ffwll.ch/search/label/Kernel%20RelNotes"&gt;Kernel v3.13&lt;/a&gt; is nearing its release, so it's time at our regular look at what the next version will bring to the Intel gfx driver.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;This time around there was a lot of infrastructure work for improved power management. Imre Deak implemented code to &lt;b&gt;manage display power wells&lt;/b&gt; in a more generic way so that the current Haswell support is also ready for other platforms. Unfortunately new platform support hasn't landed yet. But for Haswell we now have working &lt;b&gt;runtime D3&lt;/b&gt; support, contributed by Paulo Zanoni. For Baytrail/Valleyview Deepak S provided improvements to the &lt;b&gt;GT power well&amp;nbsp; force-wake &lt;/b&gt;code - on these mobile platforms it is split up between the render engine and more auxiliary engines like the blitter and the video decode hardware.&lt;br /&gt;&lt;br /&gt;Back to the topic of display and power management Ville Syrjälä contributed a lot of patches to fix little issues in the &lt;b&gt;watermark computation&lt;/b&gt; code and als for the &lt;b&gt;framebuffer compression&lt;/b&gt; support. The motivation for this is Ville's atomic pageflip feature work which not only needs to update all the scanout targets (primary plane, sprites, ...) but also all derived state perfectly synchronized to the next vblank. And especially the watermark updates have proven to be really tricky to get right. Finally Jani Nikula has completely &lt;b&gt;rewritten our low-level backlight&lt;/b&gt; code. This has already fixed a few bugs, and hopefully this new code will give us fewer headaches in the future than the old one. Note that this is just about the raw backlight interface provided by Intel's integrated gpu, almost all machines use some other PWM or at least have some fanciness (written in ACPI scripts) on top of that. So don't expect your backlight to magically work perfectly, this is just a tiny piece of the puzzle.&lt;br /&gt;&lt;br /&gt;Looking at GEM related features the big thing is the &lt;b&gt;reset statistics ioctl&lt;/b&gt; from Mika Kuoppala. This is the kernel code to implement the GLX_ARB_robustness extension, and the further building blocks on top of that. This extension is shipping in Mesa 10.0.x releases and is necessary to implement browser support for WebGL in a sane way. Thjs release cycle has also seen more patches from Ben Widawsky &lt;b&gt;towards full ppgtt support&lt;/b&gt;, but the final bits didn't make the cut due to a few regressions that popped up at the last minute.&lt;br /&gt;&lt;br /&gt;For platform support the big thing is that we've removed the prelimary hardware support tag for &lt;b&gt;Broadwell&lt;/b&gt;, which means 3.14 and later kernels will use the real i915.ko driver by default. There's still a few features missing for full-blown Broadwell kernel support, but all the basics to boot the system and so avoid users getting stuck with black screens are there. &lt;b&gt;Baytrail&lt;/b&gt; also has seen lots of smaller improvements, like a vga hotplug fix from Imre, DSI improvements from Deepak and tons of other patches from Jesse Barnes, Ville and Chon Lee Ming.&lt;br /&gt;&lt;br /&gt;One last piece new in 3.14 is the &lt;b&gt;deprecation of the legacy UMS support&lt;/b&gt;. We've kept this code on live support since a few years already, but now it's getting in the way of some of the plans for improving the driver load and teardown code. So long-term we want this gone. For now there's still a kernel config option to keep the code around. Another new&amp;amp;nifty &lt;b&gt;kernel option disables the legacy fbdev support&lt;/b&gt;. This is not something for your regular desktop linux system yet since the boot splash and a bunch of other things rely on it. And you also need to manually make sure that the vga driver doesn't load. But it does allow us to rip out all the legacy linux framebuffer support code, which is beneficial for embedded systems. And with efforts like &lt;a href="http://dvdhrm.wordpress.com/2012/08/11/kmscon-linux-kmsdrm-based-virtual-console/"&gt;David Herrmann's kmscon&lt;/a&gt; also where the future is heading towards in general.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/7722245516833600559/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html#comment-form' title='7 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' title='Neat drm/i915 stuff for 3.14'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>7</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5812434027313869869</id><published>2013-11-22T01:23:00.002-08:00</published><updated>2013-11-22T01:24:24.973-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Botching up ioctls</title><content type='html'>One clear insight kernel graphics hackers gained in the past few years is that trying to come up with a unified interface to manage the execution units and memory on completely different GPUs is a futile effort. So nowadays every driver has its own set of ioctls to allocate memory and submit work to the GPU. Which is nice, since there's no more insanity in the form of fake-generic, but actually only used once interfaces. But the clear downside is that there's much more potential to screw things up.&lt;br /&gt;&lt;br /&gt;To avoid repeating all the same mistakes again I've written up some of the lessons learned while botching the job for the drm/i915 driver. Most of these only cover technicalities and not the big-picture issues like what the &lt;a href="http://blog.ffwll.ch/2011/01/on-getting-your-api-right.html"&gt;command submission ioctl exactly should look like&lt;/a&gt;. Learning these lessons is probably something every GPU driver has to do on its own.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&lt;h2&gt;Prerequisites &lt;/h2&gt;First the basic - without these the fail already starts with the need for a 32bit compat layer:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Only use fix sized integers. To avoid conflicts with typedefs in userspace the kernel has special types like &lt;code&gt;__u32&lt;/code&gt;, &lt;code&gt;__s64&lt;/code&gt;. Use them.&lt;/li&gt;&lt;li&gt;Align everything to the natural size and use explicit padding. 32bit platforms don't necessarily align 64bit values to 64bit boundaries, but 64bit platforms do. So we always need padding to the natural size to get this right.&lt;/li&gt;&lt;li&gt;Pad the entire struct to a multiple of 64bits - the structure size will otherwise differ on 32bit versus 64bit. Which hurts when passing arrays of structures to the kernel. Or with the ioctl structure size checking that e.g. the drm core does.&lt;/li&gt;&lt;li&gt;Pointers are &lt;code&gt;__u64&lt;/code&gt;, cast from/to a &lt;code&gt;uintprt_t&lt;/code&gt; on the userspace side and from/to a void &lt;code&gt;__user *&lt;/code&gt; in the kernel. Try really hard not to delay this conversion or worse, fiddle the raw &lt;code&gt;__u64&lt;/code&gt; through your code since that diminishes the checking tools like sparse can provide.&amp;nbsp;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Basics &lt;/h2&gt;With the joys of writing a compat layer avoided we can take a look at the basic fumbles. Neglecting these will make backward and forward compatibility a real pain. And since getting things wrong on the first attempt is guaranteed you &lt;i&gt;will&lt;/i&gt; have a second iteration or at least an extension for any given interface.&lt;br /&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Have a clear way for userspace to figure out whether your new ioctl or ioctl extension is supported on a given kernel. If you can't rely on old kernels rejecting the new flags/modes or ioctls (since doing that was botched in the past) then you need a driver feature flag or revision number somewhere.&lt;/li&gt;&lt;li&gt;Have a plan for extending ioctls with new flags or new fields at the end of the structure. The drm core checks the passed-in size for each ioctl call and zero-extends any mismatches between kernel and userspace. That helps, but isn't a complete solution since newer userspace on older kernels won't notice that the newly added fields at the end get ignored. So this still needs a new driver feature flags.&lt;/li&gt;&lt;li&gt;Check &lt;i&gt;all&lt;/i&gt; unused fields and flags and all the padding for whether it's 0, and reject the ioctl if that's not the case. Otherwise your nice plan for future extensions is going right down the gutters since someone &lt;i&gt;will&lt;/i&gt; submit an ioctl struct with random stack garbage in the yet unused parts. Which then bakes in the ABI that those fields can never be used for anything else but garbage.&lt;/li&gt;&lt;li&gt;Have simple testcases for all of the above. &lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Fun with Error Paths &lt;/h2&gt;Nowadays we don't have any excuse left any more for drm drivers being neat little root exploits. Which means we both need full input validation and solid error handling paths - GPUs will die eventually in the oddmost cornercases anyway:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;The ioctl must check for array overflows. Also it needs to check for over/underflows and clamping issues of integer values in general. The usual example is sprite positioning values fed directly into the hardware with the hardware just having 12 bits or so. Works nicely until some odd display server doesn't bother with clamping itself and the cursor wraps around the screen.&lt;/li&gt;&lt;li&gt;Have simple testcases for every input validation failure case in your ioctl. Check that the error code matches your expectations. And finally make sure that you only test for one single error path in each subtest by submitting otherwise perfectly valid data. Without this an earlier check might reject the ioctl already and shadow the codepath you actually want to test, hiding bugs and regressions. &lt;/li&gt;&lt;li&gt;Make all your ioctls restartable. First X really loves signals and second this will allow you to test 90% of all error handling paths by just interrupting your main test suite constantly with signals. Thanks to X's love for signal you'll get an excellent base coverage of all your error paths pretty much for free for graphics drivers. Also, be consistent with how you handle ioctl restarting - e.g. drm has a tiny &lt;code&gt;drmIoctl&lt;/code&gt; helper in its userspace library. The i915 driver botched this with the &lt;code&gt;set_tiling&lt;/code&gt; ioctl, now we're stuck forever with some arcane semantics in both the kernel and userspace.&lt;/li&gt;&lt;li&gt;If you can't make a given codepath restartable make a stuck task at least killable. GPUs just die and your users won't like you more if you hang their entire box (by means of an unkillable X process). If the state recovery is still too tricky have a timeout or hangcheck safety net as a last-ditch effort in case the hw has gone bananas.&lt;/li&gt;&lt;li&gt;Have testcases for the really tricky cornercases in your error recovery code - it's way too easy to create a deadlock between your hangcheck code and waiters. &lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Time, Waiting and Missing it &lt;/h2&gt;GPUs do most everything asynchronous, so we have a need to time operations and wait for oustanding ones. This is really tricky business, at the moment none of the ioctls supported by the drm/i915 get this fully right. Which means there's still a tons more lessons to learn here.&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Use &lt;code&gt;CLOCK_MONOTONIC&lt;/code&gt; as your reference time, always. It's what alsa, drm and v4l use by default nowadays. But let userspace know which timestamps are derived from different clock domains like your main system clock (provided by the kernel) or some independent hardware counter somewhere else. Clocks &lt;i&gt;will&lt;/i&gt; mismatch if you look close enough, but if performance measuring tools have this information they can at least compensate. If your userspace can get at the raw values of some clocks (e.g. through in-command-stream performance counter sampling instructions) consider exposing also those.&lt;/li&gt;&lt;li&gt;Use &lt;code&gt;__s64&lt;/code&gt; seconds plus &lt;code&gt;__u64&lt;/code&gt; nanoseconds to specify time. It's not the most convenient time specification, but it's mostly the standard.&lt;/li&gt;&lt;li&gt;Check that input time values are normalized and reject them if not. Note that the kernel native &lt;code&gt;struct ktime&lt;/code&gt; has a signed integer for both seconds and nanoseconds, so beware here.&lt;/li&gt;&lt;li&gt;For timeouts, use absolute times. If you're a good fellow and made your ioctl restartable relative timeouts tend to be too coarse and can indefinitely extend your wait time due to rounding on each restart. Especially if your reference clock is something really slow like the display frame counter. With a spec laywer hat on this isn't a bug since timeouts can always be extended - but users will surely hate you if their neat animations starts to stutter due to this.&lt;/li&gt;&lt;li&gt;Consider ditching any synchronous wait ioctls with timeouts and just deliver an asynchronous event on a pollable file descriptor. It fits much better into event driven applications' main loop.&lt;/li&gt;&lt;li&gt;Have testcases for corner-cases, especially whether the return values for already-completed events, successful waits and timed-out waits are all sane and suiting to your needs. &lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Leaking Resources, Not &lt;/h2&gt;A full-blown drm driver essentially implements a little OS, but specialized to the given GPU platforms. Which means a driver needs to expose tons of handles for different objects and other resources to userspace. Doing that right entails its own little set of pitfalls:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Always attach the lifetime of your dynamically created resources to the lifetime of a file descriptor. Consider using a 1:1 mapping if your resource needs to be shared across processes -&amp;nbsp; fd-passing over unix domain sockets also simplifies lifetime management for userspace.&lt;/li&gt;&lt;li&gt;Always have O_CLOEXEC support.&lt;/li&gt;&lt;li&gt;Ensure that you have sufficient insulation between different clients. By default pick a private per-fd namespace which forces any sharing to be done explictly. Only go with a more global per-device namespace if the objects are truly device-unique. One counterexample in the drm modeset interfaces is that the per-device modeset objects like connectors share a namespace with framebuffer objects, which mostly are not shared at all. A separate namespace, private by default, for framebuffers would have been more suitable.&lt;/li&gt;&lt;li&gt;Think about uniqueness requirements for userspace handles. E.g. for most drm drivers it's a userspace bug to submit the same object twice in the same command submission ioctl. But then if objects are shareable userspace needs to know whether it has seen an imported object from a different process already or not. I haven't tried this myself yet due to lack of a new class of objects, but consider using inode numbers on your shared file descriptors as unique identifiers - it's how real files are told apart, too. Unfortunately this requires a full-blown virtual filesystem in the kernel.&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Last, but not Least &lt;/h2&gt;Not every problem needs a new ioctl:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Think hard whether you really want a driver-private interface. Of course it's much quicker to push a driver-private interface than engaging in lengthy discussions for a more generic solution. And occasionally doing a private interface to spearhead a new concept is what's required. But in the end, once the generic interface comes around you'll end up maintainer two interfaces. Indefinitely.&lt;/li&gt;&lt;li&gt;Consider other interfaces than ioctls. A sysfs attribute is much better for per-device settings, or for child objects with fairly static lifetimes (like output connectors in drm with all the detection override attributes). Or maybe only your testsuite needs this interface, and then debugfs with it's disclaimer of not having a stable ABI would be better.&lt;/li&gt;&lt;/ul&gt;Finally, the name of the game is to get it right on the first attempt. Since if your driver proves popular and your hardware platforms long-lived then you'll be stuck with a given ioctl essentially forever. You can to deprecate horrible ioctls on newer iterations of your hardware, but generally it takes years to accomplish this. And then again years until the last user able to complain about regressions disappears, too.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5812434027313869869/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5812434027313869869'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5812434027313869869'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html' title='Botching up ioctls'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2836372524824507411</id><published>2013-11-12T15:49:00.002-08:00</published><updated>2013-11-12T15:49:44.988-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>Testing Requirements for drm/i915 Features and Patches</title><content type='html'>I want to make automated test coverage an integral part of our feature and bugfix development process. For features this means that starting with the design phase testability needs to be considered an integral part of any feature. This needs to go through the entire development process, from planning, development, patch submission and final validation. For bugfixes that means the fix is only complete once the automated testcase for it is also done, if we need a new one&lt;br /&gt;&lt;br /&gt;This specifically excludes testing with humans somewhere in the loop. We are extremely limited in our validation resources, every time we put something new onto the "manual testing" plate something else &lt;i&gt;will&lt;/i&gt; fall off. &lt;br /&gt;&lt;br /&gt;  I've let this float for quite a while both internally in Intel and on the public mailing lists. Thanks to everyone who provided valuable input. Essentially this just codifies the already existing expectations from me as the maintainer, but those requirements haven't really been clear and a lot of emotional discussions ensued. With this we should now have solid guidelines and can go back to coding instead of blowing through so much time and energy on waging flamewars. &lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h2&gt;Why?&lt;/h2&gt;There are a bunch of reasons why having good tests is great: &lt;ul&gt;&lt;li&gt;&lt;b&gt;More predictability.&lt;/b&gt; Right now test coverage often only comes up as a topic   when I drop my maintainer review onto a patch series. Which is too late, since   it'll delay the otherwise working patches and so massively frustrates people.   I hope by making test requirements clear and up-front we can make the   upstreaming process more predictable. Also, if we have good tests from the get-go   there should be much less need for me to drop patches from my trees   after having them merged.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Less bikeshedding.&lt;/b&gt; In my opinion test cases are an excellent means to settle   bikesheds - we've had in the past seen cases of endless back&amp;amp;forths   where writing a simple testcase would have shown that &lt;i&gt;all&lt;/i&gt; proposed   color flavours are actually broken.&lt;br /&gt;The even more important thing is that fully automated tests allow us to   legitimately postpone cleanups. If the only testing we have is manual testing   then we have only one shot at a feature tested, namely when the developer   tests it. So it better be perfect. But with automated tests we can postpone   cleanups with too high risks of regressions until a really clear need is   established. And since that need often never materializes we'll save work.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Better review.&lt;/b&gt; For me it's often helps a lot to review tests than the actual   code in-depth. This is especially true for reviewing userspace interface   additions.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Actionable regression reports.&lt;/b&gt; Only if we have a fully automated testcase do   we have a good chance that QA reports a regression within just a few days.   Everything else can easily take weeks (for platforms and features which are   explicitly tested) to months (for stuff only users from the community notice).   And especially now that much more shipping products depend upon a working   i915.ko driver we just can't do this any more.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Better tests.&lt;/b&gt; A lot of our code is really hard to test in an automated   fashion, and pushing the frontier of what is testable often requires a lot of   work. I hope that by making tests an integral part of any feature work and so   forcing more people to work on them and think about testing we'll   advance the state of the art at a brisker pace. &lt;/ul&gt;&lt;br /&gt;&lt;h2&gt;Risks and Buts&lt;/h2&gt; But like with every change, not everything is all glorious and fun: &lt;ul&gt;&lt;li&gt;&lt;b&gt;Bikeshedding on tests.&lt;/b&gt; This plan is obviously not too useful if we just   replace massive bikeshedding on patches with massive bikeshedding on   testcases. But right now we do almost no review on i-g-t patches so the risk   is small. Long-term the review requirements for testcases will certainly   increase, but as with everything else we simply need to strive for a good   balance to strike for just the right amount of review. &lt;br /&gt;Also if we really start discussing tests &lt;i&gt;before&lt;/i&gt; having written massive patch   series we'll do the bikeshedding while there's no real rebase pain. So even if   the bikeshedding just shifts we'll benefit I think, especially for   really big features.&lt;/li&gt;&lt;li&gt;&lt;b&gt;Technical debt in test coverage.&lt;/b&gt; We have a lot of old code which still   completely lacks testcases. Which means that even small feature work might be   on the hook for a big pile of debt restructuring. I think this is inevitable   occasionally. But I think that doing an assessment of the current state of   test coverage of the existing code &lt;i&gt;before&lt;/i&gt; starting a feature instead   of when the patches are ready for merging should help a lot, before   everyone is invested into patches already and mounting rebase pain looms   large.&lt;br /&gt;Again we need to strive for a good balance between "too many tests to write   up-front for old code" and "missing tests that only the final review and validation   uncovers creating process bubbles".&lt;/li&gt;&lt;li&gt;&lt;b&gt;Upstreaming of product stuff.&lt;/b&gt; Product guys are notoriously busy and writing   tests is actual work. On the other hand the upstream codebase feeds back into &lt;i&gt;all&lt;/i&gt; product   trees (and the upstream kernel), so requirements are simply a bit higher. And   I also don't think that we can push the testing of some features fully to   product teams, since they'll be pissed really quickly if every update they get   from us breaks their stuff. So if these additional test requirements (compared   to the past) means that some product patches won't get merged, then I think   that's the right choice.&lt;/li&gt;&lt;li&gt;&lt;b&gt;But ...&lt;/b&gt; all the other kernel drivers don't do this. We're also one of the   biggest driver's in the kernel, with a code churn rate roughly 5x worse than   anything else and a pretty big (and growing) team. Also, we're often the   critical path in enabling new platforms in the fast-paced mobile space.   Different standards apply.&lt;/li&gt;&lt;/ul&gt;&lt;br/&gt;&lt;h2&gt;Test Coverage Expectations&lt;/h2&gt; Since the point here is to make the actual test requirements known up-front we need to settle on clear expectations. &lt;ul&gt;&lt;li&gt;Tests must fully cover userspace interfaces. By this I mean exercising all the   possible options, especially the usual tricky corner cases (e.g. off-by-one   array sizes, overflows). It also needs to include tests for all the   userspace input validation (i.e. correctly rejecting invalid input,   including checks for the error codes). For userspace interface additions   technical debt really must be addressed. This means that when adding a   new flag and we currently don't have any tests for those flags, then   I'll ask for a testcase which fully exercises all the flag values we   currently supported on top of the new interface addition.&lt;/li&gt;&lt;li&gt;Tests need to provide a reasonable baseline coverage of the internal driver   state. The idea here isn't to aim for full coverage, that's an impossible and   pointless endeavor. The goal is to have a good starting point of tests so that   when a tricky corner case pops up in review or validation that it's not a   terribly big effort to add a specific testcase for it. This is very much a balance thing to get right and we need a bit of experience to get a good handle here.&lt;/li&gt;&lt;li&gt;Issues discovered in review and final validation need automated test coverage. This includes any bugs found after a feature has already landed and is even more important for regressions.   The reasoning is that anything which slipped the developer's attention is   tricky enough to warrant an explicit testcase, since in a later refactoring   there's a good chance that it'll be missed again. This has a bit a risk   to delay patches, but if the basic test coverage is good enough as per   the previous point it really shouln't be an issue.&lt;/li&gt;&lt;li&gt;Finally we need to push the testable frontier with new ideas like pipe CRCs,   modeset state cross checking or arbitrary monitor configuration injection   (with fixed EDIDs and connector state forcing). The point here is to foster   new crazy ideas, and the expectation is very much &lt;i&gt;not&lt;/i&gt; that developers then   need to write testcases for all the old bugfixes that suddenly became   testable. That workload needs to be spread out over a bunch of features   touching the relevant area. This only really applies to features and   code paths which are currently in the "not testable" bucket anyway.&lt;/li&gt;&lt;/ul&gt;This should specify the "what" decently enough, but we also need to look at how tests should work.&lt;br /&gt;&lt;br /&gt;Specific testcases in i-g-t are obviously the preferred form, but for some features that's just not possible. In such cases in-kernel self-checks like the modeset state checker of fifo underrun reporting are really good approaches. Two caveats apply: &lt;ul&gt;&lt;li&gt;The test infrastructure really should be orthogonal to the code being tested.   In-line asserts that check for preconditions are really nice and useful, but   since they're closely tied to the code itself they have a good chance to be broken   in the same ways.&lt;/li&gt;&lt;li&gt;The debug feature needs to be enabled by default, and it needs to be loud.   Otherwise no one will notice that something is amiss. So currently the fifo   underrun reporting doesn't really count since it only causes debug level   output when something goes wrong. Of course it's still a really good tool for   developers, just not yet for catching regressions.&lt;/li&gt;&lt;/ul&gt;Finally the short lists of excuses that don't count as proper test coverage for a feature: &lt;ul&gt;&lt;li&gt;Manual testing. We are ridiculously limited on our QA manpower. Every time we   drop something onto the "manual testing" plate something else &lt;i&gt;will&lt;/i&gt; drop off.   Which means in the end that we don't really have any test coverage. So   if patches don't come with automated tests, in-kernel cross-checking or   some other form of validation attached they need to have really good   reasons for doing so.&lt;/li&gt;&lt;li&gt;Testing by product teams. The entire point of Intel OTC's "upstream first"   strategy is to have a common codebase for everyone. If we break product trees   every time we feed an update into them because we can't properly regression   test a given feature then the value of upstreaming features is greatly   diminished. In my opinion this could potentially doom collaborations with   product teams. We just can't have that.&lt;br/&gt;This means that when products teams submit patches upstream they also need   to submit the relevant testcases as patches to i-g-t.  &lt;/li&gt;&lt;/ul&gt;&lt;br/&gt;&lt;h2&gt;Process Adjustements&lt;/h2&gt;The important piece is really to not start with thinking about tests only when everything else is done. &lt;ul&gt;&lt;li&gt;For big features we should have an upfront discussion about the test coverage and what all should be done (like any coverage gaps for existing code and features to fill, a new crazy test infrastructure idea to implement as a proof of concept or what kinds of tests would provide a reasonable base coverage). For really big features writing a quick test plan and everyone signing off on it could be useful. Especially to be able to learn and improve once everything has landed and the usefulness of the tests is much clearer.&lt;/li&gt;&lt;li&gt;Tests should be implemented together with the feature or bugfix and should be ready about the same time. Having both pieces at hand should help development, testing and review.&lt;/li&gt;&lt;li&gt;If we decide that new test infrastructure is required or that there's a large gap in the coverage of existing code then that should be done before the main feature is developed. Otherwise we'll suffer again the pains of rebase hell for no gain.&lt;/li&gt;&lt;li&gt; Finally developers are &lt;i&gt;not&lt;/i&gt; expected to run the full testsuite before submitting patches. The test suite currently simply takes too long to run and we don't have any good centralized infrastructure to speed things up by running tests on multiple machines in parallel. And then proper testing requires a wide array of different platforms anyway, so full regression testing is still squarely a job for our QA. Of course we need to improve our infrastructure and also make it easier to run a useful subset of tests while developing patches.&lt;/li&gt;&lt;/ul&gt;With that, happy testcase writing to everyone! </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2836372524824507411/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/11/testing-requirements-for-drmi915.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2836372524824507411'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2836372524824507411'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/testing-requirements-for-drmi915.html' title='Testing Requirements for drm/i915 Features and Patches'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2495710684294338878</id><published>2013-11-02T07:36:00.000-07:00</published><updated>2014-01-17T04:57:04.272-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.13</title><content type='html'>It's that time again when the old &lt;a href="http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html"&gt;kernel v3.12&lt;/a&gt; will be released shortly and we'll take a look at what's in store for the Intel GFX driver in 3.13.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;Formerly known as Valleyview, now called &lt;b&gt;Baytrail&lt;/b&gt; has seen a lot of improvements. Jesse Barnes has crawled through bugzilla and fixed a lot of little issues all over the place. Chon Ming Lee also provided a few patches to initialize the chip without the VBIOS' help. Jani Nikula has provided the first cut at &lt;b&gt;MIPI DSI support&lt;/b&gt;, but that's still all rather preliminary and still a bit of work to do.&lt;br /&gt;&lt;br /&gt;This release has also seen a lot of changes, most of them preparatory work, for new power management features. Jani implemented &lt;b&gt;SWSCI support&lt;/b&gt; which is a new kind of OpRegion/ACPI based low power management framework for Intel graphics. Itself it's not terribly interesting, but unfortunately a lot of platform power management code in the ACPI reference implementations for Haswell platforms is linked to SWSCI. So now the power gating for e.g. audio codecs is contingent on the gfx being switched off, which obviously doesn't make too much sense. We can blame this on Windows' power management framework being sub-par, but unfortunately we can't fix it. There's also been a lot of work in handling different power domains better (not all of which managed to get into 3.13): Ville Syrjälä implemented VGA power domains and Imre Deak and Paulo Zanoni &lt;b&gt;reworked the power domain handling&lt;/b&gt; in general a lot. This is all preparatory work for power saving features on newer platforms, so stay tuned for more in the next kernel cycle. For the curious, most of the patches have already been posted to intel-gfx.&lt;br /&gt;&lt;br /&gt;Another power/performance feature is the &lt;b&gt;gpu boost/deboost&lt;/b&gt; logic from Chris Wilson. This will help for interactive gpu workloads where the hardware based boost logic is too slow to adapt. On the flip side the kernel is now also much more aggressive at deboosting the gpu when nothing is going on, which should improve power consumption figures for very light, but spikey workloads.&lt;br /&gt;&lt;br /&gt;Damien Lespiau provided basic support for &lt;a href="http://damien.lespiau.name/blog/2013/10/02/hdmi-sterero-3d-kms/"&gt;&lt;b&gt;3D/stereo displays&lt;/b&gt; on HDMI&lt;/a&gt;. Currently there's only a small test application available, but patches to support 3D modes in Wayland are already in the works. Hopefully soon we'll have glxgears spinning in 3D! As a quick aside I've just noticed that in my 3.12 release notes I've forgotten to mention the &lt;b&gt;HDMI 4K&lt;/b&gt; support, again from Damien.&lt;br /&gt;&lt;br /&gt;Under the hood of the driver we've seen more &lt;b&gt;VMA prep patches for PPGTT&lt;/b&gt; from Ben Widawsky. And Ville has again been really busy trying to beat our &lt;b&gt;watermark code&lt;/b&gt; into shape for a brave new world where atomic updates of the primary plane and any set of sprites actually works in a reliably way.&lt;br /&gt;&lt;br /&gt;Now the one feature that makes me really happy is the &lt;b&gt;display CRC support&lt;/b&gt; from Damien and He Shuang. This exposes the hardware checksum features through debugfs. Since these checksums update for each frame displayed and the tap point in the display pipe can be selected to be after all the cursor/plane/sprite blending, color correction and scaling have been applied this will finally allow us to test a lot of the modesetting code in a fully automated way. Ville has already provided a testcase for cursor placement and found a few more bugs while writing it.&lt;br /&gt;&lt;br /&gt;And of course there's been countless little bugfixes and improvements to the driver internals: DP fixes from Jani, improved tuning values for Haswell DDI ports from Paulo, the option to compile the driver without CONFIG_FB support in the kernel, small improvements to the hw context support from Ben and Chris and tons of other stuff.&lt;br /&gt;&lt;br /&gt;Oh and: We should have a little surprise ready for 3.13, too.&lt;br /&gt;&lt;br /&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2495710684294338878/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html#comment-form' title='3 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2495710684294338878'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2495710684294338878'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html' title='Neat drm/i915 stuff for 3.13'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>3</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6942625817573587722</id><published>2013-09-21T09:27:00.002-07:00</published><updated>2013-09-25T03:16:53.544-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>More drm/i915 Testsuite Infrastructure</title><content type='html'>&lt;p&gt;So after the recent &lt;a href="http://blog.ffwll.ch/2013/08/recent-drmi915-testsuite-improvements.html"&gt;overview over our kernel test infrastructure&lt;/a&gt; I've had to write a bunch multithreaded testcases. And since I'm rather lazily I've opted to create a few more helpers that hide all the little details when forking and joining processes. While at I think it's also a good time to explain a bit the infrastructure we have to help running the kernel testsuite on simulated hardware and a few other generally useful things in our testsuite helper library. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h2&gt;Multithreaded Tests &lt;/h2&gt;&lt;p&gt;One important thing when specifically testing the kernel is to exercise race conditions and truely fancy corner-cases. After all the normal cases of submitting a bit of work for the gpu and waiting for the results is really well-tested through testsuites for the userspace driver parts like piglit. Which means that the kernel tests are brimful of multithreaded testcases. &lt;/p&gt;&lt;p&gt;Now writing parallel testcases with &lt;code&gt;fork&lt;/code&gt; and friends isn't really hard. But correctly propagating exit codes from all children and cleaning up things if a test goes south is annoying boilerplate. Especially when taking into account interactions with other testsuite helper infrastructure. Hence we now have another magic code-block macro called &lt;code&gt;igt_fork(i, num_children)&lt;/code&gt;. Conceptually it works like a parallel for loop from frameworks like OpenMP: &lt;code&gt;parallel_for (i = 0; i &lt; num_children; i++)&lt;/code&gt;. The difference is that control flow in the main thread will continue, and joining together all the children happens by calling &lt;code&gt;igt_waitchildren()&lt;/code&gt;. This will block until all children have exited, and it will also forward the exit code if any of them have failed the testcase by calling &lt;code&gt;igt_exit()&lt;/code&gt;. &lt;/p&gt;&lt;p&gt;Two special considerations apply: Skipping a testcase from within a child process doesn't make much sense - such checks should happen in the main test process before forking parallel threads. Hence the testframework will catch such abuse and abort the test if a child process ends up calling &lt;code&gt;igt_skip()&lt;/code&gt;. Secondly childs are spawned using &lt;code&gt;fork()&lt;/code&gt; and not as pthreads. In my experience of writing testases thus far this is the simpler and more intuitive programming model. The only tricky part is that children need to reinitialize buffer objects (and associated tracking) if they don't want them to be shared - gem buffer objects do not have copy-on-write semantics after &lt;code&gt;fork()&lt;/code&gt;. The pitfal here are the reused buffer references stored in the libdrm buffer manager. If children don't reinitialize those different processes could end up reusing the same objects (inherited from their parent) for batches, resulting in some decent hilarity. &lt;/p&gt;&lt;h2&gt;Cleanup Handling&lt;/h2&gt;&lt;p&gt;Another piece of annoying boilerplate code is handling cleanup tasks after the test is done. We have a lot of little things that needs to be reset again, like re-enabling prefaulting when a testcase disabled it or re-enabling the kernel console after a test put it into graphics mode for a modesettting test. libc has &lt;code&gt;atexit()&lt;/code&gt; handlers, but that's not good enough since our testcases tend to die a lot through signals. To fix this &lt;code&gt;igt_install_exit_handler&lt;/code&gt; will install special signaler handlers (which re-raises the signal after processing all the exit handlers) besides a normal &lt;code&gt;atexit()&lt;/code&gt; handler. &lt;/p&gt;&lt;p&gt;The nice thing is that this plays well together with all the other testsuite helpers, especially for multi-threaded tests. For children the exit handlers get automatically reset, but it's still possible that they have their own exit handling code, e.g. if each child process has it's own helper process to clean up. One strange thing encountered though is that if a child process receives a signal right after forking it seemingly can get lost when our special re-raising handler is registered. We duct-tape over that by disabling the exit handling temporarily across the fork. See the &lt;a href="http://cgit.freedesktop.org/xorg/app/intel-gpu-tools/commit/?id=a031a1bf93b828585e7147f06145fc5030814547"&gt;relevant patch&lt;/a&gt;, explanations what exactly might be going on highly welcome. &lt;/p&gt;&lt;h2&gt;Helper Processes for Auxiliary Tasks&lt;/h2&gt;&lt;p&gt;Often a testcase needs a parallel thread which isn't part of the actual test, but concurrently does something nasty to it. For example constantly interrupting the parent with a signal to exercise our ioctl restarting code. Or using a special debugfs interface to drop gem object caches and mappings - this is especially in conjunction with disabling prefaulting and allocating userspace pointers as gtt mmmapped objects to exercise the lock-dropping &lt;code&gt;copy_*_user&lt;/code&gt;slowpaths.  &lt;/p&gt;&lt;p&gt;Since these process are expected to run forever and until the parent explicitly kills them (once the testcase has completed) there's a second set of fork helpers. The &lt;code&gt;igt_fork_helper&lt;/code&gt; magic codeblock forks such a process, and &lt;code&gt;igt_stop_helper&lt;/code&gt; cleans it up. &lt;/p&gt;&lt;p&gt;Both the helper process code and the test children support code use &lt;code&gt;waitpid()&lt;/code&gt; to reap dead child processes. This way exit codes won't get stolen and test children and helper process can be forked and reaped in any order. Also both types of process helpers register exit handlers to kill and clean all child processes if the test process dies prematurely. Otherwise, especially for long-running test children and obviously for helper processes, leftover process will keep on running and distort subsequent testcases. &lt;/p&gt;&lt;h2&gt;Running in Simulation Enviroments&lt;/h2&gt;&lt;p&gt;Another result of the kernel tests concentrating on exercising race conditions and similar corner cases is that the testcases tend to take a fair amount of time to run. After all running a stresstest for longer should increase the chances that it will actually hit the race condition. Developers can manage the overtly-long test feedback cycles by restricting the testcase list sufficiently while developing and then running the full set on our QA's patch testing infrastructure. And occasionally we need to re-tune a testcase when it simply takes way too long to complete. &lt;/p&gt;&lt;p&gt;But we also run the kernel testsuite on simulated hardware, and there all these long-running tests really take forever. Furthermore they often exercise purely software issues with no interactions down to the actual hardware platforms. &lt;/p&gt;&lt;p&gt;To still keep a reasonable cost-benefit ratio of running the kernel tests in simulated enviroments we skip a lot of the long running testcases. &lt;code&gt;igt_skip_on_simulation()&lt;/code&gt; is used for that, which internally calls &lt;code&gt;igt_skip()&lt;/code&gt; if the enviroment-variable &lt;code&gt;INTEL_SIMULATION&lt;/code&gt; is set. This can be explicitly tested with &lt;code&gt;igt_run_in_simulation()&lt;/code&gt;. But there's not much need for that since for race-condition testcase that we want to run but just reduce loop counts a bit we have the &lt;code&gt;SLOW_QUICK&lt;/code&gt; macro. This selects one of the supplied values depending upon whether &lt;code&gt;INTEL_SIMULATION&lt;/code&gt; is set or not. &lt;/p&gt;&lt;p&gt;Currently we skip a lot of the kernel tests overall that way, but then the big value of pre-silicon enviroments is to adapt and test the userspace drivers and to be able to do basic integration testing of the entire graphics stack. Hunting for corner-cases and races in the kernel driver is still best done on real hardware, and since we have a unified driver across all platforms most of the code can be tested on older platforms easily. &lt;/p&gt;&lt;h2&gt;Format String Support&lt;/h2&gt;&lt;p&gt;Finally one short paragraph on a very recent addition: All the special test assertion macros like &lt;code&gt;igt_assert&lt;/code&gt; or &lt;code&gt;igt_require&lt;/code&gt; have grown cousins that accept format strings. Those have a &lt;code&gt;_f&lt;/code&gt; suffix. With that we can replace almost all test checks that still use explicit conditions and their own output formatting, which overall tides up the code rather neatly. I've also added &lt;code&gt;igt_skip_on[_f]&lt;/code&gt; macros which is just an &lt;code&gt;igt_require[_f]&lt;/code&gt; with inverted condition. &lt;/p&gt;&lt;p&gt;Overall I think that our kernel testsuite is now in fairly good shape and writing testcase is much less a chore than it was just a few months ago. So after the flurry of patches and improvements in the past few weeks I expect things to calm down a lot again and go back to the usual trot of adding testcases here and there. &lt;/p&gt;   </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6942625817573587722/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/09/more-drmi915-testsuite-infrastructure.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6942625817573587722'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6942625817573587722'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/09/more-drmi915-testsuite-infrastructure.html' title='More drm/i915 Testsuite Infrastructure'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7576649732790701078</id><published>2013-09-02T07:01:00.002-07:00</published><updated>2013-09-02T07:01:44.091-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.12</title><content type='html'>So &lt;a href="http://blog.ffwll.ch/2013/06/neat-drmi915-stuff-for-311.html"&gt;kernel 3.11&lt;/a&gt; will be released soonish and it's time for our regular look at what the next merge window will bring in for the intel GPU driver.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;For Haswell enabling there are two new power saving features in 3.12: The first is &lt;b&gt;pc8+ support&lt;/b&gt; from Paulo Zanoni. This is a new, deeper system sleep state for the new Haswell ULT platforms where the PCH is integrated onto the same package - pc stands for "package C state". Since waking up from this will still be much faster than waking from a full resume this will help for always-on use-cases like tablets. This support required a lot of changes in many parts of the driver since we're essentially doing part of what the firmware has done for us at suspend/resume time, but now we do this ourselves at runtime. Most of the changes have been to setup/restore additional reference clocks and to improve our handling of interrupts - the added benefit of this power saving mode compared to full device (or even system suspend) is that hotplugging still works.&lt;br /&gt;&lt;br /&gt;The other Haswell power saving feature is &lt;b&gt;panel self refresh&lt;/b&gt; support (PSR for short), polished for merging by Rodrigo Vivi. Note that we still have a few issues with properly tracking frontbuffer rendering (used by X without a pageflippping compositor) without completely killing the power saving advantages on more usual setups. So right now enabling PSR will cause render issues on such legacy X setups and hence is disabled by default.&lt;br /&gt;&lt;br /&gt;On the other end in the power-vs-performace scale we've tuned our Haswell/Iris support. Ben Widawsky enabled the giant &lt;b&gt;eLLC cache&lt;/b&gt; (the seperate 128 MB cache chip on some Iris packages). And Chris Wilson enabled the &lt;b&gt;write-through scanout buffer caching mode&lt;/b&gt;, again an Iris-only feature used to improve the effectiveness of the eLLC cache.&lt;br /&gt;&lt;br /&gt;Looking at general improvements we've finally moved the &lt;b&gt;gpu error state into a sysfs file&lt;/b&gt; (the old debugfs file will stay around). So now with this official interface we can support users better even on production systems where debugfs really shouldn't be mounted. This was all made possible by Mika Kuoppala's improvements, which mostly landed in 3.12 already.&lt;br /&gt;&lt;br /&gt;Under the hood there has been lots of improvements to the codebase. Damien Lespiau, based on work from Paulo Zanoni finally &lt;b&gt;converted our HDMI infoframe code&lt;/b&gt; over to the common helpers introduced into the kernel half a year ago. Code sharing, especially for sink handling code is always nice. Also in our display code we've rid ourselves of the last remnants of the old crtc helper based modesetting code. This completes the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;massive modesetting rework&lt;/a&gt; started in kernel 3.8.&lt;br /&gt;&lt;br /&gt;But we don't stand still and the next big thing is atomic pageflipping. One of the really tricky bits there is to update the &lt;b&gt;display watermarks&lt;/b&gt; atomically, even when we completely switch the plane, sprite, cursor, ... configuration. Hence why Ville Syrjälä has written lots of patches to convert our existing code into a shape more suitable for such atomic updates.&lt;br /&gt;&lt;br /&gt;Another display area where big changes are on the horizon is fastboot support. We've further improved the pipe configuration tracking introduced in the last kernel. Now we keep track of enough state that with a few small hacks from Jesse Barnes we finally have &lt;b&gt;fastboot support&lt;/b&gt; merge. But due to these hacks this is still hidden behind a module option. Still, thanks to the pipe configuration tracking and checking we should be able to get decent testcoverage on these bits now. And hopefully we can plug the few misssing pieces in our state tracking and enable fastboot as a default option in the next kernel. &lt;br /&gt;&lt;br /&gt;More on the GEM side of things Ben Widawsky has written support for real per-process gpu address spaces. It's a really big feature requiring changes all over the driver. The big change is the &lt;b&gt;introduction of VMA objects&lt;/b&gt; (short for virtual memory area) to track the different mappings of the same underlying objects into different gpu address spaces. Most of this preparatory work is already merged into 3.12 and we should have real per-process address space support in 3.13. Together with the already merged render nodes support from David Herrmann the PPGTT code from Ben Widawsky will give us fully drm client insulation on recent Intel platforms. That should be a really nice feature for background GPU workloads like video transcoding or OpenCL.&lt;br /&gt;&lt;br /&gt;Finally Jesse Barnes contributed a set of patches to properly &lt;b&gt;reserve the graphics stolen memory&lt;/b&gt; region. Stolen memory is a carveout region set up by the firmware for exclusive usage by the graphics driver. Since the i915 GEM driver is designed to fully exploit the unified memory architecture of Intel gpus we've never really used this memory much. But recently we've started to put it to better use (since otherwise it's just wasted) and noticed that at least on some systems the BIOS doesn't mark this range correctly as reserved. Which allows the linux kernel to place various pci mmio resources and other nasty stuff in this range, resulting in potential issues and system hangs. Thus far this wasn't a real issue since we haven't really used stolen memory for much at all. But thanks to Jesse's patches we can now move ahead.&lt;br /&gt;&lt;br /&gt;Of course there have been tons of other small improvements and bugfixes all over the place: The valleyview code received quite some polish. The interrupt code received some polish after the big changes in the previous kernel (and also to prepare for pc8+) and we have tons of little bugfixes for some of the more evil testcase we've added and also a few bugfixes for special setups and platforms. </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/7576649732790701078/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html#comment-form' title='3 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7576649732790701078'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7576649732790701078'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html' title='Neat drm/i915 stuff for 3.12'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>3</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7561193979125790593</id><published>2013-08-28T02:56:00.001-07:00</published><updated>2013-08-29T09:54:33.765-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Recent drm/i915 Testsuite Improvements</title><content type='html'>&lt;p&gt;So recently I've again wreaked decent havoc in our intel-gpu-tools kernel testsuite. And then shockingly noticed that I've never done a big pompous blog post to announce what we've started about one-a-half years ago. So besides just describing the new infrastructure for writing testcases (apparently every decent hacker must reinvent a testframework at least once ...) I'll also recap a bit what's been going on in the past. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h2&gt;What Has Happened Thus Far ...&lt;/h2&gt;&lt;p&gt;drm/i915 kernel testing was in a very sorry state two years ago - we've had pretty much zero regression testing of corner cases. Of course we've implicitly tested the kernel by running userspace drivers, e.g. testing mesa with piglit. But that only exercise the best case code and not at all the fun stuff hidden behind memory and other resource exhausting handling, racing multiple threads (or the cpu against the gpu) or trying to provoke coherency issues. &lt;p&gt;&lt;/p&gt;But there was a really basic set of manually run testcases in intel-gpu-tools. So we've started with them and wrapped them up in a very hackish testrunner using autotools and went ahead integrating this into our nightly regression testing. Like I've said in my &lt;a href="http://blog.ffwll.ch/2013/02/fosdem-slides-2013.html"&gt;fosdem presentation this year&lt;/a&gt; I was shocked how much fallout and regressions even the shittiest testsuite catches ... &lt;p&gt;&lt;/p&gt;Since then an awful lot of stuff has happened: &lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;We've switching to piglit as our testrunner framework. The big reason for that was to automatically enumerate subtests and even more important to be able to easily filter them. Often we have tests that check combinations of different things. One example is &lt;code&gt;gem_concurrent_blt&lt;/code&gt; which races gpu access against cpu access in different ways, using different cpu access methods and different caching policies, leading to a nice combinatorial explosion of subtests. And some tests also take an extreme amount of time to run, like the coherency checkers, especially the ones that exercise the swap paths ... &lt;/p&gt;&lt;p&gt;The reason for using piglit was that no other established testrunner seems to sanely support skipping testcases out of the box, and we have tons of platform specific tests. And obviously tests for new features shouldn't fall over on older kernels. The other reason for picking piglit was that we could cobble together an integration with the existing tests, without really changing them, in a few lines of python. All other testsuites I've looked at were way more invasive to convert over to . &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We've added tons more testcases. Starting with just twenty-odd test tools we've ended up with currently over 300 testcases. And very often when we've started to test an existing feature bugs just kept on showing up. So nowadays new features don't go in without decent test coverage. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We've added a lot of debugfs interfaces to the kernel to allow us to exercise tricky corner conditions. One of the first examples is the ring stop interface to simulate gpu hangs without actually hanging the gpu - the latter has the ugly tendency to take down the entire system, hard. With simulated gpu hangs we can exercise the hangcheck code, error capturing and dumping and the hw and soft reset logic without too much risk. This way we can exercise gpu hang vs. pageflip races and other nasty stuff that up to then has all been nicely broken. Other examples are interfaces to provoke gpu completion number wrap-arounds, disabling the prefetching to exercise slowpaths or interfaces to our shrinker code to more accurately exercise some of the memory trashing scenarios without actually thrashing the machine too badly. &lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We've also added tons of infrastructure for writing testcases in &lt;code&gt;lib/drmtest.c&lt;/code&gt;. Detailing a bit what's all in there is the aim of this blog post. The most recent improvement here is that tests with subcases can now properly enumerate all subtests even when the drm kernel driver isn't available. &lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Running i-g-t Kernel Tests &lt;/h2&gt;&lt;p&gt;At the moment there are no provisions for installing the tests as binaries and shipping them in distros - no one yet demanded this. So first you need to grab intel-gpu-tools and piglit sources: &lt;/p&gt;&lt;code&gt;$ git clone &lt;a href="git://anongit.freedesktop.org/piglit"&gt;git://anongit.freedesktop.org/piglit&lt;/a&gt;&lt;br /&gt;$ git clone &lt;a href="git://anongit.freedesktop.org/xorg/app/intel-gpu-tools"&gt;git://anongit.freedesktop.org/xorg/app/intel-gpu-tools&lt;/a&gt;&lt;/code&gt;&lt;p&gt;Then build them: &lt;/p&gt;&lt;code&gt;$ cd intel-gpu-tools&lt;br /&gt;$ ./autogen.sh &amp;amp;&amp;amp; make&lt;br /&gt;$ cd ../piglit&lt;br /&gt;$ cmake . &amp;amp;&amp;amp; make&lt;/code&gt;&lt;p&gt;We also need to tell piglit where the kernel testsuite is with a symlink: &lt;/p&gt;&lt;code&gt;$ cd bin&lt;br /&gt;$ ln ../../intel-gpu-tools igt -s&lt;/code&gt;&lt;p&gt;Finally we can run testcases. Note that currently we assume that testcases are run as root, and there's no other drm client running. The rte testcase (short for runtime enviroment) will fail if that's not the case. Yeah, one of the projects is to improve the piglit testrunner to notice this earlier. Anyway, best get used to always run piglit for the kernel as root: &lt;/p&gt;&lt;code&gt;$ sudo ./piglit-run.py tests/igt result&lt;/code&gt;&lt;p&gt;Just enumerating the testcases doesn't need root though. But it will run the binaries of tests with subtests since igt subtests are enumerated at runtime - that helps greatly with constructing combinatorial testcases. So to list all tests just run &lt;/p&gt;&lt;code&gt;$ ./piglit-run.py -d tests/igt result&lt;/code&gt;&lt;p&gt;For further options and tools to display the test results, list the test commands and other useful stuff please consult the piglit documentation. &lt;/p&gt;&lt;h2&gt;Helper Functions&lt;/h2&gt;&lt;p&gt;The biggest part of the helper library is a pile of small wrappers around drm ioctls. libdrm is often at a way to high abstraction level, especially if you try to be nasty and provoke the kernel into doing stupid things. There's also the usual duplication of headers that we replicate (in slightly different versions) in all our userspace driver repositories ... &lt;/p&gt;&lt;p&gt;But the far more interesting functionality is in the other code in &lt;code&gt;lib/drmtest.c&lt;/code&gt;. One of the most often used helpers is the rude interruptor, which forks a second process to constantly interrupt the first with a signal. That's useful for three reasons: X makes heavy use of signals, so we need to be able to exercise these paths, too. Then the kernel code itself relies on the ioctl restarting to bail out threads when the gpu is hung - this way we can avoid ugly issues when threads hog locks waiting for the gpu, while the reset code needs those logs to complete the requests (or restart them if we ever implement them) after the hardware resets. And finally it's just a great way to exercise error paths, since most of the tricky error handling code for e.g. out of memory conditions also needs to deal with interruptions due to a pending signal. &lt;/p&gt;&lt;p&gt;Another big chunk of helper logic is the just recently improved support code for subtests. The next section will go into greater detail on those. Then there's also helper code for system suspend/resume, gpu aperture thrashing, prefault disabling. And finally we have a few helpers for modesetting tests, to draw nice framebuffers with some gradients and corner markers and to get the VT handling right - it's rather tricky to stop the fbcon from interferring by blanking the screen in the middle of a test ... &lt;/p&gt; &lt;h2&gt;Subtest Infrastructure and Magic Codeblocks&lt;/h2&gt;&lt;p&gt;As mentioned already igt kernel tests enumerate subtests at runtime. Generally the subtest infrastructure is pretty simple. At the beginning of the test &lt;code&gt;igt_subtest_init(argc, argv)&lt;/code&gt; needs to be called so that the subtest logic can correctly disable subtest - either all off them when only listing subtest names with &lt;code&gt;--list-subtests&lt;/code&gt; or all but one when running a specific subtest with &lt;code&gt;--run-subtes &amp;lt;subtest-name&amp;gt;&lt;/code&gt;. There is also a special variant of this init function called &lt;code&gt;igt_subtest_init_parse_opts&lt;/code&gt; useful when the test program wants to augment its own option parsing with this functionality. &lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Then it's just a matter of enclosing the code for each subtest in an &lt;code&gt;igt_subtest&lt;/code&gt; code block, e.g. &lt;/p&gt;&lt;code&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_subtest("basic")&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; run_basic_test();&lt;/code&gt;&lt;p&gt;This works like any C codeblock, i.e. if the block contains more than one statement it needs to be enclosed in curly braces. The block so marked up is only run when the named subtest should be run - when only listing subtests the code itself is skipped. The magic &lt;code&gt;igt_subtest&lt;/code&gt; block will also print the result of the subtest to stdout. For combinatorial subtests where the subtest name is constructed at runtime there's also &lt;code&gt;igt_subtest_f&lt;/code&gt; which takes a &lt;code&gt;printf&lt;/code&gt;-like format string and additional paramters instead of a fixed string. &lt;/p&gt;&lt;p&gt; Now this is all nice and dandy but leaves the question how to do common setup code outside of the actual subtests and make sure it doesn't interfere when just listing the subtests or when running on a unsupported system where all subtests should be skipped. And then there's the question what to do when a subtest should be skipped or failed. &lt;/p&gt;&lt;p&gt; For the first issue there's another magic codeblock, &lt;code&gt;igt_fixture&lt;/code&gt;. Anything within such a codeblock will be skipped when only listing subtests, but unconditionally run when any subtests should be run. So code to setup the global test fixture should be enclosed in such blocks. &lt;/p&gt;&lt;p&gt; For testcases without subtests the skipping and failing is easy to do - failed tests simply exit with a nonzero exit code, and the special exit code 77 is reserved to denote a skipped test. But with subtests we want to go through the entire remaining program so that the results for all subsequent subtests is still printed. Here comes &lt;code&gt;igt_skip()&lt;/code&gt; and &lt;code&gt;igt_exit(&amp;lt;exitcode&amp;gt;)&lt;/code&gt; to the rescue. With some &lt;code&gt;longjmp&lt;/code&gt; magic they will bail out of the enclosing magic code block (either a subtest or a fixture). If those magic macros bail out of a subtest only that subtest is skipped/failed and all subsequent code is run - subtest of course only if they should be run, but fixtures (e.g. used for cleanup) are unconditionally run. &lt;/p&gt;&lt;p&gt; But if those magics macros are called within a fixture all subsequent fixture and subtest blocks are skipped since presumably a required piece of state couldn't be set up. Also for all subtests that still follow their status will be reported as either skipped or failed. This way when new features are added to a new combinatorial testcase which depends upon kernel support (like a new buffer object coherency mode) this can be added at the end of the test sequence: If the setup in a fixture block then fails all the subtests which need this new kernel support will be automagically skipped, but all the previous tests still run correctly. &lt;/p&gt;&lt;p&gt; For convenience there's also the &lt;code&gt;igt_assert&lt;/code&gt; and &lt;code&gt;igt_require&lt;/code&gt; macros which work like a normal assert. But instead of calling &lt;code&gt;abort()&lt;/code&gt; internally they call &lt;code&gt;igt_fail()&lt;/code&gt; and &lt;code&gt;igt_skip()&lt;/code&gt;, respectively. And of course the print the file and line where the failure happened and the condition itself for easy identification. Unfortunately macros get expanded before being passed on, so ioctl numbers are really hard to read ... &lt;/p&gt;&lt;p&gt; Finally there's also an &lt;code&gt;igt_success()&lt;/code&gt;, but most tests don't need to call this explicitly since the magic subtest code block will call this function at the very end of the code block, presuming that the subtest succeeded when it completed. And finally there's &lt;code&gt;igt_exit()&lt;/code&gt; which will exit the test program with the correct exitcode for the piglit testrunner to interpret the result. &lt;/p&gt;&lt;p&gt; One thing to remember is that both fixtures and subtests internally use long jumps and that those can wreak havoc with stack variables. But when the testcases are written properly (specifically subtests must be independent of each another and only depend upon all the preceeding fixtures to have completed successfully) then this shouldn't ever cause trouble. It did cause a bit of trouble while converting testcase on an earlier version of&amp;nbsp; the fixture block - that used a long jump even when the fixture successfully complete and so could wreak the just set up stack variables. &lt;/p&gt;&lt;p&gt; So all in all for a testcase with subtests like &lt;code&gt;gem_mmap_gtt&lt;/code&gt; this results in a fairly streamlined main function, despite all the magic: &lt;/p&gt; &lt;code&gt;int main(int argc, char **argv)&lt;br /&gt;{&lt;/code&gt;&lt;br /&gt;&lt;code&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; int fd;&lt;/code&gt;&lt;br /&gt;&lt;code&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_subtest_init(argc, argv);&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_fixture&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; fd = drm_open_any();&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_subtest("access")&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; test_access(fd);&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; /* More subtests ... */&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_fixture&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; close(fd);&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; igt_exit();&lt;br /&gt;}&lt;/code&gt; &lt;p&gt; The test functions themselves can also shed a lot of the control flow logic by directly using the &lt;code&gt;igt_require/igt_asssert&lt;/code&gt; macros. Compared to the previous state before the introduction of the magic subtest and fixture code blocks all this control flow was explicitly done in each testcase and correspondingly buggy. And dropping all that code also nicely clarified what's actually being tested. &lt;/p&gt;&lt;p&gt;&lt;b&gt;Update:&lt;/b&gt; Fix the setup commands a bit as spotted by Mika Kuoppala. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/7561193979125790593/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/08/recent-drmi915-testsuite-improvements.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7561193979125790593'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7561193979125790593'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/08/recent-drmi915-testsuite-improvements.html' title='Recent drm/i915 Testsuite Improvements'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8642996882842482489</id><published>2013-07-24T14:43:00.000-07:00</published><updated>2013-07-24T14:43:41.802-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>In Which Kernel Release Will $FEATURE Land In?</title><content type='html'>So I get asked this question quite often and since I'm a terribly lazy person I'm just going to write this down once and then link to it ...&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;So the first thing to know is when future kernel releases will happen. In the past few years this has settled to a new version roughly every 2½ months, so this is very predictable. &lt;a href="http://www.kroah.com/log/blog/2013/07/01/3-dot-10-kernel-development-rate/"&gt;Greg KH keeps some nice statistics&lt;/a&gt; about that around. Then the upstream feature merge window is the (usually) two week period between the first -rc of a new version and the release of the previous kernel version. In that time all the subsystem trees get pulled into Linus' upstream branch, so also Dave Airlie's drm-next tree.&lt;br /&gt;&lt;br /&gt;But by the time the upstream merge window opens up subsystem trees should all be ready, so for drm/i915 driver features (and core drm features) the cut-off date is earlier: Taking into account the one week delay incurred by our QA team doing extensive manual testing of my feature pull requests before I send them off to Dave Airlie and 1-2 weeks of buffer time due to misalignment of our biweekly drm-intel-next iterations with the upstream merge window our own cut-off is roughly two weeks before that.&lt;br /&gt;&lt;br /&gt;Now this cut-off date is for patches which are ready for inclusion. Which means they're reviewed, have sufficient coverage through automated tests and survived a few days of getting beating up in my queue and our QA's nightly test runs. Even when the patches and test-cases don't need big reworks to be suitable for merging but only smaller fixups this can easily add 1-2 weeks since review bandwidth is still in constant short supply. For big&amp;amp;tricky feature work getting the first round of a patch series into shape can take much longer, and the time&amp;amp;effort required to do so needs to be individually estimated.&lt;br /&gt;&lt;br /&gt;Note that for early hardware enabling we can cut down a few of the intermediate steps. But only as long as the new hardware support just plugs into existing code and so has a much reduced risk of breaking existing support. Code refactoring to prepare for a new platform must go through the usual merge and QA process to catch regressions in time.&lt;br /&gt;&lt;br /&gt;A somewhat related topic to fast&amp;amp;loose for new hardware enabling is regressions: Upstream is crystal clear that breaking existing setups is never an option on the table, as long as someone reports the breakage at least. For early hardware enabling that gives us a bit more leeway since no one yet has the hardware, but this is deceiving since the development tree is months ahead of when users actually get released kernels, and widespread availability of SDVs for OEMs, ISVs and OSVs is surprisingly early. So the only safe place to break things is just the first kernel released with the basic enabling of a new platform. And even for that it should not regress compared to using the firmware modeset code with either the efifb or vesafb drivers.&lt;br /&gt;&lt;br /&gt;With that here's the recipe for reliably predicting when a big feature will land in the kernel:&lt;br /&gt;&lt;ol&gt;&lt;li&gt;Create an early patch series as an rfc to gather requirements for the real solution and assess a sensible amount of automated test coverage. Usually this ends up being the version to throw away (or at least needs to be substantially reworked).&lt;/li&gt;&lt;li&gt;Carefully split up all the work into sufficiently small junks both for easier reviewing (past 20 patches or so the chore tends to be much worse) and for more accurate estimation. Anything which takes more than a week to stitch&amp;nbsp; together is likely way too big.&lt;/li&gt;&lt;li&gt;Estimate both developer effort and real world time - regression, important bugfixes and review duty tend to interfere. And especially for bigger patch series or complicated subject, even more so in the drm core, review and testing bandwidth tends to be the limiting factor.&lt;/li&gt;&lt;li&gt;Add a risk buffer, both for review delays, new requirements that suddenly pop up and for tracking down regressions - those just happen. Of course different parts have different risks associated: A simple interface refactoring should have almost no risk, whereas adding new features and even more so new userspace interfaces has much more stringent test and review standards.&lt;/li&gt;&lt;li&gt;Take the estimated completion date, i.e. when a feature will have been merged to drm-intel-next. Then add the above mentioned delays and line that up with the predicted kernel release dates to figure out in which upstream release something will land.&lt;/li&gt;&lt;/ol&gt;&lt;br /&gt;In my opinion that's all that's needed for solid kernel feature planning and lining it up with upstream releases.&lt;br /&gt;&lt;br /&gt;For a little example presume that 3.x.0 was just released, and after the initial review we estimate that we need 5 weeks to beat the code into shape and write testcases plus 2 weeks trailing at the end to merge everything. Of course merging would start earlier, so the 2 weeks is just to get the last parts in. This means the feature is expected to be merged into drm-intel trees by the time 3.(x+1)-rc6 is tagged which for the usual release cycle is just on the edge to to get into the 3.(x+2) merge window. But since we can't change the whims of upstream deciding to releasing a week earlier it could very well get delayed to the 3.(x+3) kernel release. So overall from the point where the in-depth scoping is done for this example feature to the date where it would ship in a released kernel could take 7½ months.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/8642996882842482489/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/07/in-which-kernel-release-will-feature.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8642996882842482489'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8642996882842482489'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/in-which-kernel-release-will-feature.html' title='In Which Kernel Release Will $FEATURE Land In?'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4481518305873487209</id><published>2013-07-23T00:03:00.000-07:00</published><updated>2013-07-23T01:08:07.778-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Precomputing the CRTC Configuration in drm/i915</title><content type='html'>&lt;p&gt;Like I've briefly mentioned when explaining the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;new modeset code&lt;/a&gt; merged into &lt;a href="http://blog.ffwll.ch/2012/10/neat-drmi915-stuff-for-37.html"&gt;kernel 3.7&lt;/a&gt; one of the goals was to facility atomic modesetting and fastboot. Now the big new requirement for both atomic modesetting and fastboot is that we precompute the entire output configuration before we start touching the hardware. And this includes things like pll settings, internal link configuration and watermarks. For atomic modesetting we need this to be able to decide up-front whether a configuration requested by userspace works, or whether we don't have enough bandwidth, display plls or lack some other resource. For fastboot we need to be able to compute and track the full display hardware state in software so that we can compare a requested configuration from userspace with the boot-up state taken over from the BIOS. Otherwise we might end up with suboptimal settings inherited from the firmware or worse, we'd try to reuse some resources still in use by the firmware configuration (like when the BIOS and the linux driver would pick different display plls). &lt;/p&gt;&lt;p&gt;Now the new modeset code merged into 3.7 already added such state tracking and precomputation for the output routing between crtcs and connectors. Over the past months, starting with the just released 3.10 linux kernel we've added new infrastructure and tons of code to track the low-level hardware state like display pll selection, FDI link configuration and tons of other things. Read on below for an overview of how the new magic works. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h2&gt;Pipe Configuration Computation&lt;/h2&gt;&lt;p&gt;So let's first look at how the new &lt;code&gt;struct intel_crtc_config&lt;/code&gt; is used in the modeset code. The overall logic is similar to how the output routing works: First we create a new pipe configuration in a staging area. Once we have done that and know that the configuration requested by userspace is possible we shut down any pipes and ports that need to be changed or disabled. Then we commit the staged pipe configuration by writing it into the &lt;code&gt;struct intel_crtc&lt;/code&gt;, this is done at the same time when we commit all the staged output routing pointers (and other modeset state like dpms) to the curretn state pointers. With that everything is in place to set the new mode into the hardware and enable the new pipes and ports again. &lt;/p&gt;&lt;p&gt;The difference is that since the amount of data we have to keep track of is just a pointer to the entire pipe configuration per crtc we explicitly pass it around in the preparation phase. This is different from the output routing where every object has both routing pointers for both the current state and a second set of pointers with the &lt;code&gt;new_&lt;/code&gt; prefix for the staged routing state. &lt;/p&gt;&lt;p&gt;Currently our code doesn't yet support atomic modesets, so we only ever update the configuration of one display pipe. In the prepare phase we allocate a new pipe configuration structure and then fill it out with the desired state. The code generally calls functions and callbacks involved in this &lt;code&gt;compute_config&lt;/code&gt;. The first step is to prefill it with information that encoder &lt;code&gt;-&amp;gt;compute_config&lt;/code&gt; callback needs. This includes the requested mode from userspace, a copy of the requested mode called adjusted mode which encoders can change for e.g. upscaling to a built in panel. Other state prefilled is the pipe bpp value, which is computed from the pixel depth of the main framebuffer. There's also some code to handle default values for the port clock, pixel multiplier and similar things which only a few encoders need to change. &lt;/p&gt;&lt;p&gt;The next step is to loop over all encoders which will use the pipe (using the staged output routing pointers). Typically encoders can change the adjusted mode and set the desired panel fitter state (for eDP and LVDS). They adjust clock selection parameters like the pixel multiplier or the required port clock, e.g. the fixed DP lane clocks or 12 bpc HDMI output which needs a 1.5x faster port clock than the actual pixel clock. Encoders also set various state only used internally like whether the port is on the PCH (and so needs an FDI link). In some special cases encoders also set the display pll state or at least some values to steer the pll computation algorithms later on. &lt;/p&gt;&lt;p&gt;Eventually the goal is that all the pll state computation happens in the prepare phase before we start to touch the hardware. This is important for atomic modesets where we want to know upfront whether enough plls are available for a given configuration. But right now the code transformation is still in progress and the pll selection happens still later on in the actual modeset phase, and only for a few case do we already precompute the desired pll configuration even. &lt;/p&gt;&lt;p&gt;Once the encoders have had their say the last stage of the pipe configuration computation deals with general pipe state. This includes things like for example the FDI link configuration or in the future the pll state computation. This is done in &lt;code&gt;intel_crtc_compute_config&lt;/code&gt;. This is also the function which checks for global constraints (like shared FDI links or eventually sufficient display plls). If the current configuration doesn't work out, but it might be possible with some reduced settings then this function returns &lt;code&gt;RETRY&lt;/code&gt;. The overall pipe configuration computation function &lt;code&gt; intel_modeset_pipe_config&lt;/code&gt; then restarts at the second phase where encoder callbacks are called. There are also some special flags in the pipe configuration structure to make sure encoders adhere to these limits. E.g. HDMI only supports either 8 bpc or 12 bpc modes and tries to pick the port bpc setting by rounding up. Now if we have a bandwidth constraint and the crtc logic limited a 12 bpc pipe to 10 bpc then we would loop forever since we would flip-flop between 12 bpc and 10 bpc. Hence why we need a flag for this case which the HDMI encoder's &lt;code&gt;compute_config&lt;/code&gt; callback checks. &lt;/p&gt;&lt;p&gt;The eventual goal is to use the pipe configuration structure to decide which pipes need to be changed. So the logic will be that we compute the pipe configuration for all pipes that will be enabled after the modeset. Once that's done we can compare the new pipe state with the current configuration and only disable and re-enable pipes which have actually changed. This will be useful for atomic modeset where userspace might only request a change in one crtc, but due to global limits we also need to change a second crtc. It should also allow us to have robust fastboot support as long as the pipe configuration can accurately reflect any hardware state left behind by the BIOS. &lt;/p&gt;&lt;h2&gt;Configuration State Read-Out and Cross-Checking&lt;/h2&gt;&lt;p&gt;But of course that requires us to read out the pipe configuration state from the hardware when taking over from the BIOS. And once we have that state read-out code it's really good to reuse it to cross-check the hardware state with the software tracking after each modeset. For the output routing this helped to uncover tons of bugs, both in the state tracking in software and the hardware read-out code. For the pipe configuration this was even more the case, mostly due to the much higher complexity of the pipe state. &lt;/p&gt;&lt;p&gt;Reading out the pipe configuration state is a bit tricky since a bunch of the settings stored in the &lt;code&gt;struct intel_crtc_configuration&lt;/code&gt; are associated with the output port, at least on some platforms. One example is the pixel multiplier (on the few old platforms where that's stored in the port), which in turn affects how the adjusted mode's dot clock is computed from the display pll state. To solve this conundrum we have a bunch of callbacks currently which need to be used in a specific order. Unfortunately we can't share that code between the hardware state readout logic run at boot-up and resume time and the modeset hardware cross check logic. There's also been the oddball bug because the sequence didn't quite match up at first. I expect that in the future we'll need to refactor this part of the pipe configuration infrastructure and move the entire logic into per-platform callbacks. &lt;/p&gt;&lt;p&gt;But for now we first call the per-platform &lt;code&gt;-&amp;gt;get_pipe_config&lt;/code&gt; callback, which reads out all the state associated with planes, pipes and transcoders. Then we call the &lt;code&gt;-&amp;gt;get_config&lt;/code&gt; callback of each encoder connected to a given pipe. This currently fills in the sync polarity mode flags and pixel multiplier. Finally we call &lt;code&gt;-&amp;gt;get_clock&lt;/code&gt; to compute the actual dot clock of the adjusted mode from the read-out values. &lt;/p&gt;&lt;p&gt;Since we don't read out the pipe state when the pipe is disabled there has been no need yet to sanitize it beyond what the existing code already does by simple disable crtcs which aren't in use. We've stumbled though already over cases where the hardware readout can't accurately reflect state, either due to hardware bugs or since our software tracking is less flexible than what the hardware can do (and what BIOS try to use). For those cases we set special quirk flags in the read-out pipe configuration so that the state comparison code can act accordingly. &lt;/p&gt;&lt;p&gt;Comparing state configurations is done in &lt;code&gt;intel_pipe_config_compare&lt;/code&gt;. Currently this is only used for the state cross check code run after every modeset. But eventually we want to use this code to decide whether a crtc needs to go through a full modeset sequence or whether we can optimize things with a special fastpath. This is important for fastboot support where e.g. disabling the panel fitter doesn't require a complete shutdown of the pipe. Quirk flags will also play an important role for fastboot support: If e.g. the panel fitters aren't associated to the pipes we expect them to be used with then we can set a corresponding quirk flag on all affected pipes. This will ensure that the configuration comparison fails and we do a full modeset at boot-up. &lt;/p&gt;&lt;p&gt;In the future we might need to abstract away the configuration comparison with a per-platform callback to properly encode platform-specific constraints for fastpaths. But since the current experimental fastboot code doesn't explicitly deal with pipe configuration structures yet there's not yet a need for more complexity. &lt;/p&gt;&lt;h2&gt;Handling Shared Display PLLs&lt;/h2&gt;&lt;p&gt;One really special piece of pipe configuration state is handling display plls. The reason for that is that they can be shared between different pipes. This is unlike other global resources like panel fitters where sharing isn't possible, or reference clocks where sharing is the default but there's also no way to have conflicts. &lt;/p&gt;&lt;p&gt;Now for display plls on the PCH we've had a bit of code to reference count and manage them. But unfortunately it took us a lot of iterations to have anything remotely working and we still ended up with tons of bugs. And since other platforms gear up for pll sharing too I've decided that more abstraction, which will afford us much more paranoia through systematically cross-checking state is required. &lt;/p&gt;&lt;p&gt;Therefore we've added new objects to track the state of shared display plls in kernel version 3.11. Callbacks to read out the pll state and to enable/disable it provide the required abstraction between the generic refcounting and cross-checking code and the platform specific hardware state. The cross-checking not only compares whether the pll state is what we expect it to be, but also checks that the relationship between plls and crtcs is sound. For example we cross-check the reference count for all active crtcs using a given pll. &lt;/p&gt;&lt;p&gt;Like when developing the new modeset infrastructure or when implementing the pipe configuration computation code the cross-checking helped a lot in catching bugs. And it already caught a sloppy firmware implementation which left an unused but enabled pll behind, so now we also have a bit of code to sanitize the pll state. &lt;/p&gt;&lt;h2&gt;Conclusion&lt;/h2&gt;&lt;p&gt;Overall the drm/i915 driver gained quite a bit of fanciness with the addition of the pipe configuration tracking - the new infrastructure already allows us to pull off a few neat new tricks. But there's still a lot to do to fully reap the benefits for atomic modesets and solid fastbooting. One thing is clear though: The paranoid hardware cross check code really helps to catch oddball bugs and gives us a much better reassurance that the state tracking is correct than any amount of laborious QA managed to do beforehand. Which means that development pace can greatly speed up since we depend far less upon the big linux community to test our code in the upstream kernel. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4481518305873487209/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/07/precomputing-crtc-configuration-in.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4481518305873487209'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4481518305873487209'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/precomputing-crtc-configuration-in.html' title='Precomputing the CRTC Configuration in drm/i915'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2605807993115082017</id><published>2013-07-05T02:41:00.000-07:00</published><updated>2013-07-21T06:55:34.737-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>On Forklifting and Pitchforks</title><content type='html'>&lt;p&gt;So sometimes someone wants the latest drm kernel driver bits, but please on a ridiculously outdated stable kernel like last month's release. Or much worse, actually something from last year. &lt;/p&gt;&lt;p&gt;Ok I'm getting ahead of myself here, usually these things start with a request for a "minimal" backport to enable &lt;code&gt;$NEW_PLATFORM&lt;/code&gt; or some other really important feature. But the lesson that drm drivers are complex beasts and that such minimal backports tend to require full validation again and a lot of work to fix up the fallout is usually learned quickly. So backporting the entire beast with all drivers it is. &lt;/p&gt;&lt;p&gt;The next obvious question is why we can't just copy the entire thing, since reconstructing the git history is rather tedious work, and usually ends up with a few commits in between that don't quite work correctly. Which means that the backported git history is usually of little value. The answer to that question tends to boil down to "we've promised this to the customer ...". So if you're in such a situation, read on below on how to most efficiently wrestle git to forklift the history of an entire subsystem onto an older kernel release. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;p&gt;First we want to look at how to forklift git history at a high-level. The naive approach would be to use git rebase. But rebasing linearizes the history, which means that the baseline patches apply onto will change, which means that any conflicts resolved in a merge need to instead be resolved when applying patches. And usually changing one patch will cause conflicts to ripple to subsequent patches, pretty much guaranteeing that the end-result is broken somewhere. So linearizing the history is (mostly) out of the question, we need to at least reconstruct the major merge points between branches, i.e. where conflicts are resolved. The second option would be git filter-branch, which is slightly better since it will preserve the large-scale structure of the history. But that doesn't allow us to fix-up the few places where some drm change depends upon a patch in the core kernel (pulled in by a merge) or some tree-wide interface refactoring which for backporting purposes is usually best left out. So we're left with manually reconstructing the history. &lt;/p&gt;&lt;p&gt;For preparation the first thing to do is enable git rerere. Then it's also a good idea to steal all the merge resolutions from your maintainer, since otherwise you'll have to reconstruct them from merge commits by hand. For my drm-intel branches they're all getting auto-pushed to my &lt;a href="http://cgit.freedesktop.org/~danvet/drm-intel/log/?h=rerere-cache"&gt;rerere-cache branch&lt;/a&gt;. Then we need a branch based on the kernel we want to forklift everything onto (I tend to call that branch &lt;b&gt;forklift&lt;/b&gt;/&lt;baseline&gt;). Plus a bunch of throwaway branches to prepare different backported branches so that we can merge them into the main forklift branch, which I usually call &lt;b&gt;pitchfork&lt;/b&gt;s. &lt;/p&gt;&lt;p&gt;The overall strategy is now to look at the large-scale structure of the history, i.e. where different parts of the history branched off and where it is merged back in again. For each such piece we create a new pitchfork branch which is based off the corresponding backported commit in the forklift branch. Then we cherry-pick from the haystack (i.e. upstream history) until patches until we hit a merge commit. Often though, especially when the merge commit only pulled in bugfixes late in the -rc cycle we can go right ahead an cherry-pick the next part of the upstream history on top. But if there's a merge commit with conflict resolutions, or if the next part of the history depends upon the merged changes we need to merge the pitchfork branch into the main forklift branch before we can proceed to load up the next pitchfork with new patches. &lt;/p&gt;&lt;p&gt;If the history of the drm subsystem is completely independent from the core kernel this will never result in a conflict. At least if all merges are faithfully reconstructed on the forklift branch. But sometimes a core change needs to be pulled in, or a tree-wide refactoring needs to not be cheery-picked (if backporting all the other changes would be too invasive). Luckily this can only ever happen a points in the history where commits outside of the drm subsystem are merged in or where a branch is based on such commits. Figuring those things out before cherry-picking is usually to cumbersome, hence I just cherry-pick a range of commits and only test at the end, before doing the next merge. If the patches fail to apply or if compilation fails somehow then (and only tend) do I analyze what's going on. &lt;/p&gt;&lt;p&gt;The other fun part of doing this is keeping track of which patches exactly are merged already - the drm history easily can end up with 5-10 branches running in parallel which each need to be put onto their own pitchfork and merged back in at the right time. Using &lt;code&gt;git cherry-pick -x&lt;/code&gt; is useful to annotate which is the upstream commmit, I tend to add similar notes to the reconstructed merge commits. To figure out the equivalent baseline commit for starting a new pitchfork branch simply searching for the commit headline is good enough. And for really complicated sections in the upstream history liberal use of tags to mark already forklifted branches helps a lot. &lt;/p&gt;&lt;p&gt;A really useful tool to check whether anything has been missed is to diff the forklifted branch with the corresponding upstream commit, restricted to drm-relevant directories like drivers/gpu/drm or include/drm. The diff should only every contain things specifically ignored for the backport like tree-wide refactorings.  &lt;/p&gt;&lt;p&gt;Especially if the tree is supposed to be longer-lived it is useful to annotate the forklifted history with notes about which pieces of the upstream history had to be backported in addition to subsystem patches and which pieces have been ignore. I tend to use empty commits for that purpose. Finally a note of caution for such long-lived forklift branches: It is really tempting to ignore all the other drivers in the drm subsystem you don't care about and not backport those patches. But that way comparing trees is more complicated since subdirectories need to be excluded. And often there are also patches that change an interface across all drivers, which then require to be fixed up manually. So in my opinion it's simpler to just drag everything in the drm directories along. &lt;/p&gt; </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2605807993115082017/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2605807993115082017'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2605807993115082017'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html' title='On Forklifting and Pitchforks'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6661539345779075349</id><published>2013-07-02T06:14:00.000-07:00</published><updated>2014-05-26T00:13:51.456-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>drm/i915 Branches Explained</title><content type='html'>Since I've &lt;a href="http://blog.ffwll.ch/2012/01/new-drm-intel-next-git-tree.html"&gt;started maintaining the drm/i915 over a year ago&lt;/a&gt; I've fined-tuned the branching model a lot. So I think it's time for an update, especially since &lt;a href="http://lists.freedesktop.org/archives/intel-gfx/2013-July/029648.html"&gt;Sedat Dilek poked me about it&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;There are two main branches I merge patches into, namely &lt;b&gt;drm-intel-fixes&lt;/b&gt; and &lt;b&gt;drm-intel-next-queued&lt;/b&gt;. drm-intel-fixes contains bugfixes for the current -rc upstream kernels, whereas drm-intel-next-queued (commonly shortened to dinq) is for feature work. The first special thing is that contrary to subsystem trees I don't close dinq while the upstream merge window is open - stalling QA and our own driver feature and review work for usually more than 2 weeks is a bit too disruptive. But the linux-next tree maintained by upstream forbids this, hence why I also have the for-linux-next branch: Usually it's a copy of the drm-intel-next-queued branch safe when the merge window is open, then it's a copy of the drm-intel-fixes branch. This way we can keep the process in our team going without upsetting Stephen Rothwell. &lt;br /&gt;Usually once the merge-window opens I have a mix of feature work (which then obviously missed the deadline) and bugfixes oustanding (i.e. not yet merged to Dave Airlie's drm branches). Therefore I split out the bugfixes from dinq into -fixes and rebase  the remaining feature work in dinq on top of that.&lt;br /&gt;&lt;br /&gt;Now for our own nightly QA testing we want a lightweight linux-next just for graphics. Hence there's the &lt;b&gt;drm-intel-nightly&lt;/b&gt; branch which currently merges together drm-intel-fixes and -next-queued plus the drm-next and drm-fixes branches from Dave Airlie. We've had some ugly regressions in the past due to changes in the drm core which we've failed to detect for months, hence why we now also include the drm branches.&lt;br /&gt;&lt;br /&gt;Unfortunately not all of our QA procedures are fully automated and can be run every night, so roughly every two weeks I try to stabilize dinq a bit and freeze it as &lt;b&gt;drm-intel-next&lt;/b&gt;. I also push out a snapshot of -nightly to &lt;b&gt;drm-intel-testing&lt;/b&gt;, so that QA has a tree with all the bugfixes included to do the extensive and labour-intensive manual tests. Once that's done (usually takes about a week) and nothing bad popped up I send a pull request to Dave Airlie for that drm-intel-next branch.&lt;br /&gt;&lt;br /&gt;There's also still the for-airlied branch around, but since I now use git tags both for -fixes and -next pull requests I'll probably remove that branch soon. &lt;br /&gt;Finally there's the &lt;b&gt;rerere-cache&lt;/b&gt; branch. I have a bunch of scripts which automatically create drm-intel-nightly for me, using git rerere and a set of optional fixup patches. To be able to seamlessly do both at home with my workstation and on the road with my laptop the scripts also push out the latest git rerere data and fixup branches to this branch. When I switch machines I can then quickly sync up all the maintainer branch state to the next machine with a simple script.&lt;br /&gt;&lt;br /&gt;Now if you're a developer and wonder on which branch you should base your patches on it's pretty simple: If it's a bugfix which should be merged into the current -rc series it should be based on top of drm-intel-fixes. Feature work on the other hand should be based on drm-intel-nightly - if the patches don't apply cleanly to plain dinq I'll look at the situation and decide whether an explicit backport or just resolving the conflicts is the right approach. Upstream maintainers don't like backmerges, hence I try to avoid them if it makes sense. But that also means that dinq and -fixes can diverge quite a bit and that some of the patches in -fixes would break things on plain dinq in interesting ways. Hence the recommendation to base feature development on top of -nightly.&lt;br /&gt;&lt;br /&gt;Addendum: All these branches can be found in the &lt;a href="http://cgit.freedesktop.org/drm-intel/"&gt;drm-intel git repository&lt;/a&gt;.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Update:&lt;/b&gt; The &lt;a href="http://blog.ffwll.ch/2014/02/new-drmi915-git-repository.html"&gt;drm-intel repository move&lt;/a&gt;, so I've updated the link. </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6661539345779075349/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/07/drmi915-branches-explained.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6661539345779075349'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6661539345779075349'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/drmi915-branches-explained.html' title='drm/i915 Branches Explained'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5299773283244896906</id><published>2013-06-29T07:46:00.001-07:00</published><updated>2013-07-21T06:48:11.116-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.11</title><content type='html'>&lt;a href="http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html"&gt;Kernel 3.10&lt;/a&gt; will be release soon, so it's time for our regular look at what the next kernel will bring. Purely on statistics the drm-intel-next pull for 3.11&amp;nbsp; is one of the biggest pull request with 314 patches thus far. Read on after the break for the details.&lt;br /&gt;&lt;br /&gt; &lt;a name='more'&gt;&lt;/a&gt;The big item is surely that &lt;b&gt;ValleyView&lt;/b&gt; (now called &lt;b&gt;Baytrail&lt;/b&gt;) support is now solid enough that we've lifted the preliminary hardware support tag for it and enabled it by default. Support for this SoC platform should be fairly complete now with rc6, render turbo and all outputs (with the exception of MIPI/DSI panels all nicely working now. Most of the code is from Jesse Barnes with a bunch of patches from Ville Syrjälä and also from the Bangalore display guys.&lt;br /&gt;&lt;br /&gt;For &lt;b&gt;Haswell&lt;/b&gt; there's a big effort to &lt;b&gt;enable power saving features&lt;/b&gt;: Paulo Zanoni fixed up our &lt;b&gt;watermark code&lt;/b&gt; and enabled the &lt;b&gt;intermediate pixel storage&lt;/b&gt; feature. Rodrigo Vivi enabled &lt;b&gt;framebuffer compression&lt;/b&gt;. Both changes greatly increase deep package C state residency and hence power consumption on idle systems when the display is enabled. Furthermore the &lt;b&gt;audio&lt;/b&gt; guys around Haihao Xiang fixed up the interaction of the intel alsa driver with our driver when the manual &lt;b&gt;display power well&lt;/b&gt; is shut down, further improving power consumption figures.&lt;br /&gt;&lt;br /&gt;On the Haswell render side there's finally support for the &lt;b&gt;VECS engine&lt;/b&gt;.&lt;b&gt; &lt;/b&gt;This engine is used by libva for some post-processing steps.&lt;br /&gt;&lt;br /&gt;There are also some further &lt;b&gt;hotplug improvements&lt;/b&gt; from Egbert Eich.&lt;b&gt; &lt;/b&gt;Chris Wilson has some further ideas to cut down on needless reprobing (and so speed up boot and resume times), but I've decided that we should test the current changes (especially the hotplug storm detection code merged in 3.10) a bit more - hardware is simply too broken in this area to play fast&amp;amp;loose.&lt;br /&gt;&lt;br /&gt;Mika Kuoppala worked a lot on our hangcheck &amp;amp; reset code and improved our context &lt;b&gt;support to enable the GL_ARB_robustness&lt;/b&gt; extension. Unfortunately the new ioctl wasn't merged for 3.11 since one of the last prep patches blew up in a bad way and so had to be dropped. But Mika also &lt;b&gt;fixed our long-standing out-of-memory issues with dumping the gpu error state&lt;/b&gt; - finally no bug report should be blocked any more because the reporter can't grab the error dump!&lt;br /&gt;&lt;br /&gt;Some of the context work also prepares for real per-process gpu address space. Ben Widawsky is working on that and also submitted quite a few &lt;b&gt;patches for our GTT code&lt;/b&gt; to prepare for this. Hopefully 3.12 will have the first cut of that code, and if Daniel Herrman's rendernode GSOC project also lands we'd finally have much improved security between different gpu clients.&lt;br /&gt;&lt;br /&gt;Another improvement which probably fewer people will notice is that we've revamped and improved our code to handle &lt;b&gt;non-24bpp modes&lt;/b&gt; - we can finally drive DP screens at 30bpp (although there's still work to do, as always), and also fixed up a few other corner cases. This is all part of the larger effort to reorganize our modesetting code. The big change in 3.11 though is the &lt;b&gt;addition of the pipe config structure&lt;/b&gt; to track the per-crtc modesetting state. We now also have code to &lt;b&gt;cross-check the hardware state&lt;/b&gt; with the software state after each modeset (similarly to how we already cross-check the output routing). This will help greatly to catch regression earlier, especially for some of the big upcoming features like fastboot or atomic modeset.&lt;br /&gt;&lt;br /&gt;In 3.11 though we've just merged preparatory patches to convert as much as possible of our crtc state to the new infrastructure: Panel fitter state, pipe bpp and dithering modes, display pll sharing (and some of the dpll hw state) and the basic output mode properties are now all tracked in the pipe configuration structure. For those curious about what's the design behind this new code framework and how it'll work out eventually: Stay tuned to this blog, I'm working on a more in-depth coverage.&lt;br /&gt;&lt;br /&gt;And of course there's been tons of little fixes, improvements and code refactoring all over the place.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5299773283244896906/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/06/neat-drmi915-stuff-for-311.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5299773283244896906'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5299773283244896906'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/06/neat-drmi915-stuff-for-311.html' title='Neat drm/i915 stuff for 3.11'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6272495792546758051</id><published>2013-05-26T07:40:00.002-07:00</published><updated>2013-07-21T06:58:51.497-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Q&amp;A</title><content type='html'>So apparently people do indeed read my my &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html"&gt;i915/GEM crashcourse&lt;/a&gt; and a bunch of follow-up questions popped up in private mails. Since I'm a lazy bastard I've cleaned some of the common questions&amp;amp;answers up to be able to easily point at them. And hopefully they also help someone else to clarify things a bit.&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;b&gt;Question:&lt;/b&gt; What’s the significance of &lt;code&gt;i915_gem_sw_finish_ioctl&lt;/code&gt; ? It seems to flush cpu caches, but only conditional on &lt;code&gt;obj-&amp;gt;pin_count != 0&lt;/code&gt;. Why does it no unconditionally flush the cpu caches like e.g. when we move an unsnooped/not LLC-cached object into a gpu domain? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt;   &lt;code&gt;i915_gem_sw_finish_ioctl&lt;/code&gt;is only used to flush out cpu rendering to the display (and in current userspace it's not used at all). &lt;code&gt;obj-&amp;gt;pin_count != 0&lt;/code&gt; is used as a proxy for "this a scanout buffer". Obviously more intelligent userspace should know whether it is doing cpu rendering to a displayed buffer or not and force the expensive clflushing with e.g. the &lt;code&gt;set_domain&lt;/code&gt; ioctl only when really required. But the &lt;code&gt;sw_finish&lt;/code&gt; ioctl is called from the libdrm cpu mmap unmap function, which does not have this knowledge at hand, hence the check in the kernel. Furthermore for efficient integration of cpu rendering into the gpu render pipeline we want to use snoopable objects even on non-LLC platforms which means that this ioctl shouldn't really be used any more for new code. &lt;br /&gt;&lt;b&gt;Question:&lt;/b&gt; So the cpu can only access a GEM object through the GTT when it's in the mappable part of the GTT, i.e. when &lt;code&gt;gtt_offset  + size  &amp;lt;=  gtt_mappable_end&lt;/code&gt;. But the &lt;code&gt;i915_gem_object_set_to_gtt_domain&lt;/code&gt; function does not check that whether this condition is satisfied or not and simply goes ahead with the domain change. Why is that done so, even though the cpu won't be able to access the buffer object at its current place? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt;The GTT domain is purely about coherency, i.e. a buffer object is in the GTT domain if reads/writes through the GTT would see the correct values. The other big domain is cpu domain, i.e. the data (when accessed directly in the physical memory location, not going through the GTT) is coherent with cpu caches. Shifting between these two domains requires flushing/invalidating cpu caches. &lt;br /&gt;Note that on recent kernels that doesn't even mean that there's a global GTT mapping allocated for that buffer object: This is used to optimize away the redundant cache flushing when moving an object around, e.g. when moving it into the mappable range to serve a cpu access page fault. In the future this will be even more common once we have proper per-process GTT address spaces. Then an object could be fully coherent with the GTT domain, read by the gpu through a PPGTT mapping, but don't have an offset allocated for it in the global GTT at all. &lt;br /&gt;The mappable GTT address range on the other hand is a different concept and simply means the object has a GTT mapping visible to the cpu (on gpus without PPGTT the global GTT can be up to 2g, but only 256m are usually visible in the pci bar). Note that GEM object can be mappable but can be (at the same time) in the cpu domain. This happens when userspace writes to the buffer object through the cpu mappings. &lt;br /&gt;&lt;b&gt;Question:&lt;/b&gt; How does the the &lt;code&gt;i915_gem_fault&lt;/code&gt; function handle a page fault when it itself is invoked through a page fault in the i915 GEM kernel code? Like suppose if &lt;code&gt;fault_in_pages_readable&lt;/code&gt; function is called which dereferences a user pointer - won't that cause issues with deadlocks? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt;Yes, this can happen and we need to be careful that we cannot possible deadlock with our own pagefault handlers. And it's not just theoretical, it happens in the wild when a GL client tries to use a pointer obtained from one of the texture mapping funtions (which can use a GTT memory mapping internally) to upload data (which could use the &lt;code&gt;pwrite&lt;/code&gt; GEM ioctl). &lt;br /&gt;These potential deadlocks are resolved by instructing the linux memory subsystem to not serve pagefaults when accessing userspace memory but instead fail it. Then our code can release any resources and locks required by our own page fault handler and retry the operation in a slowpath. Often this requires that we copy the data into a (unfaultable) temporary buffer in kernel's memory space. These atomic sections are often implicit, but we have a few places where we need to explicitly disable page fault handler with &lt;code&gt;pagefault_disable/enable()&lt;/code&gt; calls. &lt;br /&gt;&lt;b&gt;Question:&lt;/b&gt; Is &lt;code&gt;obj-&amp;gt;fenced_gpu_access&lt;/code&gt; ever set on modern platforms - it seems not? Or could this cause a stall waiting for the gpu when all fences are in use and we need a few fence to handle a GTT page fault? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt;  No, this is only ever set on Gen2/3 devices. Those gpus use the same GTT fences used on all platforms for detiling cpu access also for gpu access, at least for some gpu rendering functions. So this is irrelevant on modern platforms and can't lead to a stall in the pagefault handler when accessing an otherwise idle buffer object. &lt;br /&gt;&lt;b&gt;Question:&lt;/b&gt; What is this &lt;emph&gt;wedeged&lt;/emph&gt; stuff - there's lots of references to it in the i915 GEM code? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt; This is part of the gpu hang detection and reset handling code, which I didn't really cover in my crashcourse. It is set when we've detected a hang but failed to reset the gpu. It will cause all subsequent command submission from userspace to fail with &lt;code&gt;-EIO&lt;/code&gt;, which is used by userspace as a signal to fall back to software rendering. The i915 hang detection and reset code has been (and still is) under pretty active development and is nowadays a rather complex piece of code. I plan to cover it more in-depth hopefully soon. &lt;br /&gt;&lt;b&gt;Question:&lt;/b&gt; In the &lt;code&gt;use_cpu_reloc&lt;/code&gt; function, why is the &lt;code&gt;obj-&amp;gt;cache_level != I915_CACHE_NONE&lt;/code&gt; condition used? &lt;br /&gt;&lt;b&gt;Answer:&lt;/b&gt;  That's just crazy optimization - it's always faster to write relocations through cpu maps if LLC caching is enabled. But without caching it's faster to use global GTT access - but then only if we have the mappable mapping already set up. Note that &lt;code&gt;pwrite&lt;/code&gt; ioctl code has similar tricks. </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6272495792546758051/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/05/i915gem-q.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6272495792546758051'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6272495792546758051'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/05/i915gem-q.html' title='i915/GEM Q&amp;A'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5100670050437314612</id><published>2013-04-18T14:29:00.003-07:00</published><updated>2013-07-21T06:50:00.722-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.10</title><content type='html'>So kernel &lt;a href="http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html"&gt;3.9&lt;/a&gt; should be releasing really soon and so it's time for our regular look at what 3.10 brings to drm/i915:&lt;br /&gt;&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;For enthusiast (i.e. people who like to see their hw burn down in flames ...) the &lt;b&gt;&lt;a href="http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html"&gt;improved overclocking&lt;/a&gt;&lt;/b&gt; support is certainly the interesting bit. Thanks to Ben Widawsky's patches we now correctly detect the gpu turbo limit and set the non-turbo frequency as the default limit to avoid hanging systems right on boot. So GPU overclocking should now work on Sandybridge and Ivybridge - apparently something changed on Haswell. Related is Chris Wilson's patch to &lt;b&gt;tune the Haswell turbo support&lt;/b&gt; properly - Haswell has new frequency domains and so needs a different control table to ramp up the ring frequency when the GPU is busy.&lt;br /&gt;&lt;br /&gt;A big pain relief, at least on affected systems, is Ebgert Eich's &lt;b&gt;hotplug irq storm mitigation&lt;/b&gt; work. With the &lt;a href="http://blog.ffwll.ch/2013/02/new-kernel-modesetting-locking.html"&gt;modeset locking rework&lt;/a&gt; from 3.9 this should get rid of the last reason to boot with the &lt;code&gt;drm_kms_helper.poll=0&lt;/code&gt; option. Finally no longer a sluggish cursor and delayed screen updates!&lt;br /&gt;&lt;br /&gt;Another neat improvement is the &lt;b&gt;vt-switchless suspend/resume&lt;/b&gt; support from Jesse Barnes. This goes back to the user modesetting days, where the kernel forced a vt-switch to the vga linux console to make sure the X server properly saved and afterwards again restored the display state. With kernel modesetting that's pretty pointless and results in an ugly console cursor appearing quickly on resume (usually you can't spot it on suspend ...). But those days are past now.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Display-less gpu support &lt;/b&gt;is probably not something many people will care about. But Ben Widawsky's patches allows us to run on special Ivybridge server configurations, where all the display parts of the gpu are fused of and only the GT is used for e.g. video transcoding. Which is pretty cool since for a long time Intel graphics was only about display things, with a comparetively puny gpu attached to it. Times are changing ...&lt;br /&gt;&lt;br /&gt;For driver internals the big change is the introduction of the &lt;b&gt;pipe configuration tracking&lt;/b&gt;. This is pretty much just a continuation of the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;modeset rework started in 3.7&lt;/a&gt; and serves two main purposes: First this will allow us to precompute the desired display pipe configuration before we start to touch the hardware. This is required to make atomic modeset operations actually useful: Userspace can then just ask the kernel which configurations work very quickly and more important without causing any flickering, before deciding on a given setup. The second reason is that for fastboot we need to track the display state left behind by the BIOS precisely - integrating that tracking into the established hw state readout and cross-check support will make sure that this tracking is actually reliable.&lt;br /&gt;&lt;br /&gt;3.10 only contains the basic infrastructure though and moves only a few basic attributes over to it (like the pipe bpp values, dither settings, color space conversion and a few internal states used by different platforms to keep track of enabled chip functions). Our aim for 3.11 is to tackle the really big things like clock sharing, output mode and especially dotclock reconstruction and so lay the groundwork for solid fastboot support.&lt;br /&gt;&lt;br /&gt;Again purely driver-internal was the massive &lt;b&gt;low-level GTT interface rework&lt;/b&gt; from Ben Widawsky. This will help a lot in finally implementing real per-process gpu address spaces on Intel hardware, and it should also simplify enabling of future hardware platforms since that has now a clearly-defined and well-separated interface. Related is Imre Deak's little cleanup to abstract all our scatter-gather list walking with a &lt;code&gt;for_each_sg_page&lt;/code&gt; iterator.&lt;br /&gt;&lt;br /&gt;Finally I want to point out the &lt;b&gt;pageflip improvements&lt;/b&gt; from Ville Syrjälä. Compositors should now no longer get stuck after a gpu hang, gen2-4 received vblank interrupt and pageflip completion interrupt handling fixes and modesetting or panning operations should now also be able to survive gpu hangs without resulting in deadlocks. And the best part is that we have full coverage for all these corner cases in our kernel test suite, so these bugs should be gone for good.&lt;br /&gt;&lt;br /&gt;Last but not least there's been the usual big pile of small&amp;amp;large improvements all over: More vlv patches, backlight improvements and tons of bugfixes all over. For amusement maybe take a look at Chris Wilson's &lt;b&gt;bring a bigger gun&lt;/b&gt; &lt;a href="http://cgit.freedesktop.org/~danvet/drm-intel/commit/?h=drm-intel-next-queued&amp;amp;id=6ef2ba0d558e55312af8406093c62bd61216b991"&gt;coherence fix&lt;/a&gt;.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/5100670050437314612/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5100670050437314612'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/5100670050437314612'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html' title='Neat drm/i915 stuff for 3.10'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3197309094902219529</id><published>2013-03-24T08:59:00.000-07:00</published><updated>2013-07-21T07:00:33.241-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>Overclocking your Intel GPU on Linux</title><content type='html'>First things first: If you damage your hardware and burn down your house, it's not my problem. You've been warned!&lt;br /&gt;&lt;br /&gt;So after a bit of irc discusssions yesterday it turns out that you can overclock intel gpus by quite a margin. Which makes some sense now that the gfx performance of intel chips isn't something to be completely ashamed of.&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;You need a few ingredients:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;An Sandybridge/Ivybridge Intel GPU (Intel HD 2000/3000/2500/4000 in marketing speak).&lt;/li&gt;&lt;li&gt;A "enthusiast" motherboard which allows you to set gpu overclocking settings (higher frequency and voltage).&lt;/li&gt;&lt;li&gt;Lastet drm-intel-nightly kernel branch from &lt;a href="http://cgit.freedesktop.org/~danvet/drm-intel"&gt;drm-intel git&lt;/a&gt; or at least a kernel built with &lt;a href="https://patchwork.kernel.org/patch/2305081/"&gt;this patch&lt;/a&gt; from Ben Widawsky. The patch should apply to pretty much any recent stable kernel. Without that patch gpu turbo support is broken. &lt;/li&gt;&lt;li&gt;Preferably a desktop gpu with a big cooling rig. Overclocking on modern intel chips essentially just increases the turbo headroom into the unvalidated range (with the potential for hangs and corruptions in rendering). And if your cooling system can't keep up with the increased heat output the on-chip controller will quickly clamp your clocks down to the non-turbo frequency.&lt;/li&gt;&lt;li&gt;Your favorite gpu benchmark. The reason for that is the thermal throttling when running in the turbo range: It happens behind the driver's back and the only observable effect is a slower gpu - the current frequency value in sysfs is still the same!&lt;/li&gt;&lt;/ul&gt;To check whether it all works out you can boot with &lt;code&gt;drm.debug=0xe&lt;/code&gt; appended to your kernel cmdline and check dmesg for the gpu overclocking support debug message:&lt;br /&gt;&lt;br /&gt;&lt;code&gt;[98650.411179] [drm:gen6_enable_rps], overclocking supported, adjusting frequency max from 1300MHz to 1300MHz&lt;/code&gt;&lt;br /&gt;&lt;br /&gt;Yeah, my system doesn't really support overclocking :(&lt;br /&gt;&lt;br /&gt;Or check in sysfs in &lt;code&gt;/sys/class/drm/card0&lt;/code&gt; the various &lt;code&gt;gt_*_freq_mhz&lt;/code&gt; files. You can also use those to limit the upper clock, which is useful for figuring out at which frequency your gpu is still stable at for a given voltage setting.&lt;br /&gt;&lt;br /&gt;Limiting the lower clocks is usually not interesting, since it will only affect how much power the hardware can safe under intermediate loads. And you want to aggressively reduce heat output to better use the turbo range when needed.&lt;br /&gt;&lt;br /&gt;If you play around with this please drop a comment with your results - I only have boring Intel developer board's around here which don't support overclocking. So no fun fore me. But freezer on #intel-gfx managed to overclock his desktop Ivybridge from 1.1GHz to 1.6GHz with only a small voltage increase, and fps in CS:S increased quite a bit due to that.&lt;br /&gt;&lt;br /&gt;Happy overclocking and benchmarking&lt;br /&gt;&lt;br /&gt;&lt;b&gt;Update:&lt;/b&gt; In debugfs you can check the CAGF (current actual gt frequency) field in the &lt;code&gt;i915_cur_delayinfo&lt;/code&gt; file for the real frequency, including any effects due to thermal throttling. &lt;br /&gt;&lt;br /&gt;&lt;b&gt;Update 2:&lt;/b&gt; Latest kernels (and so also 3.10) will limit the gpu frequency at boot-up to the non-overclocked range. This should prevent crashes while booting, but it also means that you need to manually set the overclocked frequency limit.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3197309094902219529/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3197309094902219529'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3197309094902219529'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html' title='Overclocking your Intel GPU on Linux'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4898738363561615597</id><published>2013-02-17T11:01:00.002-08:00</published><updated>2013-07-21T06:50:08.046-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.9</title><content type='html'>&lt;p&gt;So now that &lt;a href="http://blog.ffwll.ch/2012/11/neat-drmi915-stuff-for-38.html"&gt;3.8&lt;/a&gt; is winding down it's time to look at what 3.9 will bring for the drm/i915 driver:&lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;p&gt;Let's first look at bit at the drm core changes: The headline item this time around is the &lt;a href="http://blog.ffwll.ch/2013/02/new-kernel-modesetting-locking.html"&gt;&lt;b&gt;reworked kernel modeset locking&lt;/b&gt;&lt;/a&gt;. Finally the kernel doesn't stall for a few frames while probing outputs in the background! The other core drm changes revolve around the fb helper code. Both in the &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;i915 modeset rework&lt;/a&gt; which landed in 3.7 and the locking rework I've noticed a few things to fix up and clarify. And as the icing on the cake we now have rather nice &lt;a href="http://cgit.freedesktop.org/~airlied/linux/commit/?h=drm-next&amp;id=207fd32970b1def91b11ae28f6bebffc792db714"&gt;kerneldoc&lt;/a&gt; for the driver interfaces. &lt;/p&gt;Within i915.ko itself we've started with merging some of that fastboot patches from Chris Wilson, namely &lt;b&gt;stolen memory support&lt;/b&gt;. This is required to wrap the framebuffer allocated by the firmware. This is one of the many pieces needed to avoid the initial modeset at boot-up if the BIOS configuration is suitable, and so shaves off a bit of boottime. To make suspend/resume quicker and more important flicker-free Jesse Barnes implemented &lt;b&gt;vt-switchless resume&lt;/b&gt; support. With that you won't see that annoying console cursor blinking any more when resuming, but directly go to your desktop (or probably screensaver, asking for your password). The core power management and console pieces are merged, but the i915 enabling will likely only be merged for 3.10 since a few bugs surfaced in the patch review. &lt;p&gt;&lt;/p&gt;For general robustness of our GEM implementation we've clarified the various &lt;b&gt;gpu reset&lt;/b&gt; state transitions. This should prevent applications from crashing while a gpu reset is going on due to the kernel leaking that transitory state to userspace. Ville Syrjälä also started to fix up our handling of &lt;b&gt;pageflips across gpu hangs&lt;/b&gt; so that compositors no longer get stuck after a reset. Unfortunately not all of his patches made it into 3.9. Somewhat related is Mika Kuoppala's work to fix bugs across the &lt;b&gt;seqnqo wrap-around&lt;/b&gt;. And to make sure that those bugs won't pop up again he also added some testing infrastructure. &lt;p&gt;&lt;/p&gt;On the modeset feature front 3.9 has proper support for the &lt;b&gt;"RBG broadcast range/reduced color range"&lt;/b&gt; mode from Ville Syrjälä for HDMI/DP. Paulo Zanoni implemented support for the manually-controlled &lt;b&gt;display power well on Haswell&lt;/b&gt; - this should reduce power consumption when only the internal eDP panel is enabled. &lt;/p&gt;&lt;p&gt;Driver-internally Ville &lt;b&gt;removed the IS_DISPLAYREG hack on Valleyview&lt;/b&gt; which was added to kickstart early enabling. The hardware engineers moved around all the display related hardware registers which required us to add an offset. But since some of those display registers conflict with GT registers the original approach with the IS_DISPLAYREG check in the read/write functions became didn't work. And people often forgot to add new registers to that table, making it a big maintenance hassle. But now all this offset handling has been moved to the register accessing functions/definitions themselves, which also paves the way for future hardware enabling. &lt;/p&gt;&lt;p&gt;On the GEM side of userspace-visible features the big item is the &lt;b&gt;no-relocations and execbuffer LUT&lt;/b&gt; extensions from Chris Wilson. As long as buffers are not moved around between execbuffer calls, this should completely slash the in-kernel relocation overhead. Unfortunately due to some bogons in the libdrm design we can't implement support for the new mode for it. So for now only the SNA acceleration backend from Chris has support for these new execbuf modes. &lt;/p&gt;&lt;p&gt;The other big refactoring in the driver is the &lt;b&gt;massive GTT cleanup&lt;/b&gt; from Ben Widawsky. On gen6 and later we now no longer rely on the fake intel-agp driver but have moved all the code to i915.ko. Also, all the gtt and ppgtt functions are now nicely abstracted behind a set of interface function tables. This will greatly help for some of the anticipated work in the address space handling, like real per-process address spaces. &lt;/p&gt; &lt;p&gt;Finally there's the usual amount of small cleanups and bug fixes, though this time around there was also a major regression involved: The infamous &lt;b&gt;ilk/gen4 relocation regression&lt;/b&gt; which killed tons of machines when putting them under decent amounts of I/O and memory pressure. But we've &lt;a href="https://bugs.freedesktop.org/show_bug.cgi?id=55984"&gt;fixed that&lt;/a&gt;, too. And as an upside the shrinker handling should now be a notch more robust, so you can drive your systems even harder against the memory limit wall until you unleash the wrath of the OOM gods ... &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4898738363561615597/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html#comment-form' title='2 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4898738363561615597'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4898738363561615597'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html' title='Neat drm/i915 stuff for 3.9'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>2</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-816932904033519461</id><published>2013-02-07T06:42:00.000-08:00</published><updated>2013-07-21T06:58:51.506-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>New Kernel Modesetting Locking</title><content type='html'>&lt;p&gt;Now that my kernel modesetting lockig rework has &lt;a href="http://cgit.freedesktop.org/~airlied/linux/commit/?h=drm-next&amp;amp;id=735dc0d1e29329ff34ec97f66e130cce481c9607"&gt;landed&lt;/a&gt; in Dave's drm-next tree and is gearing up for inclusion into 3.9 I've figured it's time to also post my little intro here: &lt;/p&gt;&lt;p&gt;The aim of this locking rework is that ioctls which a compositor should be might call for every frame (set_cursor, page_flip, addfb, rmfb and getfb/create_handle) should not be able to block on kms background activities like output detection. And since each EDID read takes about 25ms (in the best case), that always means we'll drop at least one frame. &lt;/p&gt;&lt;p&gt;The solution is to add per-crtc locking for these ioctls, and restrict background activities to only use the global lock. Change-the-world type of events (modeset, dpms, ...) need to grab all locks. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;p&gt;Two tricky parts arose in the conversion: &lt;/p&gt;&lt;p&gt;&lt;ul&gt;&lt;li&gt;A lot of current code assumes that a kms fb object can't disappear while holding the global lock, since the current code serializes fb destruction with it. Hence proper lifetime management using the already created refcounting for fbs need to be instantiated for all ioctls and interfaces/users. &lt;/li&gt;&lt;li&gt;The rmfb ioctl removes the to-be-deleted fb from all active users. But unconditionally taking the global kms lock to do so introduces an unacceptable potential stall point. And obviously changing the userspace abi isn't on the table, either. Hence this conversion opportunistically checks whether the rmfb ioctl holds the very last reference, which guarantees that the fb isn't in active use on any crtc or plane (thanks to the conversion to the new lifetime rules using proper refcounting). Only if this is not the case will the code go through the slowpath and grab all modeset locks. Sane compositors will never hit this path and so avoid the stall, but userspace relying on these semantics will also not break.  &lt;/li&gt;&lt;/ul&gt;&lt;/p&gt;&lt;p&gt;All these cases are exercised by the newly &lt;a href="http://cgit.freedesktop.org/xorg/app/intel-gpu-tools/commit/?id=f56384c2c0264989acae7b8c7efb5030a6c94caf"&gt;added&lt;/a&gt; &lt;a href="http://cgit.freedesktop.org/xorg/app/intel-gpu-tools/commit/?id=df41e1a6bbe75f047e83bb543e0b0564ed10862b"&gt;subtests&lt;/a&gt; for the i-g-t kms_flip, tested on a machine where a full detect cycle takes around 100 ms. It works, and no frames are dropped any more with these patches applied. kms_flip also contains a special case to exercise the above-describe rmfb slowpath. &lt;/p&gt; &lt;p&gt;For anyone curious about some of the details of this rework or ARM drm driver writers needing to port out-of-tree stuff I suggest to just read through the patches - I've tried really hard to properly document things in commmit messages and note about the implications of the new design. &lt;/p&gt; &lt;p&gt;The downside of this all is that we can now enable some really paranoid inter-frame jitter checks and vblank counter timestamp checks in the kms_flip testcase. After all, no frames should be dropped any longer. But it turns out that a lot of the different platforms still have small issues here and there with races and other inconsistencies like completing a page flip immediately right after a modeset. &lt;/p&gt; &lt;p&gt;So there's still plenty of work to do until we have perfect pageflip support. And there's also a few funny issues like racing gpu hangs against pageflips, client crashes against pageflips or trying to flip overlays and cursor on the same vblank as the underlying framebuffer. Ville Syrjälä and other guys at Intel and elsewhere are working on this. So stay tuned. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/816932904033519461/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/02/new-kernel-modesetting-locking.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/816932904033519461'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/816932904033519461'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/new-kernel-modesetting-locking.html' title='New Kernel Modesetting Locking'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3162827050799783312</id><published>2013-02-05T08:11:00.001-08:00</published><updated>2013-02-05T08:11:55.577-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>FOSDEM Slides 2013</title><content type='html'>FOSDEM was great as ever, despite that I've managed to grab a bit too much attention from my management by spilling the Intel OTC gfx driver team headcount a bit ;-) Anyway, for those who missed my presentation, I've uploaded &lt;a href="http://people.freedesktop.org/~danvet/presentations/fosdem-2013.odp"&gt;the slides&lt;/a&gt; (with that embarrassing typo fixed in one headline). Phoronix should upload a video of the talk soon, I'll add a link as soon as that happens.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3162827050799783312/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/02/fosdem-slides-2013.html#comment-form' title='1 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3162827050799783312'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3162827050799783312'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/fosdem-slides-2013.html' title='FOSDEM Slides 2013'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>1</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7367005160029620308</id><published>2013-01-07T08:57:00.001-08:00</published><updated>2013-07-21T06:58:51.502-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Crashcourse: Overview</title><content type='html'>Now that the entire series is done I've figured a small overview would be in order.&lt;br /&gt;&lt;br /&gt;&lt;a href="http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html"&gt;Part 1&lt;/a&gt; talks about the different address spaces that a i915 GEM buffer object can reside in and where and how the respective page tables are set up. Then it also covers different buffer layouts as far as they're a concern for the kernel, namely how tiling, swizzling and fencing works.&lt;br /&gt;&lt;br /&gt;&lt;a href="http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html"&gt;Part 2&lt;/a&gt; covers all the different bits and pieces required to submit work to the gpu and keep track of the gpu's progress: Command submission, relocation handling, command retiring and synchronization are the topics.&lt;br /&gt;&lt;br /&gt;&lt;a href="http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html"&gt;Part 3&lt;/a&gt; looks at some of the details of the memory management implement in the i915.ko driver. Specifically we look at how we handle running out of GTT space and what happens when we're generally short on memory.&lt;br /&gt;&lt;br /&gt;Finally &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-part-4.html"&gt;part 4&lt;/a&gt; discusses coherency and caches and how to most efficiently transfer between the gpu coherency domains and the cpu coherncy domain under different circumstances.&lt;br /&gt;&lt;br /&gt;Happy reading! &lt;br /&gt;&lt;b&gt;Update:&lt;/b&gt; There's now also a new article with a few &lt;a href="http://blog.ffwll.ch/2013/05/i915gem-q.html"&gt;questions and answers about some details in the i915 gem code&lt;/a&gt;.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/7367005160029620308/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7367005160029620308'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7367005160029620308'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html' title='i915/GEM Crashcourse: Overview'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1825930399780826244</id><published>2013-01-07T07:56:00.001-08:00</published><updated>2013-07-21T06:58:51.488-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Crashcourse, Part 4</title><content type='html'>&lt;p&gt;In the previous installment we've taken a closer look at some &lt;a href="http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html"&gt;details of the gpu memory management&lt;/a&gt;. One of the last big topics now still left are all the various caches, both on the gpu (both render and display block) and the cpu, and what is required to keep the data coherent between them. Now one of the reasons gpus are so fast at processing raw amounts of data is that caches are managed through explicit instructions (cutting down massively on complexity and delays) and there are also a lot of special-purpose caches optimized for different use-cases. Since coherency management isn't automatic, we will also consider the different ways to move data between different coherency domains and what the respective up- and downsides are. See the &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html"&gt;i915/GEM crashcourse overview&lt;/a&gt; for links to the other parts of this series.  &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt; &lt;h2&gt;Interactions with CPU Caches&lt;/h2&gt; &lt;p&gt;The first thing to look at is how gpu-side caches work together with the cpu caches. Traditionally the intel gfx has been sitting right on top of the memory controller. For maximum efficiency it therefore did not take part in the coherency protocol with the cpu caches, but had direct read/write access to the underlying memory. To ensure that data written by the cpu could be read by the gpu coherently, we need to flush cpu caches and further the chipset write queue on the separate memory controller. Only once the data is guaranteed to have reached physical memory can it be read by the gpu. &lt;/p&gt; &lt;p&gt;For readbacks, e.g. after the gpu has rendered a frame, we again need to invalidate all the cpu caches - the gpu writes don't snoop cpu caches and so the cpu cache might still contain stale data. On intel hw this is again done by the clflush instruction, which (only on Intel cpus though) guarantees that clean cachelines will simply be dropped and not written back to memory. This is important, since otherwise data in memory written by the gpu could be overwritten by stale cache contents from the cpu. &lt;/p&gt; &lt;p&gt;Now on newer platforms (Sandybridge and later) where the gpu is integrated with the cpu on the same die, the render portion of the gpu is sitting on top of the last level caches, together with all the cpu cores. Current architecture is that the cpu cores (including L2 caches), gpu (again including gpu specific caches), memory controller and the big L3 cache are all connected with a coherent ring interconnect. Since then the gpu can profit from the big L3 cache on the die, giving a decent speedup for gpu workloads. Hence it is now beneficial for gpu reads/writes to be coherent with all the cpu caches - explicitly flushing cachelines is cumbersome and the last-level cache can easily hide the snooping latencies. &lt;/p&gt; &lt;p&gt;The odd thing out on this architecture is the display unit. To preserve the most power in idle situation we want to be able to turn off power for cpu cores, the gpu render block and the entire L3 and interconnect (called uncore). Which means the always-on display block can only read from memory directly and can't be coherent with caches. To allow this we can specify the caching mode in the gtt pagetables and so mark render targets which will be used as scanout sources uncacheable. But that also implies that they're no longer coherent with cpu cache contents, and so we need to again engage in manual cacheline flushing like on the platforms without a shared last level cache. &lt;/p&gt; &lt;h2&gt;Transferring Data Between CPU and GPU Coherency Domains&lt;/h2&gt; &lt;p&gt;The oldest way to move data between the gpu and cpu in the i915 GEM kernel driver was with the &lt;code&gt;set_domain&lt;/code&gt; ioctl. If required, it flushed the cpu caches for all the cachelines for the entire memory address range of the object. Which is really expensive, so we need more efficient ways to move date from/to the gpu, especially on platforms without a coherent last level cache. Note that all objects start out in the cpu domain, since freshly-allocated pages aren't necessarily flushed. Hence it is important that userspace keeps around a cache of already flushed objects, to amortize the expensive initial cacheline flushing. Also note that the &lt;code&gt;set_domain&lt;/code&gt; ioctl is also used to synchronize cpu access with outstanding gpu rendering, and so still used in that role for coherent objects. &lt;/p&gt;  &lt;p&gt;For this the kernel and older hw support a snooping mode, where the gpu asks the cpu to clear any dirty cachelines before reading/write. The upside is that we don't blow through cpu time flushing cachelines, and the gpu seems to be more efficient at moving data out of and into cpu caches anyway. The downside is, at least on older generations, that we can't use such snooped areas for rendering, but only to offload data transfers from/to the cpu to gpu. But since there are now downsides for the cpu in accessing snooped gem buffer objects they are very interesting for mixed sw/hw rendering. Another upside is that the uploads can be streamed and are asynchronously done, so avoiding stalls. Downloads can obviously also be done asynchronously using the gpu, but additional unrelated queued rendering could introduce stalls since the cpu often needs the data right away. &lt;/p&gt;  &lt;p&gt;Hence the tradeoffs for picking the gpu for copieding data from/to snoopable buffers compared to using the cpu to transfer data is tricky: For uploads it's usually only worth it to use the gpu to avoid stalls, since our cpu uploads paths are fast. For downloads on platforms without a shared last-level cached gpu copies using snoopable buffers beats the cpu readbacks hands-down. &lt;/p&gt; &lt;p&gt;The i915 GEM driver exposes a set of ioctls to allow userspace to read/write linear buffers which try to pick the most efficient way to transfer the data from/to the gpu coherency domain, called &lt;code&gt;pwrite&lt;/code&gt; and &lt;code&gt;pread&lt;/code&gt;. We'll later on look at some of the trade-offs and tricks employed, but for now only discuss how reads/writes which only partially cover a cacheline need to be handled if we write through the cpu mappings. Reads are simple, every cacheline we touch needs to be flush before reading data written by the gpu. For writes we only need to flush before writing if the cacheline is partially covered - stale data from cpu caches in that cacheline could otherwise be written to memory. For writes covering entire cachelines we can avoid this. Hence userspace tries to avoid such partial writes. Obviously we also need to flush the cacheline after writing to it, to move the data out to the gpu. &lt;/p&gt; &lt;p&gt;All this flushing doesn't apply when the buffer is coherent, and generally on platforms with a last-level cache writing through the cpu caches is the most efficient way to copy data with the cpu (the gpu can obviously also copy things around, since it doesn't pay a penalty for coherent access on such platforms). Going through the GTT to e.g. avoid manually tiling and swizzling a texture is much slower. The reason for that is that GTT writes land directly in main memory and don't go into the last-level cache - hence we're limited by main memory bandwidth and can't benefit from the fast caches. It does though issue a snoop to ensure that everything is still coherent. &lt;/p&gt; &lt;p&gt;On platforms without a shared last-level cache it's a completely different story though - we have to manually flush cpu caches, which is a rather expensive operation. GTT writes on the other hand bypass all caches and land directly in main memory. Which means that on these platforms GTT writes are generally 2-3x faster than writes through the cpu caches - a notch slower if the GTT area written to is tiled. GTT reads are in all cases extremely slow since the GTT I/O range is only write-combined, but uncached. &lt;/p&gt; &lt;p&gt;Now one of the clever tricks that the pwrite ioctl implements is that on platforms where GTT writes are faster it tries to first move the buffer object into the mappable part of the GTT (if the object isn't there yet and this can be done without blocking for the gpu). This way the upload benefits from the faster GTT writes, which easily offsets any costs in unbinding a few other buffer objects and rewriting a bunch of PTEs. Especially since on recent kernels and most platforms GTT PTEs are mapped with write-combining. &lt;/p&gt; &lt;p&gt;Summarizing the data transfer topic, we either have full coherency (where cpu cached memory mappings are the most efficient way to transfer data, with no explicit copying involved). Or we can copy data with the gpu (using snooped buffer objects), or with the cpu (either through memory mappings of the GTT or through the pwrite/pread ioctls). The kernel also supports explicit cpu cache flushing through the &lt;code&gt;set_domain&lt;/code&gt; ioctl, which allows userspace to use cpu-cached memory maps even on platforms without coherency. But they're abysmally slow and hence not used in well-optimized code. &lt;/p&gt; &lt;h2&gt;GPU Caches&lt;/h2&gt; &lt;p&gt;Up to now we've only looked at cpu caches and presumed that the gpu is an opaque black box. But like already explained, gpus have tons of special-purpose caches and assorted tlbs, which need to be invalidated and flushed. First we will go trough the various gpu caches and look at how and when they're flushed. Then we'll look at how gpu cache domains are implemented in the kernel. &lt;/p&gt; &lt;p&gt;Display caches are very simple: Data caches are always fifos, so never need to be flushed. And the assorted TLBs are in general invalidated on every vblank. The cpu mmio window into the GTT is also rather simple: No data caches need to be explicitly managed, only the tlb needs to be explicitly flush when updating PTEs by writing to a magic register afterwards. &lt;/p&gt; &lt;p&gt;Much more complicated are the various special-purpose caches of the render core. Those all get flushed either explicitly (by setting the right bit in the relevant flush instruction) or implicitly as a side-effect of batch/ringbuffer commands. Important to note is that most of these caches are not fully coherent (safe for the new L3 gpu cache on Ivybridge), so writes do not invalidate cachelines in cpu caches, even when the respective gtt PTE has the snoop/caching bits set. Writes only invalidate the cpu caches once a cacheline gets evicted from the gpu caches. Hence the command streamer instruction which flush caches also are coherency barriers. &lt;/p&gt; &lt;p&gt;One of the cornerstones of the original i915 GEM design was that the kernel explicitly keeps track of all the caches (render, texture, vertex, ...) an object is coherent in. It separately kept track of read and write domains, to optimize away flush for r/w caches if no cacheline should be dirty. But the code ended up being complicated and fragile, and thanks to tons of workarounds we need to flush most caches on many platforms way more often than necessary. Furthermore, userspace inserted it's own flushes to support e.g. rendering to textures, so the kernel wasn't even tracking properly which caches are clean. On top of that, the explicit tracking of dirty objects on the &lt;code&gt;flushing_list&lt;/code&gt; to coalesce cache flushing operations added unnecessary delays, hurting workloads with tight gpu/cpu coupling. &lt;/p&gt; &lt;p&gt;In the end this all ended up being a prime example of premature optimization. So for most parts the kernel now ignores the gpu domain values in relocations entries and instead unconditionally invalidates all caches before start a new batch and then flushes all write caches after the batch completes, but before the seqno is written and signaled with the CS interrupt. The big exception is workarounds, e.g. on Sandybridge writes from the command streamer used mostly for GL queries need global GTT entries shadowing the PPGTT PTEs. But all the in-kernel complexity to track dirty objects and gpu domains is mostly ripped out. The last remaining thing is to collapse all the different GEM domains into a simple boolean to track whether an object is cpu or gpu coherent. &lt;/p&gt; &lt;h2&gt; Odds&amp;amp;Sods &lt;/h2&gt; &lt;p&gt;This now concludes our short tour of the i915.ko GEM implementation for submitting commands to the gpu. Two bigger topics are not covered though: Resetting the gpu when is stuck somewhere and how fairness is ensured by throttling command submission. Both are results of the cooperative nature of command submission on current intel gpus - batchbuffers cannot be preempted. Hence interactive responsiveness and fairness requires cooperation from userspace. And a stuch batchbuffer can only be stopped by resetting the entire gpu due to lack of preemption support. &lt;/p&gt; &lt;p&gt;In both areas new ideas and improvements are floating around, so I've figured it best to cover them when improvements to the gpu reset code or the way we schedule batchbuffers land. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1825930399780826244/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2013/01/i915gem-crashcourse-part-4.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1825930399780826244'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1825930399780826244'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/01/i915gem-crashcourse-part-4.html' title='i915/GEM Crashcourse, Part 4'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7810278808977755614</id><published>2012-11-28T14:36:00.000-08:00</published><updated>2013-07-21T06:58:51.504-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Crashcourse, Part 3</title><content type='html'>&lt;p&gt;In previous installments of this series we've looked at &lt;a href="http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html"&gt;how the gpu can access memory&lt;/a&gt; and &lt;a href="http://blog.ffwll.ch/2012/11/neat-drmi915-stuff-for-38.html"&gt;how to submit a workload to the gpu&lt;/a&gt;. Now we will look at some of the corner cases in more detail. See the &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html"&gt;i915/GEM crashcourse overview&lt;/a&gt; for links to the other parts of this series.  &lt;/p&gt; &lt;a name='more'&gt;&lt;/a&gt; &lt;h2&gt;GEM Memory Management Details&lt;/h2&gt; &lt;p&gt;First we will look at the details of managing the gtt address space. For that the drm/i915 driver employs the &lt;code&gt;drm_mm&lt;/code&gt; helper functions, which serves as a chunk allocator from a address space with a fixed size. It allows to constrain the alignment of an allocated block and also supports crazy gpu-specific guard-page constraints through an opaque per-allocation-block color attribute and a callback. Our driver uses that to ensure that so called snoopable and uncached regions on older generations are well-separated (by one page), since the hw prefetcher on some chip functions will fall over if it encounters the wrong type of memory while prefetching into a subsequent page. &lt;/p&gt; &lt;p&gt;Now let's look at how GEM handles memory management corner cases. There are two important ways of running out of resources in GEM: There could be not enough space in the gtt for a given batch, this is the &lt;code&gt;ENOSPC&lt;/code&gt; case in the code. Or we could run out of system memory (&lt;code&gt;ENOMEM&lt;/code&gt;). One of the nice things of i915 GEM is that we use the kernel's shmemfs implementation to allocate backing storage for gem objects. The big benefit is that we get swap handling fro free. A bit a downside is that we don't have much control over how and when swapping happens, and also not really any control over how the backing storage pages get allocated. These downsides regularly result in some noises on irc channels about implementing a gemfs to fix these deficiencies, but with no patches merged thus far. &lt;/p&gt; &lt;h2&gt;Caching GEM Buffer Objects&lt;/h2&gt; &lt;p&gt;The first complication arises because GEM driver stack has a lot of buffer object caches. The most important object cache is the userspace cache in libdrm. Since setting up a gem object is expensive (allocating the shmemfs backing storage, but also cache flushing operations are required on some generations and setting up memory mappings on first use) it's advisable to keep them around for reuse. And submitting workloads to the gpu tends to require tons of temporary buffers to upload data and assorted gpu-specific state like shaders, so those buffers get recycled quickly.  &lt;/p&gt; &lt;p&gt;Now if we run out of memory it would be good if the kernel can just drop the backing storage for these buffers on the floor instead of wasting time trying to swap their data out (or even failing to allocate memory, resulting in OOM-induced hilarity). Hence gem has a &lt;code&gt;gem_madvise&lt;/code&gt; ioctl which allows a userspace cache to tell the kernel when a buffer is only kept around opportunistically with the &lt;code&gt;I915_MADV_DONTNEED&lt;/code&gt;flag. The kernel is then allowed to reap the backing storage of such marked objects anytime it pleases. It can't though destroy the object tehmselves, since userspace still has a handle to them. Once userspace wants to reuse such a buffer, it mush tell the kernel by setting the &lt;code&gt;I915_MADV_WILLNEED&lt;/code&gt; flag through the madvise ioctl. The kernel confirms that the object's backing storage is still around or whether it has been reaped. In the latter case userspace frees the object handle to also release the storage occupied by that in the kernel. If the userspace cache encounters such a reaped object it also walks all its cache buckets to free any other reaped objects. &lt;/p&gt; &lt;p&gt;The kernel itself also tries to keep objects around on the gpu for as long as possible. Any object not used by the gpu is on the &lt;code&gt;inactive_list&lt;/code&gt;. This is the list the kernel scans in LRU order when it needs to kick objects out of the gtt to free space for a different set of objects (e.g. for the ENOSPC case). In additions the kernel also keeps a list of objects which are not bound, but for which the backing storage is still pinned (and hence not allowed to be swapped out) on the &lt;code&gt;unbound_list&lt;/code&gt;. This mostly serves to mitigate costly cache flushing operations, but the pinning of the backing storage is itself not free. We will talk later about why cache flushing is required in the coherency section in the next installment of this series. &lt;/p&gt; &lt;h2&gt;Handling ENOSPC&lt;/h2&gt; &lt;p&gt;Running out of gtt space requires us to select some victim buffer objects. Then wait for all access to the selected objects through the gtt to cease and then unbind them from the gpu address space to make room for the new objects. So let's take a closer look at how GEM handles buffer eviction from the gtt when it can't find a suitable free hole. Now setting up and tearing down pagetable entries isn't free, buffer objects vary a lot in size and for some access paths through the gtt we can only use the comparatively small mappable section of it. So just evicting objects from the inactive list in LRU order would be really inefficient, since we could end up unbinding lots of unrelated small objects sitting all over the place in the gtt, until we accidentally free a suitably large hole for a really big object. And if that big object needs to be in the contended mappable part, things are even worse. &lt;/p&gt; &lt;p&gt;To avoid  trashing the gtt so badly GEM uses a eviction roaster, which is implemented with a few helper functions from the &lt;code&gt;drm_mm&lt;/code&gt; allocator library: In a first step it scans through the inactive list and adds objects to the eviction roaster until a big enough free hole can be assembled. Then it walks the list of just scanned objects backwards to reconstruct the original allocator state and while doing that also marks any objects which fall into the selected hole as to-be-freed. In the last step it unbinds all the objects which are marked as to-be-freed, creating a suitable hole with the minimal amount of object rebinding. &lt;/p&gt; &lt;p&gt;If no hole can be found by scanning the inactive list the eviction logic will also scan into the list of objects still being used by the gpu engines. Obviously it then needs to block for rendering to complete before it can unbind these objects. And if that doesn't work out, GEM returns &lt;code&gt;-ENOSPC&lt;/code&gt; to userspace which indicates a bug in either GEM or the userspace driver part: Userspace must not construct batchbuffers which cannot fit into the GTT (presuming it's the only user of the gpu), and GEM must ensure that it can move anything else out of the way to execute such a giant batchbuffer. &lt;/p&gt; &lt;p&gt;Now this works if we only need to put a single object into the gtt, e.g. when serving a pagefault for a gtt memory mapping. But when preparing a batchbuffer for command submission we need to make sure that all the buffer objects from an execbuf ioctl call are in the gtt. So we need to make sure that when reserving space for later objects, we don't kick out earlier objects which are also required to run this batchbuffer. To solve this, we need to mark objects as reserved and not evict reserved objects. In i915 GEM this is done by temporarily pinning objects, which every once in a while leads to interesting discussion because the semantics of such temporarily pinned buffers get mixed up with the semantics of buffers which are pinned for an indeterminate time, like scanout buffers. &lt;/p&gt; &lt;p&gt;An funny exercise for the interested reader is to come up with optimal reservations schemes that allocate the gtt space for all buffers of an execbuf call at once (instead of buffer-by-buffer). This is mostly relevant on older generations which have sometimes rather massive alignment constraints on buffers. And create clever approximations of such optimal algorithms, which drm/i915 hopefully implements lready - otherwise patches highly welcome. Another good thing to ponder is the implications of a separate VRAM space (in combination with a GTT) which requires even more costly dma operations to move objects in, but in return has also much higher performance (i.e. the usual discrete gpu setup). One of the big upsides of a UMA (unified memory architecture) design as used on Intel integrated graphics is that there's no headache-inducing need to balance VRAM vs. GTT usage, which needs to take into account dma transfer costs and delays ... &lt;/p&gt; &lt;h2&gt;Handling ENOMEM&lt;/h2&gt; &lt;p&gt;Handling low memory situations is first and foremost done by the core vm, which tries to free up memory pages. In turn the core vm can call down int GEM (through the shrinker interface) to make more space available. &lt;/p&gt; &lt;p&gt;Within the drm/i915 driver out of memory handling has a few tricks of its own, all of which are due to the rather simplistic locking scheme employed by drm/i915 GEM: We essentially only have one lock to protect all important GEM state, the &lt;code&gt;dev-&gt;struct_mutex&lt;/code&gt;. Which means that we need to allocate tons of memory when holding that lock, in turn requiring that our memory shrinker callback only trylocks that all-encompassing mutex, since otherwise we might deadlock. We also need to tell the memory allocations functions through GFP flags that they shouldn't endlessly retry allocations and even launch the OOM killer, but instead fail the allocation if there's no memory and return immediately. Since most likely GEM itself is sitting on tons of memory we then try unpin a bunch of objects in such failure cases and retry the allocation ourselves. If that doesn't help, or if there's no buffer object that can be unpinned, we give up and return &lt;code&gt;-ENOMEM&lt;/code&gt; to userspace. One side-effect of the trylock in the shrinker is that if any other thread than the allocator is hoggin our GEM mutex, we won't be able to unpin any gem objects, potentially causing a unnecessary OOM situation. &lt;/p&gt; &lt;p&gt;Despite that this is rather hackish approach and not really how memory management is supposed to work, it seems to hold up rather well in reality. And recently (for kernel 3.7 and 3.8) Chris Wilson added some additional clever tricks to make it work for a bit longer when the kernel is tight on free memory. But in the long-term I expect that we need to revamp our locking scheme to be able to reliable free memory in low-memory situations. &lt;/p&gt; &lt;p&gt;Another problem with the current low-memory handling is that the shrinker infrastructure is desinged to handle caches of equally-sized (filesystem) objects. It doesn't have any notion of objects of massively different sizes, which we try by reporting object counts in aggregate number of pages. And it also doesn't expect that when a shrinker runs, tons of memory suddenly shows up in the pagecache - which is what happens when we unpin the buffer object backing storage and give control over it back to shmemfs. &lt;/p&gt; &lt;p&gt;In the next installement we will take a closer look at coherency issues and optimal ways to transfer data between the cpu and gpu. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/7810278808977755614/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html#comment-form' title='3 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7810278808977755614'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/7810278808977755614'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html' title='i915/GEM Crashcourse, Part 3'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>3</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2719478283665178832</id><published>2012-11-21T08:34:00.001-08:00</published><updated>2013-07-21T06:50:38.540-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.8</title><content type='html'>&lt;p&gt;So &lt;a href="http://blog.ffwll.ch/2012/10/neat-drmi915-stuff-for-37.html"&gt;kernel 3.7&lt;/a&gt; hasn't even shipped yet, but we're already lining up all the ducks for 3.8. And since feature wise I don't expect anything massive any more on top (since the feature merge period will close rsn) I've figured I might do the overview as well a bit earlier: &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;p&gt; Now really big part is that &lt;b&gt;Haswell display support&lt;/b&gt; is finally in decent shape - big kudos to Paulo Zanoni for this awesome work. As I've said already in my 3.7 overview, one of the reasons for the reworked modeset code is the Haswell display block, specifically how the new DP DDI encoders work. Paulo has split up the major parts into three blocks: First laying the ground with the basic DP code, then using that infrastructure to enable eDP panels. The tricky part was getting external displayport connectors to work, since on earlier platforms we have two independant encoders for DP and HDMI modes each, but now on Haswell the encoding part is actually shared. Which required some decent code-reorganization in our DP/HDMI encoder code to extract the output-specific functions into DP/HDMI-specific connectors, and then merge the DP and HDMI encoders into a &lt;b&gt;unified DDI encoder for Haswell&lt;/b&gt;. Earlier platforms still have a separate encoder for DP and HDMI. &lt;/p&gt; &lt;p&gt; But that's not all for Haswell: Paulo also beat the &lt;b&gt;Haswell VGA&lt;/b&gt; into shape - we've used a few clever tricks to get the initial support going, but that didn't scale. So again we've separate the Haswell code from older generations and implemented the required tricks. All these changes are because the display pipe on Haswell is much more flexible than on earlier generations: We have a display pipe on the cpu chip, a transcoder on the cpu chip to route the data to the different DDI ports (which work as universal display ports capable of DP, HDMI, but also FDI transfers to feed the PCH display pipe). And finally the transcoder on the PCH. On Haswell we can route the display data rather flexibly between all these differents parts, whereas on e.g. Ivybridge we've only had 3 of each (for the 3 pipes supported in total), with a fixed linking between them. &lt;/p&gt; &lt;p&gt;There are also quite some small bits here&amp;there to fix up oversights in our Haswell support where reused code from older generations isn't correctly updated yet. And Haswell has a very nice feature to help in that: The hardware can tell us when a register write didn't arrive anywhere since no block claimed that specific range. Damien Lespiau fixed an aweful lot of these cases, where code from previous generations was still used on Haswell, but wasn't updated for the new registers in all cases. Also on the topic of new hw enabling is &lt;b&gt;DP support for Valleyview&lt;/b&gt; from Vijay Purushothaman et al.  &lt;/p&gt; &lt;p&gt;Another big area is panel and backlight support. Jani Nikula added some code for a &lt;b&gt;unified panel handling&lt;/b&gt; between LVDS and eDP - this should help nicely for enabling some nice features in the future. Some, like connector properties to control the panel fitter scaling for eDP are already implemented thanks to this unified code. For eDP we're now also trying really hard to set up the panel without the BIOS' help - in some cases (unfortunately not all of them) this should fix black screen problems.  &lt;/p&gt; &lt;p&gt;Again to prepare for future enabling Ben Widawsky &lt;b&gt;killed the agp layer&lt;/b&gt; for gen6+. This is a horrible in-between layer dating back to the old user-modesetting driver, and isn't really required on modern platforms any more. But we have to keep it around for backwards-compatibility (breaking userspace ABI in the kernel is verboten). But at least for new chips we don't need to jump through these hoops any more, which will greatly simplify some of the upcoming features in this area. &lt;/p&gt; &lt;p&gt; In 3.8 we'll also have a slightly &lt;b&gt;improved DP helper code&lt;/b&gt; in the drm core, with some common sink handling code extracted from i915.ko and radeon.ko. I'm planning to extract much more common code in this area, especially the DP aux transfer code is practically screaming for this. &lt;/p&gt; &lt;p&gt; And as usual, tons of bugfixes, workarounds and general code improvements all over the place!  &lt;/p&gt;&lt;p&gt; &lt;b&gt;Update:&lt;/b&gt; I've forgotten a rather nice feature implemented by Rob Clarke and Imre Deak in the drm core: Pageflip completion and vblank timestamps are now sampled with CLOCK_MONOTONIC, finally making our buffer swap support OML_sync compliant. But the real deal is that vblank-driven rendereres like Wayland now no longer stall for a few frames when the realtime clock jumps!  &lt;/p&gt; &lt;p&gt; &lt;b&gt;Update 2:&lt;/b&gt; Another feature I've missed is the &lt;b&gt;secure batchbuffer support&lt;/b&gt; from Chris Wilson, which can be used by the X driver to implement hopefully working vsync blits support without a compositor on Sandybridge and Ivybridge. So Xv on plain X should now no longer tear with a recent X driver version. &lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2719478283665178832/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/11/neat-drmi915-stuff-for-38.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2719478283665178832'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2719478283665178832'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/neat-drmi915-stuff-for-38.html' title='Neat drm/i915 stuff for 3.8'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150</id><published>2012-11-01T07:09:00.000-07:00</published><updated>2013-07-21T06:58:51.486-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Crashcourse, Part 2</title><content type='html'>&lt;p&gt;After the &lt;a href="http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html"&gt;previous installement&lt;/a&gt; this part will cover command submission to the gpu. See the &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html"&gt;i915/GEM crashcourse overview&lt;/a&gt; for links to the other parts of this series.  &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;h2&gt;Command Submission and Relocations &lt;/h2&gt;&lt;p&gt;As I've alluded already, gpu command submission on intel hardware happens by sending a special buffer object with rendering commands to the kernel for execution on the gpu, the so called batch buffer. The ioctl to do this is called &lt;code&gt;execbuf&lt;/code&gt;. Now this buffer contains tons of references to various other buffer objects which contain textures, render buffers, depth&amp;amp;stencil buffers, vertices, all kinds of gpu specific things like shaders and also quite some state buffers which e.g. describe the configuration of specific (fixed-function) gpu units.&lt;/p&gt; &lt;p&gt;The problem now is that userspace doesn't control where all these buffers are - the kernel manages the entire GTT.&amp;nbsp; And the kernel needs to manage the entire GTT, since otherwise multiple users of the same single gpu can't get along. So the kernel needs to be able to move buffers around in the GTT when they don't all fit in at the same time, which means clearing the PTEs in the relevant pagetables for the old buffers that get kicked out and then filling them again with entries pointing at new the buffers which the gpu now requires to execute the batch buffer. In short userspace needs to fill the batchbuffer with tons of GTT addresses, but only the kernel really knows them at any given point.&lt;/p&gt; &lt;p&gt;This little problem is solved by supplying a big list of relocation entries along with the batchbuffer and a list of all the buffers required to execute this batch. To optimize for the common case where buffers don't move around, userspace prefills all references with the GTT offsets from the last command submission (the kernel is so kind to tell userspace the updated offset after successful submission of a batch). The kernel then goes through that relocation list, checks whether the offsets that userspace presumed are still correct. And if that's not the case, it updates the buffer references in the batch and so relocates the referenced data, hence the name.&lt;/p&gt; &lt;p&gt;A slight complication is that the gpu data structures can be several levels deep, e.g. the batch points at the surface state, which then points at the texture/render buffers. So each buffer in the command submission list has a relocation list pointer, but for most buffers it's just NULL (since they just contain data and don't reference any other buffers).&lt;/p&gt; &lt;p&gt;Now along with any information required to rewrite references for relocated buffers, userspace also supplies some other information (the read/write domains) about how it wants to use the buffer. Originally this was to optimize cache coherency management (coherency will be covered in detail later on), but nowadays that code is massively simplified since that clever optimized cache tracking is simply not worth it. We do though still use these domain values to implement a workaround on Sandybridge though: Since we use PPGTT, all memory accesses from the batch are directed to go through the PPGTT, with the exception that pipe control writes (useful for a bunch of things, but mostly for OpenGL queries) always go through the global GTT (it's a bug in the hw ...). Hence we need to ensure that we not only bind to the PPGTT, but also set up a mapping in the global GTT. And we detect this situation by checking for a GEM_INSTRUCTION write domain - only pipe control writes have that set.&lt;/p&gt; &lt;p&gt;The other special relocation is for older generations, where the gpu needs a fence set up to access tiled buffers, at least for some operations. The relocation entries have a flag for that to signal the kernel that a fence is required. Another peculiarity is that fences can only be set up in the mappable part of the GTT, at least on those chips that require them for rendering. Hence we also restrict the placement of any buffers that require a fence to the mappable part of the GTT.&lt;/p&gt; &lt;p&gt;So after rewriting any references to buffers that moved around, the kernel is ready to submit the batch to the gpu. Every gpu engine has a ringbuffer that the kernel can fill with its own commands. First we emit a few preparatory commands to flush caches and set a few registers (which normal userspace batches can't write) to the values that userspace needs. Then we start the batch by emitting a MI_BATCHBUFFER_START command.&lt;/p&gt; &lt;h2&gt;Retiring and Synchronization&lt;/h2&gt; &lt;p&gt;Now the gpu can happily process the commands and do the rendering, but that leaves the kernel with a problem: When is the gpu done? Userspace obviously needs to know this to avoid reading back incomplete results. But the kernel also needs to know this, to avoid unmapping buffers which are still in use by the gpu, e.g. when a render operation requires a temporary buffer, userspace might free that buffer right away after the &lt;code&gt;execbuf&lt;/code&gt; call completes. But the kernel needs to delay the unmapping and freeing of the backing storage until the gpu not longer needs that buffer.&lt;/p&gt; &lt;p&gt;Therefore the kernel associates a sequence number with every batchbuffer and adds a write of that sequence number to the ringbuffer. Every engine has a hardware status page (HWS_PAGE) which we can use for such synchronization purposes. The upshot of that special status page is that gpu writes to it snoop the cpu caches, and hence a read from it is much faster than reading directly the gpu head pointer register of the ring buffer. We also add a MI_USER_IRQ command after the sequence number (seqno for short) write, so that we don't need to constantly poll when waiting for the gpu.&lt;/p&gt; &lt;p&gt;Two little optimizations apply to this gpu-to-cpu synchronization mechanism: If the cpu doesn't wait for the gpu, we mask the gpu engine interrupts to avoid flooding the cpu with thousands of interrupts (and potentially waking it up from deeper sleep states all the time). And the seqno read has a fastpath which might not be fully coherent, and a potentially much more expensive slowpath. This is because of some coherency issues on recent platforms, where the interrupt seemingly arrives before the seqno write has landed in the status page. Since we check that seqno rather often it's good to have an lightweight check which might not give the most up-to-date value, but is good enough to avoid going through more costly slowpaths in the code that handles synchronization with the gpu.&lt;/p&gt; &lt;p&gt;So now we have a means to track the progress of the gpu through the batches submitted to the engine's ringbuffer, but not yet a means to prevent the kernel from unmapping or freeing still in-use buffers. For that the kernel keeps a per-engine list of all active buffers, and marks each buffer with the seqno of the latest batch it has been used for. It also keeps a list of all still outstanding seqnos in a per-engine request list. The clever trick now is that the kernel keeps an additional reference on each buffer object that resides on one of the active list - that way a buffer can never disappear while still in use by the gpu, even when userspace removes all it's references. To batch up the active list processing and retiring of any newly completed requests, the kernel runs a regular task from a worker thread to clean things up.&lt;/p&gt; &lt;p&gt;To avoid polling in userspace the kernel also provides interfaces for userspace to wait until rendering completes on a given buffer object: The &lt;code&gt;wait_timeout&lt;/code&gt; ioctl simply waits until the gpu is done with an object (optionally with a timeout), the &lt;code&gt;set_domain&lt;/code&gt; ioctl doesn't have a timeout, but additionally takes a flag to indicate whether userspace only wants to read or also whether it wants to write. Furthermore &lt;code&gt;set_domain&lt;/code&gt; also ensures that cpu caches are coherent, but we will look at that little issue later on. The set_domain ioctl doesn't wait for all usage by the gpu to complete if userspace only wants to read the buffer. In that case it only waits for all outstanding gpu writes - the kernel knows this thanks to the separate read/write domains in the relocation entries and keeps track of both the last gpu write and read by remembering the seqnos of the respective batches.&lt;/p&gt; &lt;p&gt;The kernel also supports a &lt;code&gt;busy&lt;/code&gt; ioctl to simply inquire whether a buffer is still being used by the gpu. This recently gained the ability to tell userspace on which gpu engine an object is busy on - which is useful for compositors that get buffer objects from clients to decide which engine is the most suitable one, if a given operation can be done with more than one engine (pretty much all of them can be coaxed into copying data).&lt;/p&gt; &lt;p&gt;With that we have gpu/cpu synchronization covered. But as just mentioned above, the gpu itself also has multiple engines (at least on newer platforms) which can run in parallel. So we need to have some means of synchronization between them. To do that the kernel not only keeps track of the seqno of the last batch an object has been used for, but also of the engine (commonly just called ring in the kernel, since that's what the kernel really cares about).&lt;/p&gt; &lt;p&gt;If a batchbuffer then uses an object which is still busy on a different engine, the kernel inserts a synchronization point: Either by employing so called hardware semaphores, which similarly to when the kernel needs to wait for the gpu simply wait for the correct seqno to appear, only using internal registers instead of the status page. Or if that's disabled, simply by blocking in the kernel until rendering completes. To avoid inserting too many synchronization points the kernel also keeps track of the last synchronization point for each ring. For ring/ring synchronization we don't track read domains separately, at least not yet.&lt;/p&gt;  &lt;p&gt;Note that a big difference of GEM compared to a lot of other gpu execution management frameworks and kernel drivers is that GEM does not expose explicit sync objects/gpu fences to userspace. A synchronization point is always only implicitly attached to a buffer object, which is the only thing userspace deals with. In practice the difference is not big, since userspace can have equally fine-grained control over synchronization by keeping onto all the batchbuffer objects - keeping them around until the gpu is done with them won't waste any memory anyway. But the big upside is that when sharing buffers across processes, e.g. with DRI2 on X or generally when using a compositor, there's no need to also share a sync object: Any required sync state comes attached to the buffer object, and the kernel simply Does The Right Thing. &lt;/p&gt; &lt;p&gt;This concludes the part about command submission, active object retiring and synchronization. In the next installment we will take a &lt;a href="http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html"&gt;closer look at how the kernel manages the GTT&lt;/a&gt;, what happens when we run out of space in the GTT and how the i915.ko currently handles out-of-memory conditions.&lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1685551924522514150/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html#comment-form' title='8 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' title='i915/GEM Crashcourse, Part 2'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>8</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750</id><published>2012-10-30T14:37:00.000-07:00</published><updated>2013-07-21T06:58:51.495-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>i915/GEM Crashcourse</title><content type='html'>&lt;p&gt;This is the first part in a short tour of the Intel hardware and what the GEM (graphics execution manager) in the i915 does. See the &lt;a href="http://blog.ffwll.ch/2013/01/i915gem-crashcourse-overview.html"&gt;overview&lt;/a&gt; for links to the other parts. &lt;/p&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;p&gt;GEM essentially deals with graphics buffer objects (which can contain textures, renderbuffers, shaders or all kinds of other state objects and data used by the gpu) and how to run a given workload on the gpu, commonly called command submission (CS), but in the i915.ko driver done with the execbuf ioctl (since the gpu commands themselves reside in a buffer object on Intel hardware). &lt;/p&gt;&lt;h2&gt;Address Spaces and Pagetables&lt;/h2&gt;&lt;p&gt;So the first topic to look at is what kind of different address space we have, which different pieces of hardware can access them, and how we bind various pieces of memory into them (i.e. where the corresponding pagetables are and what they look like). Contrary to discrete gpus Intel gpus can only access system memory, hence the only way to make any memory available to the gpu is by binding a bunch of pages into one of these gpu pagetables, and we don't need to bother us with different kinds of underlying memory as backing storage. &lt;/p&gt; &lt;p&gt;The gpu itself has its own virtual address space, commonly called GTT. On modern chips its 2GB big, and all gpu functions (display unit, render rings and similar global resources, but also all the actual buffer objects used for rendering) access the data they need through it. On earlier generations it's much smaller, down to a meager 32M for the i830M. On Sandybridge and newer platforms we also have a second address space called the per-process GTT (PPGTT for short), which is of the same size. This address space can only be accessed by the gpu engines (and even there we sometimes can't use it), hence scanout buffers must be in the global GTT. The original aim of PPGTT was to insulate different gpu processes, but context switch times are high, and up to Sandybridge the TLBs have errate when using different address spaces. The reason we use PPGTT now - it's been around as a hardware feature even on earlier generations - is that PPGTT PTEs can reside in cachable memory, and so lookups benefit from the big shared LLC cache, whereas GTT PTE lookups always hit main memory. &lt;/p&gt; &lt;p&gt;But before we look at the where the pagetables reside, we also need to consider how the cpu can access graphics data. Since Intel has a unified memory architecture, we can access graphics memory by directly mapping the backing storage in main memory into the cpu address space. For a bunch of reasons that we'll discuss later on it is though useful if the cpu can access the graphics objects through the GTT. For that, the low part (usually the first 256MB) of the GTT can be accessed through the bar 2 pci mmio space of the igd. Hence we can point the cpu PTEs at that mmio window, and then point the relevant GTT PTEs at the actual backing storage in main memory. The chip block that forwards these cpu accesses is usually called System Agent (SA). Note that there's no such window for the PPGTT, that address space can really only be used by the render part of the gpu (usually called GT). This GTT cpu window is called the mappable gtt part in our code (since we can map it from the cpu) and accessed with write-combining (wc) cpu mapping. &lt;/p&gt; &lt;p&gt;Now the pagetables are a bit tricky. In the end they're all in system memory, but there are a few hoops to jump through to get at them. The GTT pagetables has just one level, so with a 4 byte entry size we need 2MB of contiguous pagetable space. The firmware allocates that for us from stolen memory (i.e. a part of the system memory that is not listed in the e820 map, and hence not managed by the linux kernel). But we write these PTEs through an alias in the register mmio bar! The reason for that is to allow the SA to invalidate TLBs. Note though that this only invalidates TLBs for cpu access, any other access to the GTT (e.g. from the GT or the display block) has its own rules for TLB invalidation. Also, on recent generations we need to (depending upon circumstances) manually invalidate the SA TLB by writing to a magic register. To speed up map/unmap operations, we map that GTT PTE aliasing region in the mmio with wc (if this is possible, which means the cpu needs to support PAT). &lt;/p&gt; &lt;p&gt;PPGTT has a two level pagetable. The PTEs have the exact same bit layout as the PTEs in the global GTT, but they reside in normal system memory. The PTE pagetables are split up into pages, each of which contains 1024 entries. So there's no need for a contiguous block of memory and they are hence allocated with the linux page allocator. The PDEs on the other hand are special. We need 512 of&amp;nbsp; them to map the entire 2GB address space. For unknown reasons the hw requires that we steal these 512 entries from the GTT pagetable (hence the useable range of the global GTT shrinks by 2 MB) and write them through the same mmio alias that we write the global GTT PTEs through. &lt;/p&gt; &lt;p&gt;A slight complication is VT-d/DMAR support, which adds another layer to remap the bus addresses that we put into (PP)GTT PTEs to real memory addresses. We simply use the common linux dma api through &lt;code&gt;pci_map/unmap_sg&lt;/code&gt; (and variants) to use these, so DMAR support is rather transparent in our code. Well, safe for the minor annoyance that the DMAR hardware interacts badly with the GTT PTE lookups on various platforms and so needs ridiculous amounts of horrible workarounds (down to disabling everything on GM45 since it simply doesn't work). Only on Ivybridge DMAR seems to be truely transparent and no longer requires strange contortions.&lt;/p&gt; &lt;h2&gt;Tiling and Swizzling&lt;/h2&gt; &lt;p&gt;Modern processors go to extreme lengths to paper over memory latency and lack of bandwidth with clever prefetchers and tons of caches. Now graphics usually deals with 2D data and that can result in some rather different access patterns. The pathalogical case is drawing a vertical line (if each horizontal line is contigous in memory, followed by the next one): Drawing one pixel will just access 4 bytes, then the next pixel is a few thousands bytes away. Which means we'll not only incur a cache miss, but also a TLB miss. Which for a 1 pixel line crossing the entire screen means a few hundred to thousands cache and TLB misses. For just 1-2 KB of date. No amount of caches and TLBs can paper over that.&lt;p&gt; &lt;/p&gt;So the solution is to rearrange the layout of 2D buffers into tiles of fixed size&amp;amp;height, so that each tile has a size of 4KB. Hence as long as we stay within a tile, we won't incur a TLB miss. Intel hardware has two different tiling layouts:&lt;/p&gt; &lt;p&gt;&lt;ul&gt;&lt;li&gt;X-tiled, which is 512 bytes wides with 8 rows, where each 512 byte long logical row is contiguous in memory. This is the compromise tiling layout which is somewhat efficient for rendering, but can still be used for scanout, where we access the 2D buffer row-by-row. A too short (or non-contigous) row within a tile would drive power consumption (due to the more random memory access pattern) for scanout through the roof, which hurts idle power consumption.&lt;/li&gt;&lt;li&gt;Y-tiled, which is 128 bytes times 32 rows. For the comon 32bit pixel layouts this means 32x32 pixels, so nicely symmetric in both x and y direction. For even better performance a row is split up in OWORDS (i.e. 16 bytes) and consecutive OWORDS in memory are mapped to consecutive &lt;i&gt;rows &lt;/i&gt;(no columns, which would result in the contigous rows of pixels that the X-tiled layout has). Hence an aligned 4x4 pixel block matches up with a 64 byte cacheline. So in a way a cacheline within a Y-tile works like a smaller microtile.&lt;/li&gt;&lt;/ul&gt; &lt;p&gt;There's also a special W-tile layout, which is only used by the separate stencil buffer. Safe when hacking around in the stencil readback code, we can just ignore this (since accessing the stencil buffer is all internal to the render engine). Also, some really old generations have slightly different parameters for the X and Y layouts.&lt;/p&gt; &lt;p&gt;An additional complexity comes with dual channel memory. For efficiency reasons we want to read entire 64 byte block (which matches the cachelines size) from a single channel. To load balance between the two channels we therefore load all even cachelines from the first channel and all odd cachelines from the second channels. There are some additional trick to even out things, but this is the gist we need for the below discussion.&lt;/p&gt; &lt;p&gt;Unfortunately this channel interleave pattern together with the X tiling again leads to a pathalogical access pattern: If we draw a vertical line in an X tile we advance by 512 bytes for each pixel, which means we'll always hit the same memory channel (since &lt;code&gt;512 % 64 == 0&lt;/code&gt;). The same happens for Y tiles when drawing a horizontal line. Looking at the memory address we see that bit 6 essentially selects which memory channel will be used, so we can even out the access pattern by XOR'ing additional, higher bits into bit 6 (which is called swizzling). XOR'ing bit 9 into bit 6 gives us a perfect checkerboard of memory channels for Y tiling. For X tile we can't get better than at most 2 consecutive cachelines in any direction that use the same memory channel, which the hw achieves by XOR'ing bit 10 and 9 into bit 6.&lt;/p&gt;  &lt;p&gt;&lt;b&gt;Addendum:&lt;/b&gt; On most older platforms the firmware selects the whether swizzling is enabled when setting up the memory controller and this can't be changed afterward any more. But on Sandybridge and later the driver controls swizzling, and enables it when it detects a symmetric DIMM configuration in the memory controller. &lt;/p&gt;  &lt;h2&gt;Fencing&lt;/h2&gt;&lt;p&gt;Now how can we tell the gpu which layout a given buffer object uses? For pretty much most gpu functions we can directly specify the tiling layout in additional state bits (or for the display unit, in special register bits). But some functions don't have any such bits, and on older platforms that even includes the blitter engine and some other special units. For these the hardware provides a limited set of so called fences.&lt;/p&gt; &lt;p&gt;The first thing to note is that Intel hardware fences are something rather different than what they normally mean around gpu drivers: Usually a fence denotes a synchronization point that is inserted into the command stream that the gpu processes, so that the cpu knows exactly up to which point the gpu has completed commands (and hence also which buffers the gpu still needs).&lt;/p&gt; &lt;p&gt;Fences on Intel hardware though are special ranges in the global GTT that make a tiled area look linear. On modern platforms we have 16 of those and can set them up rather freely, the start and end of a tiled region only need to align to page boundaries. Now most gpu GTT clients have their own tiling parameters and ignore these fences (with the exception of older platforms, where fence usage by the gpu is much more common), but fences are are obeyed by the SA and hence by all CPU access that targets the mmio window into the GTT. Fences are therefore the first reason why cpu access to a buffer object through the GTT mmio window is useful - they detile a buffer automatically, and doing the tiling and swizzling manually is simply a big pain. One peculiarity is though that we can only access X and Y tiled regions, not W tiled regions - so stencil buffers need to be manually detiled and deswizzled with the cpu.&lt;/p&gt; &lt;p&gt;Managing the fences is rather straightforward - we keep them in an lru, and if no fence is free, we make one available by ensure that nothing that currently accesses this buffer objects really needs the fence. To ensure that the cpu can't access the object any more through the mmio window we shot down all cpu PTEs pointing at it. For older generations where the gpu also needs fences we keep track of the last command submission that requires it (since not all of them do, and fences are a limited resources) and wait for that to complete.&lt;/p&gt; &lt;p&gt;Also, on some older platforms fences have a minimal size and need to be a power of two in alignment and size. To avoid the need to over-allocate a texture (and so waste memory) we allow tiled objects to be smaller than the fenced region they would require. When setting up a fence we simply reserve the entire region that the fence detiles in the GTT memory manager, and so ensure that no other object ends up in the unused, but still detiled area (where it would get corrupted).&lt;/p&gt; &lt;p&gt;Now that we've covered how to make memory accessible to the gpu and how to handle tiling, swizzling and setting up fences, the &lt;a href="http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html"&gt;next installment&lt;/a&gt; of this series will look at how to submit work to the gpu and some related issues. &lt;/p&gt; &lt;p&gt;&lt;b&gt;Errata:&lt;/b&gt; Mika Kuoppala noticed that my math about the GTT PTE stealing for the PDEs used for PPGTT was off, now it's fixed.&lt;/p&gt;</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4553523947071081750/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html#comment-form' title='5 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' title='i915/GEM Crashcourse'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>5</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4281497260812145729</id><published>2012-10-02T03:37:00.001-07:00</published><updated>2013-07-21T07:00:05.252-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Kernel RelNotes'/><title type='text'>Neat drm/i915 stuff for 3.7</title><content type='html'>Now that the upstream merge window has started and my last drm-intel-next pull request landed in Dave Airlie's drm tree it's a good time to look at some of the things landing in 3.7:&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;The big ticket item is the &lt;b&gt;&lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;modeset-rework&lt;/a&gt;&lt;/b&gt;. On top of that we have some &lt;b&gt;eDP fixes&lt;/b&gt; that required the new modeset infrastructure to work properly. Unfortunately the Haswell DP and eDP support did not make it - we've had patches for 3.6, but they've been too ugly to merge. Paulo Zanoni reworked all these patches on top of the new modeset code, unfortunately the new patches missed 3.7.  Also, thanks to these eDP fixes I could finally merge &lt;b&gt;CADL support&lt;/b&gt;, this should help to light up the backlight on some obnoxious platforms with a BIOS that tries to get in the way of the kms driver ...&lt;br /&gt;&lt;br /&gt;There are also tons of &lt;b&gt;improvements to the Haswell HDMI&lt;/b&gt; support and stability fixes for Haswell rendering from Paulo Zanoni. And Ben Widawsky enabled &lt;b&gt;hw context support&lt;/b&gt; &lt;b&gt;on Haswell&lt;/b&gt; (required for geometry shader support) and a few other more obscure hw features for Haswell.&lt;br /&gt;&lt;br /&gt;For power management Ben Widawsky added tons of &lt;b&gt;sysfs interfaces to control gpu frequency scaling&lt;/b&gt; on Sandybridge and newer, e.g. to limit the gpu to the lowest frequency for that last ounce of battery runtime. PowerTOP will use this to show a histogram of gpu frequencies, to complete the rc6 histogram support already merged into 3.6.&lt;br /&gt;&lt;br /&gt;On the GEM side Chris Wilson provided tons of tuning patches to etch out a bit more performance in corner cases: We now write &lt;b&gt;PTEs with write-combine mappings&lt;/b&gt; where the (cacheable) ppgtt ptes are not available. He also &lt;b&gt;optimized the gpu flushing code&lt;/b&gt; between batch buffers and reduced the overhead of the gpu-&amp;gt;cpu synchronization on newer platforms. Also merged are his &lt;b&gt;cachable BO support&lt;/b&gt; and the &lt;b&gt;unbound BO tracking&lt;/b&gt;, both of which should help boost SNA nicely on pre-Sandybridge machines. And we now also have &lt;b&gt;non-blocking gpu waits&lt;/b&gt;, which greatly helps interactivity when more than one drm client is using the gpu - which is the case as soon as you run a compositor using OpenGL. Beware benchmarkers though: A side-effect of this is that the gpu is shared more fairly between the different clients - this can result in reduced fps when running a windowized GL app, since Compiz now draws more frames itself, sucking away gpu time from the GL app. End result is though that more rendered frames end up actually visible on the screen. &lt;br /&gt;&lt;br /&gt;A big cleanup under the hood of GEM is the &lt;b&gt;removal of the flushing_list&lt;/b&gt;. This concept dates back to the first days of GEM years ago, but turned out to be totally useless. Unfortunately it also complicated the code massively, resulting in countless little bugs - we've first tried to rip this all out at the beginning of this year, but only for 3.7 we've managed to track down all the bugs this uncovered.&lt;br /&gt;&lt;br /&gt;Last but not least countless other small improvements and code-cleanups all over the place. Oh, and: In case you have a &lt;b&gt;i830M with a ns2501&lt;/b&gt; lvds dvo chip: We now have basic support for that, thanks to Thomas Richter.pz</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/4281497260812145729/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/10/neat-drmi915-stuff-for-37.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4281497260812145729'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/4281497260812145729'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/neat-drmi915-stuff-for-37.html' title='Neat drm/i915 stuff for 3.7'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1357117670672683652</id><published>2012-09-21T05:32:00.000-07:00</published><updated>2013-07-21T06:59:58.686-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Slides for XDC 2012 Presentation</title><content type='html'>I've already published a short &lt;a href="http://blog.ffwll.ch/2012/08/new-modeset-code.html"&gt;writeup&lt;/a&gt;, now I've also put up the &lt;a href="http://people.freedesktop.org/~danvet/presentations/xdc2012-new_modeset.odp"&gt;slides&lt;/a&gt;. There's also nice writeups of all other XDC sessions available at the &lt;a href="http://www.x.org/wiki/Events/XDC2012/Proceedings"&gt;X Wiki&lt;/a&gt;. I'll add a direct link to the video of my talk once it shows up.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1357117670672683652/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/09/slides-for-xdc-2012-presentation.html#comment-form' title='1 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1357117670672683652'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1357117670672683652'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/09/slides-for-xdc-2012-presentation.html' title='Slides for XDC 2012 Presentation'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>1</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433</id><published>2012-08-19T14:04:00.001-07:00</published><updated>2013-07-21T06:58:51.499-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>New Modeset Code</title><content type='html'>drm/i915.ko is gearing up to gain a new modeset code, to finally move away from the crtc helper code (in drm/drm_crtc_helper.c) used by (up to now) all kms drivers. As a quick reference I'll detail the motivation and design of the new code a bit here (mostly stitched together from patchbomb announcements and commits introducing the new concepts).&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;The crtc helper code has the fundamental assumption that encoders and crtcs can be enabled/disabled in any order, as long as we take care of depencies (which means that enabled encoders need an enabled crtc to feed them data, essentially).&lt;br /&gt;&lt;br /&gt;Our hw works differently. We already have tons of ugly cases where crtc code enables encoder hw (or &lt;code&gt;encoder-&amp;gt;mode_set&lt;/code&gt; enables stuff that should only be enabled in &lt;code&gt;enocder-&amp;gt;commit&lt;/code&gt;) to work around these issues. But on the disable side we can't pull off similar tricks - there we actually need to rework the modeset sequence that controls all this. And this is also the real motivation why I've finally undertaken this rewrite: eDP on my shiny new Ivybridge Ultrabook is broken, and it's broken due to the wrong disable sequence ...&lt;br /&gt;&lt;br /&gt;The new code introduces a few interfaces and concepts:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Add new encoder-&amp;gt;enable/disable functions which are directly called from the   crtc-&amp;gt;enable/disable function. This ensures that the encoder's can be   enabled/disabled at a very specific in the modeset sequence, controlled by our   platform specific code (instead of the crtc helper code calling them at a time it deems convenient).&lt;/li&gt;&lt;li&gt;Rework the dpms code - our code has mostly 1:1 connector:encoder mappings and   does support cloning on only a few encoders, so we can simplify things quite a   bit.&lt;/li&gt;&lt;li&gt;Also only ever disable/enable the entire output pipeline. This ensures   that we obey the right sequence of enabling/disabling things, trying to be clever here mostly just complicates the code and results in bugs. For cloneable   encoders this requires a bit of special handling to ensure that outputs can   still be disabled individually, but it simplifies the common case. &lt;/li&gt;&lt;li&gt;Add infrastructure to read out the current hw state. No amount of careful   ordering will help us if we brick the hw on the initial modeset setup. Which could   happen if we just randomly disable things, oblivious to the state set up by   the bios. Hence we need to be able to read that out. As a benefit, we grow a   few generic functions useful to cross-check our modeset code with actual hw   state.&lt;/li&gt;&lt;/ul&gt;With all this in place, we can copy&amp;amp;paste the crtc helper code into the drm/i915 driver and start to rework it:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;As detailed above, the new code only disables/enables an entire output pipe. As a preparation for global mode-changes (e.g. reassigning shared resources) it keeps track of which pipes need to be touched by a set of bitmasks.&lt;/li&gt;&lt;li&gt;To ensure that we correctly disable the current display pipes, we need to know the currently active connector/encoder/crtc linking. The old crtc helper simply overwrote these links with the new setup, the new code stages the new links in &lt;code&gt;-&amp;gt;new_*&lt;/code&gt; pointers. Those get commited to the real linking pointers once the old output configuration has been torn down, before the &lt;code&gt;-&amp;gt;mode_set&lt;/code&gt; callbacks are called.&lt;/li&gt;&lt;li&gt;Finally the code adds tons of self-consistency checks by employing the new hw state readout functions to cross-check the actual hw state with what the datastructure think it should be. These checks are done both after every modeset and after the hw state has been read out and sanitized at boot/resume time. All these checks greatly helped in tracking down regressions and bugs in the new code.&lt;/li&gt;&lt;/ul&gt;With this new basis, a lot of cleanups and improvements to the code are now possible (besides the DP fixes that ultimately made me write this), but not yet done:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;I think we should create &lt;code&gt;struct intel_mode&lt;/code&gt; and use it as the adjusted mode   everywhere to store little pieces like &lt;code&gt;needs_tvclock&lt;/code&gt;, pipe dithering values or   dp link parameters.  That would still be a layering violation, but at least we   wouldn't need to recompute these kinds of things in intel_display.c.   Especially the port bpc computation needed for selecting the pipe bpc and   dithering settings in intel_display.c is rather gross.&lt;/li&gt;&lt;li&gt;In a related rework we could implement &lt;code&gt;-&amp;gt;mode_valid&lt;/code&gt; in terms of   &lt;code&gt;-&amp;gt;mode_fixup&lt;/code&gt; in a generic way - I've hunted down too many bugs where -&amp;gt;mode_valid   did the right thing, but &lt;code&gt;-&amp;gt;mode_fixup&lt;/code&gt; didn't. Or vice versa, resulting in   funny bugs for user-supplied modes.&lt;/li&gt;&lt;li&gt;Ditch the idea to rework the hdp handling in the common crtc   helper code and just move things to i915.ko. Which would rid us of the   &lt;code&gt;-&amp;gt;detect&lt;/code&gt; crtc helper dependencies.&lt;/li&gt;&lt;li&gt;LVDS wire pair and pll enabling is all done in the &lt;code&gt;crtc-&amp;gt;mode_set&lt;/code&gt; function currently. We should be able to move this to   the crtc_enable callbacks (or in the case of the LVDS wire pair enabling, into some encoder callback).&lt;/li&gt;&lt;/ul&gt; Last, but not least, this new code should also help in enabling a few neat features: The hw state readout code prepares (but there are still big pieces missing) for fastboot, i.e. avoiding the inital modeset at boot-up and just taking over the configuration left behind by the bios. We also should be able to extend the configuration checks in the beginning of the modeset sequence and make better decisions about shared resources (which is the entire point behind the atomic/global modeset ioctl). </content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/6289609224469029433/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html#comment-form' title='17 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' title='New Modeset Code'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>17</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3519509342366910498</id><published>2012-07-11T15:19:00.000-07:00</published><updated>2012-07-11T15:19:08.531-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Eugeni Dodonov, 1981-2012</title><content type='html'>Personally I'll remember you as the cheerful hacker who signed up for all sorts of crazy stuff. And then followed through and came out of the dungeons with some great patches - or at least a few good jokes.&lt;br /&gt;&lt;br /&gt;Rest in peace, we'll miss you.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3519509342366910498/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/07/eugeni-dodonov-1981-2012.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3519509342366910498'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3519509342366910498'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/07/eugeni-dodonov-1981-2012.html' title='Eugeni Dodonov, 1981-2012'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3581280925304476115</id><published>2012-05-19T09:51:00.000-07:00</published><updated>2013-07-21T06:56:09.025-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>git for Bug Reporters</title><content type='html'>Pretty often I point bug reporters at random git branches and sometimes they'll happily compile kernels from sources, but have no idea about git. Unfortunately there doesn't seem to be a quick how-to tailored to the needs of bug reporters, so let's fix that.&lt;br /&gt;&lt;br /&gt;$ git clone --depth 1 --no-checkout --no-single-branch &amp;lt;git-repo-path&amp;gt;&lt;br /&gt;&lt;br /&gt;This clones the git repository, but avoids downloading the entire history. It also avoids to check out the default branch because usually you need a specific branch for testing.&lt;br /&gt;&lt;br /&gt;All the following commands only work if the working directory is within the newly cloned git repository.&lt;br /&gt;&lt;br /&gt;$ git checkout origin/&amp;lt;branch-name&amp;gt;&lt;br /&gt;&lt;br /&gt;will check out the git branch &amp;lt;branch-name&amp;gt; (from the remote git repository) into the local git repository so that you can use it. git will complain about 'detached HEAD' but that's only really important when committing new changes, so just ignore that. If you already have an older clone of the git same remote repository, you first need to update the local git database (in the .git directory in your local repository) with&lt;br /&gt;&lt;br /&gt;$ git fetch origin&lt;br /&gt;&lt;br /&gt;before checking out the branch again. Even if you need to test the same, but updated branch, you need to do &lt;i&gt;both&lt;/i&gt; steps - git doesn't update anything automatically by default.&lt;br /&gt;&lt;br /&gt;If you have patches or other local changes applied, git might complain that there's a conflict. You can simply remove all local changes with&lt;br /&gt;&lt;br /&gt;$ git reset --hard&lt;br /&gt;&lt;br /&gt;and then re-do the checkout command. Much more rarely some build artifacts could get in the way (or you just need a quick way to start a clean build),&lt;br /&gt;&lt;br /&gt;$ git clean -dfx&lt;br /&gt;&lt;br /&gt;will remove any files not in the currently checked-out git commit.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/3581280925304476115/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/05/git-for-bug-reporters.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3581280925304476115'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/3581280925304476115'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/05/git-for-bug-reporters.html' title='git for Bug Reporters'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-455512600608655117</id><published>2012-02-03T05:51:00.000-08:00</published><updated>2012-02-07T06:11:28.417-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Slides for FODSEM 2012 dma_buf presentation</title><content type='html'>I'm to lazy to publish a proper writeup of my FOSDEM talk of where dma_buf is currently standing, where it'll likely head to and what to might still come in 1-2 years. But you can grabt the &lt;a href="http://people.freedesktop.org/~danvet/presentations/fosdem2012-dma_buf.odp"&gt;slides&lt;/a&gt;. Enjoy!&lt;br /&gt;&lt;br /&gt;Edit: Phoronix also has an article with &lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;px=MTA1NDE"&gt;video&lt;/a&gt; recordings.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/455512600608655117/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/02/slides-for-fodsem-2012-dmabuf.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/455512600608655117'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/455512600608655117'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/02/slides-for-fodsem-2012-dmabuf.html' title='Slides for FODSEM 2012 dma_buf presentation'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8123378769638523809</id><published>2012-01-14T05:33:00.000-08:00</published><updated>2013-07-21T06:56:15.364-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='Maintainer-Stuff'/><title type='text'>New drm-intel-next Git Tree</title><content type='html'>[This is a verbatim copy of the announcement that went out to intel-gfx &amp;amp; Co. today.]&lt;br /&gt;&lt;br /&gt;Because Keith is routinely really busy with all kinds of things, notably gathering fixes for drm-intel-fixes, the patch merge process for the next release cycle sometimes falls behind. To support him and improve things I've been volunteered to take over handling the -next tree.&lt;br /&gt;&lt;br /&gt;The main aim is to shift the drm/i915 -next merge process massively ahead with the goals to:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;Reduce pressure to merge questionable patches into -rc kernels because the -next tree is not yet open for patches.&lt;/li&gt;&lt;li&gt;Allow our QA at Intel and also the community to actually test things before  they land in mainline. The lack of such testing has severly bitten us in the  past few releases.&lt;/li&gt;&lt;li&gt;Refocus -fixes on handling regressions with absolute top priority (as it  should).&lt;/li&gt;&lt;li&gt;And generally get a steady and predictable patch-flow towards mainline back  into gears.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;I plan to run this -next tree with a few simple rules:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;I'll open the drm/i915 -next tree around -rc1 (maybe earlier in the future)  and cut regular new trees about every 2nd week or so. 2 weeks should be enough  for both our qa and the community to give it some decent testing.&lt;/li&gt;&lt;li&gt;I intend to send out the previous -next to Dave Airlie (assuming it tests ok)  so that he has a good check on the stuff that's going on in i915-land. A few  other people also asked for a better overview of what's going on on drm/i915 -  I'll plan to announce every new -next tree with a short mail (maybe together  with the pull request to Dave for the old one).&lt;/li&gt;&lt;li&gt;-next will close about 1-2 weeks before the merge opens. No new features after  that point for a given release cycle.&lt;/li&gt;&lt;li&gt;To make this really work we also need to cut down on what can go into -fixes.  drm/i915 unfortunately has the reputation that deserves it a bunch of  draconian rules (which are stricter than drm/* in general):&lt;ul&gt;&lt;li&gt;  Only fixes for serious issues and regressions after the -next tree went to    Dave.&lt;/li&gt;&lt;li&gt;After -rc2 regression fixes only. It simply happend why too often that an    "obvious" patch blew up late in the -rc release cycle, my patches included.  - After -rc4/5 only reverts and disable patches. Imo it's way too late to play    games by then, the real fix should go straight to -next (which will close    only a few weeks afterwards already).&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Regressions have top priority, if they get neglected due to ongoing work  headed for -next I'll refuse to merge the patches.&lt;br /&gt;&lt;/li&gt;&lt;li&gt;We have a test-suite in the intel-gpu-tools package for the kernel. Expect me  to be annoying about patches that should have testcases for them but don't.  This includes new features, but also bugs that can be reproduced with a  reasonable amount of effort.&lt;/li&gt;&lt;li&gt;To avoid me pushing utter crack I will only merge my own patches after they  have gathered sufficient review on intel-gfx. Please yell at me at the top of  your voice (and in public) if I violate this.&lt;/li&gt;&lt;li&gt;The main discussion list for patches to drm/i915 is  &lt;a href="mailto:intel-gfx@lists.freedesktop.org"&gt;intel-gfx@lists.freedesktop.org&lt;/a&gt; - I don't keep up with lkml usually.&lt;/li&gt;&lt;li&gt;I'll reserve my human right to act like an incompetent arrogant fool once in a  while.&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;Last but not least, the new tree is available at&lt;br /&gt;&lt;br /&gt;&lt;a href="http://cgit.freedesktop.org/%7Edanvet/drm-intel"&gt;http://cgit.freedesktop.org/~danvet/drm-intel&lt;/a&gt;&lt;br /&gt;git://people.freedesktop.org/~danvet/drm-intel&lt;br /&gt;&lt;br /&gt;drm-intel-next is the main branch, but I expect at least a for-airlied branch for pull requests and maybe other branches with proposed patches to show up.&lt;br /&gt;&lt;br /&gt;Comments, flames and suggestions highly welcome.&lt;br /&gt;&lt;br /&gt;Yours, Daniel&lt;br /&gt;&lt;br /&gt;PS: Quick version for people with too short attentation spans:&lt;br /&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;-next will open around -rc1, a new tree should show up about every second  week. -next trees that are tested will regurarly be forwarded to Dave.&lt;/li&gt;&lt;li&gt;No stuff in -fixes that should go into -next instead.&lt;/li&gt;&lt;li&gt;-next will close for features about 1-2 weeks ahead of the upstream merge window.&lt;/li&gt;&lt;li&gt;Regressions have top priority.&lt;/li&gt;&lt;li&gt;Implementing proper tests is required.&lt;/li&gt;&lt;li&gt;Hit me hard if I break these rules for my own patches.&lt;/li&gt;&lt;li&gt;Sometimes I'll screw things up badly.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;Now grab the tree from&lt;br /&gt;&lt;br /&gt;git://people.freedesktop.org/~danvet/drm-intel</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/8123378769638523809/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2012/01/new-drm-intel-next-git-tree.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8123378769638523809'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/8123378769638523809'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/01/new-drm-intel-next-git-tree.html' title='New drm-intel-next Git Tree'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504</id><published>2011-05-04T12:11:00.000-07:00</published><updated>2013-07-21T06:58:51.484-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><category scheme='http://www.blogger.com/atom/ns#' term='In-Depth Tech'/><title type='text'>GEM Overview</title><content type='html'>This is the script of a short intro I've given at the Linaro@UDS memory management summit in Budapest in spring 2011. Yep, it's a bit old ...&lt;br /&gt;&lt;a name='more'&gt;&lt;/a&gt;&lt;br /&gt;The core idea of GEM is to identify graphic buffer objects with 32bit ids. The reason being "X runs out of open fds" (KDE easily reaches a few thousand).&lt;br /&gt;&lt;br /&gt;The core design principle behind GEM is that the kernel is in full control of the allocation of these buffer objects and is free to move the around in any way it sees fit. This is to make concurrent rendering by multiple processes possible while userspace can still assume that it is in sole possession of the gpu - GEM means "graphics execution manager".&lt;br /&gt;&lt;br /&gt;Below some more details on what GEM is and does, what it does _not_ do and how it relates to other graphic subsystems.&lt;br /&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;GEM does ...&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;&lt;ul&gt;&lt;li&gt;lifecycle management. Userspace references are associated with the drm fd and get reaped on close (in case userspace forgets about them).&lt;/li&gt;&lt;br /&gt;&lt;li&gt;per-device global names to exchange buffers between processes (eg dri2). These names are again 32bit ids. These global ids do not count as userspace references and don't prevent a buffer from being reaped.&lt;/li&gt;&lt;br /&gt;&lt;li&gt;it implements very few generic ioctls:&lt;br /&gt;&lt;ul&gt;&lt;li&gt; flink for creating a global name for a buffer object&lt;/li&gt;&lt;li&gt;open for getting a per-fd handle to a buffer object with a global name&lt;/li&gt;&lt;li&gt; close for dropping a per-fd handle.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;br /&gt;&lt;li&gt;&lt;blockquote&gt;&lt;/blockquote&gt; a little bit of kernel-internal helpers to facilitate mmap (by blending multiple buffer objects into the single drm device address space) and a few other things.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;That's it, i.e. GEM is very much meant to be as simple as possible.&lt;br /&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;Driver-specific GEM ioctls&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;The generic GEM stuff is obviously not very useful. So drivers implement&lt;br /&gt;quite a bit driver-specific ioctls, like:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;buffer creation. In recent kernels there is some support to create dumb scanout objects for KMS. But they're only really useful for boot-splashs and unaccelerated dumb KMS drivers. Creating buffers usable for rendering is only possible with driver specific ioctls.&lt;/li&gt;&lt;li&gt;command submission. An important part is mapping abstract buffer ids to actual gpu address (and rewriting batchbuffers with these). In the future,  with support for virtual gpu address spaces this might change.&lt;/li&gt;&lt;li&gt;tiling management. The kernel needs to know this to correctly tile/detile  buffers when moving them around (e.g. evicting from vram).&lt;/li&gt;&lt;li&gt;command completion signalling and gpu/cpu synchronization.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;There are currently two approaches for implementing a GEM driver:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;roll-your-own, used by drm/i915 (and sometimes getting flaked for NIH).&lt;/li&gt;&lt;li&gt;ttm-base: radeon &amp;amp; nouveau.&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;GEM does not ...&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;This still leaves out a few things that I've seen mentioned as&lt;br /&gt;ideas/requirements here and elsewhere:&lt;br /&gt;- cross-device buffer sharing and namespaces (see below) and&lt;br /&gt;- buffer format handling and mediation between different users (except&lt;br /&gt;tiling as mentioned above). The reason here is that gpus are a mess&lt;br /&gt;and one of the worst parts is format handling. Better keep that out&lt;br /&gt;of the kernel ...&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;KMS (kernel mode setting)&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;KMS is essentially just a port of the xrandr api to the kernel as an ioctl&lt;br /&gt;interface:&lt;br /&gt;&lt;ul&gt;&lt;li&gt;crtcs feed (possible multiple) outputs and get their data from a framebuffer object. A major part of KMS is also the support for vsynced-pageflipping of framebuffers.&lt;/li&gt;&lt;li&gt;Internally there's some support infrastructure to simplify drivers (all the drm_*_helper.c code).&lt;/li&gt;&lt;li&gt;framebuffers are created from a opaque driver-specific 32bit id and a format description. For GEM drivers these ids name GEM objects, but that need not be: The recently merged qemu kms driver does not implement  gem and has one unique buffer object with id 0.&lt;/li&gt;&lt;li&gt;as mentioned above there newly is a generic ioctl to create an object suitable as a dumb scanout (plus some support to mmap it).&lt;/li&gt;&lt;li&gt;currently KMS has no generic support for overlays (there are driver-specific ioctls in i915 and vmgfx, though). Jesse Barnes has posted an RFC to remedy this: &lt;a href="http://www.mail-archive.com/dri-devel@lists.freedesktop.org/msg10415.html"&gt;http://www.mail-archive.com/dri-devel@lists.freedesktop.org/msg10415.html&lt;/a&gt;&lt;br /&gt;&lt;/li&gt;&lt;/ul&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;GEM and PRIME&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;PRIME is a proof-of-concept implementation from Dave Airlie for sharing&lt;br /&gt;GEM objects between drivers/devices: Buffer sharing is done with a list of&lt;br /&gt;struct page pointers. While being shared, buffers can't be moved anymore.&lt;br /&gt;No further buffer description is passed along in the kernel, format/layout&lt;br /&gt;mediation is to be handled in userspace.&lt;br /&gt;&lt;br /&gt;Blog-post describing the initial design for sharing buffers between an&lt;br /&gt;integrated Intel igd and a discrete ATI gpu: &lt;a href="http://airlied.livejournal.com/71734.html"&gt;http://airlied.livejournal.com/71734.html&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;Other code using the same framework to render on an Intel igd and display&lt;br /&gt;the framebuffer on an usb-connected displayport: &lt;a href="http://git.kernel.org/?p=linux/kernel/git/airlied/drm-testing.git;a=shortlog;h=refs/heads/udl-v2"&gt;http://git.kernel.org/?p=linux/kernel/git/airlied/drm-testing.git;a=shortlog;h=refs/heads/udl-v2&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&lt;span style="font-size:130%;"&gt;GEM/KMS and fbdev&lt;/span&gt;&lt;br /&gt;&lt;br /&gt;There's some minimal support to emulate an fbdev with a gem/kms driver.&lt;br /&gt;Resolution can't be changed and it's unaccelerated. There's been some&lt;br /&gt;muttering once in a while to better integrate this with either a kms&lt;br /&gt;kernel console driver or by routing fbdev resolution changes to kms.&lt;br /&gt;&lt;br /&gt;But the main use case is to display a kernel oops, which works. For&lt;br /&gt;everything else there's X (or an EGL client that understands kms).</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1414489045975317504/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html#comment-form' title='7 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html' title='GEM Overview'/><author><name>danvet</name><uri>https://www.blogger.com/profile/01004742238258848471</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>7</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2873308495711562759</id><published>2011-02-26T01:47:00.000-08:00</published><updated>2011-02-26T01:48:53.592-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>Hell Froze Over</title><content type='html'>From the infamous "i855GM cache coherency is made of fail" &lt;a href="https://bugs.freedesktop.org/show_bug.cgi?id=27187"&gt;bug&lt;/a&gt;:&lt;br /&gt;&lt;br /&gt;&lt;blockquote&gt;legolas558: In yesterday's git pull I have noticed some interesting patches and I can say that the vanilla kernel (with xorg-server 1.9.4 and xf86-video-intel 2.14.0) is now very stable, no video corruptions and videos playing smoothly&lt;/blockquote&gt;&lt;br /&gt;'Nuff said.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/2873308495711562759/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2011/02/hell-froze-over.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2873308495711562759'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/2873308495711562759'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/02/hell-froze-over.html' title='Hell Froze Over'/><author><name>danvet</name><uri>https://www.blogger.com/profile/01004742238258848471</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1596341627763159524</id><published>2011-01-06T10:42:00.000-08:00</published><updated>2011-01-06T10:42:24.725-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#post'/><title type='text'>On Getting Your API Right</title><content type='html'>Ben Widawsky is writing hardware contexts support for the i915 drm module. The resulting API &lt;a href="http://lists.freedesktop.org/archives/intel-gfx/2010-December/009059.html"&gt;discussion&lt;/a&gt; showed that things are not simple and probably in need of an iteration or two. Now linux kernel rules mandate that an ioctl once merged must be supported (almost) forever. So one can still see all the evolutionary steps of gpu command submission:&lt;br /&gt;&lt;br /&gt;&lt;b&gt;cmdbuffer:&lt;/b&gt; The kernel simply copies the commands given by userspace into the hardware ringbuffer. Bad, because the kernel needs to copy everything. And it can't use hardware features to check the commands because commands in the ringbuffer are assumed to be trusted.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;batchbuffer:&lt;/b&gt; Userspace hands in a GTT adress and the kernel executes it with an MI_BATCHBUFFER command from the ringbuffer. No copying, and the hardware does some rudimentary security checking (the newer your chip, the more). But handing in a fixed GTT address requires that userspace is in full control of the graphics memory. Which fails with GEM - if you neglect some rather hacky porting of libXvMC to DRI2/GEM ...&lt;br /&gt;&lt;br /&gt;&lt;b&gt;execbuffer:&lt;/b&gt; Due to GEM, userspaces references buffer objects only by handles. So the new command submission path takes the id of a buffer containing the commands. Plus a list of buffer objects used by this command stream (textures, shaders, color- and depthbuffer, ...) and a list of relocations so the kernel can fix up buffer addresses in the command stream. As an optimization, the kernel passes back the current GTT address of all buffers used. This way the kernel only needs to fix up address in when buffers have moved around since the last time being used.&lt;br /&gt;&lt;br /&gt;&lt;b&gt;execbuffer2:&lt;/b&gt; Unfortunately the structures used by execbuf don't have reserved fields, so the next extension required an new ioctl. Older hardware (still being sold in Atom based netbooks) requires the setup of so called buffer fences (not to be confused with execution fences) for tiled buffers. But only for certain commands. There are only 16 fences available (on newer hardware, 8 on older) so this severely restricts performance. Especially since fences are not required by the 3D engine. So execbuf2 was born with a flag to explicitly designate buffers that need fences.&lt;br /&gt;&lt;br /&gt;Due to plenty of reserved fields in execbuf2 &lt;b&gt;multiple ringbuffer suppor&lt;/b&gt;t didn't need a new ioctl. But to keep things funny, there are two versions: First inter-ring synchronization must have been done by userspace, in later versions the kernel takes care of this.&lt;br /&gt;&lt;br /&gt;And now hardware context support adds its own complications. And likely requires another interface for command submission. Or two, because Intel hardware moves towards a per-process GTT, possibly handing back full control over the memory layout to userspace - somewhat similar to the DRI1 interfaces ...&lt;br /&gt;&lt;br /&gt;And for anyone forced to design an API, read these &lt;a href="http://ozlabs.org/~rusty/index.cgi/tech/2008-03-30.html"&gt;two&lt;/a&gt; &lt;a href="http://ozlabs.org/~rusty/index.cgi/tech/2008-04-01.html"&gt;posts&lt;/a&gt; by Rusty Russells.</content><link rel='replies' type='application/atom+xml' href='http://blog.ffwll.ch/feeds/1596341627763159524/comments/default' title='Post Comments'/><link rel='replies' type='text/html' href='http://blog.ffwll.ch/2011/01/on-getting-your-api-right.html#comment-form' title='0 Comments'/><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1596341627763159524'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/posts/default/1596341627763159524'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/01/on-getting-your-api-right.html' title='On Getting Your API Right'/><author><name>danvet</name><uri>https://www.blogger.com/profile/01004742238258848471</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:total>0</thr:total></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.page-555211688299469169</id><published>2014-07-14T11:53:00.000-07:00</published><updated>2014-07-14T11:53:49.407-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#page'/><title type='text'>about me</title><content type='html'>&lt;a href="http://2.bp.blogspot.com/--UxKYl3DDQY/U1bm8OBEbDI/AAAAAAAAAG4/3OaKyKd3_TA/s1600/bw.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"&gt;&lt;img alt="Daniel Vetter" border="0" src="http://2.bp.blogspot.com/--UxKYl3DDQY/U1bm8OBEbDI/AAAAAAAAAG4/3OaKyKd3_TA/s1600/bw.jpg" height="320" title="" width="284" /&gt;&lt;/a&gt;Currently I work at Intel OTC on the graphics team, mostly creating havoc in the kernel driver part of our stack and tightly related parts.&lt;br /&gt;&lt;br /&gt;I'm also the kernel maintainer for the drm/i915 driver, the official git repo I maintain is at:&amp;nbsp; &lt;a href="http://cgit.freedesktop.org/drm-intel"&gt;http://cgit.freedesktop.org/drm-intel&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;All the low-level tooling and especially all the kernel driver testcases can be found at:&amp;nbsp;&lt;a href="http://cgit.freedesktop.org/xorg/app/intel-gpu-tools/"&gt;http://cgit.freedesktop.org/xorg/app/intel-gpu-tools/&lt;/a&gt; &lt;br /&gt;&lt;br /&gt;Most of my own code and development about all things graphic can be found at: &lt;a href="http://cgit.freedesktop.org/%7Edanvet"&gt;http://cgit.freedesktop.org/~danvet&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;I occasionally post nonsense on twitter as &lt;a href="https://twitter.com/danvet"&gt;@danvet &lt;/a&gt;but the more reliable way to contact me is to send a mail to: daniel PUNGGT vetter ÄT ffwll PUNGGT ch.&lt;br /&gt;&lt;br /&gt;Legal boilerplate: The opinions expressed on this site are mine alone and do not necessarily reflect the opinions or strategies of Intel Corporation or its worldwide subsidiaries.&amp;nbsp; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/pages/default/555211688299469169'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/pages/default/555211688299469169'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/p/about-me.html' title='about me'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><media:thumbnail xmlns:media='http://search.yahoo.com/mrss/' url='http://2.bp.blogspot.com/--UxKYl3DDQY/U1bm8OBEbDI/AAAAAAAAAG4/3OaKyKd3_TA/s72-c/bw.jpg' height='72' width='72'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2894097597289404121</id><published>2012-08-22T10:25:10.302-07:00</published><updated>2012-08-22T10:25:10.302-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you for destroying all existing porting effo...</title><content type='html'>Thank you for destroying all existing porting efforts.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2894097597289404121'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2894097597289404121'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345656310302#c2894097597289404121' title=''/><author><name>darktrym</name><uri>https://www.blogger.com/profile/02285015878323261757</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-769447862'/><gd:extendedProperty name='blogger.displayTime' value='August 22, 2012 at 10:25 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8226048702706675853</id><published>2012-08-23T01:25:13.782-07:00</published><updated>2012-08-23T01:25:13.782-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great!
When can we expect a FreeBSD version of tha...</title><content type='html'>Great!&lt;br /&gt;When can we expect a FreeBSD version of that driver? Will you port it?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/8226048702706675853'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/8226048702706675853'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345710313782#c8226048702706675853' title=''/><author><name>laemodost</name><uri>https://www.blogger.com/profile/00349177425658223586</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2136276302'/><gd:extendedProperty name='blogger.displayTime' value='August 23, 2012 at 1:25 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8262503386323429545</id><published>2012-08-23T05:18:53.656-07:00</published><updated>2012-08-23T05:18:53.656-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Oh year. It took about 18 month until the &amp;quot;ol...</title><content type='html'>Oh year. It took about 18 month until the &amp;quot;old&amp;quot; Intel GPU stuff was ported from Linux to FreeBSD. And now, just in time for the first FreeBSD release supporting Westmere to Ivy Bridge, the next sweeping changes come in. I understand that GPU programing often requires massive changes due to fast moving hardware development and so on, but why is it necessary that everytime when this happens the already working stuff is broken again and again? Often including the API to xf86-video-intel. The world doesn&amp;#39;t end with Linux! &lt;br /&gt;&lt;br /&gt;What about official support for Intel GPUs under FreeBSD? Of course FreeBSD is not as big as Linux but has nevertheless a strong userbase investing a lot of money into hardware. And good supported Intel GPUs are a strong argument for buying Intel hardware... Last but not least support for a second platform can bring more stability into a codebase by exhibit bugs and and other problems.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/8262503386323429545'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/8262503386323429545'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345724333656#c8262503386323429545' title=''/><author><name>Yamagi</name><uri>https://www.blogger.com/profile/14733916265011523176</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-420201389'/><gd:extendedProperty name='blogger.displayTime' value='August 23, 2012 at 5:18 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2200171194407111522</id><published>2012-08-23T07:33:23.116-07:00</published><updated>2012-08-23T07:33:23.116-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for doing all this great work on the GPU dr...</title><content type='html'>Thanks for doing all this great work on the GPU drivers.&lt;br /&gt;Are you considering also to deliver drivers for other platforms than linux? The different BSD-Platforms (OpenBSD, NetBSD nad FreeBSD are also in urgent need of working drivers. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2200171194407111522'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2200171194407111522'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345732403116#c2200171194407111522' title=''/><author><name>Gin Dimashq</name><uri>https://www.blogger.com/profile/11074871033198354102</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1068567351'/><gd:extendedProperty name='blogger.displayTime' value='August 23, 2012 at 7:33 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-858048816647357670</id><published>2012-08-23T11:56:27.443-07:00</published><updated>2012-08-23T11:56:27.443-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I concur with everyone who already commented on th...</title><content type='html'>I concur with everyone who already commented on this, the *BSDs are really, well... screwed by such seemingly arbitrary rewriting. It already took 18 months to port the exisiting code to FreeBSD, and with this rewrite.... I just hope it&amp;#39;s not that difficult to port to different operating systems.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/858048816647357670'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/858048816647357670'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345748187443#c858048816647357670' title=''/><author><name>Dave Rand</name><uri>https://www.blogger.com/profile/00623602300217153162</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1719928976'/><gd:extendedProperty name='blogger.displayTime' value='August 23, 2012 at 11:56 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4673767500951709790</id><published>2012-08-24T11:13:28.241-07:00</published><updated>2012-08-24T11:13:28.241-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Would be nice to see some effort in supporting *BS...</title><content type='html'>Would be nice to see some effort in supporting *BSD too. I like Intel CPUs a lot, but your GPU is dead in the water with the advent of such actions. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4673767500951709790'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4673767500951709790'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345832008241#c4673767500951709790' title=''/><author><name>olhe</name><uri>https://www.blogger.com/profile/02988433358914901106</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-166505527'/><gd:extendedProperty name='blogger.displayTime' value='August 24, 2012 at 11:13 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2754520437565526388</id><published>2012-08-24T11:40:50.178-07:00</published><updated>2012-08-24T11:40:50.178-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I would advise the BSD guys to bug Intel about fun...</title><content type='html'>I would advise the BSD guys to bug Intel about funding support, seriously. Flood their website with complaints. I think the BSD effort is doomed without at least one internal developer, and slowing down Linux progress for the sake of BSD simply is not an option.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2754520437565526388'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2754520437565526388'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345833650178#c2754520437565526388' title=''/><author><name>Ben Widawsky</name><uri>https://www.blogger.com/profile/18055784062629900561</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1964548363'/><gd:extendedProperty name='blogger.displayTime' value='August 24, 2012 at 11:40 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4448264265793442335</id><published>2012-08-24T13:25:28.596-07:00</published><updated>2012-08-24T13:25:28.596-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Well, let me clarify a bit first: This patch set i...</title><content type='html'>Well, let me clarify a bit first: This patch set is not a complete rewrite of the modeset code, all the low-level hw-frobbing parts are still all the same. The code mostly just reworks the interfaces a bit and makes the logic that drives the modeset sequence intel-specific. And we need that, because with the current generic framework we flat-out can&amp;#39;t fix a few bugs.&lt;br /&gt;&lt;br /&gt;So this patch series isn&amp;#39;t more work for porting than any other patch series, and if you can&amp;#39;t keep up with the development pace of drm/i915 with porting, you have a serious problem no matter what.&lt;br /&gt;&lt;br /&gt;Now I don&amp;#39;t mind keeping the *bsd folks in mind a bit more if I actually get something back from such an effort. But right now the only feedback I&amp;#39;ve seen outside from Linux is from Solaris people, and Intel itself is pouring the money into that.&lt;br /&gt;&lt;br /&gt;I haven&amp;#39;t heard any useful feedback from any *bsd folks in years (wrt the intel driver), and as long as it&amp;#39;s just bitching&amp;amp;moaning I just keep on presuming that graphics on *bsd is dead and won&amp;#39;t bother.&lt;br /&gt;&lt;br /&gt;&amp;lt;/rant&amp;gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4448264265793442335'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4448264265793442335'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345839928596#c4448264265793442335' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 24, 2012 at 1:25 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6764094426107333966</id><published>2012-08-24T19:41:13.713-07:00</published><updated>2012-08-24T19:41:13.713-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hello danvet,

Thanks for clearing up the issue a ...</title><content type='html'>Hello danvet,&lt;br /&gt;&lt;br /&gt;Thanks for clearing up the issue a bit, it doesn&amp;#39;t sound as bad as probably many of us thought. &lt;br /&gt;I fully agree with and understand you on the point of getting no feedback, I would most probably do the same, really.&lt;br /&gt;I&amp;#39;m no developer of any *BSD, so my question is: can I as an ordinary user give you any useful feedback? That might sound stupid, but I really want to help you if it makes you mind the *BSDs a bit more, as you said.&lt;br /&gt;&lt;br /&gt;Sincerely,&lt;br /&gt;&lt;br /&gt;D.Rom</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/6764094426107333966'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/6764094426107333966'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1345862473713#c6764094426107333966' title=''/><author><name>Dave Rand</name><uri>https://www.blogger.com/profile/00623602300217153162</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1719928976'/><gd:extendedProperty name='blogger.displayTime' value='August 24, 2012 at 7:41 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5952652615000367151</id><published>2012-08-26T12:27:29.985-07:00</published><updated>2012-08-26T12:27:29.985-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Dave! As a user there&amp;#39;s not much you can do...</title><content type='html'>Hi Dave! As a user there&amp;#39;s not much you can do here - since we&amp;#39;re no experts on the *BSD kernel code we direct the occasional user away to bsd-specific support channels. Developers popping up and discussion things would be much more interesting, but the last guy was Owen Ainsworth who work on a OpenBSD port a few years back. E.g. I&amp;#39;ve only learned of the FreeBSD porting effort recently (because a user asked about it) and afaik the guy who did all the porting never showed up anywhere. That kind of disconnect with the *BSD community is what I&amp;#39;m missing here first of all ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/5952652615000367151'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/5952652615000367151'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1346009249985#c5952652615000367151' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 26, 2012 at 12:27 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3875912330991712286</id><published>2012-08-26T15:36:30.734-07:00</published><updated>2012-08-26T15:36:30.734-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for your response, Daniel!
It&amp;#39;s really ...</title><content type='html'>Thanks for your response, Daniel!&lt;br /&gt;It&amp;#39;s really a shame that there is such a disconnect between developers like you and developers of the *BSDs. And I think something should change in that respect.&lt;br /&gt;Afaik, the guy who did all the porting of the modesetting code is Konstantin Belousov(kib@freebsd.org).&lt;br /&gt;Maybe I can achieve something if I just contact everbody on the FreeBSD mailing list and do something like a &amp;#39;call for more cooperation&amp;#39;. That may be in vain, but at least it could start a discussion which may drive things further.&lt;br /&gt;In the end, I think everybody can just gain something out of it, and maybe they will see it the same way.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/3875912330991712286'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/3875912330991712286'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1346020590734#c3875912330991712286' title=''/><author><name>Dave Rand</name><uri>https://www.blogger.com/profile/00623602300217153162</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1719928976'/><gd:extendedProperty name='blogger.displayTime' value='August 26, 2012 at 3:36 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6931354007698260956</id><published>2012-08-27T00:32:08.013-07:00</published><updated>2012-08-27T00:32:08.013-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Actually I&amp;#39;ve just noticed that Konstantin _di...</title><content type='html'>Actually I&amp;#39;ve just noticed that Konstantin _did_ pop up a few times on the intel-gfx mailing list. So it looks like things are working, I&amp;#39;ve simply missed the (little) bsd signal in all the linux noise ;-)&lt;br /&gt;&lt;br /&gt;I guess that only leaves the issue that bsd simply has too few people working on low-level graphics drivers to sustain a porting effort. I can&amp;#39;t really fix that ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/6931354007698260956'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/6931354007698260956'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1346052728013#c6931354007698260956' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 27, 2012 at 12:32 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4947578115390351774</id><published>2012-08-27T07:21:10.718-07:00</published><updated>2012-08-27T07:21:10.718-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Glad to hear that he did :)

Yep, manpower is not ...</title><content type='html'>Glad to hear that he did :)&lt;br /&gt;&lt;br /&gt;Yep, manpower is not a strong point of BSD development, and I understand that you can&amp;#39;t do much about it.&lt;br /&gt;Still, thanks for talking with me, much appreciated :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4947578115390351774'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/4947578115390351774'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1346077270718#c4947578115390351774' title=''/><author><name>Dave Rand</name><uri>https://www.blogger.com/profile/00623602300217153162</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1719928976'/><gd:extendedProperty name='blogger.displayTime' value='August 27, 2012 at 7:21 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1583934308373841679</id><published>2012-09-14T04:09:33.508-07:00</published><updated>2012-09-14T04:09:33.508-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>And the slides for my little presentation about GE...</title><content type='html'>And the slides for my little presentation about GEM/KMS at the graphics memory management summit at Linaro Connect in Budapest 2011:&lt;br /&gt;&lt;br /&gt;http://people.freedesktop.org/~danvet/presentations/gem_slides.odp</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/1583934308373841679'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/1583934308373841679'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1347620973508#c1583934308373841679' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='September 14, 2012 at 4:09 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7316838046298824752</id><published>2012-09-22T11:14:03.203-07:00</published><updated>2012-09-22T11:14:03.203-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>And now with a link to the video: &lt;a href="http://...</title><content type='html'>And now with a link to the video: &lt;a href="http://www.youtube.com/watch?v=ayP6bw6EBPo" rel="nofollow"&gt; Youtube &lt;/a&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1357117670672683652/comments/default/7316838046298824752'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1357117670672683652/comments/default/7316838046298824752'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/09/slides-for-xdc-2012-presentation.html?showComment=1348337643203#c7316838046298824752' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/09/slides-for-xdc-2012-presentation.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1357117670672683652' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1357117670672683652' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='September 22, 2012 at 11:14 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1177948894420419767</id><published>2012-11-01T04:28:33.838-07:00</published><updated>2012-11-01T04:28:33.838-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Cool! Waiting for the next installment :)</title><content type='html'>Cool! Waiting for the next installment :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/1177948894420419767'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/1177948894420419767'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html?showComment=1351769313838#c1177948894420419767' title=''/><author><name>Ilyes Gouta</name><uri>https://www.blogger.com/profile/06236199462632745292</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//lh3.googleusercontent.com/--BVmXvOk61s/AAAAAAAAAAI/AAAAAAAAAFQ/Rkhle7rFXcg/s32-c/photo.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2003495258'/><gd:extendedProperty name='blogger.displayTime' value='November 1, 2012 at 4:28 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8990725502756256939</id><published>2012-11-01T10:52:25.216-07:00</published><updated>2012-11-01T10:52:25.216-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;ve always wondered - why relocations? Or mor...</title><content type='html'>I&amp;#39;ve always wondered - why relocations? Or more specifically, is there a plan to switch to true paging?&lt;br /&gt;&lt;br /&gt;As I understand, OpenCL makes relocations impossible anyway (since one can cast a pointer to integer and do all kinds of tricks with it).</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/8990725502756256939'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/8990725502756256939'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1351792345216#c8990725502756256939' title=''/><author><name>Cyberax</name><uri>https://www.blogger.com/profile/03129241076743498073</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-978938863'/><gd:extendedProperty name='blogger.displayTime' value='November 1, 2012 at 10:52 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7460213849948810569</id><published>2012-11-01T14:06:11.127-07:00</published><updated>2012-11-01T14:06:11.127-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Well a bunch of reasons: First you&amp;#39;d need page...</title><content type='html'>Well a bunch of reasons: First you&amp;#39;d need pagefault support to do real paging (since otherwise userspace still needs to supply a list of buffers), and current hardware just can&amp;#39;t. Then there&amp;#39;s the issue that 2GB of GTT isn&amp;#39;t really a sensible amount of address space in todays world with 8GB of main memory. Much better than 256MB of just a few generations agon, but still. And last but not least current hardware is still rather disastrous at address space switching performance wise (and only Ivybridge actually supports more than one address space), so the added incentive of using real per-process address spaces with better insulation just isn&amp;#39;t there.&lt;br /&gt;&lt;br /&gt;Wrt OpenCL I&amp;#39;m by far no expert, but I think OpenCL 1 still works perfectly well in a relocatable world. OpenCL 2 seems to be different, but on Intel hardware that&amp;#39;s still a distant future. At least Haswell has pretty much the same GTT model as Ivybridge, so I don&amp;#39;t see a good way to get rid of relocations soon.&lt;br /&gt;&lt;br /&gt;Last but not least I think we can squeeze out some more juice from relocations, we haven&amp;#39;t explored yet all ways to micro-optimize them. And given that simple things like batch-processing relocations in groups of 64 seems to have helped tremendously in relocation throughput I guess there are some other lower hanging fruit still around.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/7460213849948810569'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/7460213849948810569'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1351803971127#c7460213849948810569' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/8990725502756256939'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='November 1, 2012 at 2:06 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1632594398849733280</id><published>2012-11-01T18:23:37.271-07:00</published><updated>2012-11-01T18:23:37.271-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks for the series! It&amp;#39;s pretty dense, so I...</title><content type='html'>Thanks for the series! It&amp;#39;s pretty dense, so I&amp;#39;m moving throuh it slowly. Hopefully I can pitch in on my intel gpu drivers to some extent.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/1632594398849733280'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/1632594398849733280'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html?showComment=1351819417271#c1632594398849733280' title=''/><author><name>physicow</name><uri>https://www.blogger.com/profile/00434296009277449147</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='28' height='32' src='//3.bp.blogspot.com/_UCPC0UJ76DQ/S701vvfl96I/AAAAAAAABC0/76LyR3O1bRw/S220-s32/dog-n-chair.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2700415'/><gd:extendedProperty name='blogger.displayTime' value='November 1, 2012 at 6:23 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7207684236529136955</id><published>2012-11-27T09:31:11.158-08:00</published><updated>2012-11-27T09:31:11.158-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nevermind bitching bsd folks - porting to exotic O...</title><content type='html'>Nevermind bitching bsd folks - porting to exotic OS is not your job.&lt;br /&gt;But if those efforts would make bugs like https://bugs.launchpad.net/ubuntu/+source/xserver-xorg-video-intel/+bug/1052000 disappear than it&amp;#39;s totally justified.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/7207684236529136955'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/7207684236529136955'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1354037471158#c7207684236529136955' title=''/><author><name>bubuta</name><uri>https://launchpad.net/~bubuta</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img1.blogblog.com/img/openid16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1355888213'/><gd:extendedProperty name='blogger.displayTime' value='November 27, 2012 at 9:31 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1612449997267338805</id><published>2012-11-27T09:41:12.502-08:00</published><updated>2012-11-27T09:41:12.502-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Unfortunately that bug is a different issue - the ...</title><content type='html'>Unfortunately that bug is a different issue - the BIOS doesn&amp;#39;t set up the eDP panel in this case, and we can&amp;#39;t set it up without the BIOS&amp;#39; help. I&amp;#39;ve worked on some patches which will be merged into 3.8, but on the UX31A they can only enable the backlight, the panel is still non-functional. But on some other machines it now does work. It seems to be something timing-related though, since on very rare occasions I could get it to correctly light up.&lt;br /&gt;&lt;br /&gt;The eternal frustration which is called (e)DP ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/1612449997267338805'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/1612449997267338805'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1354038072502#c1612449997267338805' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/7207684236529136955'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='November 27, 2012 at 9:41 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5382888552265756208</id><published>2012-11-28T08:00:51.684-08:00</published><updated>2012-11-28T08:00:51.684-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I dare to disagree - with latest bios and ubuntu&amp;#...</title><content type='html'>I dare to disagree - with latest bios and ubuntu&amp;#39;s X stack I can actually use external eDP panel (see the bug update). The strange thing is that Xorg only show part of main screen (it has better resolution) on external monitor. I mean I can put windows into the part of the screen and even make them &amp;quot;full-screen&amp;quot; but the expected behavior is to have 2 separate distinct screens - not the one embedded into another in some twisted way.&lt;br /&gt;&lt;br /&gt;If it were bios issue I presume that external panel would be completely non-functional but it actually shows stuff. Of course it shows wrong not what user would expect and corrupts main screen (it suddenly has different background wallpaper for example) - but it does work.&lt;br /&gt;&lt;br /&gt;I&amp;#39;m no specialist in xorg internals but I would be delighted to help with testing :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/5382888552265756208'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/5382888552265756208'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1354118451684#c5382888552265756208' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/7207684236529136955'/><author><name>bubuta</name><uri>https://launchpad.net/~bubuta</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img1.blogblog.com/img/openid16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1355888213'/><gd:extendedProperty name='blogger.displayTime' value='November 28, 2012 at 8:00 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2151555050689353578</id><published>2012-11-28T08:07:29.938-08:00</published><updated>2012-11-28T08:07:29.938-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>So it&amp;#39;s just me with the unlucky panel :(

For...</title><content type='html'>So it&amp;#39;s just me with the unlucky panel :(&lt;br /&gt;&lt;br /&gt;For the default configuration that&amp;#39;s just an issue with your login manager and desktop enviroment - if you can set it up with xrandr. Luckily wrestling with those things is not my turf ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2151555050689353578'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/2151555050689353578'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/08/new-modeset-code.html?showComment=1354118849938#c2151555050689353578' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6289609224469029433/comments/default/7207684236529136955'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/08/new-modeset-code.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6289609224469029433' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6289609224469029433' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='November 28, 2012 at 8:07 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-820952930142706811</id><published>2012-12-10T04:28:31.579-08:00</published><updated>2012-12-10T04:28:31.579-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I was looking for a standard way to acquire a phys...</title><content type='html'>I was looking for a standard way to acquire a physical address of a GEM (in fact CMA) BO. Is there a standard IOCTL, or there is some issue with my approach?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/820952930142706811'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/820952930142706811'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355142511579#c820952930142706811' title=''/><author><name>Lumag</name><uri>https://www.blogger.com/profile/15715160503631766465</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1474851185'/><gd:extendedProperty name='blogger.displayTime' value='December 10, 2012 at 4:28 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4354279281539073863</id><published>2012-12-10T08:53:52.145-08:00</published><updated>2012-12-10T08:53:52.145-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nope, and if you try to do this from userspace, yo...</title><content type='html'>Nope, and if you try to do this from userspace, you&amp;#39;re doing it wrong ;-) Userspace shouldn&amp;#39;t require any knowledge of the physical location of gem objects. Usually such hacks are used to share buffers between different drivers, for which we now have the dma-buf framework.&lt;br /&gt;&lt;br /&gt;Also note that this article is pretty old, it only accidentally ended up at the top again due to a quickly-rectified operator error ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/4354279281539073863'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/4354279281539073863'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355158432145#c4354279281539073863' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/820952930142706811'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='December 10, 2012 at 8:53 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1257346922315409001</id><published>2012-12-11T02:32:27.559-08:00</published><updated>2012-12-11T02:32:27.559-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I see... Yes I used physical addressing to share b...</title><content type='html'>I see... Yes I used physical addressing to share bo between DRM and V4L subsystems. But it is 3.5 and I don&amp;#39;t remember if dma-buf was there.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/1257346922315409001'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/1257346922315409001'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355221947559#c1257346922315409001' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/820952930142706811'/><author><name>Lumag</name><uri>https://www.blogger.com/profile/15715160503631766465</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1474851185'/><gd:extendedProperty name='blogger.displayTime' value='December 11, 2012 at 2:32 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8480101145156133797</id><published>2012-12-13T22:17:52.320-08:00</published><updated>2012-12-13T22:17:52.320-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>You mentioned about TTM and GEM, is it possible to...</title><content type='html'>You mentioned about TTM and GEM, is it possible to have both exists in the kernel space to support different user space drivers under one system?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/8480101145156133797'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/8480101145156133797'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355465872320#c8480101145156133797' title=''/><author><name>Woooinred</name><uri>https://www.blogger.com/profile/13349169745998834437</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-268353364'/><gd:extendedProperty name='blogger.displayTime' value='December 13, 2012 at 10:17 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-827370270737565129</id><published>2012-12-14T00:47:56.955-08:00</published><updated>2012-12-14T00:47:56.955-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Sure, e.g. radeon is TTM based and i915 is GEM bas...</title><content type='html'>Sure, e.g. radeon is TTM based and i915 is GEM based, and on a dual-gpu system you can use both.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/827370270737565129'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/827370270737565129'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355474876955#c827370270737565129' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/8480101145156133797'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='December 14, 2012 at 12:47 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5607275355631494423</id><published>2012-12-18T18:19:24.053-08:00</published><updated>2012-12-18T18:19:24.053-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That makes sense, thanks!</title><content type='html'>That makes sense, thanks!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/5607275355631494423'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/5607275355631494423'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2011/05/gem-overview.html?showComment=1355883564053#c5607275355631494423' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1414489045975317504/comments/default/8480101145156133797'/><author><name>Woooinred</name><uri>https://www.blogger.com/profile/13349169745998834437</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2011/05/gem-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1414489045975317504' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1414489045975317504' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-268353364'/><gd:extendedProperty name='blogger.displayTime' value='December 18, 2012 at 6:19 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5204895255498974280</id><published>2013-02-08T04:13:09.814-08:00</published><updated>2013-02-08T04:13:09.814-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Phoronix video is now &lt;a href="http://www.phoronix...</title><content type='html'>Phoronix video is now &lt;a href="http://www.phoronix.com/scan.php?page=news_item&amp;amp;px=MTI5NTk" rel="nofollow"&gt;online&lt;/a&gt;!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3162827050799783312/comments/default/5204895255498974280'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3162827050799783312/comments/default/5204895255498974280'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/fosdem-slides-2013.html?showComment=1360325589814#c5204895255498974280' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/02/fosdem-slides-2013.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3162827050799783312' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3162827050799783312' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='February 8, 2013 at 4:13 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-192350233076420066</id><published>2013-02-17T15:54:54.798-08:00</published><updated>2013-02-17T15:54:54.798-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I have screensaver set to one minute. If I switch ...</title><content type='html'>I have screensaver set to one minute. If I switch from GNOME 3 to a VT just running a console, wait one minute and then switch back to GNOME 3, it will flash up the contents of the old desktop before rendering the screen-saver. This is a data leakage bug since I could be at a different location when switching back. My GPU is Intel® Ironlake Mobile.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4898738363561615597/comments/default/192350233076420066'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4898738363561615597/comments/default/192350233076420066'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html?showComment=1361145294798#c192350233076420066' title=''/><author><name>slashdotaccount</name><uri>https://www.blogger.com/profile/16290555882203363205</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4898738363561615597' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4898738363561615597' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-226288860'/><gd:extendedProperty name='blogger.displayTime' value='February 17, 2013 at 3:54 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6199064611128623374</id><published>2013-02-17T16:07:20.265-08:00</published><updated>2013-02-17T16:07:20.265-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>That&amp;#39;s a userspace issue - it simply needs to ...</title><content type='html'>That&amp;#39;s a userspace issue - it simply needs to not show anything sensitive when restoring the screen first. But given that not even my Android seems to get this right it seems to be a bit hard. The only really safe way is to fire up the screensaver before switching away (or before suspending/turning the display off) ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4898738363561615597/comments/default/6199064611128623374'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4898738363561615597/comments/default/6199064611128623374'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html?showComment=1361146040265#c6199064611128623374' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4898738363561615597/comments/default/192350233076420066'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/02/neat-drmi915-stuff-for-39.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4898738363561615597' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4898738363561615597' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='February 17, 2013 at 4:07 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8697552816927010605</id><published>2013-03-24T12:44:35.480-07:00</published><updated>2013-03-24T12:44:35.480-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I have a g45 mainboard that for a long time suffer...</title><content type='html'>I have a g45 mainboard that for a long time suffered from overheating in the GPU, since I was using a large tower cooler on the processor with no fan besides the power supply sucking air out of it, but that wasn&amp;#39;t enough for the passive cooler on the north bridge. I think it would be much more useful to underclock the GPU to make it work with just passive coolers on both the CPU and the northbridge.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3197309094902219529/comments/default/8697552816927010605'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3197309094902219529/comments/default/8697552816927010605'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html?showComment=1364154275480#c8697552816927010605' title=''/><author><name>Arnd Bergmann</name><uri>https://www.blogger.com/profile/18281965439048725621</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3197309094902219529' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3197309094902219529' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-225771835'/><gd:extendedProperty name='blogger.displayTime' value='March 24, 2013 at 12:44 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4987949971437913375</id><published>2013-03-31T02:50:14.947-07:00</published><updated>2013-03-31T02:50:14.947-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;m on linux with a Intel HD 3000. From the be...</title><content type='html'>I&amp;#39;m on linux with a Intel HD 3000. From the beginning it suffer for overheating also with Google Earth.&lt;br /&gt;&lt;br /&gt;Can this be caused by &amp;quot;Gpu turbo support&amp;quot; ?&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3197309094902219529/comments/default/4987949971437913375'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3197309094902219529/comments/default/4987949971437913375'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html?showComment=1364723414947#c4987949971437913375' title=''/><author><name>WonderLand</name><uri>https://www.blogger.com/profile/11039798275602784745</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/03/overclocking-your-intel-gpu-on-linux.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3197309094902219529' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3197309094902219529' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-440762565'/><gd:extendedProperty name='blogger.displayTime' value='March 31, 2013 at 2:50 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2444951284886256844</id><published>2013-04-19T12:37:51.387-07:00</published><updated>2013-04-19T12:37:51.387-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>as someone who&amp;#39;s been running a 2500k GPU at 1...</title><content type='html'>as someone who&amp;#39;s been running a 2500k GPU at 1.4ghz on the Ubuntu dev branch for the past several months, no more compositor hangs is something I&amp;#39;m very excited about.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5100670050437314612/comments/default/2444951284886256844'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5100670050437314612/comments/default/2444951284886256844'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html?showComment=1366400271387#c2444951284886256844' title=''/><author><name>Alex</name><uri>https://www.blogger.com/profile/01502003513477922734</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='24' src='//2.bp.blogspot.com/__u3iuw74z2o/S4n0DQBBchI/AAAAAAAAAEM/pP8lA2EwAW4/S220-s32/cr.png'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5100670050437314612' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5100670050437314612' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1683069445'/><gd:extendedProperty name='blogger.displayTime' value='April 19, 2013 at 12:37 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-865554949474994190</id><published>2013-05-25T11:10:23.367-07:00</published><updated>2013-05-25T11:10:23.367-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Waiting for 3.10 with irq storm mitigation, my T40...</title><content type='html'>Waiting for 3.10 with irq storm mitigation, my T400 is almost unusable with 3.9... I&amp;#39;m using 3.2 with drm_kms_helper.poll=0 for now...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5100670050437314612/comments/default/865554949474994190'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5100670050437314612/comments/default/865554949474994190'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html?showComment=1369505423367#c865554949474994190' title=''/><author><name>Jan Niggemann</name><uri>https://www.blogger.com/profile/01658615779543379625</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//lh5.googleusercontent.com/-pB1aiWMtm58/AAAAAAAAAAI/AAAAAAAADuk/mFlpFe5l1ng/s32-c/photo.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/04/neat-drmi915-stuff-for-310.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5100670050437314612' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5100670050437314612' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-699180897'/><gd:extendedProperty name='blogger.displayTime' value='May 25, 2013 at 11:10 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5135335944222124745</id><published>2013-06-17T22:31:27.977-07:00</published><updated>2013-06-17T22:31:27.977-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi Daniel ,
How do you ensure that objects which a...</title><content type='html'>Hi Daniel ,&lt;br /&gt;How do you ensure that objects which are currently bound to the GTT are locked in RAM ie they cannot be swapped out , Do you use something like SetPageReserved, lock_page() etc to ensure that .&lt;br /&gt;&lt;br /&gt;All these pages which are allocated using shmem_read_page func having backing store and which are marked_accessed_page() and whose dirty bit in page is set are liable to be swapped out .&lt;br /&gt;What happens if they are in GTT about to be refereed by GPU and suddenly the pages gets swapped out , the underlying page gets allocated to another process and it writes on it   </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/5135335944222124745'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/5135335944222124745'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html?showComment=1371533487977#c5135335944222124745' title=''/><author><name>dkdeepani</name><uri>https://www.blogger.com/profile/01709222693780550423</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7810278808977755614' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7810278808977755614' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-408695315'/><gd:extendedProperty name='blogger.displayTime' value='June 17, 2013 at 10:31 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3004689915192213588</id><published>2013-06-17T23:26:03.700-07:00</published><updated>2013-06-17T23:26:03.700-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>We grab a page reference to make sure it doesn&amp;#39...</title><content type='html'>We grab a page reference to make sure it doesn&amp;#39;t disappear. So essentially to the core kernel it looks like i915.ko is doing really long-lived I/O ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/3004689915192213588'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/3004689915192213588'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html?showComment=1371536763700#c3004689915192213588' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/5135335944222124745'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7810278808977755614' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7810278808977755614' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='June 17, 2013 at 11:26 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4010348885790480305</id><published>2013-06-19T22:17:00.763-07:00</published><updated>2013-06-19T22:17:00.763-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thanks Dan 
Are the VM_IO and VM_Reserved vma flag...</title><content type='html'>Thanks Dan &lt;br /&gt;Are the VM_IO and VM_Reserved vma flags which do provide immunity to swapping , Please do correct and suggest the correct semantics used by the i915 .&lt;br /&gt;&lt;br /&gt;Now what about the opposite condition when same object needs to be deliberatly swapped out as it not needed by GPU in current rendering and is out of GTT at the time of low memory pressure.&lt;br /&gt;&lt;br /&gt;The TTM driver looks like is swapping out an object with &lt;br /&gt;to_page = shmem_read_mapping_page(swap_space, i);&lt;br /&gt;set_page_dirty(to_page);&lt;br /&gt;mark_page_accessed(to_page);&lt;br /&gt;page_cache_release(to_page);&lt;br /&gt;&lt;br /&gt;Looks like the i915 is doing similar from the memory shrinker where it tries to free the object &amp;amp; in process does the following &lt;br /&gt;set_page_dirty(to_page);&lt;br /&gt;mark_page_accessed(to_page);&lt;br /&gt;page_cache_release(to_page);&lt;br /&gt;&lt;br /&gt;Please correct the understanding .  &lt;br /&gt;&lt;br /&gt;&lt;br /&gt; </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/4010348885790480305'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7810278808977755614/comments/default/4010348885790480305'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html?showComment=1371705420763#c4010348885790480305' title=''/><author><name>dkdeepani</name><uri>https://www.blogger.com/profile/01709222693780550423</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7810278808977755614' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7810278808977755614' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-408695315'/><gd:extendedProperty name='blogger.displayTime' value='June 19, 2013 at 10:17 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1774383897313672880</id><published>2013-07-07T18:50:19.882-07:00</published><updated>2013-07-07T18:50:19.882-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>The backports project supports drm too. Any reason...</title><content type='html'>The backports project supports drm too. Any reason why it can&amp;#39;t be used ?&lt;br /&gt;&lt;br /&gt;https://backports.wiki.kernel.org/index.php/Main_Page</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2605807993115082017/comments/default/1774383897313672880'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2605807993115082017/comments/default/1774383897313672880'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html?showComment=1373248219882#c1774383897313672880' title=''/><author><name>Sujith</name><uri>https://www.blogger.com/profile/05362729521831274852</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2605807993115082017' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2605807993115082017' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-990466514'/><gd:extendedProperty name='blogger.displayTime' value='July 7, 2013 at 6:50 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7914826611285381071</id><published>2013-07-08T12:29:10.701-07:00</published><updated>2013-07-08T12:29:10.701-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>If my understanding is correct the backporting pro...</title><content type='html'>If my understanding is correct the backporting project simply copies drivers from the latest upstream git and applyies some compat magic to make them work. This here is all about preserving the git history, which the copying would kill.&lt;br /&gt;&lt;br /&gt;Like I&amp;#39;ve said it&amp;#39;s all for a bit dubious reasons, and personally I&amp;#39;d prefer a copy approach like the backport project uses ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2605807993115082017/comments/default/7914826611285381071'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2605807993115082017/comments/default/7914826611285381071'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html?showComment=1373311750701#c7914826611285381071' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2605807993115082017/comments/default/1774383897313672880'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/07/on-forklifting-and-pitchforks.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2605807993115082017' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2605807993115082017' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='July 8, 2013 at 12:29 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2787237211953981921</id><published>2013-09-12T10:26:18.304-07:00</published><updated>2013-09-12T10:26:18.304-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Curious to know about ability to handle 10bpc with...</title><content type='html'>Curious to know about ability to handle 10bpc with Iris Graphics (as Deep Color capability shown in section 2.6 of Datasheet vol 1) for all these machines with onboard DisplayPort, HDMI or ThunderBolt connectors....&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/2787237211953981921'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/2787237211953981921'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html?showComment=1379006778304#c2787237211953981921' title=''/><author><name>Christopher Quarksnow</name><uri>https://www.blogger.com/profile/09409578144231815314</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7576649732790701078' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7576649732790701078' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554093632'/><gd:extendedProperty name='blogger.displayTime' value='September 12, 2013 at 10:26 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5977363963815468976</id><published>2013-09-12T13:46:25.745-07:00</published><updated>2013-09-12T13:46:39.751-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by the author.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/5977363963815468976'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/5977363963815468976'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7576649732790701078' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7576649732790701078' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='September 12, 2013 at 1:46 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3606634835007952796</id><published>2013-09-12T13:46:49.872-07:00</published><updated>2013-09-12T13:46:49.872-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Should work with DP (if you ignore that we&amp;#39;re ...</title><content type='html'>Should work with DP (if you ignore that we&amp;#39;re a bit sloppy with exposing the high-depth gamma table) and the code is there for HDMI. But for HDMI I haven&amp;#39;t really tested it yet, so ymmv.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/3606634835007952796'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/3606634835007952796'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html?showComment=1379018809872#c3606634835007952796' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7576649732790701078/comments/default/2787237211953981921'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/09/neat-drmi915-stuff-for-312.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7576649732790701078' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7576649732790701078' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='September 12, 2013 at 1:46 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5710417197773629863</id><published>2013-11-03T00:12:30.524-07:00</published><updated>2013-11-03T00:12:30.524-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Great...

Also notices somewhere in the last few k...</title><content type='html'>Great...&lt;br /&gt;&lt;br /&gt;Also notices somewhere in the last few kernel releases our old 965GM based systems improved. They now default to Linux (from win xp)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/5710417197773629863'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/5710417197773629863'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html?showComment=1383462750524#c5710417197773629863' title=''/><author><name>John</name><uri>https://www.blogger.com/profile/10433530558102163698</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2495710684294338878' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2495710684294338878' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-857802354'/><gd:extendedProperty name='blogger.displayTime' value='November 3, 2013 at 12:12 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5013472121906951618</id><published>2013-11-05T03:53:12.624-08:00</published><updated>2013-11-05T03:53:12.624-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Nice news!</title><content type='html'>Nice news!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/5013472121906951618'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/5013472121906951618'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html?showComment=1383652392624#c5013472121906951618' title=''/><author><name>Sergei Chudakov</name><uri>https://www.blogger.com/profile/09442707604459344112</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//lh4.googleusercontent.com/-pI8SG7IYM_A/AAAAAAAAAAI/AAAAAAAAArw/Xjs1mlG6xZQ/s32-c/photo.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2495710684294338878' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2495710684294338878' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-892771464'/><gd:extendedProperty name='blogger.displayTime' value='November 5, 2013 at 3:53 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1075622639198590218</id><published>2013-11-12T06:37:22.945-08:00</published><updated>2013-11-12T06:37:22.945-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Please fix critical bug: https://bugs.launchpad.ne...</title><content type='html'>Please fix critical bug: https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1199345</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/1075622639198590218'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2495710684294338878/comments/default/1075622639198590218'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html?showComment=1384267042945#c1075622639198590218' title=''/><author><name>Алена Чудакова</name><uri>https://www.blogger.com/profile/16876036895748044231</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/11/its-that-time-again-when-old-kernel-v3.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2495710684294338878' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2495710684294338878' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1271702173'/><gd:extendedProperty name='blogger.displayTime' value='November 12, 2013 at 6:37 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4353081911079619535</id><published>2013-11-24T01:36:56.256-08:00</published><updated>2013-11-24T01:36:56.256-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi, could you elaborate on why &amp;quot;Use __s64 sec...</title><content type='html'>Hi, could you elaborate on why &amp;quot;Use __s64 seconds plus __u64 nanoseconds to specify time,&amp;quot; particularly the unsigned nanoseconds rather than signed?&lt;br /&gt;&lt;br /&gt;When you mix signed with unsigned, does that not require careful casting to the same signedness (and then back) every time when computing with timestamps?&lt;br /&gt;Why 64 bits for nanoseconds, when __s32 would be enough?&lt;br /&gt;&lt;br /&gt;A great post!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5812434027313869869/comments/default/4353081911079619535'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5812434027313869869/comments/default/4353081911079619535'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html?showComment=1385285816256#c4353081911079619535' title=''/><author><name>pq</name><uri>https://www.blogger.com/profile/06263850515835057642</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='20' src='//2.bp.blogspot.com/-5_dPQMOjo0k/T37oqOCtG-I/AAAAAAAAAB8/6AEpdRVxrME/s32/cat-128px.png'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5812434027313869869' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5812434027313869869' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1840003915'/><gd:extendedProperty name='blogger.displayTime' value='November 24, 2013 at 1:36 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2810750662430883102</id><published>2013-11-24T05:01:12.171-08:00</published><updated>2013-11-24T05:01:12.171-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Like I&amp;#39;ve said we don&amp;#39;t have the perfect i...</title><content type='html'>Like I&amp;#39;ve said we don&amp;#39;t have the perfect ioctl yet in the drm/i915 driver - the wait ioctl atm only accepts a relative timeout. And for that an unsigned 64 bit value is the right choice. But relative timeouts have issues with restarting.&lt;br /&gt;&lt;br /&gt;Now for absolute times the (seconds, nanoseconds) seems to be the established split. I&amp;#39;ve opted for unsigned nanoseconds since we&amp;#39;ve actually manged to blow this up once already with a relative timeout: The code waited only for a full second at most in a loop (to catch stuck hardware timely) and then ended up waiting a bit too long for the remaining time due to a botched signed-to-unsigned conversion. Not sure whether this is worth it since int the kernel you should do everything through the ktime api anyway - hence there should be no signed bugs possible (at least if you check for normalized nanoseconds) since you only convert the userspace input into struct ktime once. So the unsigned is just to make input validation a bit simpler, adding an explicit nsecs &amp;gt;= 0 check and using signed nanoseconds is also valid I&amp;#39;d say.&lt;br /&gt;&lt;br /&gt;The 64bit overkill is just to avoid mishaps with padding and alignment. Wasting 32bit is imo ok, and as long as you properly check for normalized times you can reuse the upper 32bit later on for flags or other stuff.&lt;br /&gt;&lt;br /&gt;But like I&amp;#39;ve said we haven&amp;#39;t reached nirvana on this topic, so I can&amp;#39;t yet tell you how this will blow up exactly - I only know how all the past attempts fell short ;-) Looking at other ioctls and syscalls getting timeouts right seems to be pretty hard - but as long as you support nanosecond resolution, absolute timeouts and use a monotonic reference clock (and let userspace know which one it is) you should be avoid the most egregious pitfalls.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5812434027313869869/comments/default/2810750662430883102'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5812434027313869869/comments/default/2810750662430883102'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html?showComment=1385298072171#c2810750662430883102' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5812434027313869869/comments/default/4353081911079619535'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2013/11/botching-up-ioctls.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5812434027313869869' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5812434027313869869' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='November 24, 2013 at 5:01 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8193945343769332372</id><published>2014-01-16T22:31:50.148-08:00</published><updated>2014-01-16T22:31:50.148-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>AIUI, you definitely want fbdev support when using...</title><content type='html'>AIUI, you definitely want fbdev support when using kmscon. In the event that kms craps out, you need a stable, reliable fallback. kmscon supports fbdev as that fallback.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/8193945343769332372'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/8193945343769332372'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1389940310148#c8193945343769332372' title=''/><author><name>CamBam</name><uri>https://www.blogger.com/profile/12229133491911251323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-913967274'/><gd:extendedProperty name='blogger.displayTime' value='January 16, 2014 at 10:31 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1131041293348658043</id><published>2014-01-16T23:17:23.643-08:00</published><updated>2014-01-16T23:17:23.643-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>fbdev is useful as a fallback for hardware without...</title><content type='html'>fbdev is useful as a fallback for hardware without kms drivers. But if you have a kms driver the fb device exposed is just a wrapper around the underlying kms driver. So not useful as a fallback at all. But on a lot of embedded systems there&amp;#39;s no legacy userspace which requires and fbdev emulation to work, so it&amp;#39;s useful to be able to compile out all that code. Linux distros otoh use fbdev e.g. for boot-splashs still.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1131041293348658043'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1131041293348658043'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1389943043643#c1131041293348658043' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/8193945343769332372'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='January 16, 2014 at 11:17 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2653760403788390466</id><published>2014-01-17T02:23:54.270-08:00</published><updated>2014-01-17T02:23:54.270-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>&amp;gt; Another new&amp;amp;nifty kernel option disables ...</title><content type='html'>&amp;gt; Another new&amp;amp;nifty kernel option disables the legacy fbdev support.&lt;br /&gt;&lt;br /&gt;I&amp;#39;m missing something here. What&amp;#39;s the difference to DRM_I915_FBDEV, that afaics already landed in 3.13? http://git.kernel.org/linus/4520f53a159fb81b8c27afe52428a0959aff259c</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/2653760403788390466'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/2653760403788390466'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1389954234270#c2653760403788390466' title=''/><author><name>Thorsten Leemhuis</name><uri>https://www.blogger.com/profile/12285919704852601523</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1452491467'/><gd:extendedProperty name='blogger.displayTime' value='January 17, 2014 at 2:23 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4854897989386613862</id><published>2014-01-17T04:58:20.955-08:00</published><updated>2014-01-17T04:58:20.955-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Indeed, I&amp;#39;ve somehow missed that this has land...</title><content type='html'>Indeed, I&amp;#39;ve somehow missed that this has landed already. But we&amp;#39;ve merged a few fixes from Chris Wilson to make the vga handover a bit more robust in 3.14 with fbdev disabled, so I&amp;#39;d say it still counts a bit ;-)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/4854897989386613862'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/4854897989386613862'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1389963500955#c4854897989386613862' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/2653760403788390466'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='January 17, 2014 at 4:58 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-437875919776863064</id><published>2014-02-04T05:16:44.558-08:00</published><updated>2014-02-04T05:16:44.558-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I think you need to fix the permissions on the ODP...</title><content type='html'>I think you need to fix the permissions on the ODP file... Great talk by the way.&lt;br /&gt;&lt;br /&gt;Regards,&lt;br /&gt;&lt;br /&gt;Michael</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5608395435030887397/comments/default/437875919776863064'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5608395435030887397/comments/default/437875919776863064'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html?showComment=1391519804558#c437875919776863064' title=''/><author><name>michaeljt</name><uri>https://launchpad.net/~michaeljt</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img1.blogblog.com/img/openid16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5608395435030887397' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5608395435030887397' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-412358719'/><gd:extendedProperty name='blogger.displayTime' value='February 4, 2014 at 5:16 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5202749009768224643</id><published>2014-02-04T06:17:47.303-08:00</published><updated>2014-02-04T06:17:47.303-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Oops, indeed. Should be fixed now.</title><content type='html'>Oops, indeed. Should be fixed now.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5608395435030887397/comments/default/5202749009768224643'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5608395435030887397/comments/default/5202749009768224643'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html?showComment=1391523467303#c5202749009768224643' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5608395435030887397/comments/default/437875919776863064'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/02/fosdem-testing-kernel-gpu-drivers.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5608395435030887397' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5608395435030887397' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='February 4, 2014 at 6:17 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1857621540635994245</id><published>2014-02-11T05:18:24.826-08:00</published><updated>2014-02-11T05:18:24.826-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Wondering if 3.13 might fix my issues. I am curren...</title><content type='html'>Wondering if 3.13 might fix my issues. I am currently trying out an Asus zenbook UX302LA-BHI5T08 with i5-4200U\Intel 4400 graphics. Using kernel 3.12.9-2 (Arch), I currently have to use i915.modeset=0 to see anything a boot, even a just the command line. I have been searching all over and reading up on the i915 drivers changes and issues with haswell CPUs. Even watched a couple of your vids on this topic from late 2012. I have been trying different kernel parameters to get this thing booting with the proper 1920x1080  resolution (acpi_backlight=vendor etc.), but haven&amp;#39;t found a single param or combination of param that work.What kernel params would you try on this laptop to get things working? Would 3.13 be more likely to work?&lt;br /&gt;&lt;br /&gt;Older kernels do work (Ubuntu 12-based distros I tried), but then I don&amp;#39;t have wireless support for Wireless-AC haha! 800x600 might be worse thought LOL.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1857621540635994245'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1857621540635994245'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1392124704826#c1857621540635994245' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03303294859169407736</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-529729718'/><gd:extendedProperty name='blogger.displayTime' value='February 11, 2014 at 5:18 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4211039107605244951</id><published>2014-02-11T20:29:25.094-08:00</published><updated>2014-02-11T20:29:25.094-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Update: I threw on 3.14-rc2 and everything is now ...</title><content type='html'>Update: I threw on 3.14-rc2 and everything is now working great now without ANY extra kernel params. I have 1920x1080 and brightness control. Keep up the great work on drm/i915 stuff!</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/4211039107605244951'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/4211039107605244951'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1392179365094#c4211039107605244951' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1857621540635994245'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/03303294859169407736</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-529729718'/><gd:extendedProperty name='blogger.displayTime' value='February 11, 2014 at 8:29 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5936850176995227573</id><published>2014-02-11T22:09:55.978-08:00</published><updated>2014-06-11T06:26:39.672-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by a blog administrator.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/5936850176995227573'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/5936850176995227573'/><author><name>Yanuariko</name><uri>https://www.blogger.com/profile/12781265305462870633</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='14' height='32' src='//1.bp.blogspot.com/-YBqvggKuXwg/UqwjCt3k7LI/AAAAAAAAANk/f7Q-71y4ykE/s32/profile%2Bku.JPG'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-1607795019'/><gd:extendedProperty name='blogger.displayTime' value='February 11, 2014 at 10:09 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2502802448660707068</id><published>2014-02-13T15:29:07.274-08:00</published><updated>2014-02-13T15:29:07.274-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Awesome, always nice to hear that we&amp;#39;re making...</title><content type='html'>Awesome, always nice to hear that we&amp;#39;re making progress. Please keep on testing and file a bug report if anything breaks, we take regressions extremely serious. It&amp;#39;s the only way to have some assurance that we&amp;#39;re indeed improving and not just running in circles</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/2502802448660707068'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/2502802448660707068'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html?showComment=1392334147274#c2502802448660707068' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/7722245516833600559/comments/default/1857621540635994245'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/01/neat-drmi915-stuff-for-314.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-7722245516833600559' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/7722245516833600559' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='February 13, 2014 at 3:29 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-9120254156842884606</id><published>2014-06-10T06:20:57.947-07:00</published><updated>2014-06-10T06:20:57.947-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey Daniel, thanks for the write-up!

What about P...</title><content type='html'>Hey Daniel, thanks for the write-up!&lt;br /&gt;&lt;br /&gt;What about PPGTT? Did the team manage to iron out the bugs that prevented it to be enabled by default in 3.15? Is it on by default on 3.16?&lt;br /&gt;&lt;br /&gt;Thanks</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/9120254156842884606'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/9120254156842884606'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html?showComment=1402406457947#c9120254156842884606' title=''/><author><name>mupuf</name><uri>https://www.blogger.com/profile/17157987837111564920</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1326050572154159414' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1326050572154159414' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-492728153'/><gd:extendedProperty name='blogger.displayTime' value='June 10, 2014 at 6:20 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1362432283755506590</id><published>2014-06-10T11:00:01.495-07:00</published><updated>2014-06-10T11:00:01.495-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Still disabled in 3.15&amp;amp;3.16. Since I&amp;#39;m not...</title><content type='html'>Still disabled in 3.15&amp;amp;3.16. Since I&amp;#39;m not doing project management no predictions when it&amp;#39;s fixed.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/1362432283755506590'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/1362432283755506590'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html?showComment=1402423201495#c1362432283755506590' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/9120254156842884606'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1326050572154159414' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1326050572154159414' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='June 10, 2014 at 11:00 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6120826152665764577</id><published>2014-06-15T07:38:50.789-07:00</published><updated>2014-06-15T07:38:50.789-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>ACK, thanks.</title><content type='html'>ACK, thanks.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/6120826152665764577'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/6120826152665764577'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html?showComment=1402843130789#c6120826152665764577' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1326050572154159414/comments/default/9120254156842884606'/><author><name>mupuf</name><uri>https://www.blogger.com/profile/17157987837111564920</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/06/neat-drmi915-stuff-for-316.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1326050572154159414' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1326050572154159414' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-492728153'/><gd:extendedProperty name='blogger.displayTime' value='June 15, 2014 at 7:38 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5060700788765225032</id><published>2014-07-10T23:42:27.739-07:00</published><updated>2014-07-14T02:19:00.842-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by a blog administrator.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5069398136577877315/comments/default/5060700788765225032'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5069398136577877315/comments/default/5060700788765225032'/><author><name>Roy kher</name><uri>https://www.blogger.com/profile/05111052858061047658</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/04/neat-drmi915-stuff-for-315.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5069398136577877315' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5069398136577877315' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-1183558696'/><gd:extendedProperty name='blogger.displayTime' value='July 10, 2014 at 11:42 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7205119715409092102</id><published>2014-07-11T02:44:12.293-07:00</published><updated>2014-07-14T02:19:11.608-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by a blog administrator.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5069398136577877315/comments/default/7205119715409092102'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5069398136577877315/comments/default/7205119715409092102'/><author><name>Cals thave</name><uri>https://www.blogger.com/profile/09384307578713253377</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/04/neat-drmi915-stuff-for-315.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5069398136577877315' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5069398136577877315' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-275976157'/><gd:extendedProperty name='blogger.displayTime' value='July 11, 2014 at 2:44 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6122994294539773593</id><published>2014-08-01T22:47:40.147-07:00</published><updated>2014-08-01T22:47:40.147-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Whats the command buffer submission granularity he...</title><content type='html'>Whats the command buffer submission granularity here? Draw call boundary or Render Pass boundary or whenever the user buffer fills up. Can you have Render to Texture dependencies within the same Command submission?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/6122994294539773593'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/6122994294539773593'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1406958460147#c6122994294539773593' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04235452983694120262</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554045282'/><gd:extendedProperty name='blogger.displayTime' value='August 1, 2014 at 10:47 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2845100529878838652</id><published>2014-08-02T18:13:24.020-07:00</published><updated>2014-08-02T18:13:24.020-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>What are the Fenced register reads from the CPU us...</title><content type='html'>What are the Fenced register reads from the CPU used for? Can&amp;#39;t you just blit from the GPU (from tiled memory to non tiled memory) and have CPU read the latter?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/2845100529878838652'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/2845100529878838652'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html?showComment=1407028404020#c2845100529878838652' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04235452983694120262</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554045282'/><gd:extendedProperty name='blogger.displayTime' value='August 2, 2014 at 6:13 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7928787478180893656</id><published>2014-08-03T12:49:32.890-07:00</published><updated>2014-08-03T12:49:32.890-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>The granularity is a driver heuristics trying to o...</title><content type='html'>The granularity is a driver heuristics trying to optimize between latency (i.e. flush the command buffer often) and throughput. It&amp;#39;s at least one drawcall, but could be a lot more than a render pass.&lt;br /&gt;&lt;br /&gt;The command buffers gets flushed only on fence waits, glflush or when the cpu reads back from a render buffer. For render to texture the driver internally keeps track of renderbuffers and inserts a pipeline cache flush within the current command buffer for coherency (so doesn&amp;#39;t stall otherwise nor for a full command buffer flush).</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/7928787478180893656'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/7928787478180893656'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1407095372890#c7928787478180893656' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/6122994294539773593'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 3, 2014 at 12:49 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2707849937195730217</id><published>2014-08-03T12:51:01.004-07:00</published><updated>2014-08-03T12:51:01.004-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Yeah you could replace them all with blts to until...</title><content type='html'>Yeah you could replace them all with blts to untiled memory (and on most platforms there are some means to blit to cpu coherent memory too). So direct cpu reads to fenced regions are just used for slowpath/fallback code if there&amp;#39;s no optimized code written yet.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/2707849937195730217'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/2707849937195730217'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html?showComment=1407095461004#c2707849937195730217' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/4553523947071081750/comments/default/2845100529878838652'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/10/i915gem-crashcourse.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-4553523947071081750' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/4553523947071081750' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 3, 2014 at 12:51 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2650535393005948097</id><published>2014-08-04T16:06:44.814-07:00</published><updated>2014-08-04T16:06:44.814-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Got it. 

&amp;gt;&amp;gt; and inserts a pipeline cache fl...</title><content type='html'>Got it. &lt;br /&gt;&lt;br /&gt;&amp;gt;&amp;gt; and inserts a pipeline cache flush within the current command&lt;br /&gt;&amp;gt;&amp;gt; buffer for coherency&lt;br /&gt;&lt;br /&gt;Can I press for a bit more details here if you are comfortable sharing this level of HW detail.&lt;br /&gt;&lt;br /&gt;So Render-texture or Transform-Feedback setup Producer Consumer relationship between Draw calls. There is a Cache Visibility issue (as you pointed out) and there is a Stall that needs to be implemented somewhere. Essentially to prevent the shader threads of the second draw call  from starting before the shader threads of the first have completed and written out to whatever the point of coherence is.&lt;br /&gt;&lt;br /&gt;My question being this, at what point in the pipeline is this being enforced. Is it the Command Streamer that enforces the cache_flush + stall because of some commands you have encoded, is it a Firmware layer in there somewhere doing this or do the EUs have a mechanism to mark certain threads as blocked until signaled otherwise.&lt;br /&gt;&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/2650535393005948097'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/2650535393005948097'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1407193604814#c2650535393005948097' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/6122994294539773593'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04235452983694120262</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554045282'/><gd:extendedProperty name='blogger.displayTime' value='August 4, 2014 at 4:06 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2396142354782906936</id><published>2014-08-04T16:58:11.937-07:00</published><updated>2014-08-04T16:58:11.937-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>In defense of this strategy, Relocation tables are...</title><content type='html'>In defense of this strategy, Relocation tables are perfectly fine for GPUs IMO. Though Relocation tables are best implemented using Segments not Page Tables since using a single address space leaves you vulnerable to Security issues across separate processes.&lt;br /&gt;&lt;br /&gt;Even when you have a Fast switching MMU and/or 40-bit address space, I would generally vouch for using a single address space for Graphics (atleast) Reason being, Page Tables require a lot of memory of their own especially when you have more than 2 levels of page tables. Consider storing 3 512K textures in 3 separate address spaces. You would allocate first level, second level and third level page directory(tables) for each address space. With a single address space you do the first 3 level allocations just once. &lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/2396142354782906936'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/2396142354782906936'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1407196691937#c2396142354782906936' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/8990725502756256939'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04235452983694120262</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554045282'/><gd:extendedProperty name='blogger.displayTime' value='August 4, 2014 at 4:58 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-618800934318673884</id><published>2014-08-05T01:05:32.453-07:00</published><updated>2014-08-05T01:05:32.453-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey, we have a full open-source driver with public...</title><content type='html'>Hey, we have a full open-source driver with public docs. It&amp;#39;s all there, so I have no problem explaining how it works ;-)&lt;br /&gt;&lt;br /&gt;The flush is at the command parser level but at least to some extend (the newer your chip the more) internally pipeline and asynchronous. If you want to see the details look at the PIPE_CONTROL command in the public PRM:&lt;br /&gt;&lt;br /&gt;https://01.org/linuxgraphics/documentation</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/618800934318673884'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/618800934318673884'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1407225932453#c618800934318673884' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/6122994294539773593'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 5, 2014 at 1:05 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6900876644568278365</id><published>2014-08-07T09:47:21.947-07:00</published><updated>2014-08-07T09:47:21.947-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Thank you for the summary. Personally, I&amp;#39;m loo...</title><content type='html'>Thank you for the summary. Personally, I&amp;#39;m looking forward to DisplayPort MST support (required for my docking station) that seems to be part of 3.17 as well.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3223799358281583581/comments/default/6900876644568278365'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3223799358281583581/comments/default/6900876644568278365'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html?showComment=1407430041947#c6900876644568278365' title=''/><author><name>Steffen Weber</name><uri>https://www.blogger.com/profile/16399610489555689619</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3223799358281583581' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3223799358281583581' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1085449617'/><gd:extendedProperty name='blogger.displayTime' value='August 7, 2014 at 9:47 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8128019502178357564</id><published>2014-08-07T10:03:28.528-07:00</published><updated>2014-08-07T10:03:28.528-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Oh right, forgotten about that - Dave Airlie sneak...</title><content type='html'>Oh right, forgotten about that - Dave Airlie sneaked that in over my objections since I&amp;#39;ve thought it needs a bit more polish ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3223799358281583581/comments/default/8128019502178357564'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3223799358281583581/comments/default/8128019502178357564'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html?showComment=1407431008528#c8128019502178357564' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/08/neat-stuff-for-317.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3223799358281583581' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3223799358281583581' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='August 7, 2014 at 10:03 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-5521548668367108602</id><published>2014-08-09T10:03:20.342-07:00</published><updated>2014-08-09T10:03:20.342-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I am curious how Pixel Sync works for Haswell
http...</title><content type='html'>I am curious how Pixel Sync works for Haswell&lt;br /&gt;https://software.intel.com/en-us/blogs/2013/03/27/programmable-blend-with-pixel-shader-ordering&lt;br /&gt;&lt;br /&gt;Are there smarts in the EU to say have Lane 2 out of the 8 SIMD lanes be masked out (similar to what branches in a shader would do) to prevent concurrent execution with another fragment at the same pixel from a different primitive? &lt;br /&gt;&lt;br /&gt;This would require elaborate Scoreboarding or per fragment resource tracking in Hw.&lt;br /&gt;&lt;br /&gt;Or is there a big hammer synchronization at the top of the flight where primitives are fragment shaded one at a time.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/5521548668367108602'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1685551924522514150/comments/default/5521548668367108602'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html?showComment=1407603800342#c5521548668367108602' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/04235452983694120262</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2012/11/i915gem-crashcourse-part-2.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1685551924522514150' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1685551924522514150' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-554045282'/><gd:extendedProperty name='blogger.displayTime' value='August 9, 2014 at 10:03 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1516867636514455948</id><published>2014-11-03T14:19:00.652-08:00</published><updated>2014-11-03T14:19:00.652-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Just a quick update: Fixing the per-plane locking ...</title><content type='html'>Just a quick update: Fixing the per-plane locking turned out to be fairly simple, patches are on dri-devel already.&lt;br /&gt;&lt;br /&gt;The thing I&amp;#39;ve not mentioned is that I&amp;#39;ve completed put the locking implications of the real atomic ioctl under the rug here. With the atomic locking we wont/cant grab the mode_config.mutex any more, and that&amp;#39;s the same which protects all the probe state. Lots of drivers funnel some information about sink features from the probe code to the modeset code, and that&amp;#39;s all racy in the new world. But alas that only happens with the real atomic ioctl, which isn&amp;#39;t there. All the legacy/compat code does not suffer from this.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/8822981517130755067/comments/default/1516867636514455948'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/8822981517130755067/comments/default/1516867636514455948'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html?showComment=1415053140652#c1516867636514455948' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/11/atomic-modeset-support-for-kms-drivers.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-8822981517130755067' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/8822981517130755067' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='November 3, 2014 at 2:19 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4821297932787613930</id><published>2014-12-28T05:48:01.789-08:00</published><updated>2014-12-28T11:26:32.096-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by the author.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/4821297932787613930'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/4821297932787613930'/><author><name>Unknown</name><uri>https://www.blogger.com/profile/12523164575031487555</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-300813769'/><gd:extendedProperty name='blogger.displayTime' value='December 28, 2014 at 5:48 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-572263868886377600</id><published>2014-12-28T11:26:20.751-08:00</published><updated>2014-12-28T11:26:20.751-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hey, Daniel! Happy Holidays! :)

Do you think I wo...</title><content type='html'>Hey, Daniel! Happy Holidays! :)&lt;br /&gt;&lt;br /&gt;Do you think I would see any graphics improvements by migrating from kernel 3.16 to a newer one for my Atom D410 (GMA 3150)? Or which kernel would be best suited for this little CPU?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/572263868886377600'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/572263868886377600'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html?showComment=1419794780751#c572263868886377600' title=''/><author><name>Nicolae Crefelean</name><uri>https://www.blogger.com/profile/12523164575031487555</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//3.bp.blogspot.com/-ZIgouJtd8uc/VKBZGzW98FI/AAAAAAAAAJw/sO48_uqh1KY/s32/IMG_4735_500px.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-300813769'/><gd:extendedProperty name='blogger.displayTime' value='December 28, 2014 at 11:26 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1370382637111956866</id><published>2015-01-04T08:49:59.844-08:00</published><updated>2015-01-04T08:49:59.844-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>3.20 will have gpu reset support for your generati...</title><content type='html'>3.20 will have gpu reset support for your generation. Otherwise nothing really big for your chip in the past few releases afair. Of course, upgrading just to test that everything still works well is always appreciated.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/1370382637111956866'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/1370382637111956866'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html?showComment=1420390199844#c1370382637111956866' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/572263868886377600'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='January 4, 2015 at 8:49 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-3264952725410857838</id><published>2015-01-08T16:25:47.218-08:00</published><updated>2015-01-08T16:25:47.218-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;ll be happy to test it again and offer feedb...</title><content type='html'>I&amp;#39;ll be happy to test it again and offer feedback. :) Which is the right place to place my feedback and is there anything else I can do for better testing?&lt;br /&gt;&lt;br /&gt;Thanks for your reply and Happy New Year! :)&lt;br /&gt;Nick</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/3264952725410857838'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/3264952725410857838'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html?showComment=1420763147218#c3264952725410857838' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/572263868886377600'/><author><name>Nicolae Crefelean</name><uri>https://www.blogger.com/profile/12523164575031487555</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//3.bp.blogspot.com/-ZIgouJtd8uc/VKBZGzW98FI/AAAAAAAAAJw/sO48_uqh1KY/s32/IMG_4735_500px.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-300813769'/><gd:extendedProperty name='blogger.displayTime' value='January 8, 2015 at 4:25 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8920025527802327617</id><published>2015-01-09T00:38:44.741-08:00</published><updated>2015-01-09T00:38:44.741-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>If anything breaks please file a bug report agains...</title><content type='html'>If anything breaks please file a bug report against DRI -&amp;gt; DRM (Intel) on bugs.freedesktop.org. For testing just run it in daily use - the more different setups run the latest code the better for testing.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/8920025527802327617'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/8920025527802327617'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html?showComment=1420792724741#c8920025527802327617' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6057911954792525149/comments/default/572263868886377600'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2014/12/neat-drmi915-stuff-for-319.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6057911954792525149' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6057911954792525149' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='January 9, 2015 at 12:38 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1456734006021225234</id><published>2015-01-29T15:12:31.177-08:00</published><updated>2015-01-29T15:12:31.177-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>&amp;quot;hysterical raisins&amp;quot; should perhaps be &amp;...</title><content type='html'>&amp;quot;hysterical raisins&amp;quot; should perhaps be &amp;quot;historical reasons&amp;quot;. However I&amp;#39;m not sure if it is an auto correct issue or deliberate.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9029048282758780689/comments/default/1456734006021225234'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9029048282758780689/comments/default/1456734006021225234'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html?showComment=1422573151177#c1456734006021225234' title=''/><author><name>Darren Jenkins</name><uri>https://www.blogger.com/profile/17441849419169886054</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='32' height='32' src='//lh5.googleusercontent.com/-zuUr6dqWdL0/AAAAAAAAAAI/AAAAAAAAAVE/ooR14Ap2aJE/s32-c/photo.jpg'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-9029048282758780689' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/9029048282758780689' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1357259148'/><gd:extendedProperty name='blogger.displayTime' value='January 29, 2015 at 3:12 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1246857050703128931</id><published>2015-01-30T05:19:03.327-08:00</published><updated>2015-01-30T05:19:03.327-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>&amp;quot;hysterical raisins&amp;quot; is always deliberat...</title><content type='html'>&amp;quot;hysterical raisins&amp;quot; is always deliberate</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9029048282758780689/comments/default/1246857050703128931'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9029048282758780689/comments/default/1246857050703128931'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html?showComment=1422623943327#c1246857050703128931' title=''/><author><name>Timo</name><uri>https://www.blogger.com/profile/08514218440159967492</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/01/update-for-atomic-display-updates.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-9029048282758780689' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/9029048282758780689' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-351634291'/><gd:extendedProperty name='blogger.displayTime' value='January 30, 2015 at 5:19 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8393634158064199085</id><published>2015-02-12T09:36:27.384-08:00</published><updated>2015-02-12T09:36:27.384-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>&amp;quot;Patches for from Ville...&amp;quot; ??</title><content type='html'>&amp;quot;Patches for from Ville...&amp;quot; ??</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/746164648252083417/comments/default/8393634158064199085'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/746164648252083417/comments/default/8393634158064199085'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html?showComment=1423762587384#c8393634158064199085' title=''/><author><name>moiman2</name><uri>https://www.blogger.com/profile/13815229282181145657</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-746164648252083417' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/746164648252083417' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2089526592'/><gd:extendedProperty name='blogger.displayTime' value='February 12, 2015 at 9:36 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1679215178521063040</id><published>2015-02-12T10:36:08.331-08:00</published><updated>2015-02-12T10:36:08.331-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Patches from Ville Syrjälä to implement atomic wat...</title><content type='html'>Patches from Ville Syrjälä to implement atomic watermark updates have been around for a long time, but need to be rebased.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/746164648252083417/comments/default/1679215178521063040'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/746164648252083417/comments/default/1679215178521063040'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html?showComment=1423766168331#c1679215178521063040' title=''/><link rel='related' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/746164648252083417/comments/default/8393634158064199085'/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/02/neat-drmi915-stuff-for-320.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-746164648252083417' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/746164648252083417' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='February 12, 2015 at 10:36 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7680390636122279792</id><published>2015-09-23T14:27:56.625-07:00</published><updated>2015-09-23T14:27:56.625-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Good work.
I am eager to replace my old Wolfdale s...</title><content type='html'>Good work.&lt;br /&gt;I am eager to replace my old Wolfdale system with Skylake.&lt;br /&gt;</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/7680390636122279792'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/7680390636122279792'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html?showComment=1443043676625#c7680390636122279792' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/07489645000948657126</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5631845111107853206' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5631845111107853206' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1710845871'/><gd:extendedProperty name='blogger.displayTime' value='September 23, 2015 at 2:27 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7988982685864189749</id><published>2015-10-31T18:11:31.935-07:00</published><updated>2015-10-31T18:11:31.935-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Enabling PSR and FBC on my Dell XPS 13 running arc...</title><content type='html'>Enabling PSR and FBC on my Dell XPS 13 running arch linux (4.3 mainline) certainly help with power usage but as stated it causes screen freezes and entire lock ups, so can&amp;#39;t use for now but I would love to see it reach a stable state as some great power advantages. </content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/7988982685864189749'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/7988982685864189749'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html?showComment=1446340291935#c7988982685864189749' title=''/><author><name>harrison-pace</name><uri>https://www.blogger.com/profile/12587604024441011007</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5631845111107853206' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5631845111107853206' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2134559804'/><gd:extendedProperty name='blogger.displayTime' value='October 31, 2015 at 6:11 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2311415272374786045</id><published>2015-11-10T17:53:59.746-08:00</published><updated>2015-11-10T17:53:59.746-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>it looks like the drive has the issues with i945GM...</title><content type='html'>it looks like the drive has the issues with i945GM cards. At least there are several bugs (one is mine) in freedesktop concerning the same issue - horizontal lines and corrupted rendering.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/2311415272374786045'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/5631845111107853206/comments/default/2311415272374786045'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html?showComment=1447206839746#c2311415272374786045' title=''/><author><name>Unknown</name><uri>https://www.blogger.com/profile/10017661691631415276</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/09/neat-drmi915-stuff-for-43.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-5631845111107853206' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/5631845111107853206' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-142921076'/><gd:extendedProperty name='blogger.displayTime' value='November 10, 2015 at 5:53 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-4602339049596244625</id><published>2016-01-14T03:48:06.857-08:00</published><updated>2016-01-14T03:48:06.857-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Will this kernel support QSV (Quick Sync Video) fo...</title><content type='html'>Will this kernel support QSV (Quick Sync Video) for Braswell systems ?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1984383501718899742/comments/default/4602339049596244625'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1984383501718899742/comments/default/4602339049596244625'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html?showComment=1452772086857#c4602339049596244625' title=''/><author><name>R Oort</name><uri>https://www.blogger.com/profile/04527732199297518270</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1984383501718899742' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1984383501718899742' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1373243035'/><gd:extendedProperty name='blogger.displayTime' value='January 14, 2016 at 3:48 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6155848332160338762</id><published>2016-01-14T06:06:19.897-08:00</published><updated>2016-01-14T06:06:19.897-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Open source support for video encode/decode/transc...</title><content type='html'>Open source support for video encode/decode/transcope is provided by libva and should work on all recent platforms. I have no idea whether at all and if/how Intel Marketing sells this ...</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1984383501718899742/comments/default/6155848332160338762'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1984383501718899742/comments/default/6155848332160338762'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html?showComment=1452780379897#c6155848332160338762' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/01/neat-drmi915-stuff-for-45.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1984383501718899742' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1984383501718899742' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='January 14, 2016 at 6:06 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6593069290960964807</id><published>2016-03-02T05:15:52.348-08:00</published><updated>2016-03-02T05:15:52.348-08:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Those instructions (excepting the config target) g...</title><content type='html'>Those instructions (excepting the config target) go back to, uh, almost forever, btw :)  But more importantly, you don&amp;#39;t need to build in your git tree, use separate object directories for everyone:&lt;br /&gt;$ cd ~/kernel/src&lt;br /&gt;$ make O=~/kernel/obj/armhf ARCH=arm ...&lt;br /&gt;$ make O=~/kernel/obj/x8664 ...&lt;br /&gt;$ make O=~/kernel/obj/aarch64 ARCH=aarch64 CROSS_COMPILE=aarch64-linux-gnu-&lt;br /&gt;&lt;br /&gt;And so on and so forth.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1109414631376380336/comments/default/6593069290960964807'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/1109414631376380336/comments/default/6593069290960964807'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/02/arm-kernel-cross-compiling.html?showComment=1456924552348#c6593069290960964807' title=''/><author><name>Tom R</name><uri>https://www.blogger.com/profile/10187446098003499375</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/02/arm-kernel-cross-compiling.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-1109414631376380336' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/1109414631376380336' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-750701458'/><gd:extendedProperty name='blogger.displayTime' value='March 2, 2016 at 5:15 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7090801030709390018</id><published>2016-04-04T13:38:09.967-07:00</published><updated>2016-04-04T13:38:09.967-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Kindly kind of repeating the question by the other...</title><content type='html'>Kindly kind of repeating the question by the other user on the &amp;quot;neat stuff for 4.5&amp;quot; really out loud: Does this include the kernel patches to support Quick Sync transcoding in Linux? Intel media group says out loud that &amp;quot;No, we do not upstream our Media-specific patches to the kernels&amp;quot; (https://software.intel.com/en-us/forums/intel-media-sdk/topic/550989) so it is not about marketing only. Please answer a) Yes patches are includes b) Patches are not included c) I&amp;#39;m not in liberty to tell. FYI there are 0 known implementations of use of the MFX transcoder based on OSS.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6153199226047072843/comments/default/7090801030709390018'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6153199226047072843/comments/default/7090801030709390018'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html?showComment=1459802289967#c7090801030709390018' title=''/><author><name>FFFF</name><uri>https://www.blogger.com/profile/11709629011447923954</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6153199226047072843' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6153199226047072843' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-2117911551'/><gd:extendedProperty name='blogger.displayTime' value='April 4, 2016 at 1:38 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-6862875166552311262</id><published>2016-04-21T18:21:52.432-07:00</published><updated>2016-04-21T18:21:52.432-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>I&amp;#39;m not actually sure if I went through the pr...</title><content type='html'>I&amp;#39;m not actually sure if I went through the process to become an X.org foundation member; how would I check that?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9047795241514036687/comments/default/6862875166552311262'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9047795241514036687/comments/default/6862875166552311262'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html?showComment=1461288112432#c6862875166552311262' title=''/><author><name>Josh Triplett</name><uri>https://www.blogger.com/profile/02593171817329248190</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-9047795241514036687' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/9047795241514036687' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-951655387'/><gd:extendedProperty name='blogger.displayTime' value='April 21, 2016 at 6:21 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-781631829836255757</id><published>2016-04-22T02:30:53.899-07:00</published><updated>2016-04-22T02:30:53.899-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Every member has access to the member list and cou...</title><content type='html'>Every member has access to the member list and could check for you. You&amp;#39;re not a member (shame on you for taht!). Membership also has to be explicitly renewed every year before we start election season.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9047795241514036687/comments/default/781631829836255757'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/9047795241514036687/comments/default/781631829836255757'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html?showComment=1461317453899#c781631829836255757' title=''/><author><name>danvet</name><uri>https://www.blogger.com/profile/00909108918536377323</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/04/xorg-foundation-election-vote-now.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-9047795241514036687' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/9047795241514036687' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-465249735'/><gd:extendedProperty name='blogger.displayTime' value='April 22, 2016 at 2:30 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-7707169606542802291</id><published>2016-04-30T18:50:54.237-07:00</published><updated>2016-04-30T18:50:54.237-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Hi,
I own a netbook with a good old GMA 950 (Gen3 ...</title><content type='html'>Hi,&lt;br /&gt;I own a netbook with a good old GMA 950 (Gen3 or Gen3.5 in Intel glossary) with few hardware decode capabilities (MPEG-2 motion compensation unless I am mistaken, which doesn&amp;#39;t help for DivX movies for instance).&lt;br /&gt;Will that graphical processor benefit from atomic mode-setting so that I can hope for better battery life while watching videos (dealing with YUV videos without RGB conversion is supposed to help) ?&lt;br /&gt;Thanks !</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6153199226047072843/comments/default/7707169606542802291'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/6153199226047072843/comments/default/7707169606542802291'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html?showComment=1462067454237#c7707169606542802291' title=''/><author><name>antistress</name><uri>https://www.blogger.com/profile/00060587754759061413</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/03/neat-drmi915-stuff-for-46.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-6153199226047072843' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/6153199226047072843' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1823180273'/><gd:extendedProperty name='blogger.displayTime' value='April 30, 2016 at 6:50 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-2525308315115265840</id><published>2016-05-03T20:22:51.958-07:00</published><updated>2016-05-03T22:57:08.491-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'></title><content type='html'>This comment has been removed by a blog administrator.</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2572132837736503140/comments/default/2525308315115265840'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/2572132837736503140/comments/default/2525308315115265840'/><author><name>Mkeidn Corzip</name><uri>https://www.blogger.com/profile/06023124555412320326</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2015/08/atomic-modesetting-design-overview.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-2572132837736503140' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/2572132837736503140' type='text/html'/><gd:extendedProperty name='blogger.contentRemoved' value='true'/><gd:extendedProperty name='blogger.itemClass' value='pid-173371732'/><gd:extendedProperty name='blogger.displayTime' value='May 3, 2016 at 8:22 PM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-1230700313993749334</id><published>2016-05-11T09:20:07.681-07:00</published><updated>2016-05-11T09:20:07.681-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>Can DP fixes fix this bug https://bugs.freedesktop...</title><content type='html'>Can DP fixes fix this bug https://bugs.freedesktop.org/show_bug.cgi?id=92442 or DP and DP-MST are different things?</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3142001204592303032/comments/default/1230700313993749334'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3142001204592303032/comments/default/1230700313993749334'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html?showComment=1462983607681#c1230700313993749334' title=''/><author><name>Leinad</name><uri>https://www.blogger.com/profile/04855607262826698038</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3142001204592303032' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3142001204592303032' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-114899893'/><gd:extendedProperty name='blogger.displayTime' value='May 11, 2016 at 9:20 AM'/></entry><entry><id>tag:blogger.com,1999:blog-8047628228132312466.post-8997690404146277037</id><published>2016-05-19T13:22:49.827-07:00</published><updated>2016-05-19T13:22:49.827-07:00</updated><category scheme='http://schemas.google.com/g/2005#kind' term='http://schemas.google.com/blogger/2008/kind#comment'/><title type='text'>It&amp;#39;s now called the hw state verifier. :)</title><content type='html'>It&amp;#39;s now called the hw state verifier. :)</content><link rel='edit' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3142001204592303032/comments/default/8997690404146277037'/><link rel='self' type='application/atom+xml' href='https://www.blogger.com/feeds/8047628228132312466/3142001204592303032/comments/default/8997690404146277037'/><link rel='alternate' type='text/html' href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html?showComment=1463689369827#c8997690404146277037' title=''/><author><name>mlankhorst</name><uri>https://www.blogger.com/profile/10469435152973671732</uri><email>noreply@blogger.com</email><gd:image rel='http://schemas.google.com/g/2005#thumbnail' width='16' height='16' src='//img2.blogblog.com/img/b16-rounded.gif'/></author><thr:in-reply-to href='http://blog.ffwll.ch/2016/05/neat-drmi915-stuff-for-47.html' ref='tag:blogger.com,1999:blog-8047628228132312466.post-3142001204592303032' source='https://www.blogger.com/feeds/8047628228132312466/posts/default/3142001204592303032' type='text/html'/><gd:extendedProperty name='blogger.itemClass' value='pid-1033923729'/><gd:extendedProperty name='blogger.displayTime' value='May 19, 2016 at 1:22 PM'/></entry></feed>